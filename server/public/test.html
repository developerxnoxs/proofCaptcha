<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ProofCaptcha - Test & Validation</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 40px 20px;
    }

    .container {
      max-width: 900px;
      margin: 0 auto;
    }

    h1 {
      text-align: center;
      color: white;
      font-size: 36px;
      margin-bottom: 16px;
    }

    .subtitle {
      text-align: center;
      color: rgba(255, 255, 255, 0.9);
      margin-bottom: 40px;
      font-size: 18px;
    }

    .card {
      background: white;
      border-radius: 16px;
      padding: 32px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      margin-bottom: 24px;
    }

    .card h2 {
      font-size: 24px;
      color: #1f2937;
      margin-bottom: 8px;
    }

    .card p {
      color: #6b7280;
      margin-bottom: 24px;
      font-size: 14px;
    }

    .widget-container {
      display: flex;
      justify-content: center;
      padding: 20px 0;
      margin-bottom: 20px;
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-group label {
      display: block;
      font-weight: 600;
      color: #374151;
      margin-bottom: 8px;
      font-size: 14px;
    }

    .form-group input,
    .form-group textarea {
      width: 100%;
      padding: 12px;
      border: 2px solid #e5e7eb;
      border-radius: 8px;
      font-size: 14px;
      font-family: 'Courier New', monospace;
      transition: border-color 0.2s;
    }

    .form-group input:focus,
    .form-group textarea:focus {
      outline: none;
      border-color: #667eea;
    }

    .form-group textarea {
      resize: vertical;
      min-height: 100px;
    }

    .btn {
      background: #667eea;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      width: 100%;
    }

    .btn:hover {
      background: #5568d3;
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
    }

    .btn:active {
      transform: translateY(0);
    }

    .btn:disabled {
      background: #9ca3af;
      cursor: not-allowed;
      transform: none;
    }

    .result {
      margin-top: 24px;
      padding: 16px;
      border-radius: 8px;
      font-size: 14px;
      display: none;
    }

    .result.success {
      background: #d1fae5;
      color: #059669;
      border: 2px solid #059669;
      display: block;
    }

    .result.error {
      background: #fee2e2;
      color: #dc2626;
      border: 2px solid #dc2626;
      display: block;
    }

    .result strong {
      display: block;
      font-size: 16px;
      margin-bottom: 8px;
    }

    .result pre {
      background: rgba(0, 0, 0, 0.05);
      padding: 12px;
      border-radius: 4px;
      overflow-x: auto;
      margin-top: 8px;
      font-size: 12px;
    }

    .info-box {
      background: #fef3c7;
      border-left: 4px solid #f59e0b;
      padding: 16px;
      border-radius: 8px;
      margin-bottom: 24px;
    }

    .info-box strong {
      color: #92400e;
      display: block;
      margin-bottom: 8px;
    }

    .info-box p {
      color: #78350f;
      font-size: 14px;
      margin: 0;
      line-height: 1.6;
    }

    .info-box code {
      background: rgba(0, 0, 0, 0.1);
      padding: 2px 6px;
      border-radius: 4px;
      font-size: 13px;
    }

    .badge {
      display: inline-block;
      background: #10b981;
      color: white;
      padding: 4px 12px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 600;
      margin-left: 8px;
    }

    .token-display {
      background: #f3f4f6;
      padding: 12px;
      border-radius: 8px;
      margin-top: 12px;
      word-break: break-all;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      color: #374151;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 16px;
      margin-bottom: 24px;
    }

    .stat-card {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 20px;
      border-radius: 12px;
      text-align: center;
    }

    .stat-card h3 {
      font-size: 14px;
      opacity: 0.9;
      margin-bottom: 8px;
    }

    .stat-card .value {
      font-size: 32px;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üîê ProofCaptcha Test & Validation</h1>
    <p class="subtitle">Testing dan validasi token ProofCaptcha</p>

    <div class="info-box">
      <strong>‚ÑπÔ∏è Cara Penggunaan:</strong>
      <p>
        1. Selesaikan challenge CAPTCHA di bawah untuk mendapatkan token<br>
        2. Token akan otomatis muncul setelah verifikasi berhasil<br>
        3. Masukkan <code>secret key</code> Anda (atau gunakan demo secret key)<br>
        4. Klik "Validasi Token" untuk mengecek apakah token valid atau tidak
      </p>
    </div>

    <!-- Statistik -->
    <div class="grid">
      <div class="stat-card">
        <h3>Token Didapatkan</h3>
        <div class="value" id="stat-tokens">0</div>
      </div>
      <div class="stat-card">
        <h3>Validasi Berhasil</h3>
        <div class="value" id="stat-success">0</div>
      </div>
      <div class="stat-card">
        <h3>Validasi Gagal</h3>
        <div class="value" id="stat-failed">0</div>
      </div>
    </div>

    <!-- Anti-Debugger Status -->
    <div class="card" style="border: 2px solid #ef4444;">
      <h2>üõ°Ô∏è Anti-Debugger Protection <span class="badge" style="background: #ef4444;">SECURITY</span></h2>
      <p>Sistem proteksi multi-layer untuk mencegah debugging dan reverse engineering</p>
      
      <div class="grid" style="margin-bottom: 16px;">
        <div class="stat-card" style="background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);">
          <h3>Status Proteksi</h3>
          <div class="value" id="anti-debug-status">AKTIF</div>
        </div>
        <div class="stat-card" style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);">
          <h3>DevTools Detected</h3>
          <div class="value" id="devtools-status">TIDAK</div>
        </div>
      </div>

      <div class="info-box" style="background: #fee2e2; border-color: #ef4444;">
        <strong style="color: #991b1b;">‚ö†Ô∏è Fitur Anti-Debugger:</strong>
        <p style="color: #7f1d1d; margin-top: 8px; font-size: 13px; line-height: 1.8;">
          ‚úì <strong>Debugger Traps</strong> - Infinite loops dengan debugger statement<br>
          ‚úì <strong>Viewport Monitoring</strong> - Deteksi perubahan ukuran window saat DevTools dibuka<br>
          ‚úì <strong>Timing Detection</strong> - Analisis waktu eksekusi untuk deteksi debugging<br>
          ‚úì <strong>Function Integrity</strong> - Cek manipulasi fungsi console<br>
          ‚úì <strong>toString() Traps</strong> - Getter yang trigger saat DevTools inspect object<br>
          ‚úì <strong>Performance Monitoring</strong> - Monitor anomali performa eksekusi<br>
          ‚úì <strong>Console Protection</strong> - Proteksi output console dari manipulation
        </p>
      </div>

      <div class="form-group" style="margin-top: 16px;">
        <label>Kontrol Anti-Debugger (Development Only):</label>
        <div style="display: flex; gap: 12px;">
          <button onclick="enableAntiDebug()" class="btn" style="flex: 1; background: #22c55e;">
            Aktifkan Proteksi
          </button>
          <button onclick="disableAntiDebug()" class="btn" style="flex: 1; background: #ef4444;">
            Nonaktifkan Proteksi
          </button>
          <button onclick="checkAntiDebugStatus()" class="btn" style="flex: 1; background: #3b82f6;">
            Cek Status
          </button>
        </div>
      </div>

      <div id="anti-debug-result" class="result" style="margin-top: 16px;"></div>
    </div>

    <!-- Step 1: Dapatkan Token -->
    <div class="card">
      <h2>Step 1: Dapatkan Token <span class="badge">CAPTCHA</span></h2>
      <p>Selesaikan challenge CAPTCHA untuk mendapatkan token verifikasi</p>
      
      <div class="widget-container">
        <!-- ProofCaptcha Widget akan di-render di sini -->
        <div 
          class="proof-captcha"
          data-sitekey="pk_ab6c4ac2c8976668e6d92fe401386cae18df4c9b4f5193cb140266f6d9546f1c"
          data-theme="light"
          data-type="random"
          data-callback="onCaptchaSuccess"
          data-error-callback="onCaptchaError"
        ></div>
      </div>

      <div id="token-section" style="display: none;">
        <div class="form-group">
          <label>Token Verifikasi:</label>
          <textarea id="token-display" readonly></textarea>
        </div>
      </div>
    </div>

    <!-- Step 2: Validasi Token -->
    <div class="card">
      <h2>Step 2: Validasi Token <span class="badge" style="background: #f59e0b;">VERIFY</span></h2>
      <p>Kirim token dan secret key ke server untuk validasi</p>

      <form id="validation-form">
        <div class="form-group">
          <label>Secret Key:</label>
          <input 
            type="text" 
            id="secret-input" 
            placeholder="Masukkan secret key Anda"
            value="sk_demo_1a2b3c4d5e6f7g8h9i0j1k2l3m4n5o6p7q8r9s0t1u2v3w4x5y6z7a8b9c0d1e2f"
            required
          />
          <small style="color: #6b7280; margin-top: 4px; display: block;">
            Demo secret key sudah terisi otomatis. Ganti dengan secret key Anda jika perlu.
          </small>
        </div>

        <div class="form-group">
          <label>Response Token:</label>
          <textarea 
            id="response-input" 
            placeholder="Token akan otomatis terisi setelah CAPTCHA selesai"
            readonly
            required
          ></textarea>
        </div>

        <button type="submit" class="btn" id="validate-btn" disabled>
          Validasi Token
        </button>
      </form>

      <div id="validation-result" class="result"></div>
    </div>

    <!-- Step 3: Penjelasan Integrasi -->
    <div class="card">
      <h2>üìö Cara Integrasi di Aplikasi Anda</h2>
      <p>Panduan lengkap untuk memvalidasi token CAPTCHA di backend Anda</p>

      <div class="info-box" style="background: #f0fdf4; border-color: #22c55e;">
        <strong style="color: #166534;">‚úÖ Alur Validasi Token:</strong>
        <p style="margin-top: 8px;">
          1. User menyelesaikan CAPTCHA di frontend<br>
          2. Frontend menerima <code>verificationToken</code> dari callback<br>
          3. Kirim token ke backend Anda (misalnya saat submit form)<br>
          4. <strong>Backend memvalidasi token di server ini menggunakan endpoint <code>/proofCaptcha/api/siteverify</code></strong><br>
          5. Jika valid, proses request user (login, register, submit form, dll)
        </p>
      </div>
      
      <div class="info-box" style="background: #e0f2fe; border-color: #0ea5e9;">
        <strong style="color: #075985;">üîí Server-Side Validation:</strong>
        <p style="margin-top: 8px;">
          Token CAPTCHA <strong>HARUS divalidasi di server</strong> (bukan di frontend). 
          Endpoint validasi tersedia di: <code>${window.location.origin}/proofCaptcha/api/siteverify</code>
        </p>
      </div>

      <div class="info-box" style="background: #dbeafe; border-color: #3b82f6;">
        <strong style="color: #1e40af;">üü¶ Node.js/Express Implementation:</strong>
        <pre style="background: #1f2937; color: #e5e7eb; padding: 16px; border-radius: 8px; overflow-x: auto; margin-top: 12px;">
// Endpoint untuk validasi CAPTCHA token
app.post('/api/verify-captcha', async (req, res) => {
  const { captchaToken } = req.body;
  const SECRET_KEY = process.env.CAPTCHA_SECRET_KEY;
  
  try {
    // Validasi token di server ini (localhost atau production)
    // Gunakan URL relatif atau req.protocol + req.get('host')
    const baseUrl = `${req.protocol}://${req.get('host')}`;
    
    const response = await fetch(`${baseUrl}/proofCaptcha/api/siteverify`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        secret: SECRET_KEY,
        response: captchaToken
      })
    });
    
    const data = await response.json();
    
    // Success response:
    // {
    //   "success": true,
    //   "challenge_ts": "2024-01-15T10:30:00.000Z",
    //   "hostname": "example.com"
    // }
    
    // Error response:
    // {
    //   "success": false,
    //   "error-codes": ["timeout-or-duplicate"]
    // }
    
    if (data.success) {
      // Token valid - lanjutkan proses
      console.log('CAPTCHA validated for domain:', data.hostname);
      return res.json({ 
        valid: true, 
        message: 'CAPTCHA verification successful' 
      });
    } else {
      // Token tidak valid
      console.error('CAPTCHA validation failed:', data['error-codes']);
      return res.status(400).json({ 
        valid: false, 
        message: 'CAPTCHA verification failed',
        errors: data['error-codes']
      });
    }
  } catch (error) {
    console.error('CAPTCHA validation error:', error);
    return res.status(500).json({ 
      valid: false, 
      message: 'Server error during CAPTCHA validation' 
    });
  }
});

// Contoh penggunaan di endpoint register/login:
app.post('/api/auth/register', async (req, res) => {
  const { email, password, name, captchaToken } = req.body;
  
  // Validasi CAPTCHA terlebih dahulu
  const captchaValid = await verifyCaptcha(captchaToken);
  if (!captchaValid) {
    return res.status(400).json({ 
      error: 'CAPTCHA validation failed' 
    });
  }
  
  // Lanjutkan proses registrasi...
  // createUser(email, password, name)
});</pre>
      </div>

      <div class="info-box" style="background: #fce7f3; border-color: #ec4899; margin-top: 16px;">
        <strong style="color: #9f1239;">üü™ PHP Implementation:</strong>
        <pre style="background: #1f2937; color: #e5e7eb; padding: 16px; border-radius: 8px; overflow-x: auto; margin-top: 12px;">
&lt;?php
/**
 * Fungsi untuk memvalidasi token CAPTCHA
 */
function verifyCaptcha($token) {
    $secretKey = getenv('CAPTCHA_SECRET_KEY');
    
    // Validasi di server ini - gunakan URL relatif atau $_SERVER
    $protocol = (!empty($_SERVER['HTTPS']) && $_SERVER['HTTPS'] !== 'off') ? 'https' : 'http';
    $host = $_SERVER['HTTP_HOST'];
    $baseUrl = "$protocol://$host";
    
    $data = [
        'secret' => $secretKey,
        'response' => $token
    ];
    
    $options = [
        'http' => [
            'header'  => "Content-type: application/json\r\n",
            'method'  => 'POST',
            'content' => json_encode($data),
            'timeout' => 10
        ]
    ];
    
    try {
        $context = stream_context_create($options);
        $result = file_get_contents(
            "$baseUrl/proofCaptcha/api/siteverify", 
            false, 
            $context
        );
        
        if ($result === false) {
            error_log('CAPTCHA API request failed');
            return false;
        }
        
        $response = json_decode($result);
        
        if ($response->success) {
            error_log('CAPTCHA validated for: ' . $response->hostname);
            return true;
        } else {
            error_log('CAPTCHA validation failed: ' . 
                     implode(', ', $response->{'error-codes'}));
            return false;
        }
    } catch (Exception $e) {
        error_log('CAPTCHA validation exception: ' . $e->getMessage());
        return false;
    }
}

// Contoh penggunaan:
if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    $captchaToken = $_POST['captcha_token'] ?? '';
    
    if (empty($captchaToken)) {
        http_response_code(400);
        echo json_encode([
            'success' => false, 
            'message' => 'CAPTCHA token required'
        ]);
        exit;
    }
    
    if (!verifyCaptcha($captchaToken)) {
        http_response_code(400);
        echo json_encode([
            'success' => false, 
            'message' => 'CAPTCHA verification failed'
        ]);
        exit;
    }
    
    // CAPTCHA valid - lanjutkan proses
    // processRegistration($_POST);
}
?&gt;</pre>
      </div>

      <div class="info-box" style="background: #fef3c7; border-color: #f59e0b; margin-top: 16px;">
        <strong style="color: #92400e;">üü® Python (Flask/Django) Implementation:</strong>
        <pre style="background: #1f2937; color: #e5e7eb; padding: 16px; border-radius: 8px; overflow-x: auto; margin-top: 12px;">
import os
import requests
from flask import Flask, request, jsonify

app = Flask(__name__)

def verify_captcha(token):
    """Validasi token CAPTCHA di server ini"""
    secret_key = os.getenv('CAPTCHA_SECRET_KEY')
    
    # Validasi di server yang sama
    # Gunakan request.host_url untuk mendapatkan base URL
    from flask import request
    base_url = request.host_url.rstrip('/')
    
    try:
        response = requests.post(
            f'{base_url}/proofCaptcha/api/siteverify',
            json={
                'secret': secret_key,
                'response': token
            },
            timeout=10
        )
        
        data = response.json()
        
        if data.get('success'):
            print(f"CAPTCHA validated for: {data.get('hostname')}")
            return True
        else:
            print(f"CAPTCHA failed: {data.get('error-codes')}")
            return False
            
    except Exception as e:
        print(f"CAPTCHA validation error: {str(e)}")
        return False

@app.route('/api/register', methods=['POST'])
def register():
    data = request.get_json()
    captcha_token = data.get('captchaToken')
    
    if not captcha_token:
        return jsonify({
            'success': False,
            'message': 'CAPTCHA token required'
        }), 400
    
    # Validasi CAPTCHA
    if not verify_captcha(captcha_token):
        return jsonify({
            'success': False,
            'message': 'CAPTCHA verification failed'
        }), 400
    
    # CAPTCHA valid - lanjutkan proses registrasi
    # create_user(data)
    
    return jsonify({'success': True})</pre>
      </div>

      <div class="info-box" style="background: #f3e8ff; border-color: #a855f7; margin-top: 16px;">
        <strong style="color: #6b21a8;">‚ö†Ô∏è Error Codes Reference:</strong>
        <p style="margin-top: 8px; font-size: 13px; line-height: 1.6;">
          <code style="background: rgba(0,0,0,0.1); padding: 2px 6px; border-radius: 4px;">missing-input-secret</code> - Secret key tidak disertakan<br>
          <code style="background: rgba(0,0,0,0.1); padding: 2px 6px; border-radius: 4px;">missing-input-response</code> - Response token tidak disertakan<br>
          <code style="background: rgba(0,0,0,0.1); padding: 2px 6px; border-radius: 4px;">invalid-input-secret</code> - Secret key tidak valid atau API key tidak aktif<br>
          <code style="background: rgba(0,0,0,0.1); padding: 2px 6px; border-radius: 4px;">invalid-input-response</code> - Token tidak valid, expired, atau domain mismatch<br>
          <code style="background: rgba(0,0,0,0.1); padding: 2px 6px; border-radius: 4px;">timeout-or-duplicate</code> - Token sudah pernah digunakan atau expired
        </p>
      </div>

      <div class="info-box" style="background: #fff7ed; border-color: #fb923c; margin-top: 16px;">
        <strong style="color: #9a3412;">üí° Best Practices:</strong>
        <p style="margin-top: 8px; font-size: 13px; line-height: 1.8;">
          ‚úì Simpan secret key di environment variable, jangan hardcode<br>
          ‚úì Validasi CAPTCHA di backend SEBELUM memproses data user<br>
          ‚úì Set timeout untuk request ke API (10 detik recommended)<br>
          ‚úì Log hasil validasi untuk monitoring dan debugging<br>
          ‚úì Handle error dengan graceful (jangan expose detail error ke user)<br>
          ‚úì Pastikan domain API key sesuai dengan domain website Anda
        </p>
      </div>

      <div class="info-box" style="background: #dbeafe; border-color: #3b82f6; margin-top: 16px;">
        <strong style="color: #1e40af;">üåê Endpoint Validasi di Server Ini:</strong>
        <p style="margin-top: 8px; font-size: 14px;">
          <strong>URL:</strong> <code id="siteverify-url" style="user-select: all; background: rgba(0,0,0,0.1); padding: 4px 8px; border-radius: 4px; font-size: 12px;"></code><br><br>
          <strong>Method:</strong> POST<br>
          <strong>Content-Type:</strong> application/json<br><br>
          <strong>Request Body:</strong><br>
          <code style="background: rgba(0,0,0,0.1); padding: 4px 8px; border-radius: 4px; display: block; margin-top: 4px;">
            {<br>
            &nbsp;&nbsp;"secret": "your_secret_key",<br>
            &nbsp;&nbsp;"response": "verification_token_from_frontend"<br>
            }
          </code>
        </p>
      </div>
    </div>
  </div>

  <!-- Load ProofCaptcha API -->
  <script src="proofCaptcha/api.js"></script>

  <script>
    // Statistik
    let stats = {
      tokens: 0,
      success: 0,
      failed: 0
    };

    function updateStats() {
      document.getElementById('stat-tokens').textContent = stats.tokens;
      document.getElementById('stat-success').textContent = stats.success;
      document.getElementById('stat-failed').textContent = stats.failed;
    }

    // Callback ketika CAPTCHA berhasil
    function onCaptchaSuccess(token) {
      console.log('CAPTCHA Success! Token:', token);
      
      // Update statistik
      stats.tokens++;
      updateStats();
      
      // Tampilkan token
      document.getElementById('token-section').style.display = 'block';
      document.getElementById('token-display').value = token;
      document.getElementById('response-input').value = token;
      
      // Enable tombol validasi
      document.getElementById('validate-btn').disabled = false;
      
      // Scroll ke form validasi
      document.getElementById('validation-form').scrollIntoView({ behavior: 'smooth', block: 'center' });
    }

    // Callback ketika CAPTCHA error
    function onCaptchaError(error) {
      console.error('CAPTCHA Error:', error);
      alert('CAPTCHA Error: ' + error);
    }

    // Anti-Debugger Functions
    function enableAntiDebug() {
      if (window.ProofCaptcha && window.ProofCaptcha.antiDebug) {
        window.ProofCaptcha.antiDebug.enable();
        updateAntiDebugDisplay();
        showAntiDebugResult('success', 'Anti-Debugger Protection ENABLED', 'Proteksi multi-layer telah diaktifkan. DevTools akan terdeteksi.');
      } else {
        showAntiDebugResult('error', 'Error', 'ProofCaptcha API belum dimuat.');
      }
    }

    function disableAntiDebug() {
      if (window.ProofCaptcha && window.ProofCaptcha.antiDebug) {
        window.ProofCaptcha.antiDebug.disable();
        updateAntiDebugDisplay();
        showAntiDebugResult('success', 'Anti-Debugger Protection DISABLED', 'Proteksi telah dinonaktifkan (hanya untuk development).');
      } else {
        showAntiDebugResult('error', 'Error', 'ProofCaptcha API belum dimuat.');
      }
    }

    function checkAntiDebugStatus() {
      if (window.ProofCaptcha && window.ProofCaptcha.antiDebug) {
        const status = window.ProofCaptcha.antiDebug.getStatus();
        updateAntiDebugDisplay();
        showAntiDebugResult('success', 'Status Anti-Debugger', 
          `Enabled: ${status.enabled ? 'YA' : 'TIDAK'}<br>DevTools Detected: ${status.devtoolsDetected ? 'YA' : 'TIDAK'}`);
      } else {
        showAntiDebugResult('error', 'Error', 'ProofCaptcha API belum dimuat.');
      }
    }

    function updateAntiDebugDisplay() {
      if (window.ProofCaptcha && window.ProofCaptcha.antiDebug) {
        const status = window.ProofCaptcha.antiDebug.getStatus();
        document.getElementById('anti-debug-status').textContent = status.enabled ? 'AKTIF' : 'NONAKTIF';
        document.getElementById('devtools-status').textContent = status.devtoolsDetected ? 'YA' : 'TIDAK';
      }
    }

    function showAntiDebugResult(type, title, message) {
      const resultDiv = document.getElementById('anti-debug-result');
      resultDiv.className = `result ${type}`;
      resultDiv.innerHTML = `<strong>${title}</strong><p>${message}</p>`;
    }

    // Update status setiap 2 detik
    setInterval(updateAntiDebugDisplay, 2000);
    
    // Update pertama kali saat halaman dimuat
    setTimeout(updateAntiDebugDisplay, 1000);

    // Form validasi
    document.getElementById('validation-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const secretKey = document.getElementById('secret-input').value;
      const responseToken = document.getElementById('response-input').value;
      const resultDiv = document.getElementById('validation-result');
      const validateBtn = document.getElementById('validate-btn');
      
      if (!secretKey || !responseToken) {
        alert('Secret key dan response token harus diisi!');
        return;
      }
      
      // Disable tombol sementara
      validateBtn.disabled = true;
      validateBtn.textContent = 'Memvalidasi...';
      
      try {
        // Kirim request ke siteverify endpoint
        const response = await fetch('/proofCaptcha/api/siteverify', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            secret: secretKey,
            response: responseToken
          })
        });
        
        const data = await response.json();
        
        // Tampilkan hasil
        if (data.success) {
          stats.success++;
          updateStats();
          
          resultDiv.className = 'result success';
          resultDiv.innerHTML = `
            <strong>‚úì Token Valid!</strong>
            <p>CAPTCHA berhasil diverifikasi. Token ini sah dan belum pernah digunakan.</p>
            <strong style="margin-top: 12px;">Detail:</strong>
            <pre>${JSON.stringify(data, null, 2)}</pre>
          `;
        } else {
          stats.failed++;
          updateStats();
          
          resultDiv.className = 'result error';
          resultDiv.innerHTML = `
            <strong>‚úó Token Tidak Valid!</strong>
            <p>Validasi gagal. Token mungkin sudah digunakan, kadaluarsa, atau secret key salah.</p>
            <strong style="margin-top: 12px;">Error:</strong>
            <pre>${JSON.stringify(data, null, 2)}</pre>
          `;
        }
        
        // Scroll ke hasil
        resultDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });
        
      } catch (error) {
        stats.failed++;
        updateStats();
        
        console.error('Validation error:', error);
        resultDiv.className = 'result error';
        resultDiv.innerHTML = `
          <strong>‚úó Error!</strong>
          <p>Terjadi kesalahan saat validasi: ${error.message}</p>
        `;
      } finally {
        validateBtn.disabled = false;
        validateBtn.textContent = 'Validasi Token';
      }
    });

    // Log ketika ProofCaptcha ready
    ProofCaptcha.ready(function() {
      console.log('ProofCaptcha API ready!');
      console.log('Auto-rendered widgets:', document.querySelectorAll('.proof-captcha').length);
    });

    // Populate siteverify URL
    document.addEventListener('DOMContentLoaded', function() {
      const siteverifyUrl = window.location.origin + '/proofCaptcha/api/siteverify';
      const urlElement = document.getElementById('siteverify-url');
      if (urlElement) {
        urlElement.textContent = siteverifyUrl;
      }
    });
  </script>
</body>
</html>
