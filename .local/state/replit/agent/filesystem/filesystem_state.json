{"file_contents":{"client/src/components/ui/popover.tsx":{"content":"import * as React from \"react\"\nimport * as PopoverPrimitive from \"@radix-ui/react-popover\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Popover = PopoverPrimitive.Root\n\nconst PopoverTrigger = PopoverPrimitive.Trigger\n\nconst PopoverContent = React.forwardRef<\n  React.ElementRef<typeof PopoverPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <PopoverPrimitive.Portal>\n    <PopoverPrimitive.Content\n      ref={ref}\n      align={align}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </PopoverPrimitive.Portal>\n))\nPopoverContent.displayName = PopoverPrimitive.Content.displayName\n\nexport { Popover, PopoverTrigger, PopoverContent }\n","size_bytes":1280},"client/src/components/ui/command.tsx":{"content":"import * as React from \"react\"\nimport { type DialogProps } from \"@radix-ui/react-dialog\"\nimport { Command as CommandPrimitive } from \"cmdk\"\nimport { Search } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Dialog, DialogContent } from \"@/components/ui/dialog\"\n\nconst Command = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nCommand.displayName = CommandPrimitive.displayName\n\nconst CommandDialog = ({ children, ...props }: DialogProps) => {\n  return (\n    <Dialog {...props}>\n      <DialogContent className=\"overflow-hidden p-0 shadow-lg\">\n        <Command className=\"[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5\">\n          {children}\n        </Command>\n      </DialogContent>\n    </Dialog>\n  )\n}\n\nconst CommandInput = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Input>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>\n>(({ className, ...props }, ref) => (\n  <div className=\"flex items-center border-b px-3\" cmdk-input-wrapper=\"\">\n    <Search className=\"mr-2 h-4 w-4 shrink-0 opacity-50\" />\n    <CommandPrimitive.Input\n      ref={ref}\n      className={cn(\n        \"flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    />\n  </div>\n))\n\nCommandInput.displayName = CommandPrimitive.Input.displayName\n\nconst CommandList = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.List\n    ref={ref}\n    className={cn(\"max-h-[300px] overflow-y-auto overflow-x-hidden\", className)}\n    {...props}\n  />\n))\n\nCommandList.displayName = CommandPrimitive.List.displayName\n\nconst CommandEmpty = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Empty>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Empty>\n>((props, ref) => (\n  <CommandPrimitive.Empty\n    ref={ref}\n    className=\"py-6 text-center text-sm\"\n    {...props}\n  />\n))\n\nCommandEmpty.displayName = CommandPrimitive.Empty.displayName\n\nconst CommandGroup = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Group>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Group>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Group\n    ref={ref}\n    className={cn(\n      \"overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandGroup.displayName = CommandPrimitive.Group.displayName\n\nconst CommandSeparator = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nCommandSeparator.displayName = CommandPrimitive.Separator.displayName\n\nconst CommandItem = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandItem.displayName = CommandPrimitive.Item.displayName\n\nconst CommandShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nCommandShortcut.displayName = \"CommandShortcut\"\n\nexport {\n  Command,\n  CommandDialog,\n  CommandInput,\n  CommandList,\n  CommandEmpty,\n  CommandGroup,\n  CommandItem,\n  CommandShortcut,\n  CommandSeparator,\n}\n","size_bytes":4885},"server/public/proofCaptcha/api.js":{"content":"/**\n * ProofCaptcha Widget Library - Unified API\n * Standalone JavaScript matching React/Tailwind styling from CaptchaWidget.tsx\n * \n * Features:\n * - Multiple challenge types (grid, jigsaw, gesture, upside_down)\n * - Proof of Work security system\n * - Auto-render support with data attributes\n * - Global API (render, reset, getResponse, ready)\n * - Theme customization (light/dark/auto)\n * - Responsive design\n * - Automation detection\n * - Multi-layered Anti-Debugger Protection:\n *   ‚Ä¢ Debugger traps with randomized intervals\n *   ‚Ä¢ Viewport and window size monitoring\n *   ‚Ä¢ Timing-based detection\n *   ‚Ä¢ Function integrity checks\n *   ‚Ä¢ toString() traps for DevTools inspection\n *   ‚Ä¢ Performance monitoring\n *   ‚Ä¢ Console protection\n * \n * Anti-Debugger API:\n * - ProofCaptcha.antiDebug.enable() - Enable anti-debugger protection\n * - ProofCaptcha.antiDebug.disable() - Disable anti-debugger (development only)\n * - ProofCaptcha.antiDebug.getStatus() - Get current protection status\n * \n * @version 3.2.2\n */\n(function(window) {\n  'use strict';\n\n  // ==========================================\n  // CONFIGURATION\n  // ==========================================\n  \n  // Detect API base URL from the script tag source\n  function getApiBase() {\n    const scripts = document.getElementsByTagName('script');\n    for (let i = 0; i < scripts.length; i++) {\n      const src = scripts[i].src;\n      if (src && (src.includes('/api.js') || src.includes('/captcha.js'))) {\n        try {\n          const url = new URL(src);\n          // FIXED BUG #5: Validate origin to prevent XSS\n          // Only allow http:// and https:// protocols\n          if (url.protocol === 'http:' || url.protocol === 'https:') {\n            return url.origin;\n          }\n          console.warn('ProofCaptcha: Invalid protocol in script URL, using fallback');\n        } catch (e) {\n          console.error('ProofCaptcha: Failed to parse script URL', e);\n        }\n      }\n    }\n    return window.location.origin;\n  }\n\n  const API_BASE_URL = getApiBase();\n  const MAX_POW_ATTEMPTS = 10000000;\n  const PROGRESS_UPDATE_INTERVAL = 1000;\n  const WIDGET_CLASS = 'proof-captcha';\n  \n  // Widget management\n  const widgets = new Map();\n  let widgetCounter = 0;\n  let cssLoaded = false;\n\n  // ==========================================\n  // ANTI-DEBUGGER PROTECTION\n  // ==========================================\n  \n  /**\n   * Multi-layered anti-debugger protection system\n   * Detects and prevents DevTools usage\n   */\n  const AntiDebugger = {\n    enabled: false, // Default to disabled, will be enabled based on API key settings\n    devtoolsOpen: false,\n    initialized: false,\n    \n    /**\n     * Initialize all anti-debugging protection layers\n     */\n    init: function() {\n      if (!this.enabled || this.initialized) return;\n      \n      this.initialized = true;\n      this.startDebuggerTraps();\n      this.startViewportMonitoring();\n      this.startTimingChecks();\n      this.startFunctionIntegrityChecks();\n      this.startToStringTraps();\n      this.startPerformanceMonitoring();\n      this.protectConsole();\n      console.log('[ANTI-DEBUGGER] Protection layers initialized');\n    },\n    \n    /**\n     * Enable anti-debugger protection\n     */\n    enable: function() {\n      this.enabled = true;\n      if (!this.initialized) {\n        this.init();\n      }\n      console.log('[ANTI-DEBUGGER] Protection enabled');\n    },\n    \n    /**\n     * Layer 1: Debugger traps with randomized intervals\n     */\n    startDebuggerTraps: function() {\n      const trap1 = () => {\n        (function() {return false;})['constructor']('debugger')['call']();\n      };\n      \n      const trap2 = () => {\n        const code = Function.prototype.constructor;\n        code('debugger')();\n      };\n      \n      setInterval(() => {\n        try {\n          trap1();\n        } catch(e) {}\n      }, Math.random() * 800 + 200);\n      \n      setInterval(() => {\n        try {\n          trap2();\n        } catch(e) {}\n      }, Math.random() * 1200 + 300);\n      \n      const self = this;\n      setInterval(() => {\n        const check = /./;\n        check.toString = function() {\n          self.devtoolsOpen = true;\n          return 'check';\n        };\n        try {\n          (function(){}).constructor(\"debugger\")();\n        } catch(e) {}\n      }, 500);\n    },\n    \n    /**\n     * Layer 2: Viewport and window size monitoring\n     */\n    startViewportMonitoring: function() {\n      const checkViewport = () => {\n        const widthThreshold = window.outerWidth - window.innerWidth > 160;\n        const heightThreshold = window.outerHeight - window.innerHeight > 160;\n        const orientation = window.screen && window.screen.orientation;\n        \n        if (widthThreshold || heightThreshold) {\n          this.devtoolsOpen = true;\n          this.triggerProtection('viewport');\n        }\n      };\n      \n      setInterval(checkViewport, 1000);\n      window.addEventListener('resize', checkViewport);\n    },\n    \n    /**\n     * Layer 3: Timing-based detection\n     */\n    startTimingChecks: function() {\n      const timingSelf = this;\n      setInterval(() => {\n        const start = performance.now();\n        (function(){}).constructor(\"debugger\")();\n        const end = performance.now();\n        \n        if (end - start > 100) {\n          timingSelf.devtoolsOpen = true;\n          timingSelf.triggerProtection('timing');\n        }\n      }, 2000);\n    },\n    \n    /**\n     * Layer 4: Function integrity checks\n     */\n    startFunctionIntegrityChecks: function() {\n      const originalLog = console.log.toString();\n      const originalWarn = console.warn.toString();\n      const originalError = console.error.toString();\n      \n      setInterval(() => {\n        if (console.log.toString() !== originalLog ||\n            console.warn.toString() !== originalWarn ||\n            console.error.toString() !== originalError) {\n          this.triggerProtection('integrity');\n        }\n      }, 3000);\n    },\n    \n    /**\n     * Layer 5: toString() traps\n     */\n    startToStringTraps: function() {\n      const detectObject = {};\n      let consoleDetected = false;\n      \n      Object.defineProperty(detectObject, 'toString', {\n        get: function() {\n          consoleDetected = true;\n          this.devtoolsOpen = true;\n          this.triggerProtection('toString');\n          return '';\n        }.bind(this)\n      });\n      \n      setInterval(() => {\n        console.log('%c', detectObject);\n      }, 5000);\n      \n      const element = document.createElement('div');\n      Object.defineProperty(element, 'id', {\n        get: function() {\n          this.devtoolsOpen = true;\n          this.triggerProtection('element-inspect');\n          return 'captcha-element';\n        }.bind(this)\n      });\n      \n      setInterval(() => {\n        console.log(element);\n      }, 4000);\n    },\n    \n    /**\n     * Layer 6: Performance monitoring\n     */\n    startPerformanceMonitoring: function() {\n      let lastTime = performance.now();\n      \n      const perfSelf = this;\n      setInterval(() => {\n        const currentTime = performance.now();\n        const delta = currentTime - lastTime;\n        \n        if (delta > 2000) {\n          perfSelf.devtoolsOpen = true;\n          perfSelf.triggerProtection('performance');\n        }\n        \n        lastTime = currentTime;\n      }, 1000);\n    },\n    \n    /**\n     * Console protection and redirection\n     */\n    protectConsole: function() {\n      const noop = function() {};\n      const methods = ['log', 'debug', 'info', 'warn', 'error', 'table', 'trace', 'dir', 'group', 'groupEnd', 'clear'];\n      \n      if (typeof window !== 'undefined' && window.console) {\n        methods.forEach(method => {\n          const original = console[method];\n          console[method] = function(...args) {\n            if (args.length > 0 && typeof args[0] === 'string') {\n              if (args[0].includes('[ENCRYPTION]') || \n                  args[0].includes('ProofCaptcha') ||\n                  args[0] === '%c') {\n                return;\n              }\n            }\n            try {\n              original.apply(console, args);\n            } catch(e) {}\n          };\n        });\n      }\n    },\n    \n    /**\n     * Trigger protection response - Show CHEATERS warning with police animation\n     */\n    triggerProtection: function(reason) {\n      if (!this.enabled || !this.devtoolsOpen) return;\n      \n      const actions = [\n        () => {\n          // Hide overlay if open\n          document.querySelectorAll('.proofcaptcha-overlay').forEach(el => {\n            if (el) el.style.display = 'none';\n          });\n        },\n        () => {\n          // Change widget to \"cheater mode\" - Premium visual transformation\n          document.querySelectorAll('.proofcaptcha-widget').forEach(widget => {\n            if (!widget) return;\n            \n            // Remove blur if any\n            widget.style.filter = 'none';\n            \n            const logo = widget.querySelector('.proofcaptcha-logo');\n            const text = widget.querySelector('.proofcaptcha-text');\n            const checkboxContainer = widget.querySelector('.proofcaptcha-checkbox-container');\n            \n            if (logo) {\n              // Anti-cheater image\n              logo.className = 'proofcaptcha-logo cheater';\n              logo.innerHTML = `\n                <img src=\"${API_BASE_URL}/assets/crack.png\" \n                     alt=\"No Cheating\" \n                     style=\"\n                       width: 80px; \n                       height: 80px; \n                       object-fit: contain;\n                       animation: pc-pulse-intense 0.8s ease-in-out infinite;\n                       filter: drop-shadow(0 0 20px rgba(220, 38, 38, 0.6));\n                     \"\n                     onerror=\"console.error('Failed to load anti-cheater image'); this.style.display='none';\" />\n              `;\n            }\n            \n            if (text) {\n              // CHEATERS!! text with gradient animation\n              text.innerHTML = `\n                <div class=\"proofcaptcha-cheater-text\">CHEATERS!!</div>\n                <div class=\"proofcaptcha-cheater-subtitle\">Debugging Detected</div>\n              `;\n            }\n            \n            if (checkboxContainer) {\n              // Replace checkbox with animated warning icon\n              checkboxContainer.innerHTML = `\n                <div class=\"proofcaptcha-icon-container cheater\">\n                  <svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"#ef4444\" stroke-width=\"2.5\">\n                    <path d=\"M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z\"/>\n                    <line x1=\"12\" y1=\"9\" x2=\"12\" y2=\"13\"/>\n                    <line x1=\"12\" y1=\"17\" x2=\"12.01\" y2=\"17\"/>\n                  </svg>\n                </div>\n              `;\n              \n              // Add click handler for police animation\n              const iconContainer = checkboxContainer.querySelector('.proofcaptcha-icon-container');\n              if (iconContainer && !iconContainer.hasAttribute('data-police-handler')) {\n                iconContainer.setAttribute('data-police-handler', 'true');\n                \n                iconContainer.addEventListener('click', () => {\n                  this.showPoliceAnimation(widget);\n                });\n              }\n            }\n            \n            // Change footer to cheater warning message\n            const footer = widget.querySelector('.proofcaptcha-footer');\n            if (footer) {\n              footer.innerHTML = `\n                <span class=\"proofcaptcha-footer-message\" style=\"text-align: center; width: 100%; display: block;\">‚ö†Ô∏è Cheating detected? Your activity is being monitored.</span>\n              `;\n            }\n            \n            // Add cheater mode class to widget for premium styling\n            widget.classList.add('proofcaptcha-cheater-mode');\n          });\n        },\n        () => {\n          // Dispatch tamper event\n          const evt = new Event('captcha_tamper_detected');\n          document.dispatchEvent(evt);\n        }\n      ];\n      \n      actions.forEach(action => {\n        try {\n          action();\n        } catch(e) {}\n      });\n    },\n    \n    /**\n     * Show premium police catching attacker animation\n     */\n    showPoliceAnimation: function(widget) {\n      // FIXED BUG #4 (REGRESSION FIX): Clear timers AND remove existing overlay to prevent DOM leak\n      // This prevents stacked overlays when animation is re-triggered rapidly\n      if (widget._policeAnimationTimer1) {\n        clearTimeout(widget._policeAnimationTimer1);\n        widget._policeAnimationTimer1 = null;\n      }\n      if (widget._policeAnimationTimer2) {\n        clearTimeout(widget._policeAnimationTimer2);\n        widget._policeAnimationTimer2 = null;\n      }\n      \n      // Remove any existing police overlay to prevent stacking\n      const existingOverlay = widget.querySelector('.proofcaptcha-police-overlay');\n      if (existingOverlay) {\n        existingOverlay.remove();\n      }\n      \n      // Create overlay with CSS class\n      const animationOverlay = document.createElement('div');\n      animationOverlay.className = 'proofcaptcha-police-overlay';\n      \n      // Animation content dengan positioning yang jelas\n      animationOverlay.innerHTML = `\n        <div style=\"\n          position: relative;\n          width: 100%;\n          height: 100%;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n        \">\n          <div class=\"police-car\">üöîüëÆ‚Äç‚ôÇÔ∏è</div>\n          <div class=\"attacker-icon\">\n            <div style=\"position: relative; display: inline-block;\">\n              <span style=\"font-size: 32px;\">üßë‚Äçüíª</span>\n              <span style=\"\n                position: absolute;\n                top: -5px;\n                right: -5px;\n                font-size: 20px;\n                animation: pc-pulse-scale 0.5s ease-in-out infinite;\n              \">üö´</span>\n            </div>\n          </div>\n          <div class=\"stop-sign\">üõë</div>\n        </div>\n      `;\n      \n      widget.style.position = 'relative';\n      widget.appendChild(animationOverlay);\n      \n      // FIXED BUG #4: Store timer IDs to prevent memory leak\n      // These can be cleared when widget is destroyed\n      widget._policeAnimationTimer1 = setTimeout(() => {\n        animationOverlay.style.opacity = '0';\n        animationOverlay.style.transition = 'opacity 0.3s ease-out';\n        widget._policeAnimationTimer2 = setTimeout(() => {\n          animationOverlay.remove();\n          widget._policeAnimationTimer1 = null;\n          widget._policeAnimationTimer2 = null;\n        }, 300);\n      }, 2000);\n    },\n    \n    /**\n     * Clear police animation timers from widget AND remove overlay\n     */\n    clearPoliceAnimationTimers: function(widget) {\n      // Clear timers\n      if (widget._policeAnimationTimer1) {\n        clearTimeout(widget._policeAnimationTimer1);\n        widget._policeAnimationTimer1 = null;\n      }\n      if (widget._policeAnimationTimer2) {\n        clearTimeout(widget._policeAnimationTimer2);\n        widget._policeAnimationTimer2 = null;\n      }\n      \n      // Remove overlay DOM element to prevent orphaned nodes\n      const existingOverlay = widget.querySelector('.proofcaptcha-police-overlay');\n      if (existingOverlay) {\n        existingOverlay.remove();\n      }\n    },\n    \n    /**\n     * Disable anti-debugger (for development only)\n     */\n    disable: function() {\n      this.enabled = false;\n      this.devtoolsOpen = false;\n      console.log('[ANTI-DEBUGGER] Protection disabled');\n    },\n    \n    /**\n     * Get current protection status\n     */\n    getStatus: function() {\n      return {\n        enabled: this.enabled,\n        initialized: this.initialized,\n        devtoolsOpen: this.devtoolsOpen\n      };\n    }\n  };\n  \n  // DO NOT auto-initialize - wait for security config from server\n  // AntiDebugger will be enabled based on API key settings\n\n  // ==========================================\n  // CSS LOADING\n  // ==========================================\n  \n  function loadCSS() {\n    if (cssLoaded) return;\n    \n    // Check if CSS is already loaded\n    const existingLink = document.querySelector('link[href*=\"proofcaptcha-widget.css\"]');\n    if (existingLink) {\n      cssLoaded = true;\n      return;\n    }\n    \n    // Create and append link element\n    const link = document.createElement('link');\n    link.rel = 'stylesheet';\n    link.href = `${API_BASE_URL}/proofCaptcha/proofcaptcha-widget.css`;\n    document.head.appendChild(link);\n    cssLoaded = true;\n  }\n\n  // ==========================================\n  // ENCRYPTION MODULE\n  // ==========================================\n\n  /**\n   * End-to-end encryption using ECDH + HKDF + AES-GCM\n   * Provides progressive enhancement - falls back to plaintext if unavailable\n   */\n  const EncryptionManager = {\n    currentSession: null,\n\n    /**\n     * Check if Web Crypto API is available\n     */\n    isAvailable: function() {\n      return typeof crypto !== 'undefined' && \n             typeof crypto.subtle !== 'undefined' &&\n             typeof crypto.getRandomValues !== 'undefined';\n    },\n\n    /**\n     * Utility: ArrayBuffer to Base64\n     */\n    arrayBufferToBase64: function(buffer) {\n      const bytes = new Uint8Array(buffer);\n      let binary = '';\n      for (let i = 0; i < bytes.byteLength; i++) {\n        binary += String.fromCharCode(bytes[i]);\n      }\n      return btoa(binary);\n    },\n\n    /**\n     * Utility: Base64 to ArrayBuffer\n     */\n    base64ToArrayBuffer: function(base64) {\n      const binary = atob(base64);\n      const bytes = new Uint8Array(binary.length);\n      for (let i = 0; i < binary.length; i++) {\n        bytes[i] = binary.charCodeAt(i);\n      }\n      return bytes.buffer;\n    },\n\n    /**\n     * Generate client ECDH key pair (P-256)\n     */\n    generateKeyPair: async function() {\n      return await crypto.subtle.generateKey(\n        { name: 'ECDH', namedCurve: 'P-256' },\n        true,\n        ['deriveKey', 'deriveBits']\n      );\n    },\n\n    /**\n     * Export public key to raw format\n     */\n    exportPublicKey: async function(publicKey) {\n      return await crypto.subtle.exportKey('raw', publicKey);\n    },\n\n    /**\n     * Import server public key from raw format\n     */\n    importServerPublicKey: async function(rawKey) {\n      return await crypto.subtle.importKey(\n        'raw',\n        rawKey,\n        { name: 'ECDH', namedCurve: 'P-256' },\n        true,\n        []\n      );\n    },\n\n    /**\n     * Derive shared secret using ECDH\n     */\n    deriveSharedSecret: async function(clientPrivateKey, serverPublicKey) {\n      return await crypto.subtle.deriveBits(\n        { name: 'ECDH', public: serverPublicKey },\n        clientPrivateKey,\n        256\n      );\n    },\n\n    /**\n     * Derive master session key from ECDH shared secret using HKDF\n     */\n    deriveMasterKey: async function(sharedSecret, serverPublicKey, serverNonce) {\n      const encoder = new TextEncoder();\n      const nonceBytes = encoder.encode(serverNonce);\n      const salt = new Uint8Array(serverPublicKey.byteLength + nonceBytes.length);\n      salt.set(new Uint8Array(serverPublicKey), 0);\n      salt.set(nonceBytes, serverPublicKey.byteLength);\n\n      const baseKey = await crypto.subtle.importKey(\n        'raw',\n        sharedSecret,\n        'HKDF',\n        false,\n        ['deriveKey']\n      );\n\n      return await crypto.subtle.deriveKey(\n        {\n          name: 'HKDF',\n          hash: 'SHA-256',\n          salt: salt,\n          info: encoder.encode('captcha-session-v1'),\n        },\n        baseKey,\n        { name: 'AES-GCM', length: 256 },\n        true, // MUST be extractable for child key derivation\n        ['encrypt', 'decrypt']\n      );\n    },\n\n    /**\n     * Derive child key for per-challenge encryption\n     */\n    deriveChildKey: async function(masterKey, challengeId, direction) {\n      const encoder = new TextEncoder();\n      \n      // Hash the challenge ID to ensure it's always short (64 hex chars)\n      // This prevents HKDF info parameter from exceeding 1024 byte limit\n      const challengeIdBuffer = encoder.encode(challengeId);\n      const hashBuffer = await crypto.subtle.digest('SHA-256', challengeIdBuffer);\n      const hashArray = Array.from(new Uint8Array(hashBuffer));\n      const challengeIdHash = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');\n      \n      const info = `captcha-challenge-v1:${direction}:${challengeIdHash}`;\n\n      const masterKeyBits = await crypto.subtle.exportKey('raw', masterKey);\n      const hkdfKey = await crypto.subtle.importKey(\n        'raw',\n        masterKeyBits,\n        'HKDF',\n        false,\n        ['deriveKey']\n      );\n\n      return await crypto.subtle.deriveKey(\n        {\n          name: 'HKDF',\n          hash: 'SHA-256',\n          salt: new Uint8Array(0),\n          info: encoder.encode(info),\n        },\n        hkdfKey,\n        { name: 'AES-GCM', length: 256 },\n        false,\n        ['encrypt', 'decrypt']\n      );\n    },\n\n    /**\n     * Encrypt payload using AES-256-GCM\n     */\n    encryptPayload: async function(plaintext, key, additionalData) {\n      const iv = crypto.getRandomValues(new Uint8Array(12));\n      const encoder = new TextEncoder();\n      const plaintextBuffer = typeof plaintext === 'string' \n        ? encoder.encode(plaintext)\n        : new Uint8Array(plaintext);\n\n      const algorithm = { name: 'AES-GCM', iv: iv, tagLength: 128 };\n      if (additionalData) {\n        algorithm.additionalData = encoder.encode(additionalData);\n      }\n\n      const ciphertext = await crypto.subtle.encrypt(algorithm, key, plaintextBuffer);\n      const ciphertextArray = new Uint8Array(ciphertext);\n      const ciphertextOnly = ciphertextArray.slice(0, -16);\n      const tag = ciphertextArray.slice(-16);\n\n      return {\n        ciphertext: this.arrayBufferToBase64(ciphertextOnly),\n        iv: this.arrayBufferToBase64(iv),\n        tag: this.arrayBufferToBase64(tag),\n      };\n    },\n\n    /**\n     * Decrypt payload using AES-256-GCM\n     */\n    decryptPayload: async function(encrypted, key, additionalData) {\n      try {\n        if (!encrypted || !encrypted.iv || !encrypted.ciphertext || !encrypted.tag) {\n          console.error('[ENCRYPTION] Invalid encrypted payload structure:', encrypted);\n          return null;\n        }\n        \n        const iv = this.base64ToArrayBuffer(encrypted.iv);\n        const ciphertext = this.base64ToArrayBuffer(encrypted.ciphertext);\n        const tag = this.base64ToArrayBuffer(encrypted.tag);\n\n        const combined = new Uint8Array(ciphertext.byteLength + tag.byteLength);\n        combined.set(new Uint8Array(ciphertext), 0);\n        combined.set(new Uint8Array(tag), ciphertext.byteLength);\n\n        const encoder = new TextEncoder();\n        const algorithm = { name: 'AES-GCM', iv: iv, tagLength: 128 };\n        if (additionalData) {\n          algorithm.additionalData = encoder.encode(additionalData);\n        }\n\n        const plaintext = await crypto.subtle.decrypt(algorithm, key, combined);\n        return plaintext;\n      } catch (error) {\n        console.error('[ENCRYPTION] Decryption failed:', error);\n        console.error('[ENCRYPTION] Error details:', error.message, error.stack);\n        console.error('[ENCRYPTION] Payload structure:', {\n          hasIv: !!encrypted?.iv,\n          hasCiphertext: !!encrypted?.ciphertext,\n          hasTag: !!encrypted?.tag,\n          additionalData: additionalData\n        });\n        return null;\n      }\n    },\n\n    /**\n     * Perform handshake with server\n     */\n    performHandshake: async function(publicKey) {\n      if (!this.isAvailable()) {\n        return null;\n      }\n\n      try {\n        const clientKeyPair = await this.generateKeyPair();\n        const clientPublicKeyRaw = await this.exportPublicKey(clientKeyPair.publicKey);\n\n        const response = await fetch(`${API_BASE_URL}/api/captcha/handshake`, {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify({\n            publicKey: publicKey,\n            clientPublicKey: this.arrayBufferToBase64(clientPublicKeyRaw),\n          }),\n          credentials: 'include',\n        });\n\n        // FIXED BUG #3: Enhanced error handling with detailed logging\n        if (!response.ok) {\n          let errorMessage = 'Unknown error';\n          try {\n            const errorData = await response.json();\n            errorMessage = errorData.error || errorData.message || errorMessage;\n          } catch (e) {\n            errorMessage = response.statusText || errorMessage;\n          }\n          console.error(`[ENCRYPTION] Handshake failed: HTTP ${response.status} - ${errorMessage}`);\n          return null;\n        }\n\n        const handshakeData = await response.json();\n        const serverPublicKeyRaw = this.base64ToArrayBuffer(handshakeData.serverPublicKey);\n        const serverPublicKey = await this.importServerPublicKey(serverPublicKeyRaw);\n\n        const sharedSecret = await this.deriveSharedSecret(\n          clientKeyPair.privateKey,\n          serverPublicKey\n        );\n\n        const masterKey = await this.deriveMasterKey(\n          sharedSecret,\n          serverPublicKeyRaw,\n          handshakeData.nonce\n        );\n\n        const session = {\n          masterKey: masterKey,\n          timestamp: handshakeData.timestamp,\n          expiresAt: Date.now() + (handshakeData.expiresIn * 1000),\n          nonce: handshakeData.nonce,\n        };\n\n        this.currentSession = session;\n        console.log('[ENCRYPTION] Session established');\n        return session;\n      } catch (error) {\n        console.error('[ENCRYPTION] Handshake error:', error);\n        return null;\n      }\n    },\n\n    /**\n     * Get or create session\n     */\n    ensureSession: async function(publicKey) {\n      if (this.currentSession && Date.now() < this.currentSession.expiresAt) {\n        return this.currentSession;\n      }\n      return await this.performHandshake(publicKey);\n    },\n\n    /**\n     * Decrypt challenge data\n     */\n    decryptChallenge: async function(encrypted, challengeId, publicKey) {\n      // Ensure session is valid before decryption\n      const session = await this.ensureSession(publicKey);\n      if (!session) {\n        console.error('[ENCRYPTION] No valid session for decryption');\n        return null;\n      }\n\n      const childKey = await this.deriveChildKey(\n        session.masterKey,\n        challengeId,\n        'encrypt'\n      );\n      \n      const plaintext = await this.decryptPayload(encrypted, childKey, challengeId);\n\n      if (!plaintext) {\n        console.error('[ENCRYPTION] Decryption failed - invalid payload or key');\n        return null;\n      }\n\n      try {\n        const decoder = new TextDecoder();\n        const decoded = JSON.parse(decoder.decode(plaintext));\n        console.log('[ENCRYPTION] Challenge decrypted successfully');\n        return decoded;\n      } catch (error) {\n        console.error('[ENCRYPTION] Failed to parse decrypted data:', error);\n        return null;\n      }\n    },\n\n    /**\n     * Decrypt security config data\n     * Uses dedicated 'config' direction for key separation\n     */\n    decryptSecurityConfig: async function(encrypted, challengeId, publicKey) {\n      // Ensure session is valid before decryption\n      const session = await this.ensureSession(publicKey);\n      if (!session) {\n        console.error('[ENCRYPTION] No valid session for security config decryption');\n        return null;\n      }\n\n      const childKey = await this.deriveChildKey(\n        session.masterKey,\n        challengeId,\n        'config'\n      );\n      \n      const plaintext = await this.decryptPayload(encrypted, childKey, challengeId);\n\n      if (!plaintext) {\n        console.error('[ENCRYPTION] Security config decryption failed - invalid payload or key');\n        return null;\n      }\n\n      try {\n        const decoder = new TextDecoder();\n        const decoded = JSON.parse(decoder.decode(plaintext));\n        console.log('[ENCRYPTION] Security config decrypted successfully');\n        return decoded;\n      } catch (error) {\n        console.error('[ENCRYPTION] Failed to parse decrypted security config:', error);\n        return null;\n      }\n    },\n\n    /**\n     * Encrypt solution data\n     */\n    encryptSolution: async function(solutionData, challengeId) {\n      if (!this.currentSession) return null;\n\n      const childKey = await this.deriveChildKey(\n        this.currentSession.masterKey,\n        challengeId,\n        'decrypt'\n      );\n      const plaintext = JSON.stringify(solutionData);\n\n      return await this.encryptPayload(plaintext, childKey, challengeId);\n    },\n\n    /**\n     * Encrypt verification metadata (clientDetections, fingerprint, behavioral data)\n     */\n    encryptVerificationMetadata: async function(metadataObj, challengeId) {\n      if (!this.currentSession) return null;\n\n      const childKey = await this.deriveChildKey(\n        this.currentSession.masterKey,\n        challengeId,\n        'metadata'\n      );\n      const plaintext = JSON.stringify(metadataObj);\n\n      return await this.encryptPayload(plaintext, childKey, challengeId);\n    },\n\n    /**\n     * Clear session\n     */\n    clearSession: function() {\n      this.currentSession = null;\n    },\n  };\n\n  // ==========================================\n  // ADVANCED FINGERPRINT COLLECTOR\n  // ==========================================\n\n  /**\n   * Comprehensive browser fingerprinting using Canvas, WebGL, Audio, Fonts, and more\n   * This provides robust device identification for security purposes\n   */\n  const FingerprintCollector = {\n    cachedFingerprint: null,\n    cacheExpiry: 0,\n    CACHE_DURATION: 60000, // 1 minute cache\n\n    /**\n     * Collect complete browser fingerprint\n     */\n    async collect() {\n      // Return cached fingerprint if still valid\n      if (this.cachedFingerprint && Date.now() < this.cacheExpiry) {\n        return this.cachedFingerprint;\n      }\n\n      const fingerprint = {};\n\n      try {\n        // Canvas Fingerprinting - highly unique per device/browser\n        fingerprint.canvasHash = await this.getCanvasFingerprint();\n      } catch (e) {\n        fingerprint.canvasHash = 'error';\n      }\n\n      try {\n        // WebGL Fingerprinting - GPU and graphics driver information\n        fingerprint.webglHash = await this.getWebGLFingerprint();\n      } catch (e) {\n        fingerprint.webglHash = 'error';\n      }\n\n      try {\n        // Audio Fingerprinting - audio processing variations\n        fingerprint.audioHash = await this.getAudioFingerprint();\n      } catch (e) {\n        fingerprint.audioHash = 'error';\n      }\n\n      try {\n        // Font Detection - installed system fonts\n        fingerprint.fonts = await this.detectFonts();\n      } catch (e) {\n        fingerprint.fonts = [];\n      }\n\n      try {\n        // Screen Fingerprint - display characteristics\n        fingerprint.screenFingerprint = this.getScreenFingerprint();\n      } catch (e) {\n        fingerprint.screenFingerprint = 'error';\n      }\n\n      try {\n        // Browser Plugins\n        fingerprint.plugins = this.getPlugins();\n      } catch (e) {\n        fingerprint.plugins = [];\n      }\n\n      try {\n        // Timezone\n        fingerprint.timezone = Intl.DateTimeFormat().resolvedOptions().timeZone;\n      } catch (e) {\n        fingerprint.timezone = 'unknown';\n      }\n\n      try {\n        // Platform\n        fingerprint.platform = navigator.platform;\n      } catch (e) {\n        fingerprint.platform = 'unknown';\n      }\n\n      try {\n        // Hardware Concurrency (CPU cores)\n        fingerprint.hardwareConcurrency = navigator.hardwareConcurrency;\n      } catch (e) {\n        fingerprint.hardwareConcurrency = 0;\n      }\n\n      try {\n        // Device Memory (GB)\n        fingerprint.deviceMemory = navigator.deviceMemory;\n      } catch (e) {\n        fingerprint.deviceMemory = 0;\n      }\n\n      try {\n        // Color Depth\n        fingerprint.colorDepth = screen.colorDepth;\n      } catch (e) {\n        fingerprint.colorDepth = 0;\n      }\n\n      try {\n        // Pixel Ratio\n        fingerprint.pixelRatio = window.devicePixelRatio;\n      } catch (e) {\n        fingerprint.pixelRatio = 1;\n      }\n\n      // Cache the result\n      this.cachedFingerprint = fingerprint;\n      this.cacheExpiry = Date.now() + this.CACHE_DURATION;\n\n      return fingerprint;\n    },\n\n    /**\n     * Canvas Fingerprinting\n     * Draws text and shapes to canvas and extracts unique rendering signature\n     */\n    getCanvasFingerprint() {\n      return new Promise((resolve) => {\n        try {\n          const canvas = document.createElement('canvas');\n          canvas.width = 240;\n          canvas.height = 60;\n          const ctx = canvas.getContext('2d');\n          \n          if (!ctx) {\n            resolve('no-context');\n            return;\n          }\n\n          // Draw colorful background\n          ctx.fillStyle = '#f60';\n          ctx.fillRect(125, 1, 62, 20);\n          \n          // Draw text with specific styling\n          ctx.textBaseline = 'alphabetic';\n          ctx.font = '14px \"Arial\"';\n          ctx.fillStyle = '#069';\n          ctx.fillText('ProofCaptcha üîíüõ°Ô∏è', 2, 15);\n          \n          // Add semi-transparent overlay\n          ctx.fillStyle = 'rgba(102, 204, 0, 0.7)';\n          ctx.fillText('ProofCaptcha üîíüõ°Ô∏è', 4, 17);\n          \n          // Draw shapes\n          ctx.beginPath();\n          ctx.arc(50, 30, 20, 0, Math.PI * 2, true);\n          ctx.closePath();\n          ctx.fillStyle = 'rgba(255, 0, 0, 0.5)';\n          ctx.fill();\n          \n          // Get canvas data URL and extract signature\n          const dataURL = canvas.toDataURL();\n          // Use last 120 characters for uniqueness\n          const signature = dataURL.slice(-120);\n          resolve(signature);\n        } catch (e) {\n          resolve('error');\n        }\n      });\n    },\n\n    /**\n     * WebGL Fingerprinting\n     * Extracts GPU and graphics driver information\n     */\n    getWebGLFingerprint() {\n      return new Promise((resolve) => {\n        try {\n          const canvas = document.createElement('canvas');\n          const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');\n          \n          if (!gl) {\n            resolve('no-webgl');\n            return;\n          }\n\n          // Get WebGL parameters\n          const params = {\n            vendor: gl.getParameter(gl.VENDOR),\n            renderer: gl.getParameter(gl.RENDERER),\n            version: gl.getParameter(gl.VERSION),\n            shadingLanguageVersion: gl.getParameter(gl.SHADING_LANGUAGE_VERSION),\n          };\n\n          // Get unmasked vendor and renderer (more detailed GPU info)\n          const debugInfo = gl.getExtension('WEBGL_debug_renderer_info');\n          if (debugInfo) {\n            params.unmaskedVendor = gl.getParameter(debugInfo.UNMASKED_VENDOR_WEBGL);\n            params.unmaskedRenderer = gl.getParameter(debugInfo.UNMASKED_RENDERER_WEBGL);\n          }\n\n          // Get supported extensions\n          const extensions = gl.getSupportedExtensions();\n          params.extensions = extensions ? extensions.join(',') : '';\n\n          // Create hash from params\n          const hash = JSON.stringify(params);\n          resolve(hash.slice(0, 100));\n        } catch (e) {\n          resolve('error');\n        }\n      });\n    },\n\n    /**\n     * Audio Fingerprinting\n     * Uses AudioContext to detect audio processing differences\n     */\n    getAudioFingerprint() {\n      return new Promise((resolve) => {\n        try {\n          const AudioContext = window.AudioContext || window.webkitAudioContext;\n          \n          if (!AudioContext) {\n            resolve('no-audio');\n            return;\n          }\n\n          const context = new AudioContext();\n          const oscillator = context.createOscillator();\n          const analyser = context.createAnalyser();\n          const gainNode = context.createGain();\n          const scriptProcessor = context.createScriptProcessor(4096, 1, 1);\n\n          // Set gain to 0 (silent)\n          gainNode.gain.value = 0;\n          \n          // Configure oscillator\n          oscillator.type = 'triangle';\n          oscillator.frequency.value = 10000;\n          \n          // Connect nodes\n          oscillator.connect(analyser);\n          analyser.connect(scriptProcessor);\n          scriptProcessor.connect(gainNode);\n          gainNode.connect(context.destination);\n\n          // Start oscillator\n          oscillator.start(0);\n          \n          let fingerprint = '';\n          \n          scriptProcessor.onaudioprocess = function(event) {\n            const output = event.outputBuffer.getChannelData(0);\n            \n            // Calculate fingerprint from audio samples\n            let sum = 0;\n            for (let i = 0; i < output.length && i < 30; i++) {\n              sum += Math.abs(output[i]);\n            }\n            \n            fingerprint = sum.toString().slice(0, 20);\n            \n            // Cleanup\n            oscillator.stop();\n            scriptProcessor.disconnect();\n            gainNode.disconnect();\n            analyser.disconnect();\n            context.close();\n            \n            resolve(fingerprint || 'silent');\n          };\n          \n          // Timeout after 100ms\n          setTimeout(() => {\n            if (!fingerprint) {\n              try {\n                oscillator.stop();\n                context.close();\n              } catch (e) {}\n              resolve('timeout');\n            }\n          }, 100);\n        } catch (e) {\n          resolve('error');\n        }\n      });\n    },\n\n    /**\n     * Font Detection\n     * Detects installed fonts by measuring text width differences\n     */\n    detectFonts() {\n      return new Promise((resolve) => {\n        try {\n          const baseFonts = ['monospace', 'sans-serif', 'serif'];\n          const testFonts = [\n            'Arial', 'Verdana', 'Times New Roman', 'Courier New', 'Georgia',\n            'Palatino', 'Garamond', 'Bookman', 'Comic Sans MS', 'Trebuchet MS',\n            'Impact', 'Lucida Console', 'Tahoma', 'Helvetica', 'Calibri',\n            'Cambria', 'Consolas', 'Monaco', 'Copperplate', 'Papyrus'\n          ];\n          \n          const testString = 'mmmmmmmmmmlli';\n          const testSize = '72px';\n          const detectedFonts = [];\n          \n          const span = document.createElement('span');\n          span.style.fontSize = testSize;\n          span.style.position = 'absolute';\n          span.style.left = '-9999px';\n          span.style.top = '-9999px';\n          span.textContent = testString;\n          document.body.appendChild(span);\n          \n          // Get baseline widths\n          const baselineWidths = {};\n          for (const baseFont of baseFonts) {\n            span.style.fontFamily = baseFont;\n            baselineWidths[baseFont] = span.offsetWidth;\n          }\n          \n          // Test each font\n          for (const testFont of testFonts) {\n            let detected = false;\n            \n            for (const baseFont of baseFonts) {\n              span.style.fontFamily = `\"${testFont}\", ${baseFont}`;\n              const width = span.offsetWidth;\n              \n              if (width !== baselineWidths[baseFont]) {\n                detected = true;\n                break;\n              }\n            }\n            \n            if (detected) {\n              detectedFonts.push(testFont);\n            }\n          }\n          \n          document.body.removeChild(span);\n          resolve(detectedFonts);\n        } catch (e) {\n          resolve([]);\n        }\n      });\n    },\n\n    /**\n     * Screen Fingerprint\n     * Collects screen and display information\n     */\n    getScreenFingerprint() {\n      try {\n        return [\n          screen.width,\n          screen.height,\n          screen.availWidth,\n          screen.availHeight,\n          screen.colorDepth,\n          screen.pixelDepth,\n          window.devicePixelRatio\n        ].join('x');\n      } catch (e) {\n        return 'error';\n      }\n    },\n\n    /**\n     * Get Browser Plugins\n     */\n    getPlugins() {\n      try {\n        const plugins = [];\n        for (let i = 0; i < navigator.plugins.length && i < 10; i++) {\n          plugins.push(navigator.plugins[i].name);\n        }\n        return plugins;\n      } catch (e) {\n        return [];\n      }\n    },\n\n    /**\n     * Clear cached fingerprint\n     */\n    clearCache() {\n      this.cachedFingerprint = null;\n      this.cacheExpiry = 0;\n    }\n  };\n\n  // ==========================================\n  // BEHAVIORAL TRACKER & HONEYPOT SYSTEM\n  // ==========================================\n\n  /**\n   * Tracks user behavioral patterns for bot detection\n   * Monitors mouse movements, keyboard interactions, timing, and interaction patterns\n   */\n  const BehavioralTracker = {\n    startTime: 0,\n    mouseMovements: 0,\n    keyboardEvents: 0,\n    clickEvents: 0,\n    scrollEvents: 0,\n    lastMouseTime: 0,\n    lastKeyboardTime: 0,\n    mouseVelocity: [],\n    interactionTimings: [],\n    listenersAttached: false,\n\n    /**\n     * Initialize behavioral tracking\n     */\n    init() {\n      if (this.listenersAttached) return;\n      \n      this.startTime = Date.now();\n      \n      // Track mouse movements\n      document.addEventListener('mousemove', (e) => {\n        this.mouseMovements++;\n        \n        // Calculate mouse velocity for natural movement detection\n        const now = Date.now();\n        if (this.lastMouseTime > 0) {\n          const timeDelta = now - this.lastMouseTime;\n          if (timeDelta > 0) {\n            this.mouseVelocity.push(timeDelta);\n            if (this.mouseVelocity.length > 10) {\n              this.mouseVelocity.shift();\n            }\n          }\n        }\n        this.lastMouseTime = now;\n      }, { passive: true });\n      \n      // Track keyboard events\n      document.addEventListener('keydown', () => {\n        this.keyboardEvents++;\n        \n        const now = Date.now();\n        if (this.lastKeyboardTime > 0) {\n          const timeDelta = now - this.lastKeyboardTime;\n          this.interactionTimings.push(timeDelta);\n          if (this.interactionTimings.length > 10) {\n            this.interactionTimings.shift();\n          }\n        }\n        this.lastKeyboardTime = now;\n      }, { passive: true });\n      \n      // Track clicks\n      document.addEventListener('click', () => {\n        this.clickEvents++;\n      }, { passive: true });\n      \n      // Track scrolls\n      document.addEventListener('scroll', () => {\n        this.scrollEvents++;\n      }, { passive: true });\n      \n      this.listenersAttached = true;\n    },\n\n    /**\n     * Get current behavioral data\n     */\n    getData() {\n      const submissionTime = Date.now() - this.startTime;\n      \n      // Calculate average mouse velocity\n      const avgMouseVelocity = this.mouseVelocity.length > 0\n        ? this.mouseVelocity.reduce((a, b) => a + b, 0) / this.mouseVelocity.length\n        : 0;\n      \n      // Detect suspiciously consistent timing (bot-like)\n      const hasConsistentTiming = this.interactionTimings.length > 3 &&\n        this.interactionTimings.every((t, i, arr) => \n          i === 0 || Math.abs(t - arr[i-1]) < 50\n        );\n      \n      return {\n        mouseMovements: this.mouseMovements,\n        keyboardEvents: this.keyboardEvents,\n        clickEvents: this.clickEvents,\n        scrollEvents: this.scrollEvents,\n        submissionTime,\n        avgMouseVelocity: Math.round(avgMouseVelocity),\n        hasConsistentTiming,\n        interactionCount: this.mouseMovements + this.keyboardEvents + this.clickEvents\n      };\n    },\n\n    /**\n     * Reset tracking data\n     */\n    reset() {\n      this.startTime = Date.now();\n      this.mouseMovements = 0;\n      this.keyboardEvents = 0;\n      this.clickEvents = 0;\n      this.scrollEvents = 0;\n      this.lastMouseTime = 0;\n      this.lastKeyboardTime = 0;\n      this.mouseVelocity = [];\n      this.interactionTimings = [];\n    }\n  };\n\n  // Initialize behavioral tracker on load\n  if (typeof document !== 'undefined') {\n    if (document.readyState === 'loading') {\n      document.addEventListener('DOMContentLoaded', () => BehavioralTracker.init());\n    } else {\n      BehavioralTracker.init();\n    }\n  }\n\n  // ==========================================\n  // UTILITY FUNCTIONS\n  // ==========================================\n  \n  /**\n   * Detect client-side automation tools\n   */\n  function detectClientAutomation() {\n    return {\n      webdriver: navigator.webdriver === true,\n      headless: /headless/i.test(navigator.userAgent),\n      phantom: !!window.callPhantom || !!window._phantom,\n      selenium: !!window.document.$cdc_asdjflasutopfhvcZLmcfl_,\n      chromeDriver: !!window.document.documentElement.getAttribute('webdriver'),\n      plugins: navigator.plugins.length === 0,\n      languages: navigator.languages.length === 0,\n      platform: /Linux/.test(navigator.platform) && !/Android/.test(navigator.userAgent),\n    };\n  }\n\n  /**\n   * Reusable TextEncoder instance for performance\n   */\n  const textEncoder = new TextEncoder();\n\n  /**\n   * Generate SHA-256 hash of a message\n   */\n  async function sha256(message) {\n    const msgBuffer = textEncoder.encode(message);\n    const hashBuffer = await crypto.subtle.digest('SHA-256', msgBuffer);\n    const hashArray = Array.from(new Uint8Array(hashBuffer));\n    return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');\n  }\n\n  /**\n   * Convert hash buffer to hex string (optimized)\n   * Faster than Array.from + map + join approach\n   */\n  function bufferToHex(buffer) {\n    const hashArray = new Uint8Array(buffer);\n    let hex = '';\n    for (let i = 0; i < hashArray.length; i++) {\n      const h = hashArray[i].toString(16);\n      hex += h.length === 1 ? '0' + h : h;\n    }\n    return hex;\n  }\n\n  /**\n   * Solve ALTCHA-style POW using Web Workers (parallel processing)\n   * OPTIMIZED: Uses up to 16 workers for maximum parallelization\n   * ALTCHA approach: Find number N where SHA256(salt + N) = challengeHash\n   * Much faster than traditional prefix-based POW\n   */\n  async function solveProofOfWorkWithWorkers(challenge, onProgress) {\n    const { salt, challengeHash, maxNumber } = challenge;\n    \n    return new Promise((resolve, reject) => {\n      // Use up to 16 workers for maximum speed (or all available CPU cores)\n      const workerCount = Math.min(navigator.hardwareConcurrency || 8, 16);\n      // Increased batch size for better throughput\n      const batchSize = 10000;\n      const workers = [];\n      let currentNumber = 0;\n      let totalAttempts = 0;\n      let found = false;\n      let activeWorkers = 0;\n      \n      // Create inline worker to avoid CORS issues\n      const workerCode = `\n        function bufferToHex(buffer) {\n          const hashArray = new Uint8Array(buffer);\n          let hex = '';\n          for (let i = 0; i < hashArray.length; i++) {\n            const h = hashArray[i].toString(16);\n            hex += h.length === 1 ? '0' + h : h;\n          }\n          return hex;\n        }\n        \n        self.onmessage = async function(e) {\n          const { type, data } = e.data;\n          \n          if (type === 'solve') {\n            const { salt, challengeHash, startNumber, batchSize } = data;\n            const textEncoder = new TextEncoder();\n            let lastReportedAttempt = 0;\n            \n            for (let i = 0; i < batchSize; i++) {\n              const number = startNumber + i;\n              const hashData = salt + number.toString();\n              const msgBuffer = textEncoder.encode(hashData);\n              const hashBuffer = await crypto.subtle.digest('SHA-256', msgBuffer);\n              const hash = bufferToHex(hashBuffer);\n              \n              if (i > 0 && i % 500 === 0) {\n                const incrementalAttempts = i - lastReportedAttempt;\n                self.postMessage({\n                  type: 'progress',\n                  data: {\n                    attempts: incrementalAttempts,\n                    hash: hash,\n                    currentNumber: number\n                  }\n                });\n                lastReportedAttempt = i;\n              }\n              \n              if (hash === challengeHash) {\n                const incrementalAttempts = (i + 1) - lastReportedAttempt;\n                self.postMessage({\n                  type: 'found',\n                  data: {\n                    solution: number,\n                    attempts: incrementalAttempts,\n                    hash: hash\n                  }\n                });\n                return;\n              }\n            }\n            \n            const incrementalAttempts = batchSize - lastReportedAttempt;\n            self.postMessage({\n              type: 'complete',\n              data: {\n                attempts: incrementalAttempts\n              }\n            });\n          }\n        };\n      `;\n      \n      const blob = new Blob([workerCode], { type: 'application/javascript' });\n      const workerUrl = URL.createObjectURL(blob);\n      \n      function cleanup() {\n        workers.forEach(w => w.terminate());\n        workers.length = 0;\n        URL.revokeObjectURL(workerUrl);\n      }\n      \n      function assignWork(worker) {\n        if (found || currentNumber >= maxNumber) {\n          return false;\n        }\n        \n        const startNumber = currentNumber;\n        currentNumber += batchSize;\n        activeWorkers++;\n        \n        worker.postMessage({\n          type: 'solve',\n          data: {\n            salt,\n            challengeHash,\n            startNumber,\n            batchSize: Math.min(batchSize, maxNumber - startNumber)\n          }\n        });\n        \n        return true;\n      }\n      \n      try {\n        for (let i = 0; i < workerCount; i++) {\n          const worker = new Worker(workerUrl);\n          \n          worker.onmessage = function(e) {\n            const { type, data } = e.data;\n            \n            if (type === 'found') {\n              if (!found) {\n                found = true;\n                cleanup();\n                resolve(data.solution);\n              }\n            } else if (type === 'progress') {\n              totalAttempts += data.attempts;\n              if (onProgress) {\n                onProgress(data.hash, totalAttempts);\n              }\n            } else if (type === 'complete') {\n              activeWorkers--;\n              totalAttempts += data.attempts;\n              \n              if (!assignWork(worker)) {\n                worker.terminate();\n                \n                if (activeWorkers === 0 && !found) {\n                  cleanup();\n                  reject(new Error('Max number reached without solution'));\n                }\n              }\n            }\n          };\n          \n          worker.onerror = function(error) {\n            activeWorkers--;\n            worker.terminate();\n            \n            if (activeWorkers === 0 && !found) {\n              cleanup();\n              reject(error);\n            }\n          };\n          \n          workers.push(worker);\n          assignWork(worker);\n        }\n      } catch (error) {\n        cleanup();\n        reject(error);\n      }\n    });\n  }\n\n  /**\n   * Solve ALTCHA-style POW sequentially (fallback when workers unavailable)\n   * Find number N where SHA256(salt + N) = challengeHash\n   */\n  async function solveProofOfWorkSequential(challenge, onProgress) {\n    const { salt, challengeHash, maxNumber } = challenge;\n    let attempts = 0;\n\n    for (let number = 0; number < maxNumber; number++) {\n      // ALTCHA: hash(salt + number) - looking for exact match\n      const data = salt + number.toString();\n      const msgBuffer = textEncoder.encode(data);\n      const hashBuffer = await crypto.subtle.digest('SHA-256', msgBuffer);\n      const hash = bufferToHex(hashBuffer);\n      \n      attempts++;\n      \n      if (onProgress && attempts % PROGRESS_UPDATE_INTERVAL === 0) {\n        onProgress(hash, attempts);\n      }\n\n      // ALTCHA: Check for exact match\n      if (hash === challengeHash) {\n        return number;\n      }\n    }\n\n    throw new Error('Max number reached without solution');\n  }\n\n  /**\n   * Solve ALTCHA Proof of Work challenge - OPTIMIZED WITH WEB WORKERS\n   * Uses parallel processing via Web Workers for 5-10x speedup\n   * Falls back to sequential processing if workers unavailable\n   * ALTCHA approach is much faster than traditional prefix-based POW\n   */\n  async function solveProofOfWork(challenge, onProgress) {\n    const supportsWorkers = typeof Worker !== 'undefined';\n    \n    if (supportsWorkers) {\n      try {\n        return await solveProofOfWorkWithWorkers(challenge, onProgress);\n      } catch (error) {\n        console.warn('Worker-based ALTCHA failed, falling back to sequential:', error);\n        return await solveProofOfWorkSequential(challenge, onProgress);\n      }\n    } else {\n      return await solveProofOfWorkSequential(challenge, onProgress);\n    }\n  }\n\n  /**\n   * Seeded random number generator for deterministic puzzle generation\n   */\n  function seededRandom(seed) {\n    const x = Math.sin(seed++) * 10000;\n    return x - Math.floor(x);\n  }\n\n  /**\n   * Generate jigsaw puzzle path for SVG\n   */\n  function generateJigsawPath(seed, size) {\n    const baseSize = size;\n    const nubSize = baseSize * 0.25;\n    const nubDepth = baseSize * 0.15;\n    \n    const rng = (offset) => seededRandom(seed + offset);\n    \n    const topNubDir = rng(1) > 0.5 ? 1 : -1;\n    const rightNubDir = rng(2) > 0.5 ? 1 : -1;\n    \n    const topStart = baseSize * 0.35;\n    const topEnd = baseSize * 0.65;\n    const topMid = (topStart + topEnd) / 2;\n    \n    const rightStart = baseSize * 0.35;\n    const rightEnd = baseSize * 0.65;\n    const rightMid = (rightStart + rightEnd) / 2;\n    \n    let path = `M 0 0`;\n    path += ` L ${topStart} 0`;\n    path += ` Q ${topStart} ${-nubDepth * topNubDir * 0.3} ${topMid - nubSize / 2} ${-nubDepth * topNubDir}`;\n    path += ` Q ${topMid} ${-nubDepth * topNubDir * 1.2} ${topMid + nubSize / 2} ${-nubDepth * topNubDir}`;\n    path += ` Q ${topEnd} ${-nubDepth * topNubDir * 0.3} ${topEnd} 0`;\n    path += ` L ${baseSize} 0`;\n    path += ` L ${baseSize} ${rightStart}`;\n    path += ` Q ${baseSize + nubDepth * rightNubDir * 0.3} ${rightStart} ${baseSize + nubDepth * rightNubDir} ${rightMid - nubSize / 2}`;\n    path += ` Q ${baseSize + nubDepth * rightNubDir * 1.2} ${rightMid} ${baseSize + nubDepth * rightNubDir} ${rightMid + nubSize / 2}`;\n    path += ` Q ${baseSize + nubDepth * rightNubDir * 0.3} ${rightEnd} ${baseSize} ${rightEnd}`;\n    path += ` L ${baseSize} ${baseSize}`;\n    path += ` L 0 ${baseSize}`;\n    path += ` Z`;\n    \n    return path;\n  }\n\n  // ==========================================\n  // SVG ICONS (matching Lucide icons)\n  // ==========================================\n  \n  const Icons = {\n    bot: `<svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"M12 8V4H8\"/><rect width=\"16\" height=\"12\" x=\"4\" y=\"8\" rx=\"2\"/><path d=\"M2 14h2\"/><path d=\"M20 14h2\"/><path d=\"M15 13v2\"/><path d=\"M9 13v2\"/></svg>`,\n    userCheck: `<svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2\"/><circle cx=\"9\" cy=\"7\" r=\"4\"/><polyline points=\"16 11 18 13 22 9\"/></svg>`,\n    checkCircle: `<svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><circle cx=\"12\" cy=\"12\" r=\"10\"/><path d=\"m9 12 2 2 4-4\"/></svg>`,\n    xCircle: `<svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><circle cx=\"12\" cy=\"12\" r=\"10\"/><path d=\"m15 9-6 6\"/><path d=\"m9 9 6 6\"/></svg>`,\n    alertTriangle: `<svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z\"/><line x1=\"12\" y1=\"9\" x2=\"12\" y2=\"13\"/><line x1=\"12\" y1=\"17\" x2=\"12.01\" y2=\"17\"/></svg>`,\n    shield: `<svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z\"/></svg>`,\n    close: `<svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"M18 6 6 18\"/><path d=\"m6 6 12 12\"/></svg>`,\n    refresh: `<svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8\"/><path d=\"M21 3v5h-5\"/><path d=\"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16\"/><path d=\"M3 21v-5h5\"/></svg>`,\n    loader: `<svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"M21 12a9 9 0 1 1-6.219-8.56\"/></svg>`,\n    clock: `<svg width=\"12\" height=\"12\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><circle cx=\"12\" cy=\"12\" r=\"10\"/><polyline points=\"12 6 12 12 16 14\"/></svg>`\n  };\n\n  // ==========================================\n  // WIDGET CLASS\n  // ==========================================\n  \n  /**\n   * ProofCaptcha Widget Class\n   */\n  class ProofCaptchaWidget {\n    constructor(container, options) {\n      this.container = typeof container === 'string' ? document.querySelector(container) : container;\n      this.publicKey = options.publicKey || options['site-key'] || options.sitekey;\n      this.callback = options.callback;\n      this.errorCallback = options['error-callback'] || options['expired-callback'];\n      this.theme = options.theme || 'light';\n      this.type = options.type || 'random';\n      this.privacyUrl = options.privacyUrl || options['privacy-url'] || `${API_BASE_URL}/privacy`;\n      this.termsUrl = options.termsUrl || options['terms-url'] || `${API_BASE_URL}/terms`;\n      \n      this.status = 'idle';\n      this.challenge = null;\n      this.token = null;\n      this.widgetId = Math.random().toString(36).substring(2);\n      this.actualType = null;\n      this.selectedCells = [];\n      this.jigsawPieces = [];\n      this.dragPosition = { x: 0, y: 0 };\n      this.isDragging = false;\n      this.upsideDownClicks = [];\n      this.attempts = 0;\n      this.blockExpiresAt = null;\n      this.remainingTime = '';\n      this.countdownInterval = null;\n      \n      // Timeout management\n      this.challengeTimeoutId = null;\n      this.resetTimeoutId = null;\n      this.tokenExpiryTimeoutId = null;\n      this.errorMessage = '';\n      \n      // Animation reload flag to prevent double slide animations\n      this.isReloading = false;\n      \n      // Security settings (loaded from server per API key)\n      this.challengeTimeoutMs = 60000; // Default 1 minute\n      this.tokenExpiryMs = 60000; // Default 1 minute\n      this.advancedFingerprintingEnabled = true; // Default enabled\n      \n      this.render();\n    }\n\n    /**\n     * Collect device fingerprint (conditional based on API key settings)\n     * @returns {Promise<Object>} Fingerprint data or minimal data if disabled\n     */\n    async collectFingerprint() {\n      if (this.advancedFingerprintingEnabled) {\n        // Full advanced fingerprinting enabled\n        const fingerprint = await FingerprintCollector.collect();\n        console.log('[FINGERPRINT] Advanced fingerprinting enabled - collected', Object.keys(fingerprint).length, 'components');\n        return fingerprint;\n      } else {\n        // Advanced fingerprinting disabled - send minimal data only\n        console.log('[FINGERPRINT] Advanced fingerprinting disabled - sending minimal data');\n        return {\n          userAgent: navigator.userAgent,\n          language: navigator.language,\n          screenResolution: `${screen.width}x${screen.height}`,\n          timezone: Intl.DateTimeFormat().resolvedOptions().timeZone\n        };\n      }\n    }\n\n    /**\n     * Render the main widget UI\n     */\n    render() {\n      const themeClass = this.theme === 'dark' ? 'dark' : '';\n      \n      // Render widget WITHOUT overlay (overlay will be separate)\n      this.container.innerHTML = `\n        <div class=\"proofcaptcha-root ${themeClass}\" data-widget-id=\"${this.widgetId}\">\n          <div class=\"proofcaptcha-widget\" data-testid=\"card-captcha-widget\">\n            <div class=\"proofcaptcha-content\">\n              <div class=\"proofcaptcha-inner\">\n                <div class=\"proofcaptcha-checkbox-container\">\n                  <input \n                    type=\"checkbox\" \n                    class=\"proofcaptcha-checkbox\" \n                  />\n                </div>\n                \n                <div class=\"proofcaptcha-text\">\n                  I'm not a robot\n                </div>\n                \n                <div class=\"proofcaptcha-logo\">\n                  ${Icons.bot}\n                </div>\n              </div>\n            </div>\n            \n            <div class=\"proofcaptcha-footer\">\n              <a href=\"${this.privacyUrl}\" target=\"_blank\" rel=\"noopener noreferrer\" data-testid=\"link-privacy\">Privacy</a>\n              <span class=\"proofcaptcha-footer-brand\">ProofCaptcha</span>\n              <a href=\"${this.termsUrl}\" target=\"_blank\" rel=\"noopener noreferrer\" data-testid=\"link-terms\">Terms</a>\n            </div>\n          </div>\n        </div>\n      `;\n\n      // Create overlay separately and append to document.body (OUTSIDE the form!)\n      // Remove old overlay if exists\n      if (this.overlayElement && this.overlayElement.parentNode) {\n        this.overlayElement.parentNode.removeChild(this.overlayElement);\n      }\n      \n      this.overlayElement = document.createElement('div');\n      this.overlayElement.className = `proofcaptcha-overlay ${themeClass}`;\n      this.overlayElement.setAttribute('data-widget-id', this.widgetId);\n      // Add ARIA attributes for accessibility\n      this.overlayElement.setAttribute('role', 'dialog');\n      this.overlayElement.setAttribute('aria-modal', 'true');\n      this.overlayElement.setAttribute('aria-label', 'CAPTCHA Challenge');\n      this.overlayElement.innerHTML = `\n        <div class=\"proofcaptcha-modal\"></div>\n      `;\n      document.body.appendChild(this.overlayElement);\n\n      // Note: checkbox event listener is attached in updateWidgetState() \n      // to ensure it's always attached to the current checkbox element\n      this.updateWidgetState();\n    }\n\n    /**\n     * Update widget visual state\n     */\n    updateWidgetState() {\n      const widget = this.container.querySelector('.proofcaptcha-widget');\n      const inner = widget.querySelector('.proofcaptcha-inner');\n      const logo = widget.querySelector('.proofcaptcha-logo');\n      const text = widget.querySelector('.proofcaptcha-text');\n      const checkboxContainer = inner.querySelector('.proofcaptcha-checkbox-container');\n      \n      // Reset logo classes\n      logo.className = 'proofcaptcha-logo';\n      \n      if (this.status === 'success') {\n        logo.classList.add('success');\n        logo.innerHTML = Icons.userCheck;\n        \n        checkboxContainer.innerHTML = `\n          <div class=\"proofcaptcha-icon-container success\" style=\"animation: proofcaptcha-scale-in 0.3s ease-out;\">\n            ${Icons.checkCircle}\n          </div>\n        `;\n        \n        text.innerHTML = `\n          <div style=\"animation: proofcaptcha-fade-in 0.4s ease-out;\">\n            <div class=\"proofcaptcha-text-status\" data-testid=\"text-status\" style=\"\n              font-weight: 600;\n              background: linear-gradient(135deg, hsl(142 76% 36%), hsl(142 76% 46%));\n              -webkit-background-clip: text;\n              -webkit-text-fill-color: transparent;\n              background-clip: text;\n            \">‚úì Verified!</div>\n            ${this.attempts > 0 ? `<div class=\"proofcaptcha-text-attempts\" data-testid=\"text-attempts\" style=\"\n              font-size: 11px;\n              opacity: 0.8;\n              margin-top: 2px;\n            \">${this.attempts.toLocaleString()} computations</div>` : ''}\n          </div>\n        `;\n      } else if (this.status === 'error') {\n        // Show warning icon for errors\n        logo.classList.add('warning');\n        logo.innerHTML = Icons.alertTriangle;\n        \n        checkboxContainer.innerHTML = `\n          <div class=\"proofcaptcha-icon-container warning\">\n            ${Icons.alertTriangle}\n          </div>\n        `;\n        \n        // Display specific error message or default fallback\n        const displayMessage = this.errorMessage || 'Verification failed';\n        \n        text.innerHTML = `\n          <div>\n            <div class=\"proofcaptcha-text-status\" style=\"color: hsl(38 92% 50%);\">${displayMessage}</div>\n            <button style=\"\n              background: none;\n              border: none;\n              color: #3b82f6;\n              font-size: 12px;\n              cursor: pointer;\n              padding: 0;\n              text-decoration: underline;\n              font-weight: 500;\n            \" data-retry>Try again</button>\n          </div>\n        `;\n        \n        const retryBtn = text.querySelector('[data-retry]');\n        retryBtn.addEventListener('click', () => {\n          this.status = 'idle';\n          this.errorMessage = '';\n          this.clearChallengeTimers();\n          this.updateWidgetState();\n        });\n      } else if (this.status === 'blocked') {\n        logo.classList.add('warning');\n        logo.innerHTML = Icons.shield;\n        \n        checkboxContainer.innerHTML = `\n          <div class=\"proofcaptcha-icon-container warning\">\n            ${Icons.shield}\n          </div>\n        `;\n        \n        text.innerHTML = `\n          <div>\n            <div class=\"proofcaptcha-text-status\" style=\"color: hsl(38 92% 50%);\">IP Locked</div>\n            <div style=\"display: flex; align-items: center; gap: 4px; font-size: 12px; color: hsl(38 92% 50%); margin-top: 2px;\">\n              ${Icons.clock}\n              <span>${this.remainingTime || 'Please wait'}</span>\n            </div>\n          </div>\n        `;\n      } else if (this.status === 'country_blocked') {\n        logo.classList.add('error');\n        logo.innerHTML = Icons.xCircle;\n        \n        checkboxContainer.innerHTML = `\n          <div class=\"proofcaptcha-icon-container error\">\n            ${Icons.xCircle}\n          </div>\n        `;\n        \n        text.innerHTML = `\n          <div>\n            <div class=\"proofcaptcha-text-status\" style=\"color: hsl(0 84% 60%);\">Blocked Country</div>\n            <div style=\"font-size: 11px; color: hsl(0 84% 60%); margin-top: 2px; opacity: 0.9;\">\n              ${this.errorMessage || 'Access denied from your region'}\n            </div>\n          </div>\n        `;\n      } else if (this.status === 'loading') {\n        logo.innerHTML = `<div class=\"proofcaptcha-spin\">${Icons.loader}</div>`;\n        text.textContent = 'Loading challenge...';\n        \n        checkboxContainer.innerHTML = `\n          <div class=\"proofcaptcha-icon-container loading\">\n            <div class=\"proofcaptcha-spin\" style=\"\n              width: 20px;\n              height: 20px;\n              display: flex;\n              align-items: center;\n              justify-content: center;\n            \">\n              ${Icons.loader}\n            </div>\n          </div>\n        `;\n      } else {\n        // Idle state\n        logo.innerHTML = Icons.bot;\n        text.textContent = \"I'm not a robot\";\n        \n        checkboxContainer.innerHTML = `\n          <input \n            type=\"checkbox\" \n            class=\"proofcaptcha-checkbox\"\n          />\n        `;\n        \n        // Re-attach event listener after re-rendering checkbox\n        const checkbox = checkboxContainer.querySelector('.proofcaptcha-checkbox');\n        if (checkbox) {\n          checkbox.addEventListener('change', async (e) => {\n            if (e.target.checked && (this.status === 'idle' || this.status === 'error')) {\n              e.target.checked = false;\n              await this.handleCheckboxClick();\n            }\n          });\n        }\n      }\n    }\n\n    /**\n     * Update countdown for blocked status\n     */\n    updateBlockedCountdown() {\n      if (this.status !== 'blocked' || !this.blockExpiresAt) {\n        if (this.countdownInterval) {\n          clearInterval(this.countdownInterval);\n          this.countdownInterval = null;\n        }\n        return;\n      }\n\n      const updateTime = () => {\n        const now = Date.now();\n        const remaining = this.blockExpiresAt - now;\n\n        if (remaining <= 0) {\n          this.status = 'idle';\n          this.blockExpiresAt = null;\n          this.remainingTime = '';\n          if (this.countdownInterval) {\n            clearInterval(this.countdownInterval);\n            this.countdownInterval = null;\n          }\n          this.updateWidgetState();\n          return;\n        }\n\n        const hours = Math.floor(remaining / (1000 * 60 * 60));\n        const minutes = Math.floor((remaining % (1000 * 60 * 60)) / (1000 * 60));\n        const seconds = Math.floor((remaining % (1000 * 60)) / 1000);\n\n        if (hours > 0) {\n          this.remainingTime = `${hours}h ${minutes}m ${seconds}s`;\n        } else if (minutes > 0) {\n          this.remainingTime = `${minutes}m ${seconds}s`;\n        } else {\n          this.remainingTime = `${seconds}s`;\n        }\n        \n        // Update the display\n        const timeDisplay = this.container.querySelector('.proofcaptcha-text span');\n        if (timeDisplay) {\n          timeDisplay.textContent = this.remainingTime;\n        }\n      };\n\n      updateTime();\n      if (this.countdownInterval) {\n        clearInterval(this.countdownInterval);\n      }\n      this.countdownInterval = setInterval(updateTime, 1000);\n    }\n\n    /**\n     * Clear all challenge timeout timers\n     */\n    clearChallengeTimers() {\n      if (this.challengeTimeoutId) {\n        clearTimeout(this.challengeTimeoutId);\n        this.challengeTimeoutId = null;\n      }\n      if (this.resetTimeoutId) {\n        clearTimeout(this.resetTimeoutId);\n        this.resetTimeoutId = null;\n      }\n      if (this.tokenExpiryTimeoutId) {\n        clearTimeout(this.tokenExpiryTimeoutId);\n        this.tokenExpiryTimeoutId = null;\n      }\n    }\n\n    /**\n     * Start challenge countdown timer (configurable timeout from API key settings)\n     */\n    startChallengeCountdown() {\n      // Clear any existing timers first\n      this.clearChallengeTimers();\n      \n      // Start timeout using configured value from API key settings\n      this.challengeTimeoutId = setTimeout(() => {\n        this.handleChallengeTimeout();\n      }, this.challengeTimeoutMs);\n      \n      console.log('[TIMEOUT] Challenge timeout set to:', this.challengeTimeoutMs + 'ms');\n    }\n\n    /**\n     * Handle challenge timeout - user failed to complete challenge in time\n     */\n    handleChallengeTimeout() {\n      // Double-check widget is still in active challenge state\n      if (this.status === 'success' || this.status === 'blocked' || !this.challenge) {\n        return;\n      }\n      \n      // Clear the timeout timer\n      this.challengeTimeoutId = null;\n      \n      // Set error state with timeout message\n      this.status = 'error';\n      this.errorMessage = \"Solve timeout\";\n      \n      // Clear current challenge data\n      this.selectedCells = [];\n      this.jigsawPieces = [];\n      this.dragPosition = { x: 0, y: 0 };\n      this.isDragging = false;\n      this.upsideDownClicks = [];\n      \n      // Load new challenge with slide animation after short delay\n      setTimeout(() => {\n        this.status = 'idle';\n        this.errorMessage = '';\n        this.loadNewChallengeWithAnimation();\n      }, 800);\n    }\n\n    /**\n     * Handle token expiry - token not used within 1 minute after success\n     */\n    handleTokenExpiry() {\n      // Only expire if still in success state\n      if (this.status !== 'success') {\n        return;\n      }\n      \n      // Clear the token expiry timer\n      this.tokenExpiryTimeoutId = null;\n      \n      // Set error state with token expired message\n      this.status = 'error';\n      this.errorMessage = \"Token expired!!\";\n      \n      // Clear the verification token\n      this.verificationToken = null;\n      this.token = null;\n      \n      // Update widget to show error\n      this.updateWidgetState();\n      \n      // Trigger error callback if provided\n      this.triggerCallback('errorCallback', this.errorMessage);\n      \n      // Schedule automatic reset after 5 seconds\n      this.resetTimeoutId = setTimeout(() => {\n        this.resetTimeoutId = null;\n        \n        // Reset to idle state\n        this.status = 'idle';\n        this.errorMessage = '';\n        this.challenge = null;\n        this.token = null;\n        this.selectedCells = [];\n        this.jigsawPieces = [];\n        \n        // Update widget back to initial state\n        this.updateWidgetState();\n      }, 5000);\n    }\n\n    /**\n     * Start token expiry timer (configurable from API key settings)\n     */\n    startTokenExpiryTimer() {\n      // Clear any existing token expiry timer\n      if (this.tokenExpiryTimeoutId) {\n        clearTimeout(this.tokenExpiryTimeoutId);\n        this.tokenExpiryTimeoutId = null;\n      }\n      \n      // Start token expiry countdown using configured value from API key settings\n      this.tokenExpiryTimeoutId = setTimeout(() => {\n        this.handleTokenExpiry();\n      }, this.tokenExpiryMs);\n      \n      console.log('[TIMEOUT] Token expiry set to:', this.tokenExpiryMs + 'ms');\n    }\n\n    /**\n     * Load new challenge with slide animation\n     * Triggers slide-out animation, then loads new challenge with slide-in\n     */\n    async loadNewChallengeWithAnimation() {\n      if (!this.overlayElement) return;\n      \n      const modal = this.overlayElement.querySelector('.proofcaptcha-modal');\n      if (modal) {\n        // FIXED BUG #2: Clear content BEFORE animation to prevent old content flash\n        // This prevents race condition where old captcha is visible during slide-out\n        modal.innerHTML = '';\n        \n        // Add slide-out animation class for smooth transition\n        modal.classList.add('proofcaptcha-slide-out');\n        \n        // Wait for slide-out animation to complete (400ms)\n        await new Promise(resolve => setTimeout(resolve, 400));\n        \n        // Remove slide-out class\n        modal.classList.remove('proofcaptcha-slide-out');\n      }\n      \n      // Set reload flag to prevent double renderChallenge call\n      this.isReloading = true;\n      \n      // Load new challenge (will NOT trigger renderChallenge due to isReloading flag)\n      await this.handleCheckboxClick(true);\n      \n      // Manually call renderChallenge to trigger single slide-in animation\n      this.renderChallenge();\n      \n      // Clear reload flag\n      this.isReloading = false;\n    }\n\n    /**\n     * Handle checkbox click\n     */\n    async handleCheckboxClick(isRefresh = false) {\n      if (this.status === 'blocked' || this.status === 'country_blocked') return;\n      \n      this.status = 'loading';\n      this.updateWidgetState();\n      \n      // PERBAIKAN BUG 1: Hanya tampilkan overlay jika bukan refresh (checkbox pertama kali diklik)\n      // Jika refresh, overlay sudah ditampilkan sebelumnya\n      if (!isRefresh) {\n        // PERBAIKAN BUG 2: Hapus konten modal lama sebelum menampilkan overlay\n        // Ini mencegah captcha lama muncul sebentar saat loading challenge baru\n        if (this.overlayElement) {\n          const modal = this.overlayElement.querySelector('.proofcaptcha-modal');\n          if (modal) {\n            modal.innerHTML = '';\n          }\n        }\n        this.showOverlay();\n      }\n      \n      try {\n        // Establish encryption session if not already available\n        await EncryptionManager.ensureSession(this.publicKey);\n        \n        const clientDetections = detectClientAutomation();\n        \n        // Collect browser fingerprint (conditional based on API key settings)\n        const fingerprint = await this.collectFingerprint();\n        \n        // Get behavioral tracking data\n        const behavioralData = BehavioralTracker.getData();\n        console.log('[BEHAVIORAL] Mouse:', behavioralData.mouseMovements, 'Keyboard:', behavioralData.keyboardEvents, 'Time:', behavioralData.submissionTime + 'ms');\n        \n        // SECURITY: Encrypt sensitive client data to prevent manipulation\n        let requestBody = {\n          publicKey: this.publicKey,\n          type: this.type,\n          isRefresh: isRefresh,\n        };\n        \n        // Generate unique nonce for this request (used as challengeId for encryption)\n        const requestNonce = Date.now().toString(36) + Math.random().toString(36).substring(2);\n        \n        // Encrypt clientDetections and fingerprint data if encryption is available\n        if (EncryptionManager.isAvailable() && EncryptionManager.currentSession) {\n          console.log('[ENCRYPTION] Encrypting client detection and fingerprint data...');\n          \n          try {\n            // Prepare sensitive data payload\n            const sensitiveData = {\n              clientDetections,\n              fingerprint: {\n                canvasHash: fingerprint.canvasHash,\n                webglHash: fingerprint.webglHash,\n                audioHash: fingerprint.audioHash,\n                fonts: fingerprint.fonts,\n                screenFingerprint: fingerprint.screenFingerprint,\n                plugins: fingerprint.plugins,\n                timezone: fingerprint.timezone,\n                platform: fingerprint.platform,\n                hardwareConcurrency: fingerprint.hardwareConcurrency,\n                deviceMemory: fingerprint.deviceMemory,\n                colorDepth: fingerprint.colorDepth,\n                pixelRatio: fingerprint.pixelRatio,\n              },\n              behavioral: {\n                mouseMovements: behavioralData.mouseMovements,\n                keyboardEvents: behavioralData.keyboardEvents,\n                submissionTime: behavioralData.submissionTime\n              }\n            };\n            \n            // Encrypt using session key\n            const encrypted = await EncryptionManager.encryptSolution(sensitiveData, requestNonce);\n            \n            if (encrypted) {\n              requestBody.encryptedClientData = encrypted;\n              requestBody.requestNonce = requestNonce;\n              requestBody.protocol = 'encrypted-v1';\n              console.log('[ENCRYPTION] Client data encrypted successfully');\n            } else {\n              throw new Error('Encryption failed');\n            }\n          } catch (encError) {\n            console.warn('[ENCRYPTION] Failed to encrypt client data, falling back to plaintext:', encError);\n            // Fallback to plaintext if encryption fails\n            requestBody.clientDetections = clientDetections;\n            requestBody.canvasHash = fingerprint.canvasHash;\n            requestBody.webglHash = fingerprint.webglHash;\n            requestBody.audioHash = fingerprint.audioHash;\n            requestBody.fonts = fingerprint.fonts;\n            requestBody.screenFingerprint = fingerprint.screenFingerprint;\n            requestBody.plugins = fingerprint.plugins;\n            requestBody.timezone = fingerprint.timezone;\n            requestBody.platform = fingerprint.platform;\n            requestBody.hardwareConcurrency = fingerprint.hardwareConcurrency;\n            requestBody.deviceMemory = fingerprint.deviceMemory;\n            requestBody.colorDepth = fingerprint.colorDepth;\n            requestBody.pixelRatio = fingerprint.pixelRatio;\n            requestBody.mouseMovements = behavioralData.mouseMovements;\n            requestBody.keyboardEvents = behavioralData.keyboardEvents;\n            requestBody.submissionTime = behavioralData.submissionTime;\n          }\n        } else {\n          // No encryption available - send plaintext (fallback for old browsers)\n          console.log('[ENCRYPTION] Encryption not available, sending plaintext data');\n          requestBody.clientDetections = clientDetections;\n          requestBody.canvasHash = fingerprint.canvasHash;\n          requestBody.webglHash = fingerprint.webglHash;\n          requestBody.audioHash = fingerprint.audioHash;\n          requestBody.fonts = fingerprint.fonts;\n          requestBody.screenFingerprint = fingerprint.screenFingerprint;\n          requestBody.plugins = fingerprint.plugins;\n          requestBody.timezone = fingerprint.timezone;\n          requestBody.platform = fingerprint.platform;\n          requestBody.hardwareConcurrency = fingerprint.hardwareConcurrency;\n          requestBody.deviceMemory = fingerprint.deviceMemory;\n          requestBody.colorDepth = fingerprint.colorDepth;\n          requestBody.pixelRatio = fingerprint.pixelRatio;\n          requestBody.mouseMovements = behavioralData.mouseMovements;\n          requestBody.keyboardEvents = behavioralData.keyboardEvents;\n          requestBody.submissionTime = behavioralData.submissionTime;\n        }\n        \n        // Encode request body\n        const jsonString = JSON.stringify(requestBody);\n        const encodedBody = btoa(jsonString);\n        \n        const response = await fetch(`${API_BASE_URL}/api/captcha/challenge`, {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify({ data: encodedBody }),\n          credentials: 'include'\n        });\n\n        // Decode response\n        const rawData = await response.json();\n        let data;\n        \n        if (rawData.data) {\n          try {\n            const decodedString = atob(rawData.data);\n            data = JSON.parse(decodedString);\n            console.log('[REQUEST] Decoded response');\n          } catch (decodeError) {\n            console.error('[REQUEST] Failed to decode response:', decodeError);\n            throw new Error('Failed to decode server response');\n          }\n        } else {\n          data = rawData;\n        }\n\n        if (!response.ok) {\n          if (response.status === 429 && data.error === 'IP blocked') {\n            const remainingMinutes = data.remainingTime || 0;\n            const expiresAt = Date.now() + (remainingMinutes * 60 * 1000);\n            this.blockExpiresAt = expiresAt;\n            this.status = 'blocked';\n            this.hideOverlay();\n            this.updateWidgetState();\n            this.updateBlockedCountdown();\n            this.triggerCallback('errorCallback', data.message || 'IP blocked');\n            return;\n          }\n          \n          // Handle country blocking (status 403 with \"Access denied\")\n          if (response.status === 403 && data.error === 'Access denied') {\n            this.status = 'country_blocked';\n            this.errorMessage = data.message || 'Access denied from your country';\n            this.hideOverlay();\n            this.updateWidgetState();\n            this.triggerCallback('errorCallback', this.errorMessage);\n            return;\n          }\n          \n          // Set specific error message based on response\n          let errorMsg = 'Failed to generate challenge';\n          if (response.status === 401) {\n            errorMsg = 'Invalid sitekey';\n          } else if (response.status === 403) {\n            errorMsg = 'Access denied';\n          } else if (response.status === 400) {\n            errorMsg = data.message || data.error || 'Bad request';\n          } else if (data.message) {\n            errorMsg = data.message;\n          } else if (data.error) {\n            errorMsg = data.error;\n          }\n          \n          throw new Error(errorMsg);\n        }\n        \n        // Decrypt challenge if encrypted\n        let challengeData;\n        if (data.protocol === 'encrypted-v1' && data.encrypted) {\n          console.log('[ENCRYPTION] Received encrypted challenge, decrypting...');\n          challengeData = await EncryptionManager.decryptChallenge(data.encrypted, data.token, this.publicKey);\n          if (!challengeData) {\n            throw new Error('Failed to decrypt challenge');\n          }\n        } else {\n          challengeData = data.challenge;\n          console.log('[ENCRYPTION] Using plaintext challenge');\n        }\n        \n        this.challenge = challengeData;\n        this.token = data.token;\n        this.actualType = data.type;\n        this.status = 'idle';\n        \n        // SECURITY: Decrypt security config if encrypted\n        let securityConfig;\n        if (data.encryptedSecurityConfig) {\n          console.log('[ENCRYPTION] Received encrypted security config, decrypting...');\n          try {\n            securityConfig = await EncryptionManager.decryptSecurityConfig(data.encryptedSecurityConfig, data.token, this.publicKey);\n            if (!securityConfig) {\n              console.warn('[ENCRYPTION] Failed to decrypt security config, using defaults');\n              securityConfig = data.securityConfig || {};\n            } else {\n              console.log('[ENCRYPTION] Security config decrypted successfully');\n            }\n          } catch (error) {\n            console.error('[ENCRYPTION] Error decrypting security config:', error);\n            securityConfig = data.securityConfig || {};\n          }\n        } else {\n          securityConfig = data.securityConfig || {};\n        }\n        \n        // FIXED BUG: Apply security config from server\n        // Enable/disable features based on API key settings\n        if (securityConfig && Object.keys(securityConfig).length > 0) {\n          console.log('[SECURITY CONFIG] Received from server:', securityConfig);\n          \n          // Anti-debugger control\n          if (securityConfig.antiDebugger === true) {\n            AntiDebugger.enable();\n          } else if (securityConfig.antiDebugger === false) {\n            AntiDebugger.disable();\n          }\n          \n          // Challenge timeout control (in milliseconds)\n          if (securityConfig.challengeTimeoutMs) {\n            this.challengeTimeoutMs = securityConfig.challengeTimeoutMs;\n            console.log('[SECURITY CONFIG] Challenge timeout set to:', this.challengeTimeoutMs + 'ms');\n          }\n          \n          // Token expiry control (in milliseconds)\n          if (securityConfig.tokenExpiryMs) {\n            this.tokenExpiryMs = securityConfig.tokenExpiryMs;\n            console.log('[SECURITY CONFIG] Token expiry set to:', this.tokenExpiryMs + 'ms');\n          } else if (securityConfig.challengeTimeoutMs) {\n            // Fallback: use challenge timeout if token expiry not specified\n            this.tokenExpiryMs = securityConfig.challengeTimeoutMs;\n            console.log('[SECURITY CONFIG] Token expiry fallback to challenge timeout:', this.tokenExpiryMs + 'ms');\n          }\n          \n          // Advanced fingerprinting control\n          if (securityConfig.advancedFingerprinting !== undefined) {\n            this.advancedFingerprintingEnabled = securityConfig.advancedFingerprinting;\n            console.log('[SECURITY CONFIG] Advanced fingerprinting:', this.advancedFingerprintingEnabled);\n          }\n        } else {\n          // Default behavior if no security config provided\n          console.log('[SECURITY CONFIG] No security config received, using defaults');\n        }\n        \n        // Only render challenge if not in reload mode (to prevent double animation)\n        if (!this.isReloading) {\n          this.renderChallenge();\n        }\n      } catch (error) {\n        console.error('Challenge generation error:', error);\n        this.status = 'error';\n        // Shorten error messages\n        let shortMsg = 'Load failed';\n        if (error.message.includes('Invalid sitekey') || error.message.includes('sitekey')) {\n          shortMsg = 'Invalid key';\n        } else if (error.message.includes('token') || error.message.includes('expired')) {\n          shortMsg = 'Token expired';\n        } else if (error.message.includes('Bad request')) {\n          shortMsg = 'Bad request';\n        }\n        this.errorMessage = shortMsg;\n        this.clearChallengeTimers();\n        this.updateWidgetState();\n        this.hideOverlay();\n        this.triggerCallback('errorCallback', error.message);\n      }\n    }\n\n    /**\n     * Show overlay\n     */\n    showOverlay() {\n      if (!this.overlayElement) return;\n      \n      const overlay = this.overlayElement;\n      \n      // Explicitly set pointer events to block all interactions\n      overlay.style.pointerEvents = 'auto';\n      \n      // Lock body scrolling and touch to prevent background interaction\n      const previousOverflow = document.body.style.overflow;\n      const previousTouchAction = document.body.style.touchAction;\n      document.body.style.overflow = 'hidden';\n      document.body.style.touchAction = 'none'; // Prevent all touch gestures\n      this._previousBodyOverflow = previousOverflow;\n      this._previousBodyTouchAction = previousTouchAction;\n      \n      // Add comprehensive event blocking\n      const blockTouchEvents = (e) => {\n        // Only prevent if touching the overlay background, not the modal content\n        if (e.target === overlay) {\n          e.preventDefault();\n          e.stopPropagation();\n        }\n      };\n      \n      const blockAllTouchEvents = (e) => {\n        // Only block touch events on overlay background, allow modal content to receive events\n        if (e.target === overlay) {\n          e.preventDefault();\n          e.stopPropagation();\n        }\n      };\n      \n      const blockWheel = (e) => {\n        // Only prevent wheel on overlay background\n        if (e.target === overlay) {\n          e.preventDefault();\n          e.stopPropagation();\n        }\n      };\n      \n      const blockPointerEvents = (e) => {\n        // Only block pointer events on overlay background, allow modal content (including gesture area)\n        if (e.target === overlay) {\n          e.preventDefault();\n          e.stopPropagation();\n        }\n      };\n      \n      // Store handlers for cleanup\n      this._touchstartHandler = blockAllTouchEvents;\n      this._touchmoveHandler = blockTouchEvents;\n      this._clickHandler = blockTouchEvents;\n      this._wheelHandler = blockWheel;\n      this._pointerdownHandler = blockPointerEvents;\n      \n      // Add event listeners with passive:false to allow preventDefault\n      overlay.addEventListener('touchstart', this._touchstartHandler, { passive: false, capture: true });\n      overlay.addEventListener('touchmove', this._touchmoveHandler, { passive: false, capture: true });\n      overlay.addEventListener('click', this._clickHandler, { capture: true });\n      overlay.addEventListener('wheel', this._wheelHandler, { passive: false, capture: true });\n      overlay.addEventListener('pointerdown', this._pointerdownHandler, { passive: false, capture: true });\n      \n      // Show overlay\n      overlay.classList.add('active');\n    }\n\n    /**\n     * Hide overlay\n     */\n    hideOverlay() {\n      if (!this.overlayElement) return;\n      \n      const overlay = this.overlayElement;\n      \n      // Remove event listeners\n      if (this._touchstartHandler) {\n        overlay.removeEventListener('touchstart', this._touchstartHandler, { capture: true });\n        overlay.removeEventListener('touchmove', this._touchmoveHandler, { capture: true });\n        overlay.removeEventListener('click', this._clickHandler, { capture: true });\n        overlay.removeEventListener('wheel', this._wheelHandler, { capture: true });\n        overlay.removeEventListener('pointerdown', this._pointerdownHandler, { capture: true });\n        this._touchstartHandler = null;\n        this._touchmoveHandler = null;\n        this._clickHandler = null;\n        this._wheelHandler = null;\n        this._pointerdownHandler = null;\n      }\n      \n      // Restore body scrolling and touch action\n      if (this._previousBodyOverflow !== undefined) {\n        document.body.style.overflow = this._previousBodyOverflow;\n        this._previousBodyOverflow = undefined;\n      }\n      if (this._previousBodyTouchAction !== undefined) {\n        document.body.style.touchAction = this._previousBodyTouchAction;\n        this._previousBodyTouchAction = undefined;\n      }\n      \n      // Hide overlay\n      overlay.classList.remove('active');\n      this.selectedCells = [];\n      this.jigsawPieces = [];\n    }\n\n    /**\n     * Cancel challenge and reset widget state\n     */\n    cancelChallenge() {\n      // Clear any active challenge timers\n      this.clearChallengeTimers();\n      \n      // Reset status to idle if not already success or blocked\n      if (this.status !== 'success' && this.status !== 'blocked') {\n        this.status = 'idle';\n      }\n      \n      // Hide overlay\n      this.hideOverlay();\n      \n      // Update widget to show checkbox again\n      this.updateWidgetState();\n    }\n\n    /**\n     * Destroy widget and cleanup\n     */\n    destroy() {\n      // Clear challenge timers\n      this.clearChallengeTimers();\n      \n      // FIXED BUG #4: Clear police animation timers to prevent memory leak\n      if (this.container) {\n        const widgets = this.container.querySelectorAll('.proofcaptcha-widget');\n        widgets.forEach(widget => {\n          AntiDebugger.clearPoliceAnimationTimers(widget);\n        });\n      }\n      \n      // Hide overlay first\n      this.hideOverlay();\n      \n      // Remove overlay from DOM\n      if (this.overlayElement && this.overlayElement.parentNode) {\n        this.overlayElement.parentNode.removeChild(this.overlayElement);\n        this.overlayElement = null;\n      }\n      \n      // Clear any intervals\n      if (this.countdownInterval) {\n        clearInterval(this.countdownInterval);\n        this.countdownInterval = null;\n      }\n      \n      // Clear container\n      if (this.container) {\n        this.container.innerHTML = '';\n      }\n    }\n\n    /**\n     * Render challenge based on type\n     */\n    renderChallenge() {\n      if (!this.overlayElement) return;\n      \n      const modal = this.overlayElement.querySelector('.proofcaptcha-modal');\n      if (!modal) return;\n      \n      // Add slide-in animation class for smooth transition\n      modal.classList.add('proofcaptcha-slide-in');\n      \n      // Remove animation class after animation completes\n      setTimeout(() => {\n        modal.classList.remove('proofcaptcha-slide-in');\n      }, 400);\n      \n      // Start challenge timeout countdown (1 minute)\n      this.startChallengeCountdown();\n      \n      if (this.actualType === 'grid') {\n        this.renderGridChallenge(modal);\n      } else if (this.actualType === 'jigsaw') {\n        this.renderJigsawChallenge(modal);\n      } else if (this.actualType === 'gesture') {\n        this.renderGestureChallenge(modal);\n      } else if (this.actualType === 'upside_down') {\n        this.renderUpsideDownChallenge(modal);\n      }\n    }\n\n\n    /**\n     * Render grid challenge\n     */\n    renderGridChallenge(modal) {\n      const gridSize = this.challenge.gridSize || 3;\n      const gridEmojis = this.challenge.gridEmojis || [];\n      const targetEmojis = this.challenge.targetEmojis || ['üçé'];\n      \n      let gridCells = '';\n      for (let i = 0; i < gridSize * gridSize; i++) {\n        const emoji = gridEmojis[i] || '‚ùì';\n        gridCells += `\n          <button class=\"proofcaptcha-grid-cell\" data-cell-index=\"${i}\">\n            <span class=\"proofcaptcha-grid-emoji\">${emoji}</span>\n          </button>\n        `;\n      }\n      \n      modal.innerHTML = `\n        <div class=\"proofcaptcha-p-6\">\n          <div class=\"proofcaptcha-challenge-header\">\n            <div>\n              <h3 class=\"proofcaptcha-challenge-title\">Grid Challenge</h3>\n              <p class=\"proofcaptcha-challenge-description\">\n                Select these: ${targetEmojis.map(e => `<span style=\"font-size: 20px;\">${e}</span>`).join(' ')}\n              </p>\n            </div>\n            <div class=\"proofcaptcha-challenge-actions\">\n              <button class=\"proofcaptcha-btn proofcaptcha-btn-ghost proofcaptcha-btn-icon\" data-refresh title=\"New Challenge\">\n                ${Icons.refresh}\n              </button>\n              <button class=\"proofcaptcha-btn proofcaptcha-btn-ghost proofcaptcha-btn-icon\" data-close>\n                ${Icons.close}\n              </button>\n            </div>\n          </div>\n          \n          <div class=\"proofcaptcha-grid-container\" style=\"grid-template-columns: repeat(${gridSize}, 1fr);\">\n            ${gridCells}\n          </div>\n\n          <p class=\"proofcaptcha-info-text\" data-selected-count>\n            0 cells selected\n          </p>\n\n          <div class=\"proofcaptcha-button-grid\">\n            <button class=\"proofcaptcha-btn proofcaptcha-btn-outline proofcaptcha-btn-lg\" data-skip>\n              Skip\n            </button>\n            <button class=\"proofcaptcha-btn proofcaptcha-btn-primary proofcaptcha-btn-lg\" data-verify disabled>\n              Verify\n            </button>\n          </div>\n\n          <div class=\"proofcaptcha-progress proofcaptcha-hidden\" data-progress-container>\n            <div class=\"proofcaptcha-progress-bar\" data-progress-bar style=\"width: 0%\"></div>\n          </div>\n        </div>\n      `;\n      \n      modal.querySelector('[data-close]').addEventListener('click', () => this.cancelChallenge());\n      modal.querySelector('[data-refresh]').addEventListener('click', () => this.loadNewChallengeWithAnimation());\n      modal.querySelector('[data-skip]').addEventListener('click', () => this.cancelChallenge());\n      modal.querySelector('[data-verify]').addEventListener('click', () => this.verifyGrid());\n      \n      modal.querySelectorAll('[data-cell-index]').forEach(cell => {\n        cell.addEventListener('click', () => {\n          const index = parseInt(cell.dataset.cellIndex);\n          this.handleGridCellClick(index, cell);\n        });\n      });\n    }\n\n    /**\n     * Handle grid cell click\n     */\n    handleGridCellClick(index, cellElement) {\n      if (this.status === 'solving') return;\n      \n      if (this.selectedCells.includes(index)) {\n        this.selectedCells = this.selectedCells.filter(i => i !== index);\n        cellElement.classList.remove('selected');\n        const check = cellElement.querySelector('.proofcaptcha-grid-check');\n        if (check) check.remove();\n      } else {\n        this.selectedCells.push(index);\n        this.selectedCells.sort((a, b) => a - b);\n        cellElement.classList.add('selected');\n        cellElement.innerHTML += `\n          <div class=\"proofcaptcha-grid-check\">\n            ${Icons.checkCircle}\n          </div>\n        `;\n      }\n      \n      if (!this.overlayElement) return;\n      const modal = this.overlayElement.querySelector('.proofcaptcha-modal');\n      if (!modal) return;\n      \n      const countText = modal.querySelector('[data-selected-count]');\n      const verifyBtn = modal.querySelector('[data-verify]');\n      \n      if (countText) countText.textContent = `${this.selectedCells.length} cells selected`;\n      if (verifyBtn) verifyBtn.disabled = this.selectedCells.length === 0;\n    }\n\n    /**\n     * Render jigsaw challenge\n     */\n    renderJigsawChallenge(modal) {\n      const pieces = this.challenge.pieces || [0, 1, 2, 3];\n      const pieceEmojis = ['üî¥', 'üîµ', 'üü¢', 'üü°'];\n      \n      let piecesHtml = '';\n      pieces.forEach((piece, idx) => {\n        piecesHtml += `\n          <button class=\"proofcaptcha-jigsaw-piece color-${piece}\" data-piece=\"${piece}\">\n            <span class=\"proofcaptcha-jigsaw-emoji\">${pieceEmojis[piece]}</span>\n          </button>\n        `;\n      });\n      \n      modal.innerHTML = `\n        <div class=\"proofcaptcha-p-6\">\n          <div class=\"proofcaptcha-challenge-header\">\n            <div>\n              <h3 class=\"proofcaptcha-challenge-title\">Jigsaw Challenge</h3>\n              <p class=\"proofcaptcha-challenge-description\">\n                Click pieces in order: üî¥ üîµ üü¢ üü°\n              </p>\n            </div>\n            <div class=\"proofcaptcha-challenge-actions\">\n              <button class=\"proofcaptcha-btn proofcaptcha-btn-ghost proofcaptcha-btn-icon\" data-refresh title=\"New Challenge\">\n                ${Icons.refresh}\n              </button>\n              <button class=\"proofcaptcha-btn proofcaptcha-btn-ghost proofcaptcha-btn-icon\" data-close>\n                ${Icons.close}\n              </button>\n            </div>\n          </div>\n          \n          <div class=\"proofcaptcha-jigsaw-container\">\n            ${piecesHtml}\n          </div>\n\n          <p class=\"proofcaptcha-info-text\" data-selected-count>\n            0/4 pieces arranged\n          </p>\n\n          <div class=\"proofcaptcha-button-grid\">\n            <button class=\"proofcaptcha-btn proofcaptcha-btn-outline proofcaptcha-btn-lg\" data-skip>\n              Skip\n            </button>\n            <button class=\"proofcaptcha-btn proofcaptcha-btn-primary proofcaptcha-btn-lg\" data-verify disabled>\n              Verify\n            </button>\n          </div>\n\n          <div class=\"proofcaptcha-progress proofcaptcha-hidden\" data-progress-container>\n            <div class=\"proofcaptcha-progress-bar\" data-progress-bar style=\"width: 0%\"></div>\n          </div>\n        </div>\n      `;\n      \n      modal.querySelector('[data-close]').addEventListener('click', () => this.cancelChallenge());\n      modal.querySelector('[data-refresh]').addEventListener('click', () => this.loadNewChallengeWithAnimation());\n      modal.querySelector('[data-skip]').addEventListener('click', () => this.cancelChallenge());\n      modal.querySelector('[data-verify]').addEventListener('click', () => this.verifyJigsaw());\n      \n      modal.querySelectorAll('[data-piece]').forEach(pieceEl => {\n        pieceEl.addEventListener('click', () => {\n          const piece = parseInt(pieceEl.dataset.piece);\n          this.handleJigsawPieceClick(piece, pieceEl);\n        });\n      });\n    }\n\n    /**\n     * Handle jigsaw piece click\n     */\n    handleJigsawPieceClick(piece, pieceElement) {\n      if (this.status === 'solving') return;\n      \n      if (this.jigsawPieces.includes(piece)) {\n        this.jigsawPieces = this.jigsawPieces.filter(p => p !== piece);\n        pieceElement.classList.remove('selected');\n        const order = pieceElement.querySelector('.proofcaptcha-jigsaw-order');\n        if (order) order.remove();\n      } else {\n        this.jigsawPieces.push(piece);\n        pieceElement.classList.add('selected');\n        const orderNum = this.jigsawPieces.length;\n        pieceElement.innerHTML += `\n          <div class=\"proofcaptcha-jigsaw-order\">${orderNum}</div>\n        `;\n      }\n      \n      if (!this.overlayElement) return;\n      const modal = this.overlayElement.querySelector('.proofcaptcha-modal');\n      if (!modal) return;\n      \n      const countText = modal.querySelector('[data-selected-count]');\n      const verifyBtn = modal.querySelector('[data-verify]');\n      \n      if (countText) countText.textContent = `${this.jigsawPieces.length}/4 pieces arranged`;\n      if (verifyBtn) verifyBtn.disabled = this.jigsawPieces.length !== 4;\n    }\n\n\n    /**\n     * Render gesture challenge\n     */\n    renderGestureChallenge(modal) {\n      const gridSize = this.challenge.gridSize || { width: 300, height: 300 };\n      const target = this.challenge.target || { x: 150, y: 150 };\n      const tolerance = this.challenge.tolerance || 15;\n      const puzzleSeed = this.challenge.puzzleSeed || 1234;\n      const puzzleImageUrl = this.challenge.puzzleImageUrl || 'https://picsum.photos/seed/default/400/400';\n      \n      // Initialize drag position to starting point (top-left area)\n      this.dragPosition = { x: 50, y: 50 };\n      this.isDragging = false;\n      \n      const puzzleSize = 60;\n      const puzzlePath = generateJigsawPath(puzzleSeed, puzzleSize);\n      \n      modal.innerHTML = `\n        <div class=\"proofcaptcha-p-6\">\n          <div class=\"proofcaptcha-challenge-header\">\n            <div>\n              <h3 class=\"proofcaptcha-challenge-title\">Puzzle Challenge</h3>\n              <p class=\"proofcaptcha-challenge-description\">\n                Drag the puzzle piece to fit the hole\n              </p>\n            </div>\n            <div class=\"proofcaptcha-challenge-actions\">\n              <button class=\"proofcaptcha-btn proofcaptcha-btn-ghost proofcaptcha-btn-icon\" data-refresh title=\"New Challenge\">\n                ${Icons.refresh}\n              </button>\n              <button class=\"proofcaptcha-btn proofcaptcha-btn-ghost proofcaptcha-btn-icon\" data-close>\n                ${Icons.close}\n              </button>\n            </div>\n          </div>\n          \n          <div \n            style=\"position: relative; width: ${gridSize.width}px; height: ${gridSize.height}px; margin: 0 auto 16px; border-radius: 12px; overflow: hidden; border: 2px solid hsl(var(--pc-border)); user-select: none; touch-action: none;\" \n            data-gesture-area\n          >\n            <!-- SVG layer for background image and hole -->\n            <svg \n              style=\"position: absolute; inset: 0; pointer-events: none;\"\n              width=\"${gridSize.width}\" \n              height=\"${gridSize.height}\"\n            >\n              <defs>\n                <!-- Pattern for background image -->\n                <pattern id=\"puzzleBackgroundImage-${this.widgetId}\" x=\"0\" y=\"0\" width=\"1\" height=\"1\">\n                  <image \n                    href=\"${puzzleImageUrl}\" \n                    x=\"0\" \n                    y=\"0\" \n                    width=\"${gridSize.width}\" \n                    height=\"${gridSize.height}\"\n                    preserveAspectRatio=\"xMidYMid slice\"\n                  />\n                </pattern>\n                \n                <!-- Mask for all area except hole -->\n                <mask id=\"puzzleHoleMask-${this.widgetId}\">\n                  <rect width=\"${gridSize.width}\" height=\"${gridSize.height}\" fill=\"white\" />\n                  <path \n                    d=\"${puzzlePath}\" \n                    transform=\"translate(${target.x - puzzleSize/2}, ${target.y - puzzleSize/2})\"\n                    fill=\"black\"\n                  />\n                </mask>\n              </defs>\n              \n              <!-- Background image with mask (not visible in hole) -->\n              <rect \n                width=\"${gridSize.width}\" \n                height=\"${gridSize.height}\" \n                fill=\"url(#puzzleBackgroundImage-${this.widgetId})\"\n                mask=\"url(#puzzleHoleMask-${this.widgetId})\"\n              />\n              \n              <!-- Hole area - black solid -->\n              <path \n                d=\"${puzzlePath}\" \n                transform=\"translate(${target.x - puzzleSize/2}, ${target.y - puzzleSize/2})\"\n                fill=\"rgba(0, 0, 0, 0.85)\"\n              />\n              \n              <!-- Hole border - subtle -->\n              <path \n                data-hole-border\n                d=\"${puzzlePath}\" \n                transform=\"translate(${target.x - puzzleSize/2}, ${target.y - puzzleSize/2})\"\n                fill=\"none\"\n                stroke=\"rgba(255, 255, 255, 0.3)\"\n                stroke-width=\"1.5\"\n                opacity=\"0.5\"\n              />\n            </svg>\n            \n            <!-- Draggable puzzle piece -->\n            <div\n              style=\"position: absolute; left: ${this.dragPosition.x}px; top: ${this.dragPosition.y}px; transform: translate(-50%, -50%); z-index: 2; transition: filter 0.1s; cursor: grab;\"\n              data-puzzle-piece\n            >\n              <svg \n                width=\"${puzzleSize + 20}\" \n                height=\"${puzzleSize + 20}\" \n                viewBox=\"-10 -10 ${puzzleSize + 20} ${puzzleSize + 20}\"\n                style=\"transition: transform 0.1s; filter: drop-shadow(0 6px 12px rgba(0, 0, 0, 0.5));\"\n                data-puzzle-svg\n              >\n                <defs>\n                  <clipPath id=\"puzzlePieceClip-${this.widgetId}\">\n                    <path d=\"${puzzlePath}\" />\n                  </clipPath>\n                </defs>\n                \n                <!-- Puzzle piece with offset image - always show part from target -->\n                <g clip-path=\"url(#puzzlePieceClip-${this.widgetId})\">\n                  <image \n                    href=\"${puzzleImageUrl}\" \n                    x=\"${-target.x + puzzleSize/2}\" \n                    y=\"${-target.y + puzzleSize/2}\"\n                    width=\"${gridSize.width}\" \n                    height=\"${gridSize.height}\"\n                    preserveAspectRatio=\"xMidYMid slice\"\n                  />\n                </g>\n                \n                <!-- Puzzle piece border -->\n                <path \n                  data-piece-border\n                  d=\"${puzzlePath}\" \n                  fill=\"none\"\n                  stroke=\"#ffffff\"\n                  stroke-width=\"2.5\"\n                  opacity=\"0.95\"\n                />\n                \n                <!-- Inner highlight for 3D effect -->\n                <path \n                  d=\"${puzzlePath}\" \n                  fill=\"none\"\n                  stroke=\"rgba(255, 255, 255, 0.5)\"\n                  stroke-width=\"1\"\n                />\n              </svg>\n              \n              <!-- Distance indicator when near target -->\n              <div data-distance-indicator style=\"position: absolute; bottom: -32px; left: 50%; transform: translateX(-50%); white-space: nowrap; display: none;\">\n                <div style=\"background: #10b981; color: white; font-size: 12px; padding: 4px 8px; border-radius: 9999px; font-weight: 600; animation: pulse 1s cubic-bezier(0.4, 0, 0.6, 1) infinite;\">\n                  <span data-distance-text>0px away</span>\n                </div>\n              </div>\n            </div>\n          </div>\n\n          <p style=\"text-align: center; font-size: 14px; color: hsl(var(--pc-muted-foreground)); margin-bottom: 16px;\" data-feedback-text>\n            Drag the jigsaw piece to complete the puzzle\n          </p>\n\n          <div class=\"proofcaptcha-button-grid\">\n            <button class=\"proofcaptcha-btn proofcaptcha-btn-outline proofcaptcha-btn-lg\" data-skip>\n              Skip\n            </button>\n            <button class=\"proofcaptcha-btn proofcaptcha-btn-primary proofcaptcha-btn-lg\" data-verify>\n              Verify\n            </button>\n          </div>\n\n          <div class=\"proofcaptcha-progress proofcaptcha-hidden\" data-progress-container>\n            <div class=\"proofcaptcha-progress-bar\" data-progress-bar style=\"width: 0%\"></div>\n          </div>\n        </div>\n      `;\n      \n      modal.querySelector('[data-close]').addEventListener('click', () => this.cancelChallenge());\n      modal.querySelector('[data-refresh]').addEventListener('click', () => this.loadNewChallengeWithAnimation());\n      modal.querySelector('[data-skip]').addEventListener('click', () => this.cancelChallenge());\n      modal.querySelector('[data-verify]').addEventListener('click', () => this.verifyGesture());\n      \n      // Setup drag handlers\n      const gestureArea = modal.querySelector('[data-gesture-area]');\n      const puzzlePiece = modal.querySelector('[data-puzzle-piece]');\n      const distanceIndicator = modal.querySelector('[data-distance-indicator]');\n      const distanceText = modal.querySelector('[data-distance-text]');\n      \n      const updatePuzzlePiecePosition = () => {\n        puzzlePiece.style.left = `${this.dragPosition.x}px`;\n        puzzlePiece.style.top = `${this.dragPosition.y}px`;\n        \n        // Check proximity to target\n        const dx = this.dragPosition.x - target.x;\n        const dy = this.dragPosition.y - target.y;\n        const distance = Math.sqrt(dx * dx + dy * dy);\n        const isNear = distance <= tolerance * 1.5;\n        \n        if (distanceIndicator) {\n          distanceIndicator.style.display = isNear ? 'block' : 'none';\n          if (distanceText && isNear) {\n            distanceText.textContent = `${Math.round(distance)}px away`;\n          }\n        }\n      };\n      \n      const handlePointerDown = (e) => {\n        if (this.status !== 'idle') return;\n        this.isDragging = true;\n        puzzlePiece.style.cursor = 'grabbing';\n        puzzlePiece.style.filter = 'drop-shadow(0 12px 20px rgba(0, 0, 0, 0.6))';\n        gestureArea.setPointerCapture(e.pointerId);\n        e.preventDefault();\n      };\n      \n      const handlePointerMove = (e) => {\n        if (!this.isDragging || this.status !== 'idle') return;\n        \n        const rect = gestureArea.getBoundingClientRect();\n        const x = Math.max(0, Math.min(e.clientX - rect.left, gridSize.width));\n        const y = Math.max(0, Math.min(e.clientY - rect.top, gridSize.height));\n        \n        this.dragPosition = { x, y };\n        updatePuzzlePiecePosition();\n        e.preventDefault();\n      };\n      \n      const handlePointerUp = (e) => {\n        if (this.isDragging) {\n          this.isDragging = false;\n          puzzlePiece.style.cursor = 'grab';\n          puzzlePiece.style.filter = 'drop-shadow(0 6px 12px rgba(0, 0, 0, 0.5))';\n          gestureArea.releasePointerCapture(e.pointerId);\n          e.preventDefault();\n        }\n      };\n      \n      gestureArea.addEventListener('pointerdown', handlePointerDown);\n      gestureArea.addEventListener('pointermove', handlePointerMove);\n      gestureArea.addEventListener('pointerup', handlePointerUp);\n      gestureArea.addEventListener('pointercancel', handlePointerUp);\n    }\n\n    /**\n     * Render upside down challenge\n     */\n    renderUpsideDownChallenge(modal) {\n      const canvasWidth = this.challenge.canvasWidth || 600;\n      const canvasHeight = this.challenge.canvasHeight || 400;\n      const animals = this.challenge.animals || [];\n      const backgroundUrl = this.challenge.backgroundUrl;\n      const backgroundIndex = this.challenge.backgroundIndex || 0;\n      \n      modal.innerHTML = `\n        <div class=\"proofcaptcha-p-6\">\n          <div class=\"proofcaptcha-challenge-header\">\n            <div>\n              <h3 class=\"proofcaptcha-challenge-title\">Animal Challenge</h3>\n              <p class=\"proofcaptcha-challenge-description\">\n                Click on all upside-down animals\n              </p>\n            </div>\n            <div class=\"proofcaptcha-challenge-actions\">\n              <button class=\"proofcaptcha-btn proofcaptcha-btn-ghost proofcaptcha-btn-icon\" data-refresh title=\"New Challenge\">\n                ${Icons.refresh}\n              </button>\n              <button class=\"proofcaptcha-btn proofcaptcha-btn-ghost proofcaptcha-btn-icon\" data-close>\n                ${Icons.close}\n              </button>\n            </div>\n          </div>\n          \n          <div style=\"position: relative; margin-bottom: 16px;\">\n            <canvas \n              data-upside-canvas\n              width=\"${canvasWidth}\" \n              height=\"${canvasHeight}\"\n              style=\"\n                width: 100%; \n                max-width: ${canvasWidth}px;\n                height: auto;\n                border: 2px solid hsl(var(--pc-border));\n                border-radius: 8px;\n                cursor: crosshair;\n                display: block;\n              \"\n            ></canvas>\n          </div>\n\n          <p class=\"proofcaptcha-info-text\" data-clicks-count>\n            Clicks: 0\n          </p>\n\n          <div class=\"proofcaptcha-button-grid\">\n            <button class=\"proofcaptcha-btn proofcaptcha-btn-outline proofcaptcha-btn-lg\" data-reset>\n              Reset\n            </button>\n            <button class=\"proofcaptcha-btn proofcaptcha-btn-primary proofcaptcha-btn-lg\" data-verify disabled>\n              Verify\n            </button>\n          </div>\n\n          <div class=\"proofcaptcha-progress proofcaptcha-hidden\" data-progress-container>\n            <div class=\"proofcaptcha-progress-bar\" data-progress-bar style=\"width: 0%\"></div>\n          </div>\n        </div>\n      `;\n      \n      modal.querySelector('[data-close]').addEventListener('click', () => this.cancelChallenge());\n      modal.querySelector('[data-refresh]').addEventListener('click', () => this.loadNewChallengeWithAnimation());\n      modal.querySelector('[data-reset]').addEventListener('click', () => this.handleUpsideDownReset(modal));\n      modal.querySelector('[data-verify]').addEventListener('click', () => this.verifyUpsideDown());\n      \n      const canvas = modal.querySelector('[data-upside-canvas]');\n      const ctx = canvas.getContext('2d');\n      \n      const imageCache = new Map();\n      let imagesLoaded = false;\n      \n      const animalImages = {\n        cat: `${API_BASE_URL}/assets/generated_images/cat_3d_cute_orange.webp`,\n      };\n      \n      const backgrounds = [\n        `${API_BASE_URL}/assets/stock_images/floral_pattern_green_a3b1b488.jpg`,\n        `${API_BASE_URL}/assets/stock_images/floral_pattern_green_7eb03bb9.jpg`,\n      ];\n      \n      const loadImages = async () => {\n        const promises = [];\n        \n        const bgImg = new Image();\n        bgImg.crossOrigin = 'anonymous';\n        promises.push(new Promise((resolve, reject) => {\n          bgImg.onload = () => {\n            imageCache.set('background', bgImg);\n            resolve();\n          };\n          bgImg.onerror = reject;\n          bgImg.src = backgroundUrl || backgrounds[backgroundIndex];\n        }));\n        \n        const uniqueAnimalPaths = [...new Set(animals.map(a => a.path))];\n        uniqueAnimalPaths.forEach(path => {\n          const img = new Image();\n          img.crossOrigin = 'anonymous';\n          promises.push(new Promise((resolve, reject) => {\n            img.onload = () => {\n              imageCache.set(path, img);\n              resolve();\n            };\n            img.onerror = reject;\n            img.src = path;\n          }));\n        });\n        \n        try {\n          await Promise.all(promises);\n          imagesLoaded = true;\n          drawCanvas();\n        } catch (error) {\n          console.error('Failed to load upside-down images:', error);\n        }\n      };\n      \n      const drawCanvas = () => {\n        if (!imagesLoaded) return;\n        \n        ctx.clearRect(0, 0, canvas.width, canvas.height);\n        \n        const bgImg = imageCache.get('background');\n        if (bgImg) {\n          ctx.drawImage(bgImg, 0, 0, canvas.width, canvas.height);\n        }\n        \n        animals.forEach(animal => {\n          const img = imageCache.get(animal.path);\n          if (!img) return;\n          \n          const size = 80;\n          const rotation = animal.rotation !== undefined ? animal.rotation : 0;\n          \n          ctx.save();\n          ctx.translate(animal.x, animal.y);\n          ctx.rotate((rotation * Math.PI) / 180);\n          ctx.drawImage(img, -size / 2, -size / 2, size, size);\n          ctx.restore();\n        });\n        \n        this.upsideDownClicks.forEach((click, index) => {\n          ctx.fillStyle = 'rgba(255, 50, 50, 0.3)';\n          ctx.strokeStyle = 'rgba(255, 0, 0, 0.8)';\n          ctx.lineWidth = 2;\n          ctx.beginPath();\n          ctx.arc(click.x, click.y, 20, 0, 2 * Math.PI);\n          ctx.fill();\n          ctx.stroke();\n          \n          ctx.fillStyle = '#fff';\n          ctx.font = 'bold 16px sans-serif';\n          ctx.textAlign = 'center';\n          ctx.textBaseline = 'middle';\n          ctx.fillText((index + 1).toString(), click.x, click.y);\n        });\n      };\n      \n      canvas.addEventListener('click', (e) => {\n        if (this.status === 'solving') return;\n        \n        const rect = canvas.getBoundingClientRect();\n        const scaleX = canvas.width / rect.width;\n        const scaleY = canvas.height / rect.height;\n        \n        const x = Math.round((e.clientX - rect.left) * scaleX);\n        const y = Math.round((e.clientY - rect.top) * scaleY);\n        \n        this.upsideDownClicks.push({ x, y });\n        \n        const clicksCountEl = modal.querySelector('[data-clicks-count]');\n        const verifyBtn = modal.querySelector('[data-verify]');\n        \n        if (clicksCountEl) clicksCountEl.textContent = `Clicks: ${this.upsideDownClicks.length}`;\n        if (verifyBtn) verifyBtn.disabled = this.upsideDownClicks.length === 0;\n        \n        drawCanvas();\n      });\n      \n      loadImages();\n    }\n\n    /**\n     * Handle upside down reset\n     */\n    handleUpsideDownReset(modal) {\n      this.upsideDownClicks = [];\n      \n      const clicksCountEl = modal.querySelector('[data-clicks-count]');\n      const verifyBtn = modal.querySelector('[data-verify]');\n      const canvas = modal.querySelector('[data-upside-canvas]');\n      \n      if (clicksCountEl) clicksCountEl.textContent = 'Clicks: 0';\n      if (verifyBtn) verifyBtn.disabled = true;\n      \n      if (canvas) {\n        const ctx = canvas.getContext('2d');\n        const canvasWidth = this.challenge.canvasWidth || 600;\n        const canvasHeight = this.challenge.canvasHeight || 400;\n        const animals = this.challenge.animals || [];\n        const backgroundIndex = this.challenge.backgroundIndex || 0;\n        \n        ctx.clearRect(0, 0, canvas.width, canvas.height);\n        this.renderUpsideDownChallenge(modal);\n      }\n    }\n\n\n    /**\n     * Verify grid challenge\n     */\n    async verifyGrid() {\n      if (!this.challenge || !this.token || this.selectedCells.length === 0) return;\n\n      this.status = 'solving';\n      \n      if (!this.overlayElement) return;\n      const modal = this.overlayElement.querySelector('.proofcaptcha-modal');\n      if (!modal) return;\n      \n      const progressContainer = modal.querySelector('[data-progress-container]');\n      const progressBar = modal.querySelector('[data-progress-bar]');\n      const verifyBtn = modal.querySelector('[data-verify]');\n      \n      if (progressContainer) progressContainer.classList.remove('proofcaptcha-hidden');\n      if (progressBar) progressBar.style.width = '50%';\n      if (verifyBtn) verifyBtn.disabled = true;\n\n      try {\n        // SECURITY: Solve ALTCHA proof-of-work to prevent ML-based automated solvers\n        const powSolution = await solveProofOfWork(\n          {\n            salt: this.challenge.salt,\n            challengeHash: this.challenge.challengeHash,\n            maxNumber: this.challenge.maxNumber,\n          },\n          (hash, attempts) => {\n            const powProgress = Math.min(50 + (attempts / 1000) * 25, 75);\n            if (progressBar) progressBar.style.width = `${powProgress}%`;\n          }\n        );\n\n        if (progressBar) progressBar.style.width = '80%';\n\n        // Create solution payload: {answer: [...], powSolution: \"...\"}\n        const solutionPayload = {\n          answer: this.selectedCells,\n          powSolution,\n        };\n        const solution = JSON.stringify(solutionPayload);\n        const clientDetections = detectClientAutomation();\n        \n        // Collect browser fingerprint for verification (conditional based on API key settings)\n        const fingerprint = await this.collectFingerprint();\n        \n        // Get behavioral data\n        const behavioralData = BehavioralTracker.getData();\n\n        // Prepare metadata object for encryption\n        const metadata = {\n          clientDetections,\n          canvasHash: fingerprint.canvasHash,\n          webglHash: fingerprint.webglHash,\n          audioHash: fingerprint.audioHash,\n          fonts: fingerprint.fonts,\n          screenFingerprint: fingerprint.screenFingerprint,\n          plugins: fingerprint.plugins,\n          timezone: fingerprint.timezone,\n          platform: fingerprint.platform,\n          hardwareConcurrency: fingerprint.hardwareConcurrency,\n          deviceMemory: fingerprint.deviceMemory,\n          colorDepth: fingerprint.colorDepth,\n          pixelRatio: fingerprint.pixelRatio,\n          mouseMovements: behavioralData.mouseMovements,\n          keyboardEvents: behavioralData.keyboardEvents,\n          submissionTime: behavioralData.submissionTime\n        };\n\n        // Encrypt solution and metadata if encryption is available\n        let requestBody = { token: this.token };\n        \n        if (EncryptionManager.currentSession) {\n          const encryptedSolution = await EncryptionManager.encryptSolution(solution, this.token);\n          const encryptedMetadata = await EncryptionManager.encryptVerificationMetadata(metadata, this.token);\n          \n          if (encryptedSolution && encryptedMetadata) {\n            requestBody.encrypted = encryptedSolution;\n            requestBody.encryptedMetadata = encryptedMetadata;\n            requestBody.publicKey = this.publicKey;\n          } else {\n            requestBody.solution = solution;\n            Object.assign(requestBody, metadata);\n          }\n        } else {\n          requestBody.solution = solution;\n          Object.assign(requestBody, metadata);\n        }\n\n        const response = await fetch(`${API_BASE_URL}/api/captcha/verify`, {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify(requestBody),\n          credentials: 'include'\n        });\n\n        const result = await response.json();\n\n        if (result.success) {\n          progressBar.style.width = '100%';\n          this.status = 'success';\n          \n          // Clear challenge timers on success\n          this.clearChallengeTimers();\n          \n          // Start token expiry timer (1 minute)\n          this.startTokenExpiryTimer();\n          \n          modal.innerHTML = `\n            <div class=\"proofcaptcha-p-6\">\n              <div class=\"proofcaptcha-success-celebration\">\n                <div class=\"proofcaptcha-success-sparkles\">\n                  <div class=\"sparkle sparkle-1\">‚ú®</div>\n                  <div class=\"sparkle sparkle-2\">‚≠ê</div>\n                  <div class=\"sparkle sparkle-3\">‚ú®</div>\n                  <div class=\"sparkle sparkle-4\">‚≠ê</div>\n                  <div class=\"sparkle sparkle-5\">‚ú®</div>\n                  <div class=\"sparkle sparkle-6\">‚≠ê</div>\n                </div>\n                <div class=\"proofcaptcha-success-icon-wrapper\">\n                  <div class=\"proofcaptcha-success-icon\">\n                    ${Icons.checkCircle}\n                  </div>\n                  <div class=\"proofcaptcha-success-ring\"></div>\n                  <div class=\"proofcaptcha-success-ring-2\"></div>\n                </div>\n                <div class=\"proofcaptcha-success-content\">\n                  <h3 class=\"proofcaptcha-success-title\">Success!</h3>\n                  <p class=\"proofcaptcha-success-message\">Puzzle solved successfully</p>\n                </div>\n              </div>\n            </div>\n          `;\n          \n          // IMPORTANT: Always use verification token for siteverify\n          // Fallback to challenge token only for legacy auth flows\n          this.verificationToken = result.verificationToken;\n          if (!this.verificationToken) {\n            console.warn('ProofCaptcha: No verificationToken in response, using challenge token');\n            this.verificationToken = this.token;\n          }\n          \n          setTimeout(() => {\n            this.hideOverlay();\n            this.updateWidgetState();\n            // Send verification token (not challenge token) to callback\n            this.triggerCallback('callback', this.verificationToken);\n          }, 1000);\n        } else {\n          this.status = 'error';\n          this.errorMessage = 'Try again';\n          this.clearChallengeTimers();\n          \n          // Immediate auto-refresh challenge with slide animation\n          setTimeout(() => {\n            this.selectedCells = [];\n            this.status = 'idle';\n            this.errorMessage = '';\n            this.loadNewChallengeWithAnimation();\n          }, 800);\n        }\n      } catch (error) {\n        console.error('Verification error:', error);\n        this.status = 'error';\n        this.errorMessage = 'Error occurred';\n        this.clearChallengeTimers();\n        \n        // Immediate auto-refresh on error with slide animation\n        setTimeout(() => {\n          this.selectedCells = [];\n          this.status = 'idle';\n          this.errorMessage = '';\n          this.loadNewChallengeWithAnimation();\n        }, 800);\n      }\n    }\n\n    /**\n     * Verify jigsaw challenge\n     */\n    async verifyJigsaw() {\n      if (!this.challenge || !this.token || this.jigsawPieces.length !== 4) return;\n\n      this.status = 'solving';\n      \n      if (!this.overlayElement) return;\n      const modal = this.overlayElement.querySelector('.proofcaptcha-modal');\n      if (!modal) return;\n      \n      const progressContainer = modal.querySelector('[data-progress-container]');\n      const progressBar = modal.querySelector('[data-progress-bar]');\n      const verifyBtn = modal.querySelector('[data-verify]');\n      \n      if (progressContainer) progressContainer.classList.remove('proofcaptcha-hidden');\n      if (progressBar) progressBar.style.width = '50%';\n      if (verifyBtn) verifyBtn.disabled = true;\n\n      try {\n        // SECURITY: Solve ALTCHA proof-of-work to prevent ML-based automated solvers\n        const powSolution = await solveProofOfWork(\n          {\n            salt: this.challenge.salt,\n            challengeHash: this.challenge.challengeHash,\n            maxNumber: this.challenge.maxNumber,\n          },\n          (hash, attempts) => {\n            const powProgress = Math.min(50 + (attempts / 1000) * 25, 75);\n            if (progressBar) progressBar.style.width = `${powProgress}%`;\n          }\n        );\n\n        if (progressBar) progressBar.style.width = '80%';\n\n        // Create solution payload: {answer: [...], powSolution: \"...\"}\n        const solutionPayload = {\n          answer: this.jigsawPieces,\n          powSolution,\n        };\n        const solution = JSON.stringify(solutionPayload);\n        const clientDetections = detectClientAutomation();\n        \n        // Collect browser fingerprint for verification (conditional based on API key settings)\n        const fingerprint = await this.collectFingerprint();\n        \n        // Get behavioral data\n        const behavioralData = BehavioralTracker.getData();\n\n        // Prepare metadata object for encryption\n        const metadata = {\n          clientDetections,\n          canvasHash: fingerprint.canvasHash,\n          webglHash: fingerprint.webglHash,\n          audioHash: fingerprint.audioHash,\n          fonts: fingerprint.fonts,\n          screenFingerprint: fingerprint.screenFingerprint,\n          plugins: fingerprint.plugins,\n          timezone: fingerprint.timezone,\n          platform: fingerprint.platform,\n          hardwareConcurrency: fingerprint.hardwareConcurrency,\n          deviceMemory: fingerprint.deviceMemory,\n          colorDepth: fingerprint.colorDepth,\n          pixelRatio: fingerprint.pixelRatio,\n          mouseMovements: behavioralData.mouseMovements,\n          keyboardEvents: behavioralData.keyboardEvents,\n          submissionTime: behavioralData.submissionTime\n        };\n\n        // Encrypt solution and metadata if encryption is available\n        let requestBody = { token: this.token };\n        \n        if (EncryptionManager.currentSession) {\n          const encryptedSolution = await EncryptionManager.encryptSolution(solution, this.token);\n          const encryptedMetadata = await EncryptionManager.encryptVerificationMetadata(metadata, this.token);\n          \n          if (encryptedSolution && encryptedMetadata) {\n            requestBody.encrypted = encryptedSolution;\n            requestBody.encryptedMetadata = encryptedMetadata;\n            requestBody.publicKey = this.publicKey;\n          } else {\n            requestBody.solution = solution;\n            Object.assign(requestBody, metadata);\n          }\n        } else {\n          requestBody.solution = solution;\n          Object.assign(requestBody, metadata);\n        }\n\n        const response = await fetch(`${API_BASE_URL}/api/captcha/verify`, {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify(requestBody),\n          credentials: 'include'\n        });\n\n        const result = await response.json();\n\n        if (result.success) {\n          progressBar.style.width = '100%';\n          this.status = 'success';\n          \n          // Clear challenge timers on success\n          this.clearChallengeTimers();\n          \n          // Start token expiry timer (1 minute)\n          this.startTokenExpiryTimer();\n          \n          modal.innerHTML = `\n            <div class=\"proofcaptcha-p-6\">\n              <div class=\"proofcaptcha-success-celebration\">\n                <div class=\"proofcaptcha-success-sparkles\">\n                  <div class=\"sparkle sparkle-1\">‚ú®</div>\n                  <div class=\"sparkle sparkle-2\">‚≠ê</div>\n                  <div class=\"sparkle sparkle-3\">‚ú®</div>\n                  <div class=\"sparkle sparkle-4\">‚≠ê</div>\n                  <div class=\"sparkle sparkle-5\">‚ú®</div>\n                  <div class=\"sparkle sparkle-6\">‚≠ê</div>\n                </div>\n                <div class=\"proofcaptcha-success-icon-wrapper\">\n                  <div class=\"proofcaptcha-success-icon\">\n                    ${Icons.checkCircle}\n                  </div>\n                  <div class=\"proofcaptcha-success-ring\"></div>\n                  <div class=\"proofcaptcha-success-ring-2\"></div>\n                </div>\n                <div class=\"proofcaptcha-success-content\">\n                  <h3 class=\"proofcaptcha-success-title\">Success!</h3>\n                  <p class=\"proofcaptcha-success-message\">Jigsaw completed!</p>\n                </div>\n              </div>\n            </div>\n          `;\n          \n          // IMPORTANT: Always use verification token for siteverify\n          // Fallback to challenge token only for legacy auth flows\n          this.verificationToken = result.verificationToken;\n          if (!this.verificationToken) {\n            console.warn('ProofCaptcha: No verificationToken in response, using challenge token');\n            this.verificationToken = this.token;\n          }\n          \n          setTimeout(() => {\n            this.hideOverlay();\n            this.updateWidgetState();\n            // Send verification token (not challenge token) to callback\n            this.triggerCallback('callback', this.verificationToken);\n          }, 1000);\n        } else {\n          this.status = 'error';\n          this.errorMessage = 'Try again';\n          this.clearChallengeTimers();\n          \n          // Immediate auto-refresh challenge with slide animation\n          setTimeout(() => {\n            this.jigsawPieces = [];\n            this.status = 'idle';\n            this.errorMessage = '';\n            this.loadNewChallengeWithAnimation();\n          }, 800);\n        }\n      } catch (error) {\n        console.error('Verification error:', error);\n        this.status = 'error';\n        this.errorMessage = 'Error occurred';\n        this.clearChallengeTimers();\n        \n        // Immediate auto-refresh on error with slide animation\n        setTimeout(() => {\n          this.jigsawPieces = [];\n          this.status = 'idle';\n          this.errorMessage = '';\n          this.loadNewChallengeWithAnimation();\n        }, 800);\n      }\n    }\n\n\n    /**\n     * Verify gesture challenge\n     */\n    async verifyGesture() {\n      if (!this.challenge || !this.token) return;\n\n      this.status = 'solving';\n      \n      if (!this.overlayElement) return;\n      const modal = this.overlayElement.querySelector('.proofcaptcha-modal');\n      if (!modal) return;\n      \n      const progressContainer = modal.querySelector('[data-progress-container]');\n      const progressBar = modal.querySelector('[data-progress-bar]');\n      const verifyBtn = modal.querySelector('[data-verify]');\n      \n      if (progressContainer) progressContainer.classList.remove('proofcaptcha-hidden');\n      if (progressBar) progressBar.style.width = '50%';\n      if (verifyBtn) verifyBtn.disabled = true;\n\n      try {\n        // SECURITY: Solve ALTCHA proof-of-work to prevent ML-based automated solvers\n        const powSolution = await solveProofOfWork(\n          {\n            salt: this.challenge.salt,\n            challengeHash: this.challenge.challengeHash,\n            maxNumber: this.challenge.maxNumber,\n          },\n          (hash, attempts) => {\n            const powProgress = Math.min(50 + (attempts / 1000) * 25, 75);\n            if (progressBar) progressBar.style.width = `${powProgress}%`;\n          }\n        );\n\n        if (progressBar) progressBar.style.width = '80%';\n\n        // Create solution payload: {answer: {...}, powSolution: \"...\"}\n        const solutionPayload = {\n          answer: this.dragPosition,\n          powSolution,\n        };\n        const solution = JSON.stringify(solutionPayload);\n        const clientDetections = detectClientAutomation();\n        \n        // Collect browser fingerprint for verification (conditional based on API key settings)\n        const fingerprint = await this.collectFingerprint();\n        \n        // Get behavioral data\n        const behavioralData = BehavioralTracker.getData();\n\n        // Prepare metadata object for encryption\n        const metadata = {\n          clientDetections,\n          canvasHash: fingerprint.canvasHash,\n          webglHash: fingerprint.webglHash,\n          audioHash: fingerprint.audioHash,\n          fonts: fingerprint.fonts,\n          screenFingerprint: fingerprint.screenFingerprint,\n          plugins: fingerprint.plugins,\n          timezone: fingerprint.timezone,\n          platform: fingerprint.platform,\n          hardwareConcurrency: fingerprint.hardwareConcurrency,\n          deviceMemory: fingerprint.deviceMemory,\n          colorDepth: fingerprint.colorDepth,\n          pixelRatio: fingerprint.pixelRatio,\n          mouseMovements: behavioralData.mouseMovements,\n          keyboardEvents: behavioralData.keyboardEvents,\n          submissionTime: behavioralData.submissionTime\n        };\n\n        // Encrypt solution and metadata if encryption is available\n        let requestBody = { token: this.token };\n        \n        if (EncryptionManager.currentSession) {\n          const encryptedSolution = await EncryptionManager.encryptSolution(solution, this.token);\n          const encryptedMetadata = await EncryptionManager.encryptVerificationMetadata(metadata, this.token);\n          \n          if (encryptedSolution && encryptedMetadata) {\n            requestBody.encrypted = encryptedSolution;\n            requestBody.encryptedMetadata = encryptedMetadata;\n            requestBody.publicKey = this.publicKey;\n          } else {\n            requestBody.solution = solution;\n            Object.assign(requestBody, metadata);\n          }\n        } else {\n          requestBody.solution = solution;\n          Object.assign(requestBody, metadata);\n        }\n\n        const response = await fetch(`${API_BASE_URL}/api/captcha/verify`, {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify(requestBody),\n          credentials: 'include'\n        });\n\n        const result = await response.json();\n\n        if (result.success) {\n          progressBar.style.width = '100%';\n          this.status = 'success';\n          \n          // Clear challenge timers on success\n          this.clearChallengeTimers();\n          \n          // Start token expiry timer (1 minute)\n          this.startTokenExpiryTimer();\n          \n          modal.innerHTML = `\n            <div class=\"proofcaptcha-p-6\">\n              <div class=\"proofcaptcha-success-celebration\">\n                <div class=\"proofcaptcha-success-sparkles\">\n                  <div class=\"sparkle sparkle-1\">‚ú®</div>\n                  <div class=\"sparkle sparkle-2\">‚≠ê</div>\n                  <div class=\"sparkle sparkle-3\">‚ú®</div>\n                  <div class=\"sparkle sparkle-4\">‚≠ê</div>\n                  <div class=\"sparkle sparkle-5\">‚ú®</div>\n                  <div class=\"sparkle sparkle-6\">‚≠ê</div>\n                </div>\n                <div class=\"proofcaptcha-success-icon-wrapper\">\n                  <div class=\"proofcaptcha-success-icon\">\n                    ${Icons.checkCircle}\n                  </div>\n                  <div class=\"proofcaptcha-success-ring\"></div>\n                  <div class=\"proofcaptcha-success-ring-2\"></div>\n                </div>\n                <div class=\"proofcaptcha-success-content\">\n                  <h3 class=\"proofcaptcha-success-title\">Success!</h3>\n                  <p class=\"proofcaptcha-success-message\">Puzzle solved successfully</p>\n                </div>\n              </div>\n            </div>\n          `;\n          \n          // IMPORTANT: Always use verification token for siteverify\n          // Fallback to challenge token only for legacy auth flows\n          this.verificationToken = result.verificationToken;\n          if (!this.verificationToken) {\n            console.warn('ProofCaptcha: No verificationToken in response, using challenge token');\n            this.verificationToken = this.token;\n          }\n          \n          setTimeout(() => {\n            this.hideOverlay();\n            this.updateWidgetState();\n            // Send verification token (not challenge token) to callback\n            this.triggerCallback('callback', this.verificationToken);\n          }, 1000);\n        } else {\n          this.status = 'error';\n          this.errorMessage = 'Try again';\n          this.clearChallengeTimers();\n          \n          // Immediate auto-refresh challenge with slide animation\n          setTimeout(() => {\n            this.dragPosition = { x: 0, y: 0 };\n            this.isDragging = false;\n            this.status = 'idle';\n            this.errorMessage = '';\n            this.loadNewChallengeWithAnimation();\n          }, 800);\n        }\n      } catch (error) {\n        console.error('Verification error:', error);\n        this.status = 'error';\n        this.errorMessage = 'Error occurred';\n        this.clearChallengeTimers();\n        \n        // Immediate auto-refresh on error with slide animation\n        setTimeout(() => {\n          this.dragPosition = { x: 0, y: 0 };\n          this.isDragging = false;\n          this.status = 'idle';\n          this.errorMessage = '';\n          this.loadNewChallengeWithAnimation();\n        }, 800);\n      }\n    }\n\n    /**\n     * Verify upside down challenge\n     */\n    async verifyUpsideDown() {\n      if (!this.challenge || !this.token || this.upsideDownClicks.length === 0) return;\n\n      this.status = 'solving';\n      \n      if (!this.overlayElement) return;\n      const modal = this.overlayElement.querySelector('.proofcaptcha-modal');\n      if (!modal) return;\n      \n      const progressContainer = modal.querySelector('[data-progress-container]');\n      const progressBar = modal.querySelector('[data-progress-bar]');\n      const verifyBtn = modal.querySelector('[data-verify]');\n      \n      if (progressContainer) progressContainer.classList.remove('proofcaptcha-hidden');\n      if (progressBar) progressBar.style.width = '50%';\n      if (verifyBtn) verifyBtn.disabled = true;\n\n      try {\n        // SECURITY: Solve ALTCHA proof-of-work to prevent ML-based automated solvers\n        const powSolution = await solveProofOfWork(\n          {\n            salt: this.challenge.salt,\n            challengeHash: this.challenge.challengeHash,\n            maxNumber: this.challenge.maxNumber,\n          },\n          (hash, attempts) => {\n            const powProgress = Math.min(50 + (attempts / 1000) * 25, 75);\n            if (progressBar) progressBar.style.width = `${powProgress}%`;\n          }\n        );\n\n        if (progressBar) progressBar.style.width = '80%';\n\n        // Create solution payload: {answer: {...}, powSolution: \"...\"}\n        const solutionPayload = {\n          answer: { clicks: this.upsideDownClicks },\n          powSolution,\n        };\n        const solution = JSON.stringify(solutionPayload);\n        const clientDetections = detectClientAutomation();\n        \n        // Collect browser fingerprint for verification (conditional based on API key settings)\n        const fingerprint = await this.collectFingerprint();\n        \n        // Get behavioral data\n        const behavioralData = BehavioralTracker.getData();\n\n        // Prepare metadata object for encryption\n        const metadata = {\n          clientDetections,\n          canvasHash: fingerprint.canvasHash,\n          webglHash: fingerprint.webglHash,\n          audioHash: fingerprint.audioHash,\n          fonts: fingerprint.fonts,\n          screenFingerprint: fingerprint.screenFingerprint,\n          plugins: fingerprint.plugins,\n          timezone: fingerprint.timezone,\n          platform: fingerprint.platform,\n          hardwareConcurrency: fingerprint.hardwareConcurrency,\n          deviceMemory: fingerprint.deviceMemory,\n          colorDepth: fingerprint.colorDepth,\n          pixelRatio: fingerprint.pixelRatio,\n          mouseMovements: behavioralData.mouseMovements,\n          keyboardEvents: behavioralData.keyboardEvents,\n          submissionTime: behavioralData.submissionTime\n        };\n\n        // Encrypt solution and metadata if encryption is available\n        let requestBody = { token: this.token };\n        \n        if (EncryptionManager.currentSession) {\n          const encryptedSolution = await EncryptionManager.encryptSolution(solution, this.token);\n          const encryptedMetadata = await EncryptionManager.encryptVerificationMetadata(metadata, this.token);\n          \n          if (encryptedSolution && encryptedMetadata) {\n            requestBody.encrypted = encryptedSolution;\n            requestBody.encryptedMetadata = encryptedMetadata;\n            requestBody.publicKey = this.publicKey;\n          } else {\n            requestBody.solution = solution;\n            Object.assign(requestBody, metadata);\n          }\n        } else {\n          requestBody.solution = solution;\n          Object.assign(requestBody, metadata);\n        }\n\n        const response = await fetch(`${API_BASE_URL}/api/captcha/verify`, {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify(requestBody),\n          credentials: 'include'\n        });\n\n        const result = await response.json();\n\n        if (result.success) {\n          progressBar.style.width = '100%';\n          this.status = 'success';\n          \n          // Clear challenge timers on success\n          this.clearChallengeTimers();\n          \n          // Start token expiry timer (1 minute)\n          this.startTokenExpiryTimer();\n          \n          modal.innerHTML = `\n            <div class=\"proofcaptcha-p-6\">\n              <div class=\"proofcaptcha-success-celebration\">\n                <div class=\"proofcaptcha-success-sparkles\">\n                  <div class=\"sparkle sparkle-1\">‚ú®</div>\n                  <div class=\"sparkle sparkle-2\">‚≠ê</div>\n                  <div class=\"sparkle sparkle-3\">‚ú®</div>\n                  <div class=\"sparkle sparkle-4\">‚≠ê</div>\n                  <div class=\"sparkle sparkle-5\">‚ú®</div>\n                  <div class=\"sparkle sparkle-6\">‚≠ê</div>\n                </div>\n                <div class=\"proofcaptcha-success-icon-wrapper\">\n                  <div class=\"proofcaptcha-success-icon\">\n                    ${Icons.checkCircle}\n                  </div>\n                  <div class=\"proofcaptcha-success-ring\"></div>\n                  <div class=\"proofcaptcha-success-ring-2\"></div>\n                </div>\n                <div class=\"proofcaptcha-success-content\">\n                  <h3 class=\"proofcaptcha-success-title\">Success!</h3>\n                  <p class=\"proofcaptcha-success-message\">All images identified!</p>\n                </div>\n              </div>\n            </div>\n          `;\n          \n          // IMPORTANT: Always use verification token for siteverify\n          // Fallback to challenge token only for legacy auth flows\n          this.verificationToken = result.verificationToken;\n          if (!this.verificationToken) {\n            console.warn('ProofCaptcha: No verificationToken in response, using challenge token');\n            this.verificationToken = this.token;\n          }\n          \n          setTimeout(() => {\n            this.hideOverlay();\n            this.updateWidgetState();\n            // Send verification token (not challenge token) to callback\n            this.triggerCallback('callback', this.verificationToken);\n          }, 1000);\n        } else {\n          this.status = 'error';\n          this.errorMessage = 'Try again';\n          this.clearChallengeTimers();\n          \n          // Immediate auto-refresh challenge with slide animation\n          setTimeout(() => {\n            this.upsideDownClicks = [];\n            this.status = 'idle';\n            this.errorMessage = '';\n            this.loadNewChallengeWithAnimation();\n          }, 800);\n        }\n      } catch (error) {\n        console.error('Verification error:', error);\n        this.status = 'error';\n        this.errorMessage = 'Error occurred';\n        this.clearChallengeTimers();\n        \n        // Immediate auto-refresh on error with slide animation\n        setTimeout(() => {\n          this.upsideDownClicks = [];\n          this.status = 'idle';\n          this.errorMessage = '';\n          this.loadNewChallengeWithAnimation();\n        }, 800);\n      }\n    }\n\n    /**\n     * Trigger callback\n     */\n    triggerCallback(callbackName, value) {\n      const callbackFn = this[callbackName];\n      if (callbackFn) {\n        if (typeof callbackFn === 'string') {\n          if (typeof window[callbackFn] === 'function') {\n            window[callbackFn](value);\n          }\n        } else if (typeof callbackFn === 'function') {\n          callbackFn(value);\n        }\n      }\n    }\n\n    /**\n     * Get response token\n     * Returns verificationToken (not challenge token) for siteverify\n     */\n    getResponse() {\n      return this.status === 'success' ? this.verificationToken : null;\n    }\n\n    /**\n     * Reset widget\n     */\n    reset() {\n      this.status = 'idle';\n      this.challenge = null;\n      this.token = null;\n      this.verificationToken = null; // FIXED BUG #1: Clear verification token on reset\n      this.actualType = null;\n      this.selectedCells = [];\n      this.jigsawPieces = [];\n      this.dragPosition = { x: 0, y: 0 };\n      this.isDragging = false;\n      this.upsideDownClicks = [];\n      this.attempts = 0;\n      this.blockExpiresAt = null;\n      this.remainingTime = '';\n      this.errorMessage = ''; // Also clear error message\n      \n      if (this.countdownInterval) {\n        clearInterval(this.countdownInterval);\n        this.countdownInterval = null;\n      }\n      \n      // FIXED BUG #6: Clear fingerprint cache to ensure fresh fingerprint on next challenge\n      FingerprintCollector.clearCache();\n      \n      this.hideOverlay();\n      this.updateWidgetState();\n    }\n  }\n\n  // ==========================================\n  // GLOBAL API\n  // ==========================================\n  \n  window.ProofCaptcha = {\n    render: function(container, parameters) {\n      loadCSS();\n      \n      const element = typeof container === 'string' \n        ? document.getElementById(container) \n        : container;\n\n      if (!element) {\n        console.error('ProofCaptcha: Container element not found');\n        return -1;\n      }\n\n      const widgetId = widgetCounter++;\n      const widget = new ProofCaptchaWidget(element, parameters || {});\n      widgets.set(widgetId, widget);\n\n      return widgetId;\n    },\n\n    reset: function(widgetId) {\n      if (widgetId === undefined) {\n        const firstWidget = widgets.values().next().value;\n        if (firstWidget) firstWidget.reset();\n      } else {\n        const widget = widgets.get(widgetId);\n        if (widget) widget.reset();\n      }\n    },\n\n    getResponse: function(widgetId) {\n      if (widgetId === undefined) {\n        const firstWidget = widgets.values().next().value;\n        return firstWidget ? firstWidget.getResponse() : null;\n      } else {\n        const widget = widgets.get(widgetId);\n        return widget ? widget.getResponse() : null;\n      }\n    },\n\n    ready: function(callback) {\n      if (typeof callback === 'function') {\n        if (document.readyState === 'loading') {\n          document.addEventListener('DOMContentLoaded', callback);\n        } else {\n          callback();\n        }\n      }\n    },\n    \n    antiDebug: {\n      enable: function() {\n        AntiDebugger.enabled = true;\n        AntiDebugger.init();\n      },\n      \n      disable: function() {\n        AntiDebugger.disable();\n      },\n      \n      getStatus: function() {\n        return {\n          enabled: AntiDebugger.enabled,\n          devtoolsDetected: AntiDebugger.devtoolsOpen\n        };\n      }\n    }\n  };\n\n  // ==========================================\n  // AUTO-RENDER\n  // ==========================================\n  \n  function autoRenderWidgets() {\n    loadCSS();\n    \n    const elements = document.querySelectorAll(`.${WIDGET_CLASS}`);\n    elements.forEach((element) => {\n      if (!element.dataset.widgetId) {\n        const widgetId = ProofCaptcha.render(element, {\n          sitekey: element.dataset.sitekey,\n          callback: element.dataset.callback,\n          'error-callback': element.dataset.errorCallback,\n          theme: element.dataset.theme,\n          type: element.dataset.type\n        });\n        element.dataset.widgetId = widgetId;\n      }\n    });\n  }\n\n  // Auto-render on page load\n  if (document.readyState === 'loading') {\n    document.addEventListener('DOMContentLoaded', autoRenderWidgets);\n  } else {\n    autoRenderWidgets();\n  }\n\n  // Watch for dynamically added widgets\n  if (typeof MutationObserver !== 'undefined') {\n    const observer = new MutationObserver((mutations) => {\n      mutations.forEach((mutation) => {\n        mutation.addedNodes.forEach((node) => {\n          if (node.nodeType === 1) {\n            if (node.classList && node.classList.contains(WIDGET_CLASS)) {\n              if (!node.dataset.widgetId) {\n                loadCSS();\n                const widgetId = ProofCaptcha.render(node, {\n                  sitekey: node.dataset.sitekey,\n                  callback: node.dataset.callback,\n                  'error-callback': node.dataset.errorCallback,\n                  theme: node.dataset.theme,\n                  type: node.dataset.type\n                });\n                node.dataset.widgetId = widgetId;\n              }\n            }\n            const children = node.querySelectorAll && node.querySelectorAll(`.${WIDGET_CLASS}`);\n            if (children) {\n              children.forEach((child) => {\n                if (!child.dataset.widgetId) {\n                  loadCSS();\n                  const widgetId = ProofCaptcha.render(child, {\n                    sitekey: child.dataset.sitekey,\n                    callback: child.dataset.callback,\n                    'error-callback': child.dataset.errorCallback,\n                    theme: child.dataset.theme,\n                    type: child.dataset.type\n                  });\n                  child.dataset.widgetId = widgetId;\n                }\n              });\n            }\n          }\n        });\n      });\n    });\n\n    observer.observe(document.body, { childList: true, subtree: true });\n  }\n\n})(window);\n","size_bytes":155456},"server/enhancements/honeypot-detector.ts":{"content":"/**\n * Honeypot Field Detection\n * \n * Invisible fields yang hanya akan diisi oleh bots\n * untuk mendeteksi automated form submissions\n */\n\nimport { Request } from \"express\";\n\nexport interface HoneypotConfig {\n  fieldNames: string[];      // Nama fields yang digunakan sebagai honeypot\n  strictMode: boolean;       // Strict mode langsung reject\n  logOnly: boolean;          // Hanya log tanpa blocking\n  scoreWeight: number;       // Weight untuk risk score (0-100)\n}\n\nexport const DEFAULT_HONEYPOT_CONFIG: HoneypotConfig = {\n  fieldNames: [\n    'email_confirm',        // Common honeypot field\n    'phone_verify',         // Phone verification honeypot\n    'website',              // URL honeypot\n    'company_name',         // Company honeypot\n    'full_address',         // Address honeypot\n    'social_security',      // SSN honeypot (never use in real forms!)\n  ],\n  strictMode: false,\n  logOnly: false,\n  scoreWeight: 50,  // Medium-high weight\n};\n\nexport interface HoneypotCheckResult {\n  isBot: boolean;\n  triggeredFields: string[];\n  confidence: number;  // 0-100\n  riskScore: number;   // 0-100\n  shouldBlock: boolean;\n}\n\n/**\n * Check for honeypot field triggers\n */\nexport function checkHoneypot(\n  req: Request,\n  config: HoneypotConfig = DEFAULT_HONEYPOT_CONFIG\n): HoneypotCheckResult {\n  const triggeredFields: string[] = [];\n  \n  // Check request body\n  if (req.body) {\n    for (const fieldName of config.fieldNames) {\n      const value = req.body[fieldName];\n      \n      // Field exists and has value = bot detected\n      if (value !== undefined && value !== null && value !== '') {\n        triggeredFields.push(fieldName);\n      }\n    }\n  }\n  \n  const isBot = triggeredFields.length > 0;\n  const confidence = isBot ? Math.min(triggeredFields.length * 50, 100) : 0;\n  const riskScore = isBot ? config.scoreWeight : 0;\n  const shouldBlock = isBot && !config.logOnly;\n  \n  return {\n    isBot,\n    triggeredFields,\n    confidence,\n    riskScore,\n    shouldBlock,\n  };\n}\n\n/**\n * Generate honeypot HTML fields untuk injection ke forms\n */\nexport function generateHoneypotFields(\n  fieldNames: string[] = DEFAULT_HONEYPOT_CONFIG.fieldNames\n): string {\n  return fieldNames.map(name => `\n    <input \n      type=\"text\" \n      name=\"${name}\" \n      id=\"${name}\"\n      value=\"\"\n      tabindex=\"-1\"\n      autocomplete=\"off\"\n      aria-hidden=\"true\"\n      style=\"position:absolute;left:-9999px;width:1px;height:1px;opacity:0;pointer-events:none;\"\n    />\n  `).join('\\n');\n}\n\n/**\n * Middleware untuk auto-detect honeypot\n */\nexport function honeypotMiddleware(config: HoneypotConfig = DEFAULT_HONEYPOT_CONFIG) {\n  return (req: Request, res: any, next: any) => {\n    const result = checkHoneypot(req, config);\n    \n    if (result.isBot) {\n      console.log(`[HONEYPOT] Bot detected: ${result.triggeredFields.join(', ')} from IP ${req.socket.remoteAddress}`);\n      \n      if (result.shouldBlock) {\n        return res.status(403).json({\n          success: false,\n          error: 'Bot detected',\n          message: 'Automated form submission detected',\n        });\n      }\n    }\n    \n    // Attach result to request for logging\n    (req as any).honeypotCheck = result;\n    next();\n  };\n}\n\n/**\n * Time-based honeypot - detect forms submitted too quickly\n */\nexport interface TimeBasedHoneypotConfig {\n  minimumFormTime: number;  // Minimum waktu dalam ms\n  maximumFormTime: number;  // Maximum waktu dalam ms (suspect if too long)\n  strictMode: boolean;\n}\n\nexport const DEFAULT_TIME_HONEYPOT_CONFIG: TimeBasedHoneypotConfig = {\n  minimumFormTime: 3000,    // 3 detik minimum\n  maximumFormTime: 3600000, // 1 jam maksimum\n  strictMode: false,\n};\n\nexport function checkTimingHoneypot(\n  formLoadTime: number,  // Timestamp ketika form dimuat\n  submitTime: number = Date.now(),\n  config: TimeBasedHoneypotConfig = DEFAULT_TIME_HONEYPOT_CONFIG\n): { isBot: boolean; reason?: string; timeTaken: number } {\n  const timeTaken = submitTime - formLoadTime;\n  \n  // Too fast - likely bot\n  if (timeTaken < config.minimumFormTime) {\n    return {\n      isBot: true,\n      reason: `Form submitted too quickly (${timeTaken}ms < ${config.minimumFormTime}ms)`,\n      timeTaken,\n    };\n  }\n  \n  // Too slow - possibly abandoned or automated long-running script\n  if (config.strictMode && timeTaken > config.maximumFormTime) {\n    return {\n      isBot: true,\n      reason: `Form submission took too long (${timeTaken}ms > ${config.maximumFormTime}ms)`,\n      timeTaken,\n    };\n  }\n  \n  return {\n    isBot: false,\n    timeTaken,\n  };\n}\n\n/**\n * Mouse movement honeypot - detect lack of mouse interaction\n * (Requires client-side component to track mouse movements)\n */\nexport interface MouseHoneypotCheck {\n  hasMouseMovement: boolean;\n  movementCount: number;\n  clickCount: number;\n}\n\nexport function checkMouseHoneypot(data: MouseHoneypotCheck): {\n  isBot: boolean;\n  confidence: number;\n  reason?: string;\n} {\n  // No mouse movement at all = high confidence bot\n  if (!data.hasMouseMovement || data.movementCount === 0) {\n    return {\n      isBot: true,\n      confidence: 90,\n      reason: 'No mouse movement detected',\n    };\n  }\n  \n  // Very few movements = medium confidence bot\n  if (data.movementCount < 5) {\n    return {\n      isBot: true,\n      confidence: 60,\n      reason: 'Insufficient mouse movement',\n    };\n  }\n  \n  // No clicks = medium confidence bot\n  if (data.clickCount === 0) {\n    return {\n      isBot: true,\n      confidence: 50,\n      reason: 'No mouse clicks detected',\n    };\n  }\n  \n  return {\n    isBot: false,\n    confidence: 0,\n  };\n}\n\n/**\n * Combined honeypot check\n */\nexport function performComprehensiveHoneypotCheck(\n  req: Request,\n  formLoadTime?: number,\n  mouseData?: MouseHoneypotCheck,\n  config: HoneypotConfig = DEFAULT_HONEYPOT_CONFIG\n): {\n  isBot: boolean;\n  confidence: number;\n  checks: {\n    fieldHoneypot: HoneypotCheckResult;\n    timing?: ReturnType<typeof checkTimingHoneypot>;\n    mouse?: ReturnType<typeof checkMouseHoneypot>;\n  };\n  totalRiskScore: number;\n} {\n  const fieldCheck = checkHoneypot(req, config);\n  let totalRiskScore = fieldCheck.riskScore;\n  let maxConfidence = fieldCheck.confidence;\n  \n  const checks: any = { fieldHoneypot: fieldCheck };\n  \n  // Timing check\n  if (formLoadTime !== undefined) {\n    const timingCheck = checkTimingHoneypot(formLoadTime);\n    checks.timing = timingCheck;\n    if (timingCheck.isBot) {\n      totalRiskScore += 30;\n      maxConfidence = Math.max(maxConfidence, 70);\n    }\n  }\n  \n  // Mouse check\n  if (mouseData) {\n    const mouseCheck = checkMouseHoneypot(mouseData);\n    checks.mouse = mouseCheck;\n    if (mouseCheck.isBot) {\n      totalRiskScore += mouseCheck.confidence * 0.5;\n      maxConfidence = Math.max(maxConfidence, mouseCheck.confidence);\n    }\n  }\n  \n  const isBot = fieldCheck.isBot || \n                (checks.timing?.isBot) || \n                (checks.mouse?.isBot);\n  \n  return {\n    isBot,\n    confidence: maxConfidence,\n    checks,\n    totalRiskScore: Math.min(totalRiskScore, 100),\n  };\n}\n\n/**\n * Example usage in HTML form:\n * \n * <form id=\"myForm\">\n *   <input type=\"text\" name=\"email\" required />\n *   \n *   <!-- Honeypot fields (invisible) -->\n *   ${generateHoneypotFields()}\n *   \n *   <!-- Hidden form load timestamp -->\n *   <input type=\"hidden\" name=\"form_load_time\" value=\"${Date.now()}\" />\n *   \n *   <button type=\"submit\">Submit</button>\n * </form>\n * \n * Example usage in backend:\n * \n * app.post('/submit', honeypotMiddleware(), async (req, res) => {\n *   const honeypotResult = (req as any).honeypotCheck;\n *   \n *   if (honeypotResult.isBot) {\n *     // Log or block\n *     console.log('Bot detected via honeypot');\n *   }\n *   \n *   // Process form...\n * });\n */\n","size_bytes":7679},"client/src/pages/Terms.tsx":{"content":"import { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Shield } from \"lucide-react\";\nimport { Link } from \"wouter\";\nimport { useTranslation } from \"react-i18next\";\nimport LanguageToggle from \"@/components/LanguageToggle\";\nimport ThemeToggle from \"@/components/ThemeToggle\";\n\nexport default function Terms() {\n  const { t } = useTranslation();\n\n  return (\n    <div className=\"min-h-screen\" data-testid=\"page-terms\">\n      <header className=\"border-b\">\n        <div className=\"container mx-auto px-4 py-4 flex items-center justify-between\">\n          <div className=\"flex items-center gap-2\">\n            <Shield className=\"h-6 w-6 text-primary\" />\n            <span className=\"font-bold text-lg\">ProofCaptcha</span>\n          </div>\n          <div className=\"flex items-center gap-2\">\n            <LanguageToggle />\n            <ThemeToggle />\n          </div>\n        </div>\n      </header>\n\n      <div className=\"p-4 md:p-8\">\n        <div className=\"max-w-4xl mx-auto\">\n          <div className=\"flex items-center gap-3 mb-6\">\n            <Shield className=\"h-8 w-8 text-primary\" />\n            <h1 className=\"text-3xl font-bold\">{t('terms.title')}</h1>\n          </div>\n\n          <Card className=\"mb-6\">\n            <CardHeader>\n              <CardTitle>{t('terms.pageTitle')}</CardTitle>\n              <p className=\"text-sm text-muted-foreground\">{t('terms.lastUpdated')}: {t('terms.lastUpdatedDate')}</p>\n            </CardHeader>\n            <CardContent className=\"space-y-6\">\n              <section>\n                <h2 className=\"text-xl font-semibold mb-3\">{t('terms.agreement.title')}</h2>\n                <p className=\"text-muted-foreground\">\n                  {t('terms.agreement.content')}\n                </p>\n              </section>\n\n              <section>\n                <h2 className=\"text-xl font-semibold mb-3\">{t('terms.description.title')}</h2>\n                <div className=\"space-y-2 text-muted-foreground\">\n                  <p>{t('terms.description.intro')}</p>\n                  <ul className=\"list-disc list-inside space-y-1 ml-4\">\n                    {(t('terms.description.items', { returnObjects: true }) as string[]).map((item: string, index: number) => (\n                      <li key={index}>{item}</li>\n                    ))}\n                  </ul>\n                </div>\n              </section>\n\n              <section>\n                <h2 className=\"text-xl font-semibold mb-3\">{t('terms.registration.title')}</h2>\n                <div className=\"space-y-2 text-muted-foreground\">\n                  <p>{t('terms.registration.intro')}</p>\n                  <ul className=\"list-disc list-inside space-y-1 ml-4\">\n                    {(t('terms.registration.items', { returnObjects: true }) as string[]).map((item: string, index: number) => (\n                      <li key={index}>{item}</li>\n                    ))}\n                  </ul>\n                </div>\n              </section>\n\n              <section>\n                <h2 className=\"text-xl font-semibold mb-3\">{t('terms.acceptable.title')}</h2>\n                <div className=\"space-y-3 text-muted-foreground\">\n                  <div>\n                    <h3 className=\"font-medium text-foreground mb-2\">{t('terms.acceptable.youMay.title')}</h3>\n                    <ul className=\"list-disc list-inside space-y-1 ml-4\">\n                      {(t('terms.acceptable.youMay.items', { returnObjects: true }) as string[]).map((item: string, index: number) => (\n                        <li key={index}>{item}</li>\n                      ))}\n                    </ul>\n                  </div>\n                  <div>\n                    <h3 className=\"font-medium text-foreground mb-2\">{t('terms.acceptable.youMayNot.title')}</h3>\n                    <ul className=\"list-disc list-inside space-y-1 ml-4\">\n                      {(t('terms.acceptable.youMayNot.items', { returnObjects: true }) as string[]).map((item: string, index: number) => (\n                        <li key={index}>{item}</li>\n                      ))}\n                    </ul>\n                  </div>\n                </div>\n              </section>\n\n              <section>\n                <h2 className=\"text-xl font-semibold mb-3\">{t('terms.apiKeys.title')}</h2>\n                <div className=\"space-y-2 text-muted-foreground\">\n                  <p>{t('terms.apiKeys.intro')}</p>\n                  <ul className=\"list-disc list-inside space-y-1 ml-4\">\n                    {(t('terms.apiKeys.items', { returnObjects: true }) as string[]).map((item: string, index: number) => (\n                      <li key={index}>{item}</li>\n                    ))}\n                  </ul>\n                </div>\n              </section>\n\n              <section>\n                <h2 className=\"text-xl font-semibold mb-3\">{t('terms.availability.title')}</h2>\n                <p className=\"text-muted-foreground\">\n                  {t('terms.availability.content')}\n                </p>\n              </section>\n\n              <section>\n                <h2 className=\"text-xl font-semibold mb-3\">{t('terms.rateLimits.title')}</h2>\n                <div className=\"space-y-2 text-muted-foreground\">\n                  <p>{t('terms.rateLimits.intro')}</p>\n                  <ul className=\"list-disc list-inside space-y-1 ml-4\">\n                    {(t('terms.rateLimits.items', { returnObjects: true }) as string[]).map((item: string, index: number) => (\n                      <li key={index}>{item}</li>\n                    ))}\n                  </ul>\n                </div>\n              </section>\n\n              <section>\n                <h2 className=\"text-xl font-semibold mb-3\">{t('terms.ip.title')}</h2>\n                <p className=\"text-muted-foreground\">\n                  {t('terms.ip.content')}\n                </p>\n              </section>\n\n              <section>\n                <h2 className=\"text-xl font-semibold mb-3\">{t('terms.privacyData.title')}</h2>\n                <p className=\"text-muted-foreground\">\n                  {t('terms.privacyData.content')}\n                </p>\n              </section>\n\n              <section>\n                <h2 className=\"text-xl font-semibold mb-3\">{t('terms.liability.title')}</h2>\n                <p className=\"text-muted-foreground\">\n                  {t('terms.liability.content')}\n                </p>\n              </section>\n\n              <section>\n                <h2 className=\"text-xl font-semibold mb-3\">{t('terms.indemnification.title')}</h2>\n                <p className=\"text-muted-foreground\">\n                  {t('terms.indemnification.content')}\n                </p>\n              </section>\n\n              <section>\n                <h2 className=\"text-xl font-semibold mb-3\">{t('terms.termination.title')}</h2>\n                <div className=\"space-y-2 text-muted-foreground\">\n                  <p>{t('terms.termination.intro')}</p>\n                  <ul className=\"list-disc list-inside space-y-1 ml-4\">\n                    {(t('terms.termination.items', { returnObjects: true }) as string[]).map((item: string, index: number) => (\n                      <li key={index}>{item}</li>\n                    ))}\n                  </ul>\n                </div>\n              </section>\n\n              <section>\n                <h2 className=\"text-xl font-semibold mb-3\">{t('terms.changesToTerms.title')}</h2>\n                <p className=\"text-muted-foreground\">\n                  {t('terms.changesToTerms.content')}\n                </p>\n              </section>\n\n              <section>\n                <h2 className=\"text-xl font-semibold mb-3\">{t('terms.governingLaw.title')}</h2>\n                <p className=\"text-muted-foreground\">\n                  {t('terms.governingLaw.content')}\n                </p>\n              </section>\n\n              <section>\n                <h2 className=\"text-xl font-semibold mb-3\">{t('terms.contactInfo.title')}</h2>\n                <p className=\"text-muted-foreground\">\n                  {t('terms.contactInfo.content')}\n                </p>\n              </section>\n\n              <section>\n                <h2 className=\"text-xl font-semibold mb-3\">{t('terms.severability.title')}</h2>\n                <p className=\"text-muted-foreground\">\n                  {t('terms.severability.content')}\n                </p>\n              </section>\n            </CardContent>\n          </Card>\n\n          <div className=\"text-center\">\n            <Link href=\"/\" className=\"text-primary hover:underline\" data-testid=\"link-home\">\n              {t('terms.backToHome')}\n            </Link>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n","size_bytes":8637},"client/src/components/ui/toaster.tsx":{"content":"import { useToast } from \"@/hooks/use-toast\"\nimport {\n  Toast,\n  ToastClose,\n  ToastDescription,\n  ToastProvider,\n  ToastTitle,\n  ToastViewport,\n} from \"@/components/ui/toast\"\n\nexport function Toaster() {\n  const { toasts } = useToast()\n\n  return (\n    <ToastProvider>\n      {toasts.map(function ({ id, title, description, action, ...props }) {\n        return (\n          <Toast key={id} {...props}>\n            <div className=\"grid gap-1\">\n              {title && <ToastTitle>{title}</ToastTitle>}\n              {description && (\n                <ToastDescription>{description}</ToastDescription>\n              )}\n            </div>\n            {action}\n            <ToastClose />\n          </Toast>\n        )\n      })}\n      <ToastViewport />\n    </ToastProvider>\n  )\n}\n","size_bytes":772},"client/src/components/ui/separator.tsx":{"content":"import * as React from \"react\"\nimport * as SeparatorPrimitive from \"@radix-ui/react-separator\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Separator = React.forwardRef<\n  React.ElementRef<typeof SeparatorPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SeparatorPrimitive.Root>\n>(\n  (\n    { className, orientation = \"horizontal\", decorative = true, ...props },\n    ref\n  ) => (\n    <SeparatorPrimitive.Root\n      ref={ref}\n      decorative={decorative}\n      orientation={orientation}\n      className={cn(\n        \"shrink-0 bg-border\",\n        orientation === \"horizontal\" ? \"h-[1px] w-full\" : \"h-full w-[1px]\",\n        className\n      )}\n      {...props}\n    />\n  )\n)\nSeparator.displayName = SeparatorPrimitive.Root.displayName\n\nexport { Separator }\n","size_bytes":756},"SECURITY.md":{"content":"# Security Policy\n\n## üõ°Ô∏è Overview\n\nProofCaptcha takes security seriously. This document outlines our security architecture, vulnerability disclosure process, and best practices for developers using ProofCaptcha.\n\n---\n\n## üìã Table of Contents\n\n- [Supported Versions](#supported-versions)\n- [Vulnerability Disclosure](#vulnerability-disclosure)\n- [Security Architecture](#security-architecture)\n  - [End-to-End Encryption](#end-to-end-encryption)\n  - [Multi-Layer Bot Detection](#multi-layer-bot-detection)\n  - [Anti-Debugger Protection](#anti-debugger-protection)\n  - [Code Obfuscation](#code-obfuscation)\n  - [Domain Validation](#domain-validation)\n  - [Session Management](#session-management)\n- [Security Features](#security-features)\n- [Security Best Practices](#security-best-practices)\n- [Known Security Considerations](#known-security-considerations)\n- [Security Audit Log](#security-audit-log)\n\n---\n\n## üì¶ Supported Versions\n\nWe release security updates for the following versions:\n\n| Version | Supported          | End of Support |\n| ------- | ------------------ | -------------- |\n| 1.0.x   | :white_check_mark: | TBD            |\n\n**Update Policy:**\n- Security patches are released as soon as possible after discovery\n- Critical vulnerabilities receive immediate attention (within 24-48 hours)\n- Non-critical vulnerabilities are addressed in regular releases\n\n---\n\n## üîí Vulnerability Disclosure\n\n### Reporting a Vulnerability\n\nIf you discover a security vulnerability in ProofCaptcha, please report it responsibly:\n\n**DO:**\n- ‚úÖ Email security reports to: **security@proofcaptcha.com** (if available)\n- ‚úÖ Provide detailed description of the vulnerability\n- ‚úÖ Include steps to reproduce\n- ‚úÖ Suggest potential fixes if possible\n- ‚úÖ Allow reasonable time for fix before public disclosure (90 days recommended)\n\n**DON'T:**\n- ‚ùå Create public GitHub issues for security vulnerabilities\n- ‚ùå Publicly disclose before fix is available\n- ‚ùå Exploit vulnerabilities maliciously\n\n### Report Template\n\nPlease include the following information:\n\n```\n**Vulnerability Type:**\n[e.g., XSS, SQL Injection, Authentication Bypass, etc.]\n\n**Affected Component:**\n[e.g., CAPTCHA widget, API endpoint, Dashboard, etc.]\n\n**Severity:**\n[Critical / High / Medium / Low]\n\n**Description:**\n[Detailed description of the vulnerability]\n\n**Steps to Reproduce:**\n1. ...\n2. ...\n3. ...\n\n**Expected Behavior:**\n[What should happen]\n\n**Actual Behavior:**\n[What actually happens]\n\n**Proof of Concept:**\n[Code, screenshots, or video demonstration]\n\n**Impact:**\n[Potential consequences if exploited]\n\n**Suggested Fix:**\n[Optional: Your recommendations]\n\n**Environment:**\n- ProofCaptcha Version: \n- Browser/Client: \n- Operating System: \n```\n\n### Response Timeline\n\n- **Acknowledgment**: Within 48 hours of report\n- **Initial Assessment**: Within 7 days\n- **Fix Development**: Depends on severity\n  - Critical: 24-48 hours\n  - High: 1-2 weeks\n  - Medium: 2-4 weeks\n  - Low: Next regular release\n- **Public Disclosure**: After fix is deployed + 7 days notice\n\n### Bounty Program\n\nCurrently, we do not have a bug bounty program. However, we deeply appreciate security researchers' contributions and will acknowledge them in our Hall of Fame.\n\n---\n\n## üèóÔ∏è Security Architecture\n\nProofCaptcha employs multiple layers of defense to protect against various attack vectors.\n\n### End-to-End Encryption\n\nAll challenge and solution data is encrypted using a hybrid encryption scheme:\n\n#### 1. Key Exchange (ECDH)\n\n**Algorithm:** Elliptic Curve Diffie-Hellman (P-256)\n\n**Process:**\n1. Client generates ephemeral ECDH keypair\n2. Server generates session-based ECDH keypair\n3. Both parties derive shared secret without transmitting private keys\n4. Shared secret is used for symmetric encryption\n\n**Security Properties:**\n- **Forward Secrecy**: Each session has unique keys\n- **No Private Key Transmission**: Private keys never leave their respective sides\n- **Perfect Forward Secrecy**: Compromise of long-term keys doesn't compromise past sessions\n\n```\nClient Keypair         Server Keypair\n  privateKey             privateKey\n  publicKey       ‚Üí      publicKey\n        ‚Üì                     ‚Üì\n        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ ECDH ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n                  ‚Üì\n           Shared Secret (256-bit)\n```\n\n#### 2. Key Derivation (HKDF)\n\n**Algorithm:** HKDF-SHA256\n\n**Purpose:** Derive AES encryption key and HMAC key from shared secret\n\n**Parameters:**\n- **Salt**: SHA-256 hash of challengeId (ensures uniqueness)\n- **Info**: `ProofCaptcha-v1-encrypt|decrypt-{hashedChallengeId}` (context binding)\n- **Output**: 512 bits (256-bit AES key + 256-bit HMAC key)\n\n**Security Properties:**\n- **Key Separation**: Separate keys for encryption and authentication\n- **Context Binding**: Keys tied to specific challenge context\n- **Cryptographic Strength**: Based on SHA-256 hash function\n\n```\nShared Secret + Salt + Info\n         ‚Üì\n      HKDF-SHA256\n         ‚Üì\n   512-bit Output\n    ‚Üô         ‚Üò\nAES Key    HMAC Key\n(256-bit)  (256-bit)\n```\n\n#### 3. Data Encryption (AES-GCM)\n\n**Algorithm:** AES-256-GCM (Galois/Counter Mode)\n\n**Process:**\n1. Generate random 96-bit IV (Initialization Vector)\n2. Encrypt plaintext with AES-GCM using derived AES key\n3. Use challengeId as Additional Authenticated Data (AAD)\n4. Output: ciphertext + authentication tag\n\n**Security Properties:**\n- **Confidentiality**: AES-256 encryption prevents data disclosure\n- **Integrity**: GMAC tag prevents tampering\n- **Authenticity**: AAD binding ensures data comes from legitimate source\n- **Replay Protection**: HMAC signature prevents replay attacks\n\n```\nPlaintext Data + IV + AAD (challengeId)\n              ‚Üì\n         AES-256-GCM\n              ‚Üì\n    Ciphertext + Auth Tag\n```\n\n#### 4. Server-Side Encryption Control\n\n**CRITICAL SECURITY FEATURE**: Server **ALWAYS** determines encryption mode.\n\n**Why This Matters:**\n- ‚ùå **OLD (Insecure)**: Client could set `supportsEncryption: false` ‚Üí force plaintext\n- ‚úÖ **NEW (Secure)**: Server enforces encryption based on session existence\n\n**Implementation:**\n\n```javascript\n// Server-side decision (SECURE)\nfunction determineEncryptionMode(sessionExists) {\n  if (sessionExists) {\n    // MANDATORY encryption for existing sessions\n    return { requiresEncryption: true };\n  } else {\n    // Fallback to plaintext only if no session\n    return { requiresEncryption: false };\n  }\n}\n\n// Client CANNOT override this decision\n```\n\n**Attack Prevention:**\n- **Downgrade Attack**: Attacker cannot force plaintext mode\n- **MITM Protection**: Encrypted challenges cannot be intercepted\n- **Replay Attack**: Encrypted solutions cannot be replayed\n\n**Progressive Enhancement:**\n- First request (no session): Plaintext fallback for compatibility\n- Subsequent requests (session exists): Encryption ENFORCED\n- All modern browsers support Web Crypto API ‚Üí encryption works\n\n### Multi-Layer Bot Detection\n\nProofCaptcha uses 5 independent layers of bot detection:\n\n#### 1. Advanced Fingerprinting\n\n**Collects:**\n- **Canvas Fingerprint**: Unique rendering patterns from HTML5 Canvas\n- **WebGL Fingerprint**: GPU and driver-specific rendering signatures\n- **Audio Context**: Audio API fingerprint\n- **Font Detection**: Installed system fonts\n- **Screen Properties**: Resolution, color depth, orientation\n- **Timezone & Language**: Browser timezone and language settings\n- **Platform**: OS, browser, device type\n- **Plugins**: Installed browser plugins\n- **Hardware**: CPU cores, memory, touch support\n\n**Implementation:**\n```javascript\n// client/src/lib/fingerprint.ts\nconst fingerprint = {\n  canvas: getCanvasFingerprint(),\n  webgl: getWebGLFingerprint(),\n  audio: getAudioFingerprint(),\n  fonts: detectFonts(),\n  screen: getScreenInfo(),\n  timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,\n  platform: navigator.platform,\n  // ... more properties\n};\n```\n\n**Server-Side Validation:**\n```typescript\n// server/device-fingerprint.ts\nfunction validateFingerprint(fingerprint: DeviceFingerprint): {\n  isValid: boolean;\n  riskScore: number;\n  flags: string[];\n}\n```\n\n**Detection Capabilities:**\n- Identify same device across sessions\n- Detect fingerprint spoofing attempts\n- Track suspicious pattern changes\n- Risk scoring based on fingerprint consistency\n\n#### 2. Automation Detection\n\n**Detects:**\n- **Headless Browsers**: Puppeteer, Playwright, PhantomJS\n- **WebDriver**: Selenium, ChromeDriver, GeckoDriver\n- **Automation Frameworks**: Cypress, Nightwatch\n- **HTTP Clients**: curl, wget, Python requests, Postman\n\n**Detection Methods:**\n```typescript\n// server/automation-detector.ts\nexport function detectAutomation(req: Request): {\n  isAutomation: boolean;\n  detectedBy: string[];\n  score: number;\n}\n```\n\n**Checks:**\n- User-Agent analysis (headless signatures)\n- Missing browser headers (accept-language, accept-encoding)\n- WebDriver-specific headers\n- Automation framework signatures\n- Chrome DevTools Protocol indicators\n\n**Scoring:**\n- Headless user-agent: +50 points\n- Automation framework: +50 points\n- Missing headers: +5 points each\n- Bot patterns: +40 points\n- Threshold: 50 points = bot detected\n\n#### 3. Behavioral Analysis\n\n**Analyzes:**\n- **Mouse Movement**: Natural curves vs. linear bot movements\n- **Keyboard Timing**: Human typing patterns vs. automated input\n- **Click Patterns**: Human variability vs. perfect bot clicks\n- **Form Fill Timing**: Realistic delays vs. instant completion\n- **Interaction Velocity**: Human speed vs. superhuman bot speed\n\n**Implementation:**\n```typescript\n// server/behavioral-analysis.ts\nexport function analyzeBehavior(req: Request, fingerprint?: any): {\n  isSuspicious: boolean;\n  suspiciousPatterns: string[];\n  riskScore: number;\n}\n```\n\n**Patterns Detected:**\n- Too-perfect mouse movements\n- Instant form completion\n- Missing interaction data\n- Superhuman speeds\n- Repetitive patterns\n\n#### 4. Honeypot Detection\n\n**Techniques:**\n- **Invisible Form Fields**: Hidden fields that bots auto-fill\n- **Timing Analysis**: Submissions faster than humanly possible\n- **JavaScript Requirements**: CAPTCHA requires JS execution\n- **DOM Manipulation Detection**: Unusual DOM changes\n\n**Implementation:**\n```typescript\n// server/enhancements/honeypot-detector.ts\nexport function detectHoneypot(data: any): {\n  isHoneypot: boolean;\n  triggers: string[];\n}\n```\n\n#### 5. IP Reputation & Rate Limiting\n\n**Tracks:**\n- Failed verification attempts per IP\n- Challenge generation rate per IP\n- Geographic anomalies\n- Known bot IP ranges\n- Tor exit nodes\n\n**Rate Limits:**\n- Challenge generation: 30/minute per IP (configurable)\n- Verification attempts: 30/minute per IP (configurable)\n- Token validation: 100/minute per IP (configurable)\n\n**Auto-Blocking:**\n- Temporary blocks for excessive failures\n- Permanent blocks for malicious patterns\n- Configurable per-API-key blocking rules\n\n### Anti-Debugger Protection\n\nPrevents reverse engineering and tampering attempts.\n\n**Detection Methods:**\n\n#### 1. Debugger Statement Traps\n\n```javascript\n// Periodic debugger checks\nsetInterval(() => {\n  debugger;  // Halts execution if DevTools open\n}, 4000);\n```\n\n#### 2. Console Monitoring\n\n```javascript\n// Detect console usage\nlet devtools = {\n  open: false,\n  orientation: null\n};\n\nconst element = new Image();\nObject.defineProperty(element, 'id', {\n  get: function() {\n    devtools.open = true;\n    throw new Error('DevTools detected');\n  }\n});\nconsole.log('%c', element);\n```\n\n#### 3. Timing Analysis\n\n```javascript\n// Detect debugger via timing\nconst start = Date.now();\ndebugger;\nconst end = Date.now();\n\nif (end - start > 100) {\n  // Debugger detected (execution paused)\n  triggerAntiDebugger();\n}\n```\n\n#### 4. Function Integrity Checks\n\n```javascript\n// Detect function tampering\nconst originalToString = Function.prototype.toString;\nconst funcString = originalToString.call(myFunction);\n\nif (funcString.includes('native code') === false) {\n  // Function has been tampered with\n}\n```\n\n#### 5. Viewport Detection\n\n```javascript\n// Detect DevTools by window size changes\nconst widthThreshold = window.outerWidth - window.innerWidth > 160;\nconst heightThreshold = window.outerHeight - window.innerHeight > 160;\n\nif (widthThreshold || heightThreshold) {\n  // DevTools likely open (docked)\n}\n```\n\n**Response Actions:**\n\n**Standard Mode:**\n- Disable CAPTCHA widget\n- Show \"Debugger Detected\" message\n- Prevent form submission\n\n**\"CHEATERS!!\" Mode (Premium):**\n- Police car animation\n- 3D cracker icon\n- Dramatic visual effects\n- User shaming (ethical considerations apply)\n\n**Configuration:**\n\n```javascript\n// Per-API-key configuration\n{\n  \"antiDebugger\": true,  // Enable/disable\n  \"antiDebuggerMode\": \"standard\"  // or \"cheaters\"\n}\n```\n\n### Code Obfuscation\n\nProtects source code from reverse engineering.\n\n#### Backend Obfuscation (Maximum Protection)\n\n**Features:**\n- **RC4 String Encryption**: Encrypts all string literals\n- **Control Flow Flattening**: Scrambles code execution flow\n- **Dead Code Injection**: Adds fake code paths (50% injection rate)\n- **Self-Defending**: Crashes if tampered with\n- **Debug Protection**: Intervals of debugger statements\n- **Console Disabling**: Removes all console outputs\n- **Identifier Mangling**: Renames variables to hexadecimal\n\n**Configuration:**\n```javascript\n// scripts/obfuscate.js\nconst serverObfuscationConfig = {\n  compact: true,\n  controlFlowFlattening: true,\n  controlFlowFlatteningThreshold: 1,\n  deadCodeInjection: true,\n  deadCodeInjectionThreshold: 0.5,\n  debugProtection: true,\n  debugProtectionInterval: 4000,\n  stringArrayEncoding: ['rc4'],\n  selfDefending: true,\n  // ... more options\n};\n```\n\n#### Frontend Obfuscation (Balanced)\n\n**Features:**\n- **Base64 String Encoding**: Lighter encoding for performance\n- **Control Flow Flattening**: 50% threshold\n- **Dead Code Injection**: 20% injection rate\n- **No Debug Protection**: Maintains performance\n- **Identifier Mangling**: Hexadecimal renaming\n\n**Trade-offs:**\n- Better performance (faster load times)\n- Acceptable obfuscation level\n- Allows legitimate debugging\n- Prevents casual reverse engineering\n\n**Configuration:**\n```javascript\n// scripts/obfuscate.js\nconst clientObfuscationConfig = {\n  compact: true,\n  controlFlowFlattening: true,\n  controlFlowFlatteningThreshold: 0.5,\n  deadCodeInjection: true,\n  deadCodeInjectionThreshold: 0.2,\n  debugProtection: false,\n  stringArrayEncoding: ['base64'],\n  // ... more options\n};\n```\n\n#### Source Code Obfuscation (Advanced)\n\n**‚ö†Ô∏è WARNING:** Only use for final production deployment!\n\n**Features:**\n- Obfuscates TypeScript and JavaScript source files directly\n- Maximum protection settings (RC4, self-defending, etc.)\n- Automatic backup creation\n- Cannot be recompiled after obfuscation\n\n**Usage:**\n```bash\n# Obfuscate source code (creates backup)\nnpm run obfuscate:source\n\n# Restore from backup\nnpm run restore:source\n```\n\n**Backup Location:**\n```\nbackup/backup-YYYYMMDD-HHMMSS/\n  ‚îú‚îÄ‚îÄ client/\n  ‚îú‚îÄ‚îÄ server/\n  ‚îú‚îÄ‚îÄ shared/\n  ‚îî‚îÄ‚îÄ scripts/\n```\n\n### Domain Validation\n\nStrict validation ensures CAPTCHA only works on authorized domains.\n\n**Validation Process:**\n\n```typescript\n// server/crypto-utils.ts\nexport function validateDomain(\n  allowedDomains: string | null,\n  origin: string | undefined,\n  referer: string | undefined\n): { isValid: boolean; validatedDomain: string | null }\n```\n\n**Checks:**\n\n1. **Origin Header**: Primary validation method\n2. **Referer Header**: Fallback if Origin missing\n3. **Wildcard Support**: `*.example.com` allows all subdomains\n4. **Localhost Exception**: Allows `localhost` in development\n\n**Example Configurations:**\n\n```javascript\n// Single domain\nallowedDomains: \"example.com\"\n\n// Multiple domains (comma-separated)\nallowedDomains: \"example.com,app.example.com\"\n\n// Wildcard subdomains\nallowedDomains: \"*.example.com\"\n\n// Development (allow all - NOT for production)\nallowedDomains: \"*\"\n```\n\n**Security:**\n- **CORS Protection**: Only allowed domains can load widget\n- **Token Binding**: Tokens tied to validated domain\n- **Replay Prevention**: Tokens cannot be used cross-domain\n\n### Session Management\n\nSecure session handling with fingerprint binding.\n\n**Session Structure:**\n\n```typescript\ninterface Session {\n  sessionId: string;\n  apiKeyId: string;\n  deviceFingerprint: string;\n  ipAddress: string;\n  createdAt: number;\n  lastUsed: number;\n  encryptionKeys: {\n    aesKey: Buffer;\n    hmacKey: Buffer;\n  };\n}\n```\n\n**Security Features:**\n\n#### 1. Session Binding\n\n**Binds Sessions To:**\n- API Key ID\n- Device Fingerprint\n- IP Address (with tolerance for proxy changes)\n\n**Validation:**\n```typescript\nfunction validateSession(sessionId: string, fingerprint: string, ip: string) {\n  const session = cache.get(sessionId);\n  if (!session) return false;\n  \n  // Strict fingerprint check\n  if (session.deviceFingerprint !== fingerprint) return false;\n  \n  // Tolerant IP check (same /24 subnet)\n  if (!isSameSubnet(session.ipAddress, ip)) return false;\n  \n  return true;\n}\n```\n\n#### 2. Session Expiration\n\n**Timeouts:**\n- **Session Lifetime**: 1 hour (rolling)\n- **Challenge Expiry**: 60 seconds (configurable)\n- **Token Expiry**: 60 seconds (configurable)\n- **Grace Period**: 5 seconds for clock skew\n\n**Cleanup:**\n```typescript\n// Automatic cleanup every 10 minutes\nsetInterval(() => {\n  cleanupExpiredSessions();\n  cleanupExpiredChallenges();\n}, 600000);\n```\n\n#### 3. Session Rotation\n\n**Key Rotation:**\n- New encryption keys generated per session\n- Keys rotated on session expiry\n- No key reuse across sessions\n\n**Benefits:**\n- **Forward Secrecy**: Old sessions cannot be decrypted\n- **Reduced Impact**: Compromise of one session doesn't affect others\n- **Compliance**: Meets data protection regulations\n\n---\n\n## üîê Security Features\n\n### Core Security Features (Always Enforced)\n\nThese features are **ALWAYS ACTIVE** and cannot be disabled:\n\n‚úÖ **End-to-End Encryption** (ECDH + AES-GCM)\n‚úÖ **Domain Validation** (Origin/Referer checks)\n‚úÖ **Session Management** (Fingerprint binding)\n‚úÖ **Token Expiration** (Time-based validation)\n‚úÖ **Replay Attack Prevention** (HMAC signatures, single-use tokens)\n‚úÖ **HTTPS Enforcement** (Production only)\n\n### Configurable Security Features\n\nThese features can be enabled/disabled per API key:\n\n‚öôÔ∏è **Anti-Debugger Protection** (default: enabled)\n‚öôÔ∏è **Advanced Fingerprinting** (default: enabled)\n‚öôÔ∏è **Automation Detection** (default: enabled)\n‚öôÔ∏è **Behavioral Analysis** (default: enabled)\n‚öôÔ∏è **CSRF Protection** (default: enabled)\n‚öôÔ∏è **IP Rate Limiting** (default: enabled)\n‚öôÔ∏è **Risk-Adaptive Difficulty** (default: enabled)\n\n### Security Settings Schema\n\n```typescript\ninterface SecuritySettings {\n  // Security Features\n  antiDebugger: boolean;\n  advancedFingerprinting: boolean;\n  sessionBinding: boolean;\n  csrfProtection: boolean;\n  ipRateLimiting: boolean;\n  automationDetection: boolean;\n  behavioralAnalysis: boolean;\n  riskAdaptiveDifficulty: boolean;\n  \n  // Blocking\n  blockedIps: string[];          // CIDR notation supported\n  blockedCountries: string[];    // ISO 3166-1 alpha-2 codes\n  \n  // Proof of Work\n  proofOfWorkDifficulty: number; // 1-10\n  \n  // Rate Limiting\n  rateLimitWindowMs: number;     // 1s - 1h\n  rateLimitMaxRequests: number;  // 1-1000\n  \n  // Timeouts\n  challengeTimeoutMs: number;    // 10s - 5min\n  tokenExpiryMs: number;         // 30s - 10min\n  \n  // Challenge Types\n  enabledChallengeTypes: ('grid' | 'jigsaw' | 'gesture' | 'upside_down')[];\n}\n```\n\n---\n\n## üõ†Ô∏è Security Best Practices\n\n### For Developers Using ProofCaptcha\n\n#### 1. Always Validate on Backend\n\n**‚ùå DON'T: Frontend-Only Validation**\n```javascript\n// INSECURE - Can be bypassed!\nif (captchaToken) {\n  submitForm();\n}\n```\n\n**‚úÖ DO: Backend Validation**\n```javascript\napp.post('/submit', async (req, res) => {\n  // ALWAYS validate on backend\n  const isValid = await validateCaptchaToken(req.body.token);\n  \n  if (!isValid) {\n    return res.status(400).json({ error: 'Invalid CAPTCHA' });\n  }\n  \n  // Process form\n});\n```\n\n#### 2. Use Environment Variables for Secrets\n\n**‚ùå DON'T: Hardcoded Secrets**\n```javascript\nconst SECRET_KEY = 'sk_abc123...'; // INSECURE!\n```\n\n**‚úÖ DO: Environment Variables**\n```javascript\nconst SECRET_KEY = process.env.CAPTCHA_SECRET_KEY;\n\nif (!SECRET_KEY) {\n  throw new Error('CAPTCHA_SECRET_KEY not configured');\n}\n```\n\n**Best Practice:**\n- Use `.env` files for local development\n- Use secure environment variable management in production\n- Never commit `.env` files to version control\n- Rotate keys regularly\n\n#### 3. Handle Errors Gracefully\n\n**‚ùå DON'T: Expose Internal Errors**\n```javascript\ncatch (error) {\n  res.status(500).json({ error: error.message }); // Leaks info!\n}\n```\n\n**‚úÖ DO: Generic Error Messages**\n```javascript\ntry {\n  const result = await validateCaptcha(token);\n  \n  if (!result.success) {\n    return res.status(400).json({ \n      error: 'CAPTCHA verification failed'\n      // Don't expose internal error details\n    });\n  }\n} catch (error) {\n  // Log error for debugging (server-side only)\n  console.error('CAPTCHA validation error:', error);\n  \n  // Return generic error to client\n  res.status(500).json({ \n    error: 'Service temporarily unavailable' \n  });\n}\n```\n\n#### 4. Set Appropriate Timeouts\n\n**‚úÖ DO: Network Timeouts**\n```javascript\nconst verifyResponse = await fetch(url, {\n  method: 'POST',\n  headers: headers,\n  body: JSON.stringify({ token }),\n  signal: AbortSignal.timeout(5000) // 5 second timeout\n});\n```\n\n**Benefits:**\n- Prevents hanging requests\n- Improves user experience\n- Reduces resource consumption\n\n#### 5. Use HTTPS in Production\n\n**‚ùå DON'T: HTTP in Production**\n```\nhttp://example.com  // Vulnerable to MITM attacks\n```\n\n**‚úÖ DO: HTTPS Everywhere**\n```\nhttps://example.com  // Encrypted connection\n```\n\n**CAPTCHA Configuration:**\n- ProofCaptcha enforces HTTPS in production\n- Development mode allows HTTP for localhost\n- Mixed content (HTTPS page + HTTP CAPTCHA) will be blocked by browsers\n\n#### 6. Configure Domain Whitelist Properly\n\n**‚ùå DON'T: Wildcard in Production**\n```javascript\nallowedDomains: \"*\"  // Allows ANY domain!\n```\n\n**‚úÖ DO: Specific Domains**\n```javascript\n// Production\nallowedDomains: \"example.com,app.example.com\"\n\n// Development\nallowedDomains: \"localhost,*.example.local\"\n```\n\n#### 7. Monitor Security Events\n\n**‚úÖ DO: Regular Monitoring**\n```javascript\n// Check analytics dashboard regularly\n// Review blocked IPs\n// Investigate suspicious patterns\n// Analyze success rates\n\n// Set up alerts for:\n// - Sudden drops in success rate\n// - High volume of failed attempts\n// - New blocked IPs\n```\n\n#### 8. Keep Dependencies Updated\n\n**‚úÖ DO: Regular Updates**\n```bash\n# Check for updates\nnpm outdated\n\n# Update dependencies\nnpm update\n\n# Audit security vulnerabilities\nnpm audit\n\n# Fix vulnerabilities\nnpm audit fix\n```\n\n#### 9. Implement Rate Limiting on Your Backend\n\n**‚úÖ DO: Backend Rate Limiting**\n```javascript\nconst rateLimit = require('express-rate-limit');\n\nconst limiter = rateLimit({\n  windowMs: 15 * 60 * 1000, // 15 minutes\n  max: 100, // limit each IP to 100 requests per windowMs\n  message: 'Too many requests from this IP'\n});\n\napp.use('/api/', limiter);\n```\n\n**Why:**\n- Defense in depth\n- Protects against DDoS\n- Complements CAPTCHA protection\n\n#### 10. Secure Session Management\n\n**‚úÖ DO: Secure Session Cookies**\n```javascript\napp.use(session({\n  secret: process.env.SESSION_SECRET,\n  resave: false,\n  saveUninitialized: false,\n  cookie: {\n    secure: true,      // HTTPS only\n    httpOnly: true,    // No JavaScript access\n    sameSite: 'strict', // CSRF protection\n    maxAge: 3600000    // 1 hour\n  }\n}));\n```\n\n---\n\n## ‚ö†Ô∏è Known Security Considerations\n\n### 1. Client-Side JavaScript Requirement\n\n**Issue:**\n- CAPTCHA requires JavaScript to function\n- No-JS users cannot complete CAPTCHA\n\n**Mitigation:**\n- Provide alternative verification methods (email, SMS)\n- Detect JavaScript disabled and show appropriate message\n- Consider server-side fallback for critical flows\n\n### 2. Accessibility Concerns\n\n**Issue:**\n- Visual challenges may be difficult for users with disabilities\n- Screen readers may not work well with interactive challenges\n\n**Mitigation:**\n- Provide audio alternative for visual challenges\n- Ensure keyboard navigation works\n- Follow WCAG 2.1 guidelines\n- Offer alternative verification for accessibility\n\n### 3. Advanced Bots Can Bypass Some Challenges\n\n**Issue:**\n- Sophisticated bots with ML/AI can solve some challenges\n- Headless browsers with stealth mode can bypass detection\n\n**Mitigation:**\n- Use multiple challenge types randomly\n- Combine with behavioral analysis\n- Enable risk-adaptive difficulty\n- Monitor and block suspicious patterns\n- Keep detection methods updated\n\n### 4. False Positives\n\n**Issue:**\n- Legitimate users may be flagged as bots\n- VPN/proxy users may have higher risk scores\n\n**Mitigation:**\n- Tune risk thresholds carefully\n- Allow manual review for blocked users\n- Provide support contact for appeals\n- Use adaptive difficulty instead of hard blocks\n\n### 5. Session Hijacking\n\n**Issue:**\n- If attacker steals session ID, they can reuse it\n\n**Mitigation:**\n- **Session Binding**: Tie sessions to device fingerprints\n- **IP Binding**: Validate IP address (with tolerance for proxies)\n- **Short Expiry**: 1-hour session lifetime\n- **Token Single-Use**: Each token can only be used once\n- **HTTPS Only**: Prevent session ID interception\n\n### 6. Replay Attacks\n\n**Issue:**\n- Attacker could reuse captured valid tokens\n\n**Mitigation:**\n- **HMAC Signatures**: Each challenge has unique signature\n- **Single-Use Tokens**: Tokens marked as used after validation\n- **Timestamp Validation**: Tokens expire after configured time\n- **Nonce Tracking**: Challenge IDs prevent replay\n- **Database Logging**: All verifications logged for audit\n\n### 7. Denial of Service (DoS)\n\n**Issue:**\n- Attacker floods server with challenge requests\n\n**Mitigation:**\n- **Rate Limiting**: Per-IP limits on all endpoints\n- **IP Blocking**: Automatic blocking of abusive IPs\n- **Resource Limits**: CPU/memory limits for proof-of-work\n- **Cloudflare/CDN**: Use CDN for DDoS protection\n- **Monitoring**: Alert on unusual traffic patterns\n\n### 8. Privacy Concerns\n\n**Issue:**\n- Fingerprinting may raise privacy concerns\n- Location tracking from IP address\n\n**Mitigation:**\n- **Transparent Privacy Policy**: Explain data collection\n- **Minimal Data**: Only collect necessary data\n- **No Third-Party Sharing**: Data stays on your servers\n- **Data Retention**: Auto-delete old data\n- **User Control**: Allow users to request data deletion\n- **GDPR/CCPA Compliance**: Follow regulations\n\n### 9. Obfuscation Is Not Encryption\n\n**Issue:**\n- Code obfuscation can be reversed with enough effort\n- Not a substitute for proper encryption\n\n**Mitigation:**\n- **Use Obfuscation AND Encryption**: Defense in depth\n- **Server-Side Logic**: Keep sensitive logic on server\n- **Regular Updates**: Update obfuscation to counter new tools\n- **Monitor**: Detect and block reverse engineering attempts\n- **Legal Protection**: Terms of Service prohibit reverse engineering\n\n### 10. Zero-Day Vulnerabilities\n\n**Issue:**\n- Unknown vulnerabilities may exist in dependencies or code\n\n**Mitigation:**\n- **Regular Audits**: Code reviews and security audits\n- **Dependency Scanning**: Use `npm audit` regularly\n- **Update Policy**: Apply security patches promptly\n- **Bug Bounty**: Encourage responsible disclosure\n- **Monitoring**: Watch for unusual patterns\n- **Incident Response Plan**: Have plan for responding to breaches\n\n---\n\n## üìú Security Audit Log\n\nThis section tracks security-related changes and fixes.\n\n### Version 1.0.0 (2025-11-17)\n\n**Initial Release Security Features:**\n\n- ‚úÖ End-to-end encryption (ECDH + AES-GCM)\n- ‚úÖ Server-side encryption control (downgrade attack prevention)\n- ‚úÖ Multi-layer bot detection (5 layers)\n- ‚úÖ Advanced device fingerprinting\n- ‚úÖ Anti-debugger protection with premium mode\n- ‚úÖ Code obfuscation (RC4 backend, Base64 frontend)\n- ‚úÖ Domain validation with wildcard support\n- ‚úÖ Session management with fingerprint binding\n- ‚úÖ Rate limiting (per-IP, per-API-key)\n- ‚úÖ IP and country blocking\n- ‚úÖ CSRF protection\n- ‚úÖ Replay attack prevention\n- ‚úÖ Honeypot detection\n- ‚úÖ Behavioral analysis\n- ‚úÖ Risk-adaptive difficulty\n- ‚úÖ Security headers (HSTS, CSP, X-Frame-Options, etc.)\n- ‚úÖ Comprehensive security logging\n\n**Security Fixes:**\n\n- **CVE-2025-XXXX**: Fixed downgrade attack vulnerability\n  - **Issue**: Client could force plaintext mode by setting `supportsEncryption: false`\n  - **Fix**: Server now ALWAYS determines encryption mode based on session existence\n  - **Impact**: Prevents MITM attacks and eavesdropping\n  - **Severity**: HIGH\n  - **Fixed in**: v1.0.0\n  - **Credit**: Internal security review\n\n- **CVE-2025-YYYY**: Fixed session fixation vulnerability\n  - **Issue**: Session IDs were predictable\n  - **Fix**: Use cryptographically secure random session IDs (crypto.randomBytes)\n  - **Impact**: Prevents session hijacking\n  - **Severity**: MEDIUM\n  - **Fixed in**: v1.0.0\n  - **Credit**: Internal security review\n\n- **CVE-2025-ZZZZ**: Fixed timing attack on token validation\n  - **Issue**: Token comparison used non-constant-time comparison\n  - **Fix**: Use `crypto.timingSafeEqual` for token comparison\n  - **Impact**: Prevents timing-based token guessing\n  - **Severity**: MEDIUM\n  - **Fixed in**: v1.0.0\n  - **Credit**: Internal security review\n\n---\n\n## üîç Security Testing\n\n### Recommended Testing\n\n**For Developers:**\n- [ ] Test domain validation with various domains\n- [ ] Verify backend token validation works\n- [ ] Test rate limiting thresholds\n- [ ] Verify HTTPS enforcement in production\n- [ ] Test error handling (network failures, invalid tokens, etc.)\n\n**For Security Researchers:**\n- [ ] Attempt replay attacks\n- [ ] Test encryption downgrade attacks\n- [ ] Fuzz API endpoints\n- [ ] Test session hijacking\n- [ ] Attempt CSRF attacks\n- [ ] Test XSS vectors\n- [ ] SQL injection attempts (should be blocked by ORM)\n- [ ] Test automation detection bypass\n- [ ] Test fingerprint spoofing\n\n### Security Tools\n\n**Recommended Tools:**\n- **OWASP ZAP**: Web application security scanner\n- **Burp Suite**: Manual security testing\n- **Nikto**: Web server scanner\n- **SQLMap**: SQL injection testing\n- **npm audit**: Dependency vulnerability scanner\n- **Snyk**: Continuous security monitoring\n\n---\n\n## üìû Security Contact\n\nFor security-related inquiries:\n\n- **Email**: security@proofcaptcha.com\n- **PGP Key**: [Available on request]\n- **Response Time**: 48 hours for acknowledgment\n\nFor general support:\n- **GitHub Issues**: https://github.com/your-org/proofcaptcha/issues\n- **Email**: support@proofcaptcha.com\n\n---\n\n## üìÑ License\n\nThis security policy is part of ProofCaptcha, licensed under the [MIT License](LICENSE).\n\n---\n\n<div align=\"center\">\n  **Security is a shared responsibility. Stay vigilant, stay secure.**\n  \n  Last Updated: 2025-11-17\n</div>\n","size_bytes":30943},"client/src/components/ui/input.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Input = React.forwardRef<HTMLInputElement, React.ComponentProps<\"input\">>(\n  ({ className, type, ...props }, ref) => {\n    // h-9 to match icon buttons and default buttons.\n    return (\n      <input\n        type={type}\n        className={cn(\n          \"flex h-9 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nInput.displayName = \"Input\"\n\nexport { Input }\n","size_bytes":844},"server/upside-down-config.ts":{"content":"export const UPSIDE_DOWN_CONFIG = {\n  animals: [\n    { id: 'animal_001', path: '/assets/generated_images/animal_001_compressed_232cc0094da3c80c28196350cf21d603.webp', size: 80 },\n    { id: 'animal_002', path: '/assets/generated_images/animal_002_compressed_d187b6126635b1f648c430ee08973471.webp', size: 80 },\n    { id: 'animal_003', path: '/assets/generated_images/animal_003_compressed_a8bc6da31617c4e855411d235ea804ee.webp', size: 80 },\n    { id: 'animal_004', path: '/assets/generated_images/animal_004_compressed_129c396210c1e62c83e9191e47792fba.webp', size: 80 },\n    { id: 'animal_005', path: '/assets/generated_images/animal_005_compressed_1818bb6cffa894a50e752664e7d25043.webp', size: 80 },\n    { id: 'animal_006', path: '/assets/generated_images/animal_006_compressed_63b0269c635d3e00e3530d40e7038d90.webp', size: 80 },\n    { id: 'animal_007', path: '/assets/generated_images/animal_007_compressed_06002a6749417522d33ae83820567fc8.webp', size: 80 },\n    { id: 'animal_008', path: '/assets/generated_images/animal_008_compressed_0e9f2d3f34869040c9bff8518d92ae13.webp', size: 80 },\n    { id: 'animal_009', path: '/assets/generated_images/animal_009_compressed_74af1e0898c17aa4fac9a106ed08bb10.webp', size: 80 },\n    { id: 'animal_010', path: '/assets/generated_images/animal_010_compressed_e687027ccb94ac8cca9308fcb6babc11.webp', size: 80 },\n    { id: 'animal_011', path: '/assets/generated_images/animal_011_compressed_7bb4788b4dc3dcf75409aa8172347b24.webp', size: 80 },\n    { id: 'animal_012', path: '/assets/generated_images/animal_012_compressed_b65b83ad17b23a981ea2430a2bf83cda.webp', size: 80 },\n    { id: 'animal_013', path: '/assets/generated_images/animal_013_compressed_a0ae5ebadb4a4078c28b5fd8e74b21ea.webp', size: 80 },\n    { id: 'animal_014', path: '/assets/generated_images/animal_014_compressed_c5db153275b53861fcbbc7b8e4a79553.webp', size: 80 },\n    { id: 'animal_015', path: '/assets/generated_images/animal_015_compressed_53aff7d205bf15cabc654b4c826f51af.webp', size: 80 },\n    { id: 'animal_016', path: '/assets/generated_images/animal_016_compressed_81efbd2b11c2f62c54d34454b62b1aea.webp', size: 80 },\n    { id: 'animal_017', path: '/assets/generated_images/animal_017_compressed_02961d116404ea67b9d65270432af724.webp', size: 80 },\n    { id: 'animal_018', path: '/assets/generated_images/animal_018_compressed_1c101c84847eaf5f850a314bd9520aa5.webp', size: 80 },\n    { id: 'animal_019', path: '/assets/generated_images/animal_019_compressed_dd6b680c5f6b058e3b57789cb88556f5.webp', size: 80 },\n    { id: 'animal_020', path: '/assets/generated_images/animal_020_compressed_601c29739ceaa43577810dcae2539e76.webp', size: 80 },\n    { id: 'animal_021', path: '/assets/generated_images/animal_021_compressed_a668067c7119ee73bd248ce3abeb85a7.webp', size: 80 },\n    { id: 'animal_022', path: '/assets/generated_images/animal_022_compressed_c2b9c1108a9f8953df23a128b5ea30b1.webp', size: 80 },\n    { id: 'animal_023', path: '/assets/generated_images/animal_023_compressed_168b93d8e70175d0a976a589f368f723.webp', size: 80 },\n    { id: 'animal_024', path: '/assets/generated_images/animal_024_compressed_1190042f5943e185019f25145a0977c0.webp', size: 80 },\n    { id: 'animal_025', path: '/assets/generated_images/animal_025_compressed_d724c4aeb538a94e7642507c7e40177d.webp', size: 80 },\n    { id: 'animal_026', path: '/assets/generated_images/animal_026_compressed_50869502d5abc7a3235dad753a9428be.webp', size: 80 },\n    { id: 'animal_027', path: '/assets/generated_images/animal_027_compressed_02f3795764a78f7a67b9f4bb03c7b5a0.webp', size: 80 },\n    { id: 'animal_028', path: '/assets/generated_images/animal_028_compressed_5c496c081e657272a62885af2b30ba28.webp', size: 80 },\n    { id: 'animal_029', path: '/assets/generated_images/animal_029_compressed_29ed664210b92794e048cc77d6a24fd9.webp', size: 80 },\n    { id: 'animal_030', path: '/assets/generated_images/animal_030_compressed_8b70d2a954bd358ed0f570fc946bf83e.webp', size: 80 },\n    { id: 'animal_031', path: '/assets/generated_images/animal_031_compressed_882005afc0e1ba6a22500d87e74191f6.webp', size: 80 },\n    { id: 'animal_032', path: '/assets/generated_images/animal_032_compressed_a0aa14d5b070a974194279ee240cd07c.webp', size: 80 },\n    { id: 'animal_033', path: '/assets/generated_images/animal_033_compressed_91b9ca5aefce3a4ade7a96474a9d7a1a.webp', size: 80 },\n    { id: 'animal_034', path: '/assets/generated_images/animal_034_compressed_1a9cfd56ae2a68dc88e37ca1906e7ace.webp', size: 80 },\n    { id: 'animal_035', path: '/assets/generated_images/animal_035_compressed_d1603450329122ac3553d1dd99d6e7ad.webp', size: 80 },\n    { id: 'animal_036', path: '/assets/generated_images/animal_036_compressed_ed992f3d82c09b2350502f7c306bb0b7.webp', size: 80 },\n    { id: 'animal_037', path: '/assets/generated_images/animal_037_compressed_4c3cef808bb21a39419ef6b1697f2ac2.webp', size: 80 },\n    { id: 'animal_038', path: '/assets/generated_images/animal_038_compressed_937b1205d6566e8a3c96b99cfbc9b220.webp', size: 80 },\n    { id: 'animal_039', path: '/assets/generated_images/animal_039_compressed_4be9bd67d05bf5646f72c2984254b2e8.webp', size: 80 },\n    { id: 'animal_040', path: '/assets/generated_images/animal_040_compressed_0fbbea7a0885757a803c771a13535097.webp', size: 80 },\n    { id: 'animal_041', path: '/assets/generated_images/animal_041_compressed_53effbb5c8cedd736c2eadd924928d24.webp', size: 80 },\n    { id: 'animal_042', path: '/assets/generated_images/animal_042_compressed_62d5c1be671e35318141af9e3b0d3849.webp', size: 80 },\n    { id: 'animal_043', path: '/assets/generated_images/animal_043_compressed_e10c35506cd36ed502d9d9e9e94821e4.webp', size: 80 },\n    { id: 'animal_044', path: '/assets/generated_images/animal_044_compressed_d31baa524e82a101bf3f0656a581fdcb.webp', size: 80 },\n    { id: 'animal_045', path: '/assets/generated_images/animal_045_compressed_a681d8b30b5215101a1effa33f482ad0.webp', size: 80 },\n    { id: 'animal_046', path: '/assets/generated_images/animal_046_compressed_96c0f26c5779d2f25a33b2918eb09179.webp', size: 80 },\n    { id: 'animal_047', path: '/assets/generated_images/animal_047_compressed_abad3849c40521e8cc4c66a15477d970.webp', size: 80 },\n    { id: 'animal_048', path: '/assets/generated_images/animal_048_compressed_f8b1d320de30c01abeefcb7c4f994858.webp', size: 80 },\n    { id: 'animal_049', path: '/assets/generated_images/animal_049_compressed_809c6940025311924682a8ab71490c05.webp', size: 80 },\n  ],\n  backgrounds: [\n    '/assets/stock_images/floral_pattern_green_a3b1b488.jpg',\n    '/assets/stock_images/floral_pattern_green_7eb03bb9.jpg',\n  ],\n  canvas: {\n    width: 600,\n    height: 400,\n  },\n  tolerance: 50,\n  minAnimals: 5,\n  maxAnimals: 10,\n  upsideDownPercentage: 0.4,\n} as const;\n\nexport interface AnimalSprite {\n  id: string;\n  x: number;\n  y: number;\n  orientation: 'upright' | 'upside_down';\n  animalType: string;\n  path: string;\n  rotation?: number;\n}\n\nexport interface UpsideDownChallengeData {\n  backgroundIndex: number;\n  backgroundUrl: string;\n  animals: AnimalSprite[];\n  canvasWidth: number;\n  canvasHeight: number;\n  tolerance: number;\n}\n\nexport interface UpsideDownSolution {\n  clicks: Array<{ x: number; y: number }>;\n}\n","size_bytes":7166},"server/public/backend-example.js":{"content":"/**\n * CONTOH BACKEND VALIDATION untuk API-SERVER.CLOUD\n * \n * File ini adalah contoh implementasi backend untuk memvalidasi token captcha\n * yang dikirim dari client ke server Replit.\n * \n * Flow:\n * 1. Client menyelesaikan captcha di browser\n * 2. Client mendapat verificationToken\n * 3. Client kirim form data + verificationToken ke backend Anda (api-server.cloud)\n * 4. Backend Anda validasi token ke server Replit menggunakan endpoint ini\n * 5. Backend Anda proses form jika validasi berhasil\n */\n\n// ============================================================================\n// CONTOH MENGGUNAKAN NODE.JS + EXPRESS\n// ============================================================================\n\nconst express = require('express');\nconst fetch = require('node-fetch'); // atau gunakan axios\nconst app = express();\n\n// Middleware\napp.use(express.json());\napp.use(express.urlencoded({ extended: true }));\n\n// Konfigurasi - GANTI dengan nilai Anda\nconst CONFIG = {\n  // Domain server Replit Anda\n  REPLIT_API_URL: 'https://<REPLIT_DOMAIN>',\n  \n  // Secret Key dari dashboard Replit (JANGAN SHARE!)\n  // Ini berbeda dengan sitekey - ini adalah API secret key\n  API_SECRET_KEY: 'your-api-secret-key-here',\n  \n  // Sitekey Anda (untuk referensi, tidak digunakan di backend)\n  SITEKEY: 'your-sitekey-here'\n};\n\n/**\n * Endpoint untuk menerima form submission dari client\n */\napp.post('/validate-captcha', async (req, res) => {\n  try {\n    const { name, email, message, captchaToken } = req.body;\n    \n    // 1. Validasi input dasar\n    if (!name || !email || !message) {\n      return res.status(400).json({\n        success: false,\n        message: 'Semua field harus diisi'\n      });\n    }\n    \n    // 2. Validasi captcha token\n    if (!captchaToken) {\n      return res.status(400).json({\n        success: false,\n        message: 'Token captcha diperlukan'\n      });\n    }\n    \n    // 3. Verifikasi token ke server Replit\n    const isValidCaptcha = await verifyCaptchaToken(captchaToken);\n    \n    if (!isValidCaptcha.success) {\n      return res.status(400).json({\n        success: false,\n        message: 'Validasi captcha gagal: ' + isValidCaptcha.error\n      });\n    }\n    \n    // 4. Proses data (simpan ke database, kirim email, dll)\n    console.log('Form data valid:', { name, email, message });\n    console.log('Captcha verification:', isValidCaptcha.data);\n    \n    // TODO: Simpan ke database atau proses sesuai kebutuhan\n    // await saveToDatabase({ name, email, message });\n    // await sendEmail({ to: email, subject: 'Terima kasih!', ... });\n    \n    // 5. Return success response\n    res.json({\n      success: true,\n      message: 'Formulir berhasil dikirim!',\n      data: {\n        name,\n        email,\n        // Jangan return captcha token ke client\n      }\n    });\n    \n  } catch (error) {\n    console.error('Error processing form:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Terjadi kesalahan server'\n    });\n  }\n});\n\n/**\n * Fungsi untuk memverifikasi token captcha ke server Replit\n * @param {string} verificationToken - Token dari captcha yang sudah diselesaikan\n * @returns {Promise<{success: boolean, error?: string, data?: object}>}\n */\nasync function verifyCaptchaToken(verificationToken) {\n  try {\n    const response = await fetch(\n      `${CONFIG.REPLIT_API_URL}/api/captcha/verify-token`,\n      {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          // PENTING: Gunakan API Secret Key untuk autentikasi\n          'Authorization': `Bearer ${CONFIG.API_SECRET_KEY}`,\n        },\n        body: JSON.stringify({\n          token: verificationToken,\n        })\n      }\n    );\n    \n    const result = await response.json();\n    \n    if (!response.ok) {\n      return {\n        success: false,\n        error: result.error || 'Verification failed'\n      };\n    }\n    \n    return {\n      success: result.success,\n      data: result.data || {}\n    };\n    \n  } catch (error) {\n    console.error('Error verifying captcha token:', error);\n    return {\n      success: false,\n      error: 'Failed to connect to verification server'\n    };\n  }\n}\n\n// Start server\nconst PORT = process.env.PORT || 3000;\napp.listen(PORT, () => {\n  console.log(`Backend server running on port ${PORT}`);\n  console.log('Captcha verification endpoint: POST /validate-captcha');\n});\n\n\n// ============================================================================\n// CONTOH MENGGUNAKAN PHP\n// ============================================================================\n/*\n<?php\n// validate-captcha.php\n\n// Konfigurasi\ndefine('REPLIT_API_URL', 'https://<REPLIT_DOMAIN>');\ndefine('API_SECRET_KEY', 'your-api-secret-key-here');\n\n// Terima POST request\nif ($_SERVER['REQUEST_METHOD'] !== 'POST') {\n    http_response_code(405);\n    echo json_encode(['success' => false, 'message' => 'Method not allowed']);\n    exit;\n}\n\n// Ambil data dari request\n$input = json_decode(file_get_contents('php://input'), true);\n$name = $input['name'] ?? '';\n$email = $input['email'] ?? '';\n$message = $input['message'] ?? '';\n$captchaToken = $input['captchaToken'] ?? '';\n\n// Validasi input\nif (empty($name) || empty($email) || empty($message)) {\n    http_response_code(400);\n    echo json_encode(['success' => false, 'message' => 'Semua field harus diisi']);\n    exit;\n}\n\nif (empty($captchaToken)) {\n    http_response_code(400);\n    echo json_encode(['success' => false, 'message' => 'Token captcha diperlukan']);\n    exit;\n}\n\n// Verifikasi captcha token\n$verificationResult = verifyCaptchaToken($captchaToken);\n\nif (!$verificationResult['success']) {\n    http_response_code(400);\n    echo json_encode([\n        'success' => false, \n        'message' => 'Validasi captcha gagal: ' . $verificationResult['error']\n    ]);\n    exit;\n}\n\n// Proses data (simpan ke database, dll)\n// ... your business logic here ...\n\n// Return success\necho json_encode([\n    'success' => true,\n    'message' => 'Formulir berhasil dikirim!'\n]);\n\n/**\n * Fungsi untuk memverifikasi token captcha\n */\nfunction verifyCaptchaToken($token) {\n    $url = REPLIT_API_URL . '/api/captcha/verify-token';\n    \n    $data = json_encode(['token' => $token]);\n    \n    $ch = curl_init($url);\n    curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);\n    curl_setopt($ch, CURLOPT_POST, true);\n    curl_setopt($ch, CURLOPT_POSTFIELDS, $data);\n    curl_setopt($ch, CURLOPT_HTTPHEADER, [\n        'Content-Type: application/json',\n        'Authorization: Bearer ' . API_SECRET_KEY\n    ]);\n    \n    $response = curl_exec($ch);\n    $httpCode = curl_getinfo($ch, CURLINFO_HTTP_CODE);\n    curl_close($ch);\n    \n    if ($httpCode !== 200) {\n        return [\n            'success' => false,\n            'error' => 'HTTP error: ' . $httpCode\n        ];\n    }\n    \n    $result = json_decode($response, true);\n    \n    return [\n        'success' => $result['success'] ?? false,\n        'error' => $result['error'] ?? null,\n        'data' => $result['data'] ?? []\n    ];\n}\n?>\n*/\n\n\n// ============================================================================\n// CONTOH MENGGUNAKAN PYTHON + FLASK\n// ============================================================================\n/*\nfrom flask import Flask, request, jsonify\nimport requests\n\napp = Flask(__name__)\n\n# Konfigurasi\nREPLIT_API_URL = 'https://<REPLIT_DOMAIN>'\nAPI_SECRET_KEY = 'your-api-secret-key-here'\n\n@app.route('/validate-captcha', methods=['POST'])\ndef validate_captcha():\n    try:\n        # Ambil data dari request\n        data = request.get_json()\n        name = data.get('name')\n        email = data.get('email')\n        message = data.get('message')\n        captcha_token = data.get('captchaToken')\n        \n        # Validasi input\n        if not all([name, email, message]):\n            return jsonify({\n                'success': False,\n                'message': 'Semua field harus diisi'\n            }), 400\n        \n        if not captcha_token:\n            return jsonify({\n                'success': False,\n                'message': 'Token captcha diperlukan'\n            }), 400\n        \n        # Verifikasi captcha token\n        is_valid = verify_captcha_token(captcha_token)\n        \n        if not is_valid['success']:\n            return jsonify({\n                'success': False,\n                'message': f\"Validasi captcha gagal: {is_valid.get('error')}\"\n            }), 400\n        \n        # Proses data (simpan ke database, dll)\n        # ... your business logic here ...\n        \n        # Return success\n        return jsonify({\n            'success': True,\n            'message': 'Formulir berhasil dikirim!'\n        })\n        \n    except Exception as e:\n        print(f'Error processing form: {e}')\n        return jsonify({\n            'success': False,\n            'message': 'Terjadi kesalahan server'\n        }), 500\n\ndef verify_captcha_token(token):\n    \"\"\"Verifikasi token captcha ke server Replit\"\"\"\n    try:\n        url = f'{REPLIT_API_URL}/api/captcha/verify-token'\n        headers = {\n            'Content-Type': 'application/json',\n            'Authorization': f'Bearer {API_SECRET_KEY}'\n        }\n        payload = {'token': token}\n        \n        response = requests.post(url, json=payload, headers=headers)\n        \n        if response.status_code != 200:\n            return {\n                'success': False,\n                'error': f'HTTP error: {response.status_code}'\n            }\n        \n        result = response.json()\n        \n        return {\n            'success': result.get('success', False),\n            'error': result.get('error'),\n            'data': result.get('data', {})\n        }\n        \n    except Exception as e:\n        print(f'Error verifying captcha: {e}')\n        return {\n            'success': False,\n            'error': 'Failed to connect to verification server'\n        }\n\nif __name__ == '__main__':\n    app.run(port=3000)\n*/\n\n\n// ============================================================================\n// TESTING\n// ============================================================================\n/*\nUntuk testing, gunakan curl:\n\ncurl -X POST http://localhost:3000/validate-captcha \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"name\": \"John Doe\",\n    \"email\": \"john@example.com\",\n    \"message\": \"Hello!\",\n    \"captchaToken\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...\"\n  }'\n*/\n","size_bytes":10313},"server/session-cache.ts":{"content":"import { SessionKey, generateServerKeyPair } from \"./encryption\";\n\n/**\n * Session cache for storing ephemeral ECDH keys and derived session keys\n * \n * Features:\n * - Automatic expiry (default 5 minutes)\n * - Memory-based storage with cleanup\n * - IP/fingerprint binding for replay protection\n * - Periodic rotation of server ephemeral keys (hourly)\n * \n * Security considerations:\n * - Session keys are kept in memory only (not persisted to disk)\n * - Expired sessions are automatically cleaned up\n * - Server key pairs rotate regularly to limit exposure\n */\n\nexport interface ServerKeyPair {\n  publicKey: Buffer;\n  privateKey: Buffer;\n  createdAt: number;\n  expiresAt: number;\n}\n\nexport interface CachedSession {\n  sessionKey: SessionKey;\n  apiPublicKey: string; // Binds session to specific API key\n  clientIP: string;\n  deviceFingerprint: string;\n  createdAt: number;\n  expiresAt: number;\n}\n\n/**\n * SessionCache manages ephemeral keys and session state\n */\nexport class SessionCache {\n  private currentServerKeyPair: ServerKeyPair | null = null;\n  private sessions: Map<string, CachedSession> = new Map();\n\n  // Configuration\n  private readonly SESSION_EXPIRY_MS = 5 * 60 * 1000; // 5 minutes\n  private readonly SERVER_KEY_ROTATION_MS = 60 * 60 * 1000; // 1 hour\n  private readonly CLEANUP_INTERVAL_MS = 60 * 1000; // 1 minute\n\n  private cleanupInterval: NodeJS.Timeout | null = null;\n\n  constructor() {\n    this.startCleanupTask();\n  }\n\n  /**\n   * Get current server ephemeral key pair\n   * Generates new pair if none exists or expired\n   */\n  getCurrentServerKeyPair(): ServerKeyPair {\n    const now = Date.now();\n\n    // Generate new key pair if none exists or expired\n    if (\n      !this.currentServerKeyPair ||\n      this.currentServerKeyPair.expiresAt <= now\n    ) {\n      const keyPair = generateServerKeyPair();\n\n      this.currentServerKeyPair = {\n        publicKey: keyPair.publicKey,\n        privateKey: keyPair.privateKey,\n        createdAt: now,\n        expiresAt: now + this.SERVER_KEY_ROTATION_MS,\n      };\n\n      console.log(\n        `[SESSION] Generated new server ephemeral key pair (expires in ${this.SERVER_KEY_ROTATION_MS / 1000}s)`\n      );\n    }\n\n    return this.currentServerKeyPair;\n  }\n\n  /**\n   * Generate unique session ID from client info\n   * Note: We don't include IP in the session ID because proxies/load balancers\n   * (like Replit's infrastructure) can change the client IP between requests,\n   * which would invalidate the session. Instead, we rely on device fingerprint\n   * and API key for session binding.\n   */\n  private generateSessionId(\n    apiPublicKey: string,\n    clientIP: string,\n    deviceFingerprint: string\n  ): string {\n    return `${apiPublicKey}:${deviceFingerprint}`;\n  }\n\n  /**\n   * Store session key with binding to API key, IP, and fingerprint\n   */\n  storeSession(\n    sessionKey: SessionKey,\n    apiPublicKey: string,\n    clientIP: string,\n    deviceFingerprint: string\n  ): string {\n    const sessionId = this.generateSessionId(\n      apiPublicKey,\n      clientIP,\n      deviceFingerprint\n    );\n\n    const now = Date.now();\n    const cachedSession: CachedSession = {\n      sessionKey,\n      apiPublicKey,\n      clientIP,\n      deviceFingerprint,\n      createdAt: now,\n      expiresAt: now + this.SESSION_EXPIRY_MS,\n    };\n\n    this.sessions.set(sessionId, cachedSession);\n\n    console.log(\n      `[SESSION] Stored session for ${apiPublicKey.substring(0, 12)}... (expires in ${this.SESSION_EXPIRY_MS / 1000}s)`\n    );\n\n    return sessionId;\n  }\n\n  /**\n   * Retrieve session key with validation\n   * Returns null if session not found, expired, or binding mismatch\n   */\n  getSession(\n    apiPublicKey: string,\n    clientIP: string,\n    deviceFingerprint: string\n  ): SessionKey | null {\n    const sessionId = this.generateSessionId(\n      apiPublicKey,\n      clientIP,\n      deviceFingerprint\n    );\n\n    const cached = this.sessions.get(sessionId);\n    if (!cached) {\n      return null;\n    }\n\n    const now = Date.now();\n\n    // Check expiry\n    if (cached.expiresAt <= now) {\n      this.sessions.delete(sessionId);\n      console.log(`[SESSION] Session expired for ${sessionId}`);\n      return null;\n    }\n\n    // Verify bindings (excluding IP since it can change due to load balancing)\n    if (\n      cached.apiPublicKey !== apiPublicKey ||\n      cached.deviceFingerprint !== deviceFingerprint\n    ) {\n      console.warn(\n        `[SESSION] Session binding mismatch for ${sessionId} - possible replay attack`\n      );\n      return null;\n    }\n    \n    // Log IP change for monitoring (not a security issue in load-balanced environments)\n    if (cached.clientIP !== clientIP) {\n      console.log(\n        `[SESSION] IP changed from ${cached.clientIP} to ${clientIP} for session ${sessionId.substring(0, 20)}... (acceptable in load-balanced environments)`\n      );\n    }\n\n    return cached.sessionKey;\n  }\n\n  /**\n   * Invalidate a specific session\n   */\n  invalidateSession(\n    apiPublicKey: string,\n    clientIP: string,\n    deviceFingerprint: string\n  ): void {\n    const sessionId = this.generateSessionId(\n      apiPublicKey,\n      clientIP,\n      deviceFingerprint\n    );\n\n    if (this.sessions.delete(sessionId)) {\n      console.log(`[SESSION] Invalidated session ${sessionId}`);\n    }\n  }\n\n  /**\n   * Clear all expired sessions\n   */\n  private cleanupExpiredSessions(): void {\n    const now = Date.now();\n    let removedCount = 0;\n\n    this.sessions.forEach((cached, sessionId) => {\n      if (cached.expiresAt <= now) {\n        this.sessions.delete(sessionId);\n        removedCount++;\n      }\n    });\n\n    if (removedCount > 0) {\n      console.log(\n        `[SESSION] Cleaned up ${removedCount} expired sessions (${this.sessions.size} active)`\n      );\n    }\n  }\n\n  /**\n   * Start periodic cleanup task\n   */\n  private startCleanupTask(): void {\n    if (this.cleanupInterval) {\n      return;\n    }\n\n    this.cleanupInterval = setInterval(() => {\n      this.cleanupExpiredSessions();\n    }, this.CLEANUP_INTERVAL_MS);\n\n    console.log(\n      `[SESSION] Started cleanup task (interval: ${this.CLEANUP_INTERVAL_MS / 1000}s)`\n    );\n  }\n\n  /**\n   * Stop cleanup task (for testing or shutdown)\n   */\n  stopCleanupTask(): void {\n    if (this.cleanupInterval) {\n      clearInterval(this.cleanupInterval);\n      this.cleanupInterval = null;\n      console.log(\"[SESSION] Stopped cleanup task\");\n    }\n  }\n\n  /**\n   * Get cache statistics\n   */\n  getStats(): {\n    activeSessions: number;\n    serverKeyExpiresIn: number;\n  } {\n    const now = Date.now();\n    const serverKeyExpiresIn = this.currentServerKeyPair\n      ? Math.max(0, this.currentServerKeyPair.expiresAt - now)\n      : 0;\n\n    return {\n      activeSessions: this.sessions.size,\n      serverKeyExpiresIn: Math.floor(serverKeyExpiresIn / 1000),\n    };\n  }\n\n  /**\n   * Clear all sessions (for testing)\n   */\n  clearAll(): void {\n    this.sessions.clear();\n    this.currentServerKeyPair = null;\n    console.log(\"[SESSION] Cleared all sessions and server keys\");\n  }\n}\n\nexport const sessionCache = new SessionCache();\n","size_bytes":7041},"client/src/components/ui/input-otp.tsx":{"content":"import * as React from \"react\"\nimport { OTPInput, OTPInputContext } from \"input-otp\"\nimport { Dot } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst InputOTP = React.forwardRef<\n  React.ElementRef<typeof OTPInput>,\n  React.ComponentPropsWithoutRef<typeof OTPInput>\n>(({ className, containerClassName, ...props }, ref) => (\n  <OTPInput\n    ref={ref}\n    containerClassName={cn(\n      \"flex items-center gap-2 has-[:disabled]:opacity-50\",\n      containerClassName\n    )}\n    className={cn(\"disabled:cursor-not-allowed\", className)}\n    {...props}\n  />\n))\nInputOTP.displayName = \"InputOTP\"\n\nconst InputOTPGroup = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"flex items-center\", className)} {...props} />\n))\nInputOTPGroup.displayName = \"InputOTPGroup\"\n\nconst InputOTPSlot = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\"> & { index: number }\n>(({ index, className, ...props }, ref) => {\n  const inputOTPContext = React.useContext(OTPInputContext)\n  const { char, hasFakeCaret, isActive } = inputOTPContext.slots[index]\n\n  return (\n    <div\n      ref={ref}\n      className={cn(\n        \"relative flex h-10 w-10 items-center justify-center border-y border-r border-input text-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md\",\n        isActive && \"z-10 ring-2 ring-ring ring-offset-background\",\n        className\n      )}\n      {...props}\n    >\n      {char}\n      {hasFakeCaret && (\n        <div className=\"pointer-events-none absolute inset-0 flex items-center justify-center\">\n          <div className=\"h-4 w-px animate-caret-blink bg-foreground duration-1000\" />\n        </div>\n      )}\n    </div>\n  )\n})\nInputOTPSlot.displayName = \"InputOTPSlot\"\n\nconst InputOTPSeparator = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ ...props }, ref) => (\n  <div ref={ref} role=\"separator\" {...props}>\n    <Dot />\n  </div>\n))\nInputOTPSeparator.displayName = \"InputOTPSeparator\"\n\nexport { InputOTP, InputOTPGroup, InputOTPSlot, InputOTPSeparator }\n","size_bytes":2154},"client/src/components/ui/label.tsx":{"content":"import * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst labelVariants = cva(\n  \"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\n)\n\nconst Label = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &\n    VariantProps<typeof labelVariants>\n>(({ className, ...props }, ref) => (\n  <LabelPrimitive.Root\n    ref={ref}\n    className={cn(labelVariants(), className)}\n    {...props}\n  />\n))\nLabel.displayName = LabelPrimitive.Root.displayName\n\nexport { Label }\n","size_bytes":710},"server/challenge-tracker.ts":{"content":"interface UsedChallenge {\n  token: string;\n  usedAt: number;\n}\n\nconst usedChallenges = new Map<string, UsedChallenge>();\nconst MAX_TRACKED_CHALLENGES = 10000;\nconst CLEANUP_INTERVAL_MS = 5 * 60 * 1000;\nconst CHALLENGE_TTL_MS = 10 * 60 * 1000;\n\nexport function markChallengeAsUsed(token: string): void {\n  usedChallenges.set(token, {\n    token,\n    usedAt: Date.now(),\n  });\n\n  if (usedChallenges.size > MAX_TRACKED_CHALLENGES) {\n    const sortedEntries = Array.from(usedChallenges.entries())\n      .sort((a, b) => a[1].usedAt - b[1].usedAt);\n    \n    const toRemove = sortedEntries.slice(0, MAX_TRACKED_CHALLENGES / 2);\n    toRemove.forEach(([key]) => usedChallenges.delete(key));\n  }\n}\n\nexport function isChallengeUsed(token: string): boolean {\n  return usedChallenges.has(token);\n}\n\nexport function cleanupOldChallenges(): void {\n  const now = Date.now();\n  const toDelete: string[] = [];\n\n  for (const [token, challenge] of Array.from(usedChallenges.entries())) {\n    if (now - challenge.usedAt > CHALLENGE_TTL_MS) {\n      toDelete.push(token);\n    }\n  }\n\n  toDelete.forEach(token => usedChallenges.delete(token));\n  \n  if (toDelete.length > 0) {\n    console.log(`Cleaned up ${toDelete.length} expired challenges from memory`);\n  }\n}\n\nsetInterval(cleanupOldChallenges, CLEANUP_INTERVAL_MS);\n\nexport function getChallengeStats() {\n  return {\n    totalTracked: usedChallenges.size,\n    oldestChallenge: Math.min(...Array.from(usedChallenges.values()).map(c => c.usedAt)),\n    newestChallenge: Math.max(...Array.from(usedChallenges.values()).map(c => c.usedAt)),\n  };\n}\n","size_bytes":1570},"client/src/components/ui/progress.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ProgressPrimitive from \"@radix-ui/react-progress\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Progress = React.forwardRef<\n  React.ElementRef<typeof ProgressPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ProgressPrimitive.Root>\n>(({ className, value, ...props }, ref) => (\n  <ProgressPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative h-4 w-full overflow-hidden rounded-full bg-secondary\",\n      className\n    )}\n    {...props}\n  >\n    <ProgressPrimitive.Indicator\n      className=\"h-full w-full flex-1 bg-primary transition-all\"\n      style={{ transform: `translateX(-${100 - (value || 0)}%)` }}\n    />\n  </ProgressPrimitive.Root>\n))\nProgress.displayName = ProgressPrimitive.Root.displayName\n\nexport { Progress }\n","size_bytes":791},"client/src/pages/ApiDocs.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { motion } from \"framer-motion\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Accordion, AccordionContent, AccordionItem, AccordionTrigger } from \"@/components/ui/accordion\";\nimport { Alert, AlertDescription, AlertTitle } from \"@/components/ui/alert\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport CaptchaWidget from \"@/components/CaptchaWidget\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Code2, Shield, Lock, Key, Fingerprint, AlertTriangle, CheckCircle2, XCircle, Activity, Zap, Globe, Code } from \"lucide-react\";\nimport { useTranslation } from \"react-i18next\";\n\nexport default function ApiDocs() {\n  const { t } = useTranslation();\n  const isDev = import.meta.env.DEV;\n  const [verified, setVerified] = useState(false);\n  const [selectedType, setSelectedType] = useState<\"random\" | \"grid\" | \"jigsaw\" | \"gesture\" | \"upside_down\">(\"random\");\n  const { toast } = useToast();\n\n  const { data: demoKey, isLoading: isDemoKeyLoading } = useQuery<{ sitekey: string; publicKey: string; name: string }>({\n    queryKey: [\"/api/demo/key\"],\n  });\n\n  const handleSuccess = () => {\n    setVerified(true);\n    toast({\n      title: t('apiDocs.demo.toast.verificationSuccess'),\n      description: t('apiDocs.demo.toast.captchaCompleted'),\n    });\n  };\n\n  useEffect(() => {\n    if (verified) {\n      const timer = setTimeout(() => setVerified(false), 5000);\n      return () => clearTimeout(timer);\n    }\n  }, [verified]);\n\n  return (\n    <div className=\"min-h-screen bg-background relative\">\n      {/* Animated Background */}\n      <div className=\"fixed inset-0 overflow-hidden pointer-events-none\">\n        <div className=\"absolute top-0 right-0 w-[300px] md:w-[500px] h-[300px] md:h-[500px] bg-purple-500/5 dark:bg-purple-500/10 rounded-full blur-[100px] animate-pulse\" />\n        <div className=\"absolute bottom-0 left-0 w-[250px] md:w-[400px] h-[250px] md:h-[400px] bg-blue-500/5 dark:bg-blue-500/10 rounded-full blur-[80px] animate-pulse\" style={{ animationDelay: '1.5s' }} />\n      </div>\n\n      <div className=\"relative container mx-auto px-3 py-4 sm:p-6 space-y-4 sm:space-y-6\">\n        <motion.div\n          initial={{ opacity: 0, y: -20 }}\n          animate={{ opacity: 1, y: 0 }}\n          transition={{ duration: 0.6 }}\n          className=\"flex items-center gap-2 sm:gap-3\"\n        >\n          <div className=\"p-1.5 sm:p-2 bg-gradient-to-br from-purple-500 to-blue-600 rounded-lg shadow-lg shadow-purple-500/30\">\n            <Code className=\"h-4 w-4 sm:h-6 sm:w-6 text-white\" data-testid=\"icon-api-docs\" />\n          </div>\n          <div>\n            <h1 className=\"text-xl sm:text-2xl lg:text-3xl font-bold\" data-testid=\"heading-api-docs\">{t('apiDocs.title')}</h1>\n            <p className=\"text-xs sm:text-sm text-muted-foreground\">{t('apiDocs.subtitle')}</p>\n          </div>\n        </motion.div>\n\n        <motion.div\n          initial={{ opacity: 0, y: 20 }}\n          animate={{ opacity: 1, y: 0 }}\n          transition={{ delay: 0.2 }}\n        >\n          <Tabs defaultValue=\"demo\" className=\"w-full\">\n        <div className=\"overflow-x-auto -mx-3 px-3 sm:-mx-0 sm:px-0 pb-1\">\n          <TabsList className=\"inline-flex sm:grid sm:grid-cols-5 w-auto sm:w-full gap-1 sm:gap-2\" data-testid=\"tabs-api-docs\">\n            <TabsTrigger value=\"demo\" data-testid=\"tab-demo\" className=\"whitespace-nowrap text-xs sm:text-sm px-3 sm:px-4\">{t('apiDocs.tabs.demo')}</TabsTrigger>\n            <TabsTrigger value=\"frontend\" data-testid=\"tab-frontend\" className=\"whitespace-nowrap text-xs sm:text-sm px-3 sm:px-4\">{t('apiDocs.tabs.frontend')}</TabsTrigger>\n            <TabsTrigger value=\"backend\" data-testid=\"tab-backend\" className=\"whitespace-nowrap text-xs sm:text-sm px-3 sm:px-4\">{t('apiDocs.tabs.backend')}</TabsTrigger>\n            <TabsTrigger value=\"security\" data-testid=\"tab-security\" className=\"whitespace-nowrap text-xs sm:text-sm px-3 sm:px-4\">{t('apiDocs.tabs.security')}</TabsTrigger>\n            <TabsTrigger value=\"best-practices\" data-testid=\"tab-best-practices\" className=\"whitespace-nowrap text-xs sm:text-sm px-3 sm:px-4\">{t('apiDocs.tabs.bestPractices')}</TabsTrigger>\n          </TabsList>\n        </div>\n\n        {/* Live Demo Tab */}\n        <TabsContent value=\"demo\" className=\"space-y-4\">\n          <Alert>\n            <Shield className=\"h-4 w-4\" />\n            <AlertTitle>{t('apiDocs.demo.alert.title')}</AlertTitle>\n            <AlertDescription>\n              {t('apiDocs.demo.alert.description')}\n            </AlertDescription>\n          </Alert>\n\n          <Card data-testid=\"card-checkbox-demo\" className=\"card-3d\">\n            <CardHeader>\n              <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3\">\n                <div className=\"flex-1 min-w-0\">\n                  <CardTitle className=\"text-base sm:text-lg\">{t('apiDocs.demo.card.title')}</CardTitle>\n                  <CardDescription className=\"mt-1 sm:mt-2 text-xs sm:text-sm\">\n                    {t('apiDocs.demo.card.description')}\n                  </CardDescription>\n                </div>\n                <div className=\"flex items-center gap-2 flex-wrap sm:flex-nowrap\">\n                  {isDev && (\n                    <Select\n                      value={selectedType}\n                      onValueChange={(value) => setSelectedType(value as typeof selectedType)}\n                      data-testid=\"select-challenge-type\"\n                    >\n                      <SelectTrigger className=\"w-full sm:w-40 text-xs sm:text-sm\" data-testid=\"trigger-challenge-type\">\n                        <SelectValue placeholder={t('apiDocs.demo.card.selectChallenge')} />\n                      </SelectTrigger>\n                      <SelectContent data-testid=\"content-challenge-type\">\n                        <SelectItem value=\"random\" data-testid=\"option-random\">{t('apiDocs.demo.challengeTypes.random')}</SelectItem>\n                        <SelectItem value=\"grid\" data-testid=\"option-grid\">{t('apiDocs.demo.challengeTypes.grid')}</SelectItem>\n                        <SelectItem value=\"jigsaw\" data-testid=\"option-jigsaw\">{t('apiDocs.demo.challengeTypes.jigsaw')}</SelectItem>\n                        <SelectItem value=\"gesture\" data-testid=\"option-gesture\">{t('apiDocs.demo.challengeTypes.gesture')}</SelectItem>\n                        <SelectItem value=\"upside_down\" data-testid=\"option-upside-down\">{t('apiDocs.demo.challengeTypes.upsideDown')}</SelectItem>\n                      </SelectContent>\n                    </Select>\n                  )}\n                  {verified && (\n                    <Badge variant=\"default\" data-testid=\"badge-verified\" className=\"text-xs\">\n                      {t('apiDocs.demo.card.verified')}\n                    </Badge>\n                  )}\n                </div>\n              </div>\n            </CardHeader>\n            <CardContent className=\"flex justify-center py-4 sm:py-8 px-2 sm:px-6\">\n              {isDemoKeyLoading ? (\n                <div className=\"flex items-center gap-2 sm:gap-3 p-4 sm:p-8\">\n                  <div className=\"h-6 w-6 sm:h-8 sm:w-8 animate-spin rounded-full border-3 sm:border-4 border-primary border-t-transparent\" />\n                  <p className=\"text-sm sm:text-lg font-medium\">{t('apiDocs.demo.card.loading')}</p>\n                </div>\n              ) : demoKey ? (\n                <CaptchaWidget\n                  publicKey={demoKey.sitekey}\n                  type={selectedType}\n                  onSuccess={handleSuccess}\n                  onError={(error) => {\n                    toast({\n                      title: t('apiDocs.demo.toast.verificationFailed'),\n                      description: error,\n                      variant: \"destructive\",\n                    });\n                  }}\n                />\n              ) : (\n                <div className=\"flex items-center gap-2 sm:gap-3 p-4 sm:p-8 text-muted-foreground\">\n                  <p className=\"text-sm sm:text-base\">{t('apiDocs.demo.card.unavailable')}</p>\n                </div>\n              )}\n            </CardContent>\n          </Card>\n\n          <Card className=\"card-3d\">\n            <CardHeader>\n              <CardTitle className=\"text-base sm:text-lg\">{t('apiDocs.demo.quickStart.title')}</CardTitle>\n              <CardDescription className=\"text-xs sm:text-sm\">{t('apiDocs.demo.quickStart.description')}</CardDescription>\n            </CardHeader>\n            <CardContent className=\"space-y-3 sm:space-y-4\">\n              <div className=\"space-y-1.5 sm:space-y-2\">\n                <h3 className=\"text-sm sm:text-lg font-semibold\">{t('apiDocs.demo.quickStart.step1.title')}</h3>\n                <p className=\"text-xs sm:text-sm text-muted-foreground\">\n                  {t('apiDocs.demo.quickStart.step1.descriptionPart1')}{' '}\n                  <Badge variant=\"secondary\" className=\"mx-1 text-xs\">{t('apiDocs.demo.quickStart.step1.sitekey')}</Badge>{' '}\n                  {t('apiDocs.demo.quickStart.step1.descriptionPart2')}{' '}\n                  <Badge variant=\"secondary\" className=\"mx-1 text-xs\">{t('apiDocs.demo.quickStart.step1.secretkey')}</Badge>{' '}\n                  {t('apiDocs.demo.quickStart.step1.descriptionPart3')}\n                </p>\n              </div>\n\n              <div className=\"space-y-1.5 sm:space-y-2\">\n                <h3 className=\"text-sm sm:text-lg font-semibold\">{t('apiDocs.demo.quickStart.step2.title')}</h3>\n                <p className=\"text-xs sm:text-sm text-muted-foreground\">\n                  {t('apiDocs.demo.quickStart.step2.description')}\n                </p>\n              </div>\n\n              <div className=\"space-y-1.5 sm:space-y-2\">\n                <h3 className=\"text-sm sm:text-lg font-semibold\">{t('apiDocs.demo.quickStart.step3.title')}</h3>\n                <p className=\"text-xs sm:text-sm text-muted-foreground\">\n                  {t('apiDocs.demo.quickStart.step3.description')}\n                </p>\n              </div>\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        {/* Frontend Integration Tab */}\n        <TabsContent value=\"frontend\" className=\"space-y-4\">\n          <Card data-testid=\"card-integration\">\n            <CardHeader>\n              <div className=\"flex items-center gap-2\">\n                <Code2 className=\"h-5 w-5\" />\n                <CardTitle>{t('apiDocs.frontend.title')}</CardTitle>\n              </div>\n              <CardDescription>{t('apiDocs.frontend.description')}</CardDescription>\n            </CardHeader>\n            <CardContent>\n              <Tabs defaultValue=\"html\" data-testid=\"tabs-integration\">\n                <div className=\"overflow-x-auto -mx-3 px-3 sm:-mx-0 sm:px-0 pb-1\">\n                  <TabsList className=\"inline-flex sm:grid sm:grid-cols-2 w-auto sm:w-full gap-1 sm:gap-2\">\n                    <TabsTrigger value=\"html\" data-testid=\"tab-html\" className=\"whitespace-nowrap text-xs sm:text-sm px-4 sm:px-6 flex-1 sm:flex-none\">\n                      {t('apiDocs.frontend.tabs.html')}\n                    </TabsTrigger>\n                    <TabsTrigger value=\"react\" data-testid=\"tab-react\" className=\"whitespace-nowrap text-xs sm:text-sm px-4 sm:px-6 flex-1 sm:flex-none\">\n                      {t('apiDocs.frontend.tabs.react')}\n                    </TabsTrigger>\n                  </TabsList>\n                </div>\n\n                <TabsContent value=\"html\" className=\"space-y-4\">\n                  <div className=\"space-y-2\">\n                    <h4 className=\"font-medium text-sm sm:text-base\">{t('apiDocs.frontend.html.step1.title')}</h4>\n                    <p className=\"text-xs sm:text-sm text-muted-foreground\">\n                      {t('apiDocs.frontend.html.step1.description')}\n                    </p>\n                    <div className=\"overflow-auto rounded-lg\">\n                      <pre className=\"bg-muted p-3 sm:p-4 rounded-lg text-[10px] sm:text-xs font-mono whitespace-pre w-max min-w-full\">\n{`Sitekey: ${demoKey?.sitekey || 'pk_your_sitekey_here'}\nDomain: Your website domain (e.g., example.com)`}\n                      </pre>\n                    </div>\n                  </div>\n                  \n                  <div className=\"space-y-2\">\n                    <h4 className=\"font-medium text-sm sm:text-base\">{t('apiDocs.frontend.html.step2.title')}</h4>\n                    <p className=\"text-xs sm:text-sm text-muted-foreground\">\n                      {t('apiDocs.frontend.html.step2.description')}\n                    </p>\n                    <div className=\"overflow-auto rounded-lg\">\n                      <pre className=\"bg-muted p-3 sm:p-4 rounded-lg text-[10px] sm:text-xs font-mono whitespace-pre w-max min-w-full\">\n{`<script src=\"${window.location.origin}/proofCaptcha/api.js\" async defer></script>`}\n                      </pre>\n                    </div>\n                  </div>\n\n                  <div className=\"space-y-2\">\n                    <h4 className=\"font-medium text-sm sm:text-base\">{t('apiDocs.frontend.html.step3.title')}</h4>\n                    <p className=\"text-xs sm:text-sm text-muted-foreground\">\n                      {t('apiDocs.frontend.html.step3.description')}\n                    </p>\n                    <div className=\"overflow-auto rounded-lg max-h-[400px]\">\n                      <pre className=\"bg-muted p-3 sm:p-4 rounded-lg text-[10px] sm:text-xs font-mono whitespace-pre w-max min-w-full\">\n{`<form id=\"contact-form\">\n  <input type=\"email\" name=\"email\" placeholder=\"Email\" required>\n  <textarea name=\"message\" placeholder=\"Message\" required></textarea>\n  \n  <!-- Auto-Render CAPTCHA Widget -->\n  <div class=\"proof-captcha\"\n       data-sitekey=\"${demoKey?.sitekey || 'YOUR_SITEKEY'}\"\n       data-theme=\"light\"\n       data-type=\"random\"\n       data-callback=\"onCaptchaSuccess\"\n       data-error-callback=\"onCaptchaError\">\n  </div>\n  \n  <button type=\"submit\">Send Message</button>\n</form>\n\n<script>\n  function onCaptchaSuccess(token) {\n    console.log('CAPTCHA verified:', token);\n  }\n  \n  function onCaptchaError(error) {\n    console.error('CAPTCHA error:', error);\n  }\n  \n  document.getElementById('contact-form').addEventListener('submit', (e) => {\n    e.preventDefault();\n    const token = ProofCaptcha.getResponse();\n    if (!token) {\n      alert('Please complete CAPTCHA');\n      return;\n    }\n    // Submit form with token\n    console.log('Submitting with token:', token);\n  });\n</script>`}\n                      </pre>\n                    </div>\n                  </div>\n\n                  <div className=\"space-y-2\">\n                    <h4 className=\"font-medium text-sm sm:text-base\">{t('apiDocs.frontend.html.step4.title')}</h4>\n                    <p className=\"text-xs sm:text-sm text-muted-foreground\">\n                      {t('apiDocs.frontend.html.step4.description')}\n                    </p>\n                    <div className=\"overflow-auto rounded-lg\">\n                      <pre className=\"bg-muted p-3 sm:p-4 rounded-lg text-[10px] sm:text-xs font-mono whitespace-pre w-max min-w-full\">\n{`<div id=\"captcha-container\"></div>\n\n<script>\n  ProofCaptcha.ready(function() {\n    ProofCaptcha.render('captcha-container', {\n      sitekey: '${demoKey?.sitekey || 'YOUR_SITEKEY'}',\n      theme: 'light',\n      type: 'random',\n      callback: onCaptchaSuccess,\n      'error-callback': onCaptchaError\n    });\n  });\n</script>`}\n                      </pre>\n                    </div>\n                  </div>\n                </TabsContent>\n\n                <TabsContent value=\"react\" className=\"space-y-4\">\n                  <div className=\"space-y-2\">\n                    <h4 className=\"font-medium\">{t('apiDocs.frontend.react.step1.title')}</h4>\n                    <pre className=\"bg-muted p-4 rounded-lg overflow-x-auto text-xs font-mono\">\n{`npm install @proofcaptcha/react\n# or\nyarn add @proofcaptcha/react`}\n                    </pre>\n                  </div>\n\n                  <div className=\"space-y-2\">\n                    <h4 className=\"font-medium\">{t('apiDocs.frontend.react.step2.title')}</h4>\n                    <pre className=\"bg-muted p-4 rounded-lg overflow-x-auto text-xs font-mono\">\n{`import { useState } from 'react';\nimport { ProofCaptcha } from '@proofcaptcha/react';\n\nfunction ContactForm() {\n  const [token, setToken] = useState('');\n  const [formData, setFormData] = useState({\n    email: '',\n    message: ''\n  });\n\n  const handleSubmit = async (e) => {\n    e.preventDefault();\n    \n    if (!token) {\n      alert('Please complete CAPTCHA');\n      return;\n    }\n\n    // Submit form with CAPTCHA token\n    const response = await fetch('/api/contact', {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({ ...formData, captchaToken: token })\n    });\n    \n    const result = await response.json();\n    console.log(result);\n  };\n\n  return (\n    <form onSubmit={handleSubmit}>\n      <input\n        type=\"email\"\n        value={formData.email}\n        onChange={(e) => setFormData({...formData, email: e.target.value})}\n        placeholder=\"Email\"\n        required\n      />\n      \n      <textarea\n        value={formData.message}\n        onChange={(e) => setFormData({...formData, message: e.target.value})}\n        placeholder=\"Message\"\n        required\n      />\n      \n      {/* ProofCaptcha Widget */}\n      <ProofCaptcha\n        publicKey=\"${demoKey?.sitekey || 'YOUR_SITEKEY'}\"\n        type=\"random\"\n        onSuccess={setToken}\n        onError={(error) => console.error(error)}\n      />\n      \n      <button type=\"submit\" disabled={!token}>\n        Send Message\n      </button>\n    </form>\n  );\n}`}\n                    </pre>\n                  </div>\n\n                  <div className=\"space-y-2\">\n                    <h4 className=\"font-medium\">{t('apiDocs.frontend.react.step3.title')}</h4>\n                    <pre className=\"bg-muted p-4 rounded-lg overflow-x-auto text-xs font-mono\">\n{`publicKey: string;          // Your sitekey (public API key)\ntype?: 'random' | 'grid' | 'jigsaw';  // Challenge type\nonSuccess?: (token: string) => void;  // Success callback\nonError?: (error: string) => void;    // Error callback`}\n                    </pre>\n                  </div>\n                </TabsContent>\n              </Tabs>\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        {/* Backend Verification Tab */}\n        <TabsContent value=\"backend\" className=\"space-y-4\">\n          <Card>\n            <CardHeader>\n              <CardTitle>{t('apiDocs.backend.title')}</CardTitle>\n              <CardDescription>{t('apiDocs.backend.description')}</CardDescription>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <Alert data-testid=\"alert-backend-required\">\n                <AlertTriangle className=\"h-4 w-4\" />\n                <AlertTitle>{t('apiDocs.backend.alert.title')}</AlertTitle>\n                <AlertDescription>\n                  {t('apiDocs.backend.alert.description')}\n                </AlertDescription>\n              </Alert>\n\n              <div className=\"space-y-2\">\n                <h4 className=\"font-medium\">{t('apiDocs.backend.tokenFlow.title')}</h4>\n                <div className=\"bg-muted p-4 rounded-lg space-y-2 text-sm\">\n                  <div className=\"flex items-start gap-2\">\n                    <Badge variant=\"outline\" className=\"mt-0.5\">{t('apiDocs.backend.tokenFlow.step1.label')}</Badge>\n                    <div>\n                      <strong>{t('apiDocs.backend.tokenFlow.step1.title')}</strong> {t('apiDocs.backend.tokenFlow.step1.description')}\n                    </div>\n                  </div>\n                  <div className=\"flex items-start gap-2\">\n                    <Badge variant=\"outline\" className=\"mt-0.5\">{t('apiDocs.backend.tokenFlow.step2.label')}</Badge>\n                    <div>\n                      <strong>{t('apiDocs.backend.tokenFlow.step2.title')}</strong> {t('apiDocs.backend.tokenFlow.step2.description')}\n                    </div>\n                  </div>\n                  <div className=\"flex items-start gap-2\">\n                    <Badge variant=\"outline\" className=\"mt-0.5\">{t('apiDocs.backend.tokenFlow.step3.label')}</Badge>\n                    <div>\n                      <strong>{t('apiDocs.backend.tokenFlow.step3.title')}</strong> {t('apiDocs.backend.tokenFlow.step3.description')}\n                    </div>\n                  </div>\n                  <div className=\"flex items-start gap-2\">\n                    <Badge variant=\"outline\" className=\"mt-0.5\">{t('apiDocs.backend.tokenFlow.step4.label')}</Badge>\n                    <div>\n                      <strong>{t('apiDocs.backend.tokenFlow.step4.title')}</strong> {t('apiDocs.backend.tokenFlow.step4.description', { endpoint: '/proofCaptcha/api/siteverify' })}\n                    </div>\n                  </div>\n                  <div className=\"flex items-start gap-2\">\n                    <Badge variant=\"outline\" className=\"mt-0.5\">{t('apiDocs.backend.tokenFlow.step5.label')}</Badge>\n                    <div>\n                      <strong>{t('apiDocs.backend.tokenFlow.step5.title')}</strong> {t('apiDocs.backend.tokenFlow.step5.description')}\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n              <div className=\"space-y-2\">\n                <h4 className=\"font-medium\">{t('apiDocs.backend.tokenTypes.title')}</h4>\n                <div className=\"grid gap-3\">\n                  <div className=\"bg-muted p-3 rounded-lg\">\n                    <div className=\"flex items-start gap-2\">\n                      <Key className=\"h-4 w-4 text-blue-500 mt-0.5 flex-shrink-0\" />\n                      <div>\n                        <strong className=\"text-sm\">{t('apiDocs.backend.tokenTypes.challenge.title')}</strong>\n                        <p className=\"text-xs text-muted-foreground mt-1\">\n                          {t('apiDocs.backend.tokenTypes.challenge.description')}\n                        </p>\n                      </div>\n                    </div>\n                  </div>\n                  <div className=\"bg-muted p-3 rounded-lg\">\n                    <div className=\"flex items-start gap-2\">\n                      <Lock className=\"h-4 w-4 text-green-500 mt-0.5 flex-shrink-0\" />\n                      <div>\n                        <strong className=\"text-sm\">{t('apiDocs.backend.tokenTypes.verification.title')}</strong>\n                        <p className=\"text-xs text-muted-foreground mt-1\">\n                          {t('apiDocs.backend.tokenTypes.verification.description')}\n                        </p>\n                      </div>\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n              <div className=\"space-y-2\">\n                <h4 className=\"font-medium\">{t('apiDocs.backend.examples.nodejs.title')}</h4>\n                <pre className=\"bg-muted p-4 rounded-lg overflow-x-auto text-xs font-mono\" data-testid=\"code-backend-example\">\n{`app.post('/api/contact', async (req, res) => {\n  const { captchaToken, email, message } = req.body;\n  \n  // REQUIRED: Verify CAPTCHA token with ProofCaptcha backend\n  // This prevents bots from bypassing client-side checks\n  const verifyResponse = await fetch('${window.location.origin}/proofCaptcha/api/siteverify', {\n    method: 'POST',\n    headers: { 'Content-Type': 'application/json' },\n    body: JSON.stringify({\n      response: captchaToken,  // Verification token from api.js\n      secret: process.env.PROOFCAPTCHA_SECRET_KEY  // Your secret key\n    })\n  });\n  \n  const verifyResult = await verifyResponse.json();\n  \n  // Reject if verification fails\n  if (!verifyResult.success) {\n    return res.status(400).json({ \n      error: 'CAPTCHA verification failed',\n      details: verifyResult['error-codes'] || 'Invalid CAPTCHA'\n    });\n  }\n  \n  // ‚úì CAPTCHA verified successfully\n  // Now it's safe to process the user's request\n  await sendContactEmail(email, message);\n  \n  res.json({ \n    success: true,\n    message: 'Message sent successfully' \n  });\n});`}\n                </pre>\n              </div>\n\n              <div className=\"space-y-2\">\n                <h4 className=\"font-medium\">{t('apiDocs.backend.examples.python.title')}</h4>\n                <pre className=\"bg-muted p-4 rounded-lg overflow-x-auto text-xs font-mono\">\n{`import requests\nimport os\n\n@app.route('/api/contact', methods=['POST'])\ndef contact():\n    data = request.get_json()\n    captcha_token = data.get('captchaToken')\n    \n    # REQUIRED: Verify with ProofCaptcha backend\n    verify_response = requests.post(\n        '${window.location.origin}/proofCaptcha/api/siteverify',\n        json={\n            'response': captcha_token,  # Verification token\n            'secret': os.getenv('PROOFCAPTCHA_SECRET_KEY')\n        }\n    )\n    \n    result = verify_response.json()\n    \n    # Reject if verification fails\n    if not result.get('success'):\n        return jsonify({\n            'error': 'CAPTCHA verification failed',\n            'details': result.get('error-codes', [])\n        }), 400\n    \n    # ‚úì Verified - process the request\n    send_email(data['email'], data['message'])\n    \n    return jsonify({'success': True})`}\n                </pre>\n              </div>\n\n              <div className=\"space-y-2\">\n                <h4 className=\"font-medium\">{t('apiDocs.backend.siteverify.request')}</h4>\n                <pre className=\"bg-muted p-4 rounded-lg overflow-x-auto text-xs font-mono\" data-testid=\"code-backend-request\">\n{`POST /proofCaptcha/api/siteverify\nContent-Type: application/json\n\n{\n  \"response\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...\",  // JWT verification token\n  \"secret\": \"sk_your_secret_key_here\"  // Your secret key from dashboard\n}`}\n                </pre>\n              </div>\n\n              <div className=\"space-y-2\">\n                <h4 className=\"font-medium\">{t('apiDocs.backend.siteverify.response')}</h4>\n                <div className=\"grid gap-3\">\n                  <div>\n                    <p className=\"text-xs font-medium mb-2 text-green-600\">{t('apiDocs.backend.siteverify.successTitle')}</p>\n                    <pre className=\"bg-muted p-3 rounded text-xs font-mono overflow-x-auto\" data-testid=\"code-backend-response\">\n{`{\n  \"success\": true,\n  \"challenge_ts\": \"2024-01-15T10:30:45.123Z\",\n  \"hostname\": \"example.com\"\n}`}\n                    </pre>\n                  </div>\n                  <div>\n                    <p className=\"text-xs font-medium mb-2 text-red-600\">{t('apiDocs.backend.siteverify.errorTitle')}</p>\n                    <pre className=\"bg-muted p-3 rounded text-xs font-mono overflow-x-auto\">\n{`{\n  \"success\": false,\n  \"error-codes\": [\"invalid-input-response\"]\n}`}\n                    </pre>\n                  </div>\n                </div>\n              </div>\n\n              <div className=\"space-y-2\">\n                <h4 className=\"font-medium\">{t('apiDocs.backend.siteverify.errorCodesTitle')}</h4>\n                <div className=\"bg-muted p-4 rounded-lg space-y-2 text-xs\">\n                  <div><code>missing-input-secret</code> - {t('apiDocs.backend.siteverify.errors.missingSecret')}</div>\n                  <div><code>invalid-input-secret</code> - {t('apiDocs.backend.siteverify.errors.invalidSecret')}</div>\n                  <div><code>missing-input-response</code> - {t('apiDocs.backend.siteverify.errors.missingResponse')}</div>\n                  <div><code>invalid-input-response</code> - {t('apiDocs.backend.siteverify.errors.invalidResponse')}</div>\n                  <div><code>timeout-or-duplicate</code> - {t('apiDocs.backend.siteverify.errors.timeoutDuplicate')}</div>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        {/* Security Tab */}\n        <TabsContent value=\"security\" className=\"space-y-4\">\n          <Card data-testid=\"card-security-architecture\">\n            <CardHeader>\n              <div className=\"flex items-center gap-2\">\n                <Shield className=\"h-5 w-5 text-primary\" />\n                <CardTitle>{t('apiDocs.security.title')}</CardTitle>\n              </div>\n              <CardDescription>\n                {t('apiDocs.security.description')}\n              </CardDescription>\n            </CardHeader>\n            <CardContent className=\"space-y-6\">\n              <div className=\"grid gap-3 sm:gap-4 md:grid-cols-2 lg:grid-cols-4\">\n                <div data-testid=\"pillar-crypto\" className=\"bg-card border rounded-md p-3 sm:p-4 space-y-2\">\n                  <div className=\"flex items-center gap-2\">\n                    <Lock className=\"h-4 w-4 text-primary flex-shrink-0\" />\n                    <h3 className=\"text-sm font-medium\">\n                      {t('apiDocs.security.pillars.crypto.title')}\n                    </h3>\n                  </div>\n                  <p className=\"text-xs text-muted-foreground\">\n                    {t('apiDocs.security.pillars.crypto.description')}\n                  </p>\n                </div>\n\n                <div data-testid=\"pillar-validation\" className=\"bg-card border rounded-md p-3 sm:p-4 space-y-2\">\n                  <div className=\"flex items-center gap-2\">\n                    <Globe className=\"h-4 w-4 text-primary flex-shrink-0\" />\n                    <h3 className=\"text-sm font-medium\">\n                      {t('apiDocs.security.pillars.validation.title')}\n                    </h3>\n                  </div>\n                  <p className=\"text-xs text-muted-foreground\">\n                    {t('apiDocs.security.pillars.validation.description')}\n                  </p>\n                </div>\n\n                <div data-testid=\"pillar-pow\" className=\"bg-card border rounded-md p-3 sm:p-4 space-y-2\">\n                  <div className=\"flex items-center gap-2\">\n                    <Zap className=\"h-4 w-4 text-primary flex-shrink-0\" />\n                    <h3 className=\"text-sm font-medium\">\n                      {t('apiDocs.security.pillars.pow.title')}\n                    </h3>\n                  </div>\n                  <p className=\"text-xs text-muted-foreground\">\n                    {t('apiDocs.security.pillars.pow.description')}\n                  </p>\n                </div>\n\n                <div data-testid=\"pillar-fingerprint\" className=\"bg-card border rounded-md p-3 sm:p-4 space-y-2\">\n                  <div className=\"flex items-center gap-2\">\n                    <Fingerprint className=\"h-4 w-4 text-primary flex-shrink-0\" />\n                    <h3 className=\"text-sm font-medium\">\n                      {t('apiDocs.security.pillars.fingerprint.title')}\n                    </h3>\n                  </div>\n                  <p className=\"text-xs text-muted-foreground\">\n                    {t('apiDocs.security.pillars.fingerprint.description')}\n                  </p>\n                </div>\n              </div>\n\n              <Tabs defaultValue=\"features\" data-testid=\"tabs-security\">\n                <TabsList className=\"grid w-full grid-cols-2\">\n                  <TabsTrigger value=\"features\" data-testid=\"tab-features\">{t('apiDocs.security.tabs.features')}</TabsTrigger>\n                  <TabsTrigger value=\"scenarios\" data-testid=\"tab-scenarios\">{t('apiDocs.security.tabs.threatModel')}</TabsTrigger>\n                </TabsList>\n\n                <TabsContent value=\"features\" className=\"space-y-4\">\n                  <Accordion type=\"single\" collapsible className=\"w-full\" data-testid=\"accordion-security\">\n                    <AccordionItem value=\"fingerprinting\">\n                      <AccordionTrigger data-testid=\"trigger-fingerprinting\">\n                        <div className=\"flex items-center gap-2\">\n                          <Fingerprint className=\"h-4 w-4\" />\n                          <span>{t('apiDocs.security.features.fingerprinting.title')}</span>\n                        </div>\n                      </AccordionTrigger>\n                      <AccordionContent className=\"space-y-2\">\n                        <p className=\"text-sm\">\n                          {t('apiDocs.security.features.fingerprinting.description')}\n                        </p>\n                        <div className=\"grid gap-2 text-sm\">\n                          <div className=\"flex items-start gap-2\">\n                            <CheckCircle2 className=\"h-4 w-4 text-green-500 mt-0.5 flex-shrink-0\" />\n                            <div>\n                              <strong>{t('apiDocs.security.features.fingerprinting.canvas.title')}</strong> {t('apiDocs.security.features.fingerprinting.canvas.description')}\n                            </div>\n                          </div>\n                          <div className=\"flex items-start gap-2\">\n                            <CheckCircle2 className=\"h-4 w-4 text-green-500 mt-0.5 flex-shrink-0\" />\n                            <div>\n                              <strong>{t('apiDocs.security.features.fingerprinting.webgl.title')}</strong> {t('apiDocs.security.features.fingerprinting.webgl.description')}\n                            </div>\n                          </div>\n                          <div className=\"flex items-start gap-2\">\n                            <CheckCircle2 className=\"h-4 w-4 text-green-500 mt-0.5 flex-shrink-0\" />\n                            <div>\n                              <strong>{t('apiDocs.security.features.fingerprinting.audio.title')}</strong> {t('apiDocs.security.features.fingerprinting.audio.description')}\n                            </div>\n                          </div>\n                          <div className=\"flex items-start gap-2\">\n                            <CheckCircle2 className=\"h-4 w-4 text-green-500 mt-0.5 flex-shrink-0\" />\n                            <div>\n                              <strong>{t('apiDocs.security.features.fingerprinting.font.title')}</strong> {t('apiDocs.security.features.fingerprinting.font.description')}\n                            </div>\n                          </div>\n                          <div className=\"flex items-start gap-2\">\n                            <CheckCircle2 className=\"h-4 w-4 text-green-500 mt-0.5 flex-shrink-0\" />\n                            <div>\n                              <strong>{t('apiDocs.security.features.fingerprinting.screen.title')}</strong> {t('apiDocs.security.features.fingerprinting.screen.description')}\n                            </div>\n                          </div>\n                        </div>\n                      </AccordionContent>\n                    </AccordionItem>\n\n                    <AccordionItem value=\"risk-scoring\">\n                      <AccordionTrigger data-testid=\"trigger-risk\">\n                        <div className=\"flex items-center gap-2\">\n                          <Activity className=\"h-4 w-4\" />\n                          <span>{t('apiDocs.security.features.riskScoring.title')}</span>\n                        </div>\n                      </AccordionTrigger>\n                      <AccordionContent className=\"space-y-2\">\n                        <p className=\"text-sm\">\n                          {t('apiDocs.security.features.riskScoring.description')}\n                        </p>\n                        <div className=\"mt-3\">\n                          <strong>{t('apiDocs.security.features.riskScoring.factorsTitle')}</strong>\n                        </div>\n                        <div className=\"grid gap-1\">\n                          <div className=\"flex items-center justify-between p-2 bg-muted rounded\">\n                            <span>{t('apiDocs.security.features.riskScoring.automation')}</span>\n                            <Badge variant=\"destructive\">{t('apiDocs.security.features.riskScoring.automationPoints')}</Badge>\n                          </div>\n                          <div className=\"flex items-center justify-between p-2 bg-muted rounded\">\n                            <span>{t('apiDocs.security.features.riskScoring.highFrequency')}</span>\n                            <Badge variant=\"destructive\">{t('apiDocs.security.features.riskScoring.highFrequencyPoints')}</Badge>\n                          </div>\n                          <div className=\"flex items-center justify-between p-2 bg-muted rounded\">\n                            <span>{t('apiDocs.security.features.riskScoring.failedAttempts')}</span>\n                            <Badge variant=\"destructive\">{t('apiDocs.security.features.riskScoring.failedAttemptsPoints')}</Badge>\n                          </div>\n                        </div>\n                        <div className=\"mt-3\">\n                          <strong>{t('apiDocs.security.features.riskScoring.responseTitle')}</strong>\n                        </div>\n                        <div className=\"grid gap-1\">\n                          <div className=\"flex items-center gap-2\">\n                            <Badge className=\"bg-green-500\">{t('apiDocs.security.features.riskScoring.lowRisk')}</Badge>\n                            <span>{t('apiDocs.security.features.riskScoring.lowRiskResponse')}</span>\n                          </div>\n                          <div className=\"flex items-center gap-2\">\n                            <Badge className=\"bg-yellow-500\">{t('apiDocs.security.features.riskScoring.mediumRisk')}</Badge>\n                            <span>{t('apiDocs.security.features.riskScoring.mediumRiskResponse')}</span>\n                          </div>\n                          <div className=\"flex items-center gap-2\">\n                            <Badge className=\"bg-red-500\">{t('apiDocs.security.features.riskScoring.highRisk')}</Badge>\n                            <span>{t('apiDocs.security.features.riskScoring.highRiskResponse')}</span>\n                          </div>\n                        </div>\n                      </AccordionContent>\n                    </AccordionItem>\n\n                    <AccordionItem value=\"ip\">\n                      <AccordionTrigger data-testid=\"trigger-ip\">\n                        <div className=\"flex items-center gap-2\">\n                          <Shield className=\"h-4 w-4\" />\n                          <span>{t('apiDocs.security.features.ipBlocking.title')}</span>\n                        </div>\n                      </AccordionTrigger>\n                      <AccordionContent className=\"space-y-2\">\n                        <p className=\"text-sm\">\n                          {t('apiDocs.security.features.ipBlocking.description')}\n                        </p>\n                        <div className=\"grid gap-2 text-sm\">\n                          <div className=\"flex items-start gap-2\">\n                            <CheckCircle2 className=\"h-4 w-4 text-green-500 mt-0.5 flex-shrink-0\" />\n                            <div>\n                              <strong>{t('apiDocs.security.features.ipBlocking.automatic.title')}</strong> {t('apiDocs.security.features.ipBlocking.automatic.description')}\n                            </div>\n                          </div>\n                          <div className=\"flex items-start gap-2\">\n                            <CheckCircle2 className=\"h-4 w-4 text-green-500 mt-0.5 flex-shrink-0\" />\n                            <div>\n                              <strong>{t('apiDocs.security.features.ipBlocking.manual.title')}</strong> {t('apiDocs.security.features.ipBlocking.manual.description')}\n                            </div>\n                          </div>\n                          <div className=\"flex items-start gap-2\">\n                            <CheckCircle2 className=\"h-4 w-4 text-green-500 mt-0.5 flex-shrink-0\" />\n                            <div>\n                              <strong>{t('apiDocs.security.features.ipBlocking.rateLimit.title')}</strong> {t('apiDocs.security.features.ipBlocking.rateLimit.description')}\n                            </div>\n                          </div>\n                          <div className=\"flex items-start gap-2\">\n                            <CheckCircle2 className=\"h-4 w-4 text-green-500 mt-0.5 flex-shrink-0\" />\n                            <div>\n                              <strong>{t('apiDocs.security.features.ipBlocking.cleanup.title')}</strong> {t('apiDocs.security.features.ipBlocking.cleanup.description')}\n                            </div>\n                          </div>\n                        </div>\n                      </AccordionContent>\n                    </AccordionItem>\n\n                    <AccordionItem value=\"behavioral\">\n                      <AccordionTrigger data-testid=\"trigger-behavioral\">\n                        <div className=\"flex items-center gap-2\">\n                          <Activity className=\"h-4 w-4\" />\n                          <span>{t('apiDocs.security.features.behavioral.title')}</span>\n                        </div>\n                      </AccordionTrigger>\n                      <AccordionContent className=\"space-y-2\">\n                        <p className=\"text-sm\">\n                          {t('apiDocs.security.features.behavioral.description')}\n                        </p>\n                        <div className=\"grid gap-2 text-sm\">\n                          <div className=\"flex items-start gap-2\">\n                            <AlertTriangle className=\"h-4 w-4 text-yellow-500 mt-0.5 flex-shrink-0\" />\n                            <div>\n                              <strong>{t('apiDocs.security.features.behavioral.timing.title')}</strong> {t('apiDocs.security.features.behavioral.timing.description')}\n                            </div>\n                          </div>\n                          <div className=\"flex items-start gap-2\">\n                            <AlertTriangle className=\"h-4 w-4 text-yellow-500 mt-0.5 flex-shrink-0\" />\n                            <div>\n                              <strong>{t('apiDocs.security.features.behavioral.request.title')}</strong> {t('apiDocs.security.features.behavioral.request.description')}\n                            </div>\n                          </div>\n                          <div className=\"flex items-start gap-2\">\n                            <AlertTriangle className=\"h-4 w-4 text-yellow-500 mt-0.5 flex-shrink-0\" />\n                            <div>\n                              <strong>{t('apiDocs.security.features.behavioral.userAgent.title')}</strong> {t('apiDocs.security.features.behavioral.userAgent.description')}\n                            </div>\n                          </div>\n                        </div>\n                      </AccordionContent>\n                    </AccordionItem>\n\n                    <AccordionItem value=\"devtools\">\n                      <AccordionTrigger data-testid=\"trigger-devtools\">\n                        <div className=\"flex items-center gap-2\">\n                          <AlertTriangle className=\"h-4 w-4\" />\n                          <span>{t('apiDocs.security.features.antiDebugger.title')}</span>\n                        </div>\n                      </AccordionTrigger>\n                      <AccordionContent className=\"space-y-3\">\n                        <p className=\"text-sm\">\n                          {t('apiDocs.security.features.antiDebugger.description')}\n                        </p>\n                        <div className=\"grid gap-3 md:grid-cols-2\">\n                          <div className=\"bg-muted p-4 rounded-lg space-y-2\">\n                            <div className=\"flex items-center gap-2\">\n                              <Shield className=\"h-4 w-4 text-destructive\" />\n                              <h4 className=\"font-medium text-sm\">{t('apiDocs.security.features.antiDebugger.realtime.title')}</h4>\n                            </div>\n                            <p className=\"text-xs text-muted-foreground\">\n                              {t('apiDocs.security.features.antiDebugger.realtime.description')}\n                            </p>\n                            <div className=\"mt-2 space-y-1 text-xs\">\n                              <div className=\"flex items-center gap-2\">\n                                <CheckCircle2 className=\"h-3 w-3 text-green-500\" />\n                                <span>{t('apiDocs.security.features.antiDebugger.realtime.console')}</span>\n                              </div>\n                              <div className=\"flex items-center gap-2\">\n                                <CheckCircle2 className=\"h-3 w-3 text-green-500\" />\n                                <span>{t('apiDocs.security.features.antiDebugger.realtime.warning')}</span>\n                              </div>\n                              <div className=\"flex items-center gap-2\">\n                                <CheckCircle2 className=\"h-3 w-3 text-green-500\" />\n                                <span>{t('apiDocs.security.features.antiDebugger.realtime.animation')}</span>\n                              </div>\n                            </div>\n                          </div>\n\n                          <div className=\"bg-muted p-4 rounded-lg space-y-2\">\n                            <div className=\"flex items-center gap-2\">\n                              <Lock className=\"h-4 w-4 text-destructive\" />\n                              <h4 className=\"font-medium text-sm\">{t('apiDocs.security.features.antiDebugger.integrity.title')}</h4>\n                            </div>\n                            <p className=\"text-xs text-muted-foreground\">\n                              {t('apiDocs.security.features.antiDebugger.integrity.description')}\n                            </p>\n                            <div className=\"mt-2 space-y-1 text-xs\">\n                              <div className=\"flex items-center gap-2\">\n                                <CheckCircle2 className=\"h-3 w-3 text-green-500\" />\n                                <span>{t('apiDocs.security.features.antiDebugger.integrity.validation')}</span>\n                              </div>\n                              <div className=\"flex items-center gap-2\">\n                                <CheckCircle2 className=\"h-3 w-3 text-green-500\" />\n                                <span>{t('apiDocs.security.features.antiDebugger.integrity.timing')}</span>\n                              </div>\n                              <div className=\"flex items-center gap-2\">\n                                <CheckCircle2 className=\"h-3 w-3 text-green-500\" />\n                                <span>{t('apiDocs.security.features.antiDebugger.integrity.script')}</span>\n                              </div>\n                            </div>\n                          </div>\n                        </div>\n\n                        <Alert className=\"bg-destructive/10 border-destructive/20\">\n                          <AlertTriangle className=\"h-4 w-4 text-destructive\" />\n                          <AlertTitle>{t('apiDocs.security.features.antiDebugger.alert.title')}</AlertTitle>\n                          <AlertDescription className=\"text-xs sm:text-sm\">\n                            {t('apiDocs.security.features.antiDebugger.alert.description')}\n                          </AlertDescription>\n                        </Alert>\n                      </AccordionContent>\n                    </AccordionItem>\n                  </Accordion>\n                </TabsContent>\n\n                <TabsContent value=\"scenarios\" className=\"space-y-4\">\n                  <Alert data-testid=\"alert-scenarios-info\">\n                    <Shield className=\"h-4 w-4\" />\n                    <AlertTitle>{t('apiDocs.security.threatModel.title')}</AlertTitle>\n                    <AlertDescription>\n                      {t('apiDocs.security.threatModel.description')}\n                    </AlertDescription>\n                  </Alert>\n\n                  <div className=\"overflow-x-auto\">\n                    <table className=\"w-full text-sm\" data-testid=\"table-threat-scenarios\">\n                      <thead>\n                        <tr className=\"border-b\">\n                          <th className=\"text-left p-3 font-medium\">{t('apiDocs.security.threatModel.table.scenario')}</th>\n                          <th className=\"text-left p-3 font-medium\">{t('apiDocs.security.threatModel.table.method')}</th>\n                          <th className=\"text-left p-3 font-medium\">{t('apiDocs.security.threatModel.table.protection')}</th>\n                          <th className=\"text-left p-3 font-medium\">{t('apiDocs.security.threatModel.table.result')}</th>\n                        </tr>\n                      </thead>\n                      <tbody>\n                        <tr className=\"border-b\" data-testid=\"row-token-replay\">\n                          <td className=\"p-3\">\n                            <div className=\"flex items-center gap-2\">\n                              <XCircle className=\"h-4 w-4 text-destructive flex-shrink-0\" />\n                              <strong>{t('apiDocs.security.threatModel.attacks.tokenReplay.title')}</strong>\n                            </div>\n                          </td>\n                          <td className=\"p-3 text-muted-foreground\">\n                            {t('apiDocs.security.threatModel.attacks.tokenReplay.description')}\n                          </td>\n                          <td className=\"p-3\">\n                            <div className=\"flex flex-wrap gap-1\">\n                              {t('apiDocs.security.threatModel.attacks.tokenReplay.mitigations').split(',').map((m: string, i: number) => (\n                                <Badge key={i} variant=\"secondary\">{m.trim()}</Badge>\n                              ))}\n                            </div>\n                          </td>\n                          <td className=\"p-3\">\n                            <Badge className=\"bg-green-500\">{t('apiDocs.security.threatModel.attacks.tokenReplay.status')}</Badge>\n                          </td>\n                        </tr>\n\n                        <tr className=\"border-b\" data-testid=\"row-cross-domain\">\n                          <td className=\"p-3\">\n                            <div className=\"flex items-center gap-2\">\n                              <XCircle className=\"h-4 w-4 text-destructive flex-shrink-0\" />\n                              <strong>{t('apiDocs.security.threatModel.attacks.crossDomain.title')}</strong>\n                            </div>\n                          </td>\n                          <td className=\"p-3 text-muted-foreground\">\n                            {t('apiDocs.security.threatModel.attacks.crossDomain.description')}\n                          </td>\n                          <td className=\"p-3\">\n                            <div className=\"flex flex-wrap gap-1\">\n                              {t('apiDocs.security.threatModel.attacks.crossDomain.mitigations').split(',').map((m: string, i: number) => (\n                                <Badge key={i} variant=\"secondary\">{m.trim()}</Badge>\n                              ))}\n                            </div>\n                          </td>\n                          <td className=\"p-3\">\n                            <Badge className=\"bg-green-500\">{t('apiDocs.security.threatModel.attacks.crossDomain.status')}</Badge>\n                          </td>\n                        </tr>\n\n                        <tr className=\"border-b\" data-testid=\"row-automation\">\n                          <td className=\"p-3\">\n                            <div className=\"flex items-center gap-2\">\n                              <XCircle className=\"h-4 w-4 text-destructive flex-shrink-0\" />\n                              <strong>{t('apiDocs.security.threatModel.attacks.botFarm.title')}</strong>\n                            </div>\n                          </td>\n                          <td className=\"p-3 text-muted-foreground\">\n                            {t('apiDocs.security.threatModel.attacks.botFarm.description')}\n                          </td>\n                          <td className=\"p-3\">\n                            <div className=\"flex flex-wrap gap-1\">\n                              {t('apiDocs.security.threatModel.attacks.botFarm.mitigations').split(',').map((m: string, i: number) => (\n                                <Badge key={i} variant=\"secondary\">{m.trim()}</Badge>\n                              ))}\n                            </div>\n                          </td>\n                          <td className=\"p-3\">\n                            <Badge className=\"bg-yellow-500\">{t('apiDocs.security.threatModel.attacks.botFarm.status')}</Badge>\n                          </td>\n                        </tr>\n\n                        <tr className=\"border-b\" data-testid=\"row-tampering\">\n                          <td className=\"p-3\">\n                            <div className=\"flex items-center gap-2\">\n                              <XCircle className=\"h-4 w-4 text-destructive flex-shrink-0\" />\n                              <strong>{t('apiDocs.security.threatModel.attacks.tampering.title')}</strong>\n                            </div>\n                          </td>\n                          <td className=\"p-3 text-muted-foreground\">\n                            {t('apiDocs.security.threatModel.attacks.tampering.description')}\n                          </td>\n                          <td className=\"p-3\">\n                            <div className=\"flex flex-wrap gap-1\">\n                              {t('apiDocs.security.threatModel.attacks.tampering.mitigations').split(',').map((m: string, i: number) => (\n                                <Badge key={i} variant=\"secondary\">{m.trim()}</Badge>\n                              ))}\n                            </div>\n                          </td>\n                          <td className=\"p-3\">\n                            <Badge className=\"bg-green-500\">{t('apiDocs.security.threatModel.attacks.tampering.status')}</Badge>\n                          </td>\n                        </tr>\n\n                        <tr className=\"border-b\" data-testid=\"row-ddos\">\n                          <td className=\"p-3\">\n                            <div className=\"flex items-center gap-2\">\n                              <XCircle className=\"h-4 w-4 text-destructive flex-shrink-0\" />\n                              <strong>{t('apiDocs.security.threatModel.attacks.ddos.title')}</strong>\n                            </div>\n                          </td>\n                          <td className=\"p-3 text-muted-foreground\">\n                            {t('apiDocs.security.threatModel.attacks.ddos.description')}\n                          </td>\n                          <td className=\"p-3\">\n                            <div className=\"flex flex-wrap gap-1\">\n                              {t('apiDocs.security.threatModel.attacks.ddos.mitigations').split(',').map((m: string, i: number) => (\n                                <Badge key={i} variant=\"secondary\">{m.trim()}</Badge>\n                              ))}\n                            </div>\n                          </td>\n                          <td className=\"p-3\">\n                            <Badge className=\"bg-green-500\">{t('apiDocs.security.threatModel.attacks.ddos.status')}</Badge>\n                          </td>\n                        </tr>\n\n                        <tr className=\"border-b\" data-testid=\"row-csrf\">\n                          <td className=\"p-3\">\n                            <div className=\"flex items-center gap-2\">\n                              <XCircle className=\"h-4 w-4 text-destructive flex-shrink-0\" />\n                              <strong>{t('apiDocs.security.threatModel.attacks.csrf.title')}</strong>\n                            </div>\n                          </td>\n                          <td className=\"p-3 text-muted-foreground\">\n                            {t('apiDocs.security.threatModel.attacks.csrf.description')}\n                          </td>\n                          <td className=\"p-3\">\n                            <div className=\"flex flex-wrap gap-1\">\n                              {t('apiDocs.security.threatModel.attacks.csrf.mitigations').split(',').map((m: string, i: number) => (\n                                <Badge key={i} variant=\"secondary\">{m.trim()}</Badge>\n                              ))}\n                            </div>\n                          </td>\n                          <td className=\"p-3\">\n                            <Badge className=\"bg-green-500\">{t('apiDocs.security.threatModel.attacks.csrf.status')}</Badge>\n                          </td>\n                        </tr>\n\n                        <tr className=\"border-b\" data-testid=\"row-session-hijack\">\n                          <td className=\"p-3\">\n                            <div className=\"flex items-center gap-2\">\n                              <XCircle className=\"h-4 w-4 text-destructive flex-shrink-0\" />\n                              <strong>{t('apiDocs.security.threatModel.attacks.sessionHijack.title')}</strong>\n                            </div>\n                          </td>\n                          <td className=\"p-3 text-muted-foreground\">\n                            {t('apiDocs.security.threatModel.attacks.sessionHijack.description')}\n                          </td>\n                          <td className=\"p-3\">\n                            <div className=\"flex flex-wrap gap-1\">\n                              {t('apiDocs.security.threatModel.attacks.sessionHijack.mitigations').split(',').map((m: string, i: number) => (\n                                <Badge key={i} variant=\"secondary\">{m.trim()}</Badge>\n                              ))}\n                            </div>\n                          </td>\n                          <td className=\"p-3\">\n                            <Badge className=\"bg-green-500\">{t('apiDocs.security.threatModel.attacks.sessionHijack.status')}</Badge>\n                          </td>\n                        </tr>\n\n                        <tr data-testid=\"row-solver-farms\">\n                          <td className=\"p-3\">\n                            <div className=\"flex items-center gap-2\">\n                              <XCircle className=\"h-4 w-4 text-destructive flex-shrink-0\" />\n                              <strong>{t('apiDocs.security.threatModel.attacks.solverFarms.title')}</strong>\n                            </div>\n                          </td>\n                          <td className=\"p-3 text-muted-foreground\">\n                            {t('apiDocs.security.threatModel.attacks.solverFarms.description')}\n                          </td>\n                          <td className=\"p-3\">\n                            <div className=\"flex flex-wrap gap-1\">\n                              {t('apiDocs.security.threatModel.attacks.solverFarms.mitigations').split(',').map((m: string, i: number) => (\n                                <Badge key={i} variant=\"secondary\">{m.trim()}</Badge>\n                              ))}\n                            </div>\n                          </td>\n                          <td className=\"p-3\">\n                            <Badge className=\"bg-yellow-500\">{t('apiDocs.security.threatModel.attacks.solverFarms.status')}</Badge>\n                          </td>\n                        </tr>\n                      </tbody>\n                    </table>\n                  </div>\n\n                  <Alert className=\"mt-4\" data-testid=\"alert-defense-summary\">\n                    <CheckCircle2 className=\"h-4 w-4 text-green-500\" />\n                    <AlertTitle>{t('apiDocs.security.threatModel.defenseAlert.title')}</AlertTitle>\n                    <AlertDescription>\n                      {t('apiDocs.security.threatModel.defenseAlert.description')}\n                    </AlertDescription>\n                  </Alert>\n                </TabsContent>\n              </Tabs>\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        {/* Best Practices Tab */}\n        <TabsContent value=\"best-practices\" className=\"space-y-4\">\n          <Card>\n            <CardHeader>\n              <div className=\"flex items-center gap-2\">\n                <CheckCircle2 className=\"h-5 w-5 text-primary\" />\n                <CardTitle>{t('apiDocs.bestPractices.title')}</CardTitle>\n              </div>\n              <CardDescription>\n                {t('apiDocs.bestPractices.description')}\n              </CardDescription>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <div className=\"grid gap-3\">\n                <div className=\"flex items-start gap-3 p-3 bg-muted rounded-lg\">\n                  <div className=\"bg-primary text-primary-foreground rounded-full w-6 h-6 flex items-center justify-center flex-shrink-0 text-sm font-bold\">\n                    {t('apiDocs.bestPractices.practices.practice1.number')}\n                  </div>\n                  <div>\n                    <h4 className=\"font-medium text-sm\">{t('apiDocs.bestPractices.practices.practice1.title')}</h4>\n                    <p className=\"text-xs text-muted-foreground mt-1\">\n                      {t('apiDocs.bestPractices.practices.practice1.description')}\n                    </p>\n                  </div>\n                </div>\n\n                <div className=\"flex items-start gap-3 p-3 bg-muted rounded-lg\">\n                  <div className=\"bg-primary text-primary-foreground rounded-full w-6 h-6 flex items-center justify-center flex-shrink-0 text-sm font-bold\">\n                    {t('apiDocs.bestPractices.practices.practice2.number')}\n                  </div>\n                  <div>\n                    <h4 className=\"font-medium text-sm\">{t('apiDocs.bestPractices.practices.practice2.title')}</h4>\n                    <p className=\"text-xs text-muted-foreground mt-1\">\n                      {t('apiDocs.bestPractices.practices.practice2.description')}\n                    </p>\n                  </div>\n                </div>\n\n                <div className=\"flex items-start gap-3 p-3 bg-muted rounded-lg\">\n                  <div className=\"bg-primary text-primary-foreground rounded-full w-6 h-6 flex items-center justify-center flex-shrink-0 text-sm font-bold\">\n                    {t('apiDocs.bestPractices.practices.practice3.number')}\n                  </div>\n                  <div>\n                    <h4 className=\"font-medium text-sm\">{t('apiDocs.bestPractices.practices.practice3.title')}</h4>\n                    <p className=\"text-xs text-muted-foreground mt-1\">\n                      {t('apiDocs.bestPractices.practices.practice3.description')}\n                    </p>\n                  </div>\n                </div>\n\n                <div className=\"flex items-start gap-3 p-3 bg-muted rounded-lg\">\n                  <div className=\"bg-primary text-primary-foreground rounded-full w-6 h-6 flex items-center justify-center flex-shrink-0 text-sm font-bold\">\n                    {t('apiDocs.bestPractices.practices.practice4.number')}\n                  </div>\n                  <div>\n                    <h4 className=\"font-medium text-sm\">{t('apiDocs.bestPractices.practices.practice4.title')}</h4>\n                    <p className=\"text-xs text-muted-foreground mt-1\">\n                      {t('apiDocs.bestPractices.practices.practice4.description')}\n                    </p>\n                  </div>\n                </div>\n\n                <div className=\"flex items-start gap-3 p-3 bg-muted rounded-lg\">\n                  <div className=\"bg-primary text-primary-foreground rounded-full w-6 h-6 flex items-center justify-center flex-shrink-0 text-sm font-bold\">\n                    {t('apiDocs.bestPractices.practices.practice5.number')}\n                  </div>\n                  <div>\n                    <h4 className=\"font-medium text-sm\">{t('apiDocs.bestPractices.practices.practice5.title')}</h4>\n                    <p className=\"text-xs text-muted-foreground mt-1\">\n                      {t('apiDocs.bestPractices.practices.practice5.description')}\n                    </p>\n                  </div>\n                </div>\n\n                <div className=\"flex items-start gap-3 p-3 bg-muted rounded-lg\">\n                  <div className=\"bg-primary text-primary-foreground rounded-full w-6 h-6 flex items-center justify-center flex-shrink-0 text-sm font-bold\">\n                    {t('apiDocs.bestPractices.practices.practice6.number')}\n                  </div>\n                  <div>\n                    <h4 className=\"font-medium text-sm\">{t('apiDocs.bestPractices.practices.practice6.title')}</h4>\n                    <p className=\"text-xs text-muted-foreground mt-1\">\n                      {t('apiDocs.bestPractices.practices.practice6.description')}\n                    </p>\n                  </div>\n                </div>\n\n                <div className=\"flex items-start gap-3 p-3 bg-muted rounded-lg\">\n                  <div className=\"bg-primary text-primary-foreground rounded-full w-6 h-6 flex items-center justify-center flex-shrink-0 text-sm font-bold\">\n                    {t('apiDocs.bestPractices.practices.practice7.number')}\n                  </div>\n                  <div>\n                    <h4 className=\"font-medium text-sm\">{t('apiDocs.bestPractices.practices.practice7.title')}</h4>\n                    <p className=\"text-xs text-muted-foreground mt-1\">\n                      {t('apiDocs.bestPractices.practices.practice7.description')}\n                    </p>\n                  </div>\n                </div>\n\n                <div className=\"flex items-start gap-3 p-3 bg-muted rounded-lg\">\n                  <div className=\"bg-primary text-primary-foreground rounded-full w-6 h-6 flex items-center justify-center flex-shrink-0 text-sm font-bold\">\n                    {t('apiDocs.bestPractices.practices.practice8.number')}\n                  </div>\n                  <div>\n                    <h4 className=\"font-medium text-sm\">{t('apiDocs.bestPractices.practices.practice8.title')}</h4>\n                    <p className=\"text-xs text-muted-foreground mt-1\">\n                      {t('apiDocs.bestPractices.practices.practice8.description')}\n                    </p>\n                  </div>\n                </div>\n              </div>\n\n              <Alert data-testid=\"alert-security-contact\">\n                <Shield className=\"h-4 w-4\" />\n                <AlertTitle>{t('apiDocs.bestPractices.monitoringAlert.title')}</AlertTitle>\n                <AlertDescription>\n                  {t('apiDocs.bestPractices.monitoringAlert.description')}\n                </AlertDescription>\n              </Alert>\n            </CardContent>\n          </Card>\n        </TabsContent>\n      </Tabs>\n      </motion.div>\n      </div>\n    </div>\n  );\n}\n","size_bytes":66762},"client/src/components/ui/radio-group.tsx":{"content":"import * as React from \"react\"\nimport * as RadioGroupPrimitive from \"@radix-ui/react-radio-group\"\nimport { Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst RadioGroup = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Root\n      className={cn(\"grid gap-2\", className)}\n      {...props}\n      ref={ref}\n    />\n  )\n})\nRadioGroup.displayName = RadioGroupPrimitive.Root.displayName\n\nconst RadioGroupItem = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Item>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        \"aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    >\n      <RadioGroupPrimitive.Indicator className=\"flex items-center justify-center\">\n        <Circle className=\"h-2.5 w-2.5 fill-current text-current\" />\n      </RadioGroupPrimitive.Indicator>\n    </RadioGroupPrimitive.Item>\n  )\n})\nRadioGroupItem.displayName = RadioGroupPrimitive.Item.displayName\n\nexport { RadioGroup, RadioGroupItem }\n","size_bytes":1467},"client/src/components/ui/carousel.tsx":{"content":"import * as React from \"react\"\nimport useEmblaCarousel, {\n  type UseEmblaCarouselType,\n} from \"embla-carousel-react\"\nimport { ArrowLeft, ArrowRight } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\n\ntype CarouselApi = UseEmblaCarouselType[1]\ntype UseCarouselParameters = Parameters<typeof useEmblaCarousel>\ntype CarouselOptions = UseCarouselParameters[0]\ntype CarouselPlugin = UseCarouselParameters[1]\n\ntype CarouselProps = {\n  opts?: CarouselOptions\n  plugins?: CarouselPlugin\n  orientation?: \"horizontal\" | \"vertical\"\n  setApi?: (api: CarouselApi) => void\n}\n\ntype CarouselContextProps = {\n  carouselRef: ReturnType<typeof useEmblaCarousel>[0]\n  api: ReturnType<typeof useEmblaCarousel>[1]\n  scrollPrev: () => void\n  scrollNext: () => void\n  canScrollPrev: boolean\n  canScrollNext: boolean\n} & CarouselProps\n\nconst CarouselContext = React.createContext<CarouselContextProps | null>(null)\n\nfunction useCarousel() {\n  const context = React.useContext(CarouselContext)\n\n  if (!context) {\n    throw new Error(\"useCarousel must be used within a <Carousel />\")\n  }\n\n  return context\n}\n\nconst Carousel = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & CarouselProps\n>(\n  (\n    {\n      orientation = \"horizontal\",\n      opts,\n      setApi,\n      plugins,\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const [carouselRef, api] = useEmblaCarousel(\n      {\n        ...opts,\n        axis: orientation === \"horizontal\" ? \"x\" : \"y\",\n      },\n      plugins\n    )\n    const [canScrollPrev, setCanScrollPrev] = React.useState(false)\n    const [canScrollNext, setCanScrollNext] = React.useState(false)\n\n    const onSelect = React.useCallback((api: CarouselApi) => {\n      if (!api) {\n        return\n      }\n\n      setCanScrollPrev(api.canScrollPrev())\n      setCanScrollNext(api.canScrollNext())\n    }, [])\n\n    const scrollPrev = React.useCallback(() => {\n      api?.scrollPrev()\n    }, [api])\n\n    const scrollNext = React.useCallback(() => {\n      api?.scrollNext()\n    }, [api])\n\n    const handleKeyDown = React.useCallback(\n      (event: React.KeyboardEvent<HTMLDivElement>) => {\n        if (event.key === \"ArrowLeft\") {\n          event.preventDefault()\n          scrollPrev()\n        } else if (event.key === \"ArrowRight\") {\n          event.preventDefault()\n          scrollNext()\n        }\n      },\n      [scrollPrev, scrollNext]\n    )\n\n    React.useEffect(() => {\n      if (!api || !setApi) {\n        return\n      }\n\n      setApi(api)\n    }, [api, setApi])\n\n    React.useEffect(() => {\n      if (!api) {\n        return\n      }\n\n      onSelect(api)\n      api.on(\"reInit\", onSelect)\n      api.on(\"select\", onSelect)\n\n      return () => {\n        api?.off(\"select\", onSelect)\n      }\n    }, [api, onSelect])\n\n    return (\n      <CarouselContext.Provider\n        value={{\n          carouselRef,\n          api: api,\n          opts,\n          orientation:\n            orientation || (opts?.axis === \"y\" ? \"vertical\" : \"horizontal\"),\n          scrollPrev,\n          scrollNext,\n          canScrollPrev,\n          canScrollNext,\n        }}\n      >\n        <div\n          ref={ref}\n          onKeyDownCapture={handleKeyDown}\n          className={cn(\"relative\", className)}\n          role=\"region\"\n          aria-roledescription=\"carousel\"\n          {...props}\n        >\n          {children}\n        </div>\n      </CarouselContext.Provider>\n    )\n  }\n)\nCarousel.displayName = \"Carousel\"\n\nconst CarouselContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { carouselRef, orientation } = useCarousel()\n\n  return (\n    <div ref={carouselRef} className=\"overflow-hidden\">\n      <div\n        ref={ref}\n        className={cn(\n          \"flex\",\n          orientation === \"horizontal\" ? \"-ml-4\" : \"-mt-4 flex-col\",\n          className\n        )}\n        {...props}\n      />\n    </div>\n  )\n})\nCarouselContent.displayName = \"CarouselContent\"\n\nconst CarouselItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { orientation } = useCarousel()\n\n  return (\n    <div\n      ref={ref}\n      role=\"group\"\n      aria-roledescription=\"slide\"\n      className={cn(\n        \"min-w-0 shrink-0 grow-0 basis-full\",\n        orientation === \"horizontal\" ? \"pl-4\" : \"pt-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nCarouselItem.displayName = \"CarouselItem\"\n\nconst CarouselPrevious = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollPrev, canScrollPrev } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute  h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-left-12 top-1/2 -translate-y-1/2\"\n          : \"-top-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollPrev}\n      onClick={scrollPrev}\n      {...props}\n    >\n      <ArrowLeft className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Previous slide</span>\n    </Button>\n  )\n})\nCarouselPrevious.displayName = \"CarouselPrevious\"\n\nconst CarouselNext = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollNext, canScrollNext } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-right-12 top-1/2 -translate-y-1/2\"\n          : \"-bottom-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollNext}\n      onClick={scrollNext}\n      {...props}\n    >\n      <ArrowRight className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Next slide</span>\n    </Button>\n  )\n})\nCarouselNext.displayName = \"CarouselNext\"\n\nexport {\n  type CarouselApi,\n  Carousel,\n  CarouselContent,\n  CarouselItem,\n  CarouselPrevious,\n  CarouselNext,\n}\n","size_bytes":6210},"client/src/pages/RegisterPage.tsx":{"content":"import { useState, useEffect, useRef } from \"react\";\nimport { useAuth } from \"@/hooks/use-auth\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Card, CardContent, CardDescription, CardFooter, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Label } from \"@/components/ui/label\";\nimport { Shield, ArrowRight } from \"lucide-react\";\nimport { Link } from \"wouter\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useTranslation } from \"react-i18next\";\nimport LanguageToggle from \"@/components/LanguageToggle\";\nimport ThemeToggle from \"@/components/ThemeToggle\";\n\nconst DEMO_PUBLIC_KEY = \"pk_ab6c4ac2c8976668e6d92fe401386cae18df4c9b4f5193cb140266f6d9546f1c\";\n\n// Declare global ProofCaptcha API\ndeclare global {\n  interface Window {\n    ProofCaptcha: {\n      render: (container: string | HTMLElement, params: any) => number;\n      getResponse: (widgetId?: number) => string | null;\n      reset: (widgetId?: number) => void;\n      ready: (callback: () => void) => void;\n    };\n    onCaptchaSuccessRegister?: (token: string) => void;\n    onCaptchaErrorRegister?: (error: string) => void;\n  }\n}\n\nexport default function RegisterPage() {\n  const [name, setName] = useState(\"\");\n  const [email, setEmail] = useState(\"\");\n  const [password, setPassword] = useState(\"\");\n  const [confirmPassword, setConfirmPassword] = useState(\"\");\n  const [isLoading, setIsLoading] = useState(false);\n  const [captchaToken, setCaptchaToken] = useState<string>(\"\");\n  const [widgetId, setWidgetId] = useState<number | null>(null);\n  const captchaContainerRef = useRef<HTMLDivElement>(null);\n  const { register } = useAuth();\n  const { toast } = useToast();\n  const { t } = useTranslation();\n\n  useEffect(() => {\n    // Load api.js script\n    const script = document.createElement('script');\n    script.src = '/proofCaptcha/api.js';\n    script.async = true;\n    script.onload = () => {\n      // Define global callback functions\n      window.onCaptchaSuccessRegister = (token: string) => {\n        console.log('[CAPTCHA] Success callback received:', token);\n        setCaptchaToken(token);\n      };\n\n      window.onCaptchaErrorRegister = (error: string) => {\n        console.log('[CAPTCHA] Error callback received:', error);\n        setCaptchaToken(\"\");\n        toast({\n          title: t('auth.captchaError'),\n          description: error,\n          variant: \"destructive\",\n        });\n      };\n\n      // Render captcha widget using ProofCaptcha API\n      if (window.ProofCaptcha && captchaContainerRef.current) {\n        const id = window.ProofCaptcha.render(captchaContainerRef.current, {\n          sitekey: DEMO_PUBLIC_KEY,\n          type: 'random',\n          callback: 'onCaptchaSuccessRegister',\n          'error-callback': 'onCaptchaErrorRegister',\n          theme: 'auto'\n        });\n        setWidgetId(id);\n        console.log('[CAPTCHA] Widget rendered with ID:', id);\n      }\n    };\n    document.head.appendChild(script);\n\n    return () => {\n      // Cleanup\n      if (script.parentNode) {\n        script.parentNode.removeChild(script);\n      }\n      delete window.onCaptchaSuccessRegister;\n      delete window.onCaptchaErrorRegister;\n    };\n  }, [toast]);\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n\n    if (password !== confirmPassword) {\n      toast({\n        title: t('auth.passwordsDontMatch'),\n        description: t('auth.passwordsDontMatchDesc'),\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    if (password.length < 8) {\n      toast({\n        title: t('auth.passwordTooShort'),\n        description: t('auth.passwordTooShortDesc'),\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    if (!captchaToken) {\n      toast({\n        title: t('auth.captchaRequired'),\n        description: t('auth.completeCaptcha'),\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    setIsLoading(true);\n\n    try {\n      await register(name, email, password, captchaToken);\n      setCaptchaToken(\"\");\n      // Reset captcha widget\n      if (window.ProofCaptcha && widgetId !== null) {\n        window.ProofCaptcha.reset(widgetId);\n      }\n    } catch (error: any) {\n      toast({\n        title: \"Pendaftaran Gagal\",\n        description: error.message || \"Gagal membuat akun\",\n        variant: \"destructive\",\n      });\n      setCaptchaToken(\"\");\n      // Reset captcha widget\n      if (window.ProofCaptcha && widgetId !== null) {\n        window.ProofCaptcha.reset(widgetId);\n      }\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen relative overflow-hidden\" data-testid=\"page-register\">\n      {/* Animated gradient background */}\n      <div className=\"absolute inset-0 -z-10\">\n        <div className=\"absolute top-0 -left-4 w-96 h-96 bg-primary/30 rounded-full mix-blend-multiply filter blur-3xl opacity-70 animate-blob\" />\n        <div className=\"absolute top-0 -right-4 w-96 h-96 bg-purple-300/30 rounded-full mix-blend-multiply filter blur-3xl opacity-70 animate-blob animation-delay-2000\" />\n        <div className=\"absolute -bottom-8 left-20 w-96 h-96 bg-blue-300/30 rounded-full mix-blend-multiply filter blur-3xl opacity-70 animate-blob animation-delay-4000\" />\n      </div>\n\n      {/* Header with glassmorphism */}\n      <header className=\"sticky top-0 z-50 backdrop-blur-md bg-background/80 border-b border-border/50\">\n        <div className=\"container mx-auto px-4 py-4 flex items-center justify-between\">\n          <Link href=\"/\">\n            <div className=\"flex items-center gap-3 group hover-elevate active-elevate-2\">\n              <div className=\"relative\">\n                <Shield className=\"h-7 w-7 text-primary transition-all duration-300 group-hover:scale-110 group-hover:rotate-12\" />\n                <div className=\"absolute inset-0 bg-primary/20 rounded-full blur-md group-hover:blur-lg transition-all\" />\n              </div>\n              <span className=\"font-bold text-xl bg-gradient-to-r from-primary to-purple-600 bg-clip-text text-transparent\">\n                ProofCaptcha\n              </span>\n            </div>\n          </Link>\n          <div className=\"flex items-center gap-2\">\n            <LanguageToggle />\n            <ThemeToggle />\n          </div>\n        </div>\n      </header>\n\n      <div className=\"flex items-center justify-center p-4 py-8 sm:py-12\">\n        <Card className=\"w-full max-w-md border-2 shadow-2xl relative overflow-hidden\">\n          {/* Card gradient overlay */}\n          <div className=\"absolute inset-0 bg-gradient-to-br from-primary/5 via-purple-500/5 to-blue-500/5 pointer-events-none\" />\n          \n          <CardHeader className=\"space-y-4 relative\">\n            {/* Floating 3D icon */}\n            <div className=\"flex justify-center\">\n              <div className=\"relative transform-gpu hover:scale-110 transition-all duration-500 floating\">\n                <div className=\"absolute inset-0 bg-gradient-to-br from-primary/50 to-purple-500/50 rounded-2xl blur-xl opacity-60 animate-pulse-slow\" />\n                <div className=\"relative bg-gradient-to-br from-primary to-purple-600 p-5 rounded-2xl shadow-xl transform rotate-3 hover:rotate-0 transition-all duration-500\">\n                  <Shield className=\"h-10 w-10 text-white drop-shadow-lg\" />\n                </div>\n              </div>\n            </div>\n            \n            <div className=\"space-y-2\">\n              <CardTitle className=\"text-3xl text-center font-bold bg-gradient-to-r from-foreground to-muted-foreground bg-clip-text text-transparent\" data-testid=\"text-register-title\">\n                {t('auth.registerTitle')}\n              </CardTitle>\n              <CardDescription className=\"text-center text-base\">\n                {t('auth.registerSubtitle')}\n              </CardDescription>\n            </div>\n          </CardHeader>\n          \n          <form onSubmit={handleSubmit}>\n            <CardContent className=\"space-y-4 relative\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"name\" className=\"text-sm font-medium\">{t('common.name')}</Label>\n                <Input\n                  id=\"name\"\n                  type=\"text\"\n                  placeholder={t('auth.namePlaceholder')}\n                  value={name}\n                  onChange={(e) => setName(e.target.value)}\n                  required\n                  className=\"h-11 rounded-lg border-2 focus:border-primary transition-colors\"\n                  data-testid=\"input-name\"\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"email\" className=\"text-sm font-medium\">{t('common.email')}</Label>\n                <Input\n                  id=\"email\"\n                  type=\"email\"\n                  placeholder={t('auth.emailPlaceholder')}\n                  value={email}\n                  onChange={(e) => setEmail(e.target.value)}\n                  required\n                  className=\"h-11 rounded-lg border-2 focus:border-primary transition-colors\"\n                  data-testid=\"input-email\"\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"password\" className=\"text-sm font-medium\">{t('common.password')}</Label>\n                <Input\n                  id=\"password\"\n                  type=\"password\"\n                  placeholder={t('auth.passwordPlaceholder')}\n                  value={password}\n                  onChange={(e) => setPassword(e.target.value)}\n                  required\n                  className=\"h-11 rounded-lg border-2 focus:border-primary transition-colors\"\n                  data-testid=\"input-password\"\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"confirmPassword\" className=\"text-sm font-medium\">{t('common.password')}</Label>\n                <Input\n                  id=\"confirmPassword\"\n                  type=\"password\"\n                  placeholder={t('auth.passwordPlaceholder')}\n                  value={confirmPassword}\n                  onChange={(e) => setConfirmPassword(e.target.value)}\n                  required\n                  className=\"h-11 rounded-lg border-2 focus:border-primary transition-colors\"\n                  data-testid=\"input-confirm-password\"\n                />\n              </div>\n              <div ref={captchaContainerRef} data-testid=\"captcha-container\"></div>\n            </CardContent>\n            \n            <CardFooter className=\"flex flex-col space-y-4 relative\">\n              <Button \n                type=\"submit\" \n                className=\"w-full h-11 rounded-xl shadow-lg hover:shadow-xl transition-all duration-300 text-base group\" \n                disabled={isLoading || !captchaToken} \n                data-testid=\"button-register\"\n              >\n                <span className=\"flex items-center gap-2\">\n                  {isLoading ? t('auth.verifyingCaptcha') : t('auth.registerButton')}\n                  {!isLoading && <ArrowRight className=\"w-4 h-4 group-hover:translate-x-1 transition-transform\" />}\n                </span>\n              </Button>\n              \n              <div className=\"text-sm text-center text-muted-foreground\">\n                {t('auth.hasAccount')}{\" \"}\n                <Link href=\"/login\" className=\"text-primary hover:underline font-medium transition-colors\" data-testid=\"link-login\">\n                  {t('auth.signInLink')}\n                </Link>\n              </div>\n            </CardFooter>\n          </form>\n        </Card>\n      </div>\n    </div>\n  );\n}\n","size_bytes":11609},"server/automation-detector.ts":{"content":"import type { Request } from \"express\";\n\nexport interface AutomationCheckResult {\n  isAutomation: boolean;\n  detectedBy: string[];\n  score: number;\n}\n\nexport function detectAutomation(req: Request): AutomationCheckResult {\n  const detectedBy: string[] = [];\n  let score = 0;\n\n  const userAgent = (req.headers[\"user-agent\"] || \"\").toLowerCase();\n  const headers = req.headers;\n\n  // Check for headless browsers\n  if (\n    userAgent.includes(\"headless\") ||\n    userAgent.includes(\"phantomjs\") ||\n    userAgent.includes(\"selenium\") ||\n    userAgent.includes(\"webdriver\") ||\n    userAgent.includes(\"chromedriver\") ||\n    userAgent.includes(\"geckodriver\")\n  ) {\n    detectedBy.push(\"headless-user-agent\");\n    score += 50;\n  }\n\n  // Check for automation frameworks\n  if (\n    userAgent.includes(\"puppeteer\") ||\n    userAgent.includes(\"playwright\") ||\n    userAgent.includes(\"cypress\") ||\n    userAgent.includes(\"nightwatch\")\n  ) {\n    detectedBy.push(\"automation-framework\");\n    score += 50;\n  }\n\n  // Check for suspicious headers (low confidence - just log)\n  if (headers[\"x-requested-with\"] === \"XMLHttpRequest\" && !headers[\"referer\"]) {\n    detectedBy.push(\"suspicious-ajax\");\n    score += 5; // Reduced from 10\n  }\n\n  // Check for missing common headers (low confidence - just log)\n  if (!headers[\"accept-language\"]) {\n    detectedBy.push(\"missing-accept-language\");\n    score += 5; // Reduced from 15\n  }\n\n  if (!headers[\"accept-encoding\"]) {\n    detectedBy.push(\"missing-accept-encoding\");\n    score += 5; // Reduced from 15\n  }\n\n  // Check for automation-specific headers\n  if (headers[\"chrome-lighthouse\"]) {\n    detectedBy.push(\"lighthouse\");\n    score += 30;\n  }\n\n  // Check for webdriver headers\n  const automationHeaders = [\n    \"x-devtools-emulate-network-conditions-client-id\",\n    \"sec-ch-ua-platform-version\",\n  ];\n\n  for (const header of automationHeaders) {\n    if (headers[header]) {\n      detectedBy.push(`automation-header-${header}`);\n      score += 20;\n    }\n  }\n\n  // Check for bot patterns in user agent\n  const botPatterns = [\n    \"bot\",\n    \"crawler\",\n    \"spider\",\n    \"scraper\",\n    \"curl\",\n    \"wget\",\n    \"python-requests\",\n    \"httpie\",\n    \"postman\",\n  ];\n\n  for (const pattern of botPatterns) {\n    if (userAgent.includes(pattern)) {\n      detectedBy.push(`bot-pattern-${pattern}`);\n      score += 40;\n    }\n  }\n\n  // Check for Chrome DevTools Protocol\n  if (headers[\"connection\"] === \"Upgrade\" && headers[\"upgrade\"] === \"websocket\") {\n    const origin = headers[\"origin\"] as string;\n    if (origin && origin.includes(\"devtools\")) {\n      detectedBy.push(\"devtools-websocket\");\n      score += 30;\n    }\n  }\n\n  return {\n    isAutomation: score >= 50, // Increased threshold from 40 to 50\n    detectedBy,\n    score,\n  };\n}\n\nexport function getClientDetectionScript(): string {\n  return `\n    (function() {\n      const detections = [];\n      \n      // Check for webdriver\n      if (navigator.webdriver) {\n        detections.push('webdriver');\n      }\n      \n      // Check for automation properties\n      if (window.navigator.plugins.length === 0) {\n        detections.push('no-plugins');\n      }\n      \n      // Check for headless Chrome\n      if (window.chrome && !window.chrome.runtime) {\n        detections.push('headless-chrome');\n      }\n      \n      // Check for automation flags\n      if (window.document.documentElement.getAttribute('webdriver')) {\n        detections.push('webdriver-attribute');\n      }\n      \n      // Check for missing window properties\n      if (!window.localStorage || !window.sessionStorage) {\n        detections.push('missing-storage');\n      }\n      \n      // Check for permissions API\n      if (navigator.permissions && navigator.permissions.query) {\n        navigator.permissions.query({name: 'notifications'}).then(function(result) {\n          if (result.state === 'denied' && Notification.permission === 'default') {\n            detections.push('permission-mismatch');\n          }\n        });\n      }\n      \n      // Check for languages mismatch\n      if (navigator.languages && navigator.languages.length === 0) {\n        detections.push('no-languages');\n      }\n      \n      // Check for automation variables\n      const automationVars = [\n        '__webdriver_evaluate',\n        '__selenium_evaluate',\n        '__webdriver_script_function',\n        '__webdriver_script_func',\n        '__webdriver_script_fn',\n        '__fxdriver_evaluate',\n        '__driver_unwrapped',\n        '__webdriver_unwrapped',\n        '__driver_evaluate',\n        '__selenium_unwrapped',\n        '__fxdriver_unwrapped',\n        '_Selenium_IDE_Recorder',\n        '_selenium',\n        'calledSelenium',\n        '_WEBDRIVER_ELEM_CACHE',\n        'ChromeDriverw',\n        'driver-evaluate',\n        'webdriver-evaluate',\n        'selenium-evaluate',\n        'webdriverCommand',\n        'webdriver-evaluate-response',\n        '__webdriverFunc',\n        '__webdriver_script_fn',\n        '__$webdriverAsyncExecutor',\n        'domAutomation',\n        'domAutomationController',\n        '__nightmare',\n        '_phantom',\n        'callPhantom',\n        '__phantomas'\n      ];\n      \n      for (const v of automationVars) {\n        if (window[v] || document[v]) {\n          detections.push('automation-var-' + v);\n        }\n      }\n      \n      return detections;\n    })();\n  `;\n}\n","size_bytes":5314},"client/src/components/ui/sidebar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, VariantProps } from \"class-variance-authority\"\nimport { PanelLeftIcon } from \"lucide-react\"\n\nimport { useIsMobile } from \"@/hooks/use-mobile\"\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport { Separator } from \"@/components/ui/separator\"\nimport {\n  Sheet,\n  SheetContent,\n  SheetDescription,\n  SheetHeader,\n  SheetTitle,\n} from \"@/components/ui/sheet\"\nimport { Skeleton } from \"@/components/ui/skeleton\"\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\"\n\nconst SIDEBAR_COOKIE_NAME = \"sidebar_state\"\nconst SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7\nconst SIDEBAR_WIDTH = \"16rem\"\nconst SIDEBAR_WIDTH_MOBILE = \"18rem\"\nconst SIDEBAR_WIDTH_ICON = \"3rem\"\nconst SIDEBAR_KEYBOARD_SHORTCUT = \"b\"\n\ntype SidebarContextProps = {\n  state: \"expanded\" | \"collapsed\"\n  open: boolean\n  setOpen: (open: boolean) => void\n  openMobile: boolean\n  setOpenMobile: (open: boolean) => void\n  isMobile: boolean\n  toggleSidebar: () => void\n}\n\nconst SidebarContext = React.createContext<SidebarContextProps | null>(null)\n\nfunction useSidebar() {\n  const context = React.useContext(SidebarContext)\n  if (!context) {\n    throw new Error(\"useSidebar must be used within a SidebarProvider.\")\n  }\n\n  return context\n}\n\nfunction SidebarProvider({\n  defaultOpen = true,\n  open: openProp,\n  onOpenChange: setOpenProp,\n  className,\n  style,\n  children,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  defaultOpen?: boolean\n  open?: boolean\n  onOpenChange?: (open: boolean) => void\n}) {\n  const isMobile = useIsMobile()\n  const [openMobile, setOpenMobile] = React.useState(false)\n\n  // This is the internal state of the sidebar.\n  // We use openProp and setOpenProp for control from outside the component.\n  const [_open, _setOpen] = React.useState(defaultOpen)\n  const open = openProp ?? _open\n  const setOpen = React.useCallback(\n    (value: boolean | ((value: boolean) => boolean)) => {\n      const openState = typeof value === \"function\" ? value(open) : value\n      if (setOpenProp) {\n        setOpenProp(openState)\n      } else {\n        _setOpen(openState)\n      }\n\n      // This sets the cookie to keep the sidebar state.\n      document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`\n    },\n    [setOpenProp, open]\n  )\n\n  // Helper to toggle the sidebar.\n  const toggleSidebar = React.useCallback(() => {\n    return isMobile ? setOpenMobile((open) => !open) : setOpen((open) => !open)\n  }, [isMobile, setOpen, setOpenMobile])\n\n  // Adds a keyboard shortcut to toggle the sidebar.\n  React.useEffect(() => {\n    const handleKeyDown = (event: KeyboardEvent) => {\n      if (\n        event.key === SIDEBAR_KEYBOARD_SHORTCUT &&\n        (event.metaKey || event.ctrlKey)\n      ) {\n        event.preventDefault()\n        toggleSidebar()\n      }\n    }\n\n    window.addEventListener(\"keydown\", handleKeyDown)\n    return () => window.removeEventListener(\"keydown\", handleKeyDown)\n  }, [toggleSidebar])\n\n  // We add a state so that we can do data-state=\"expanded\" or \"collapsed\".\n  // This makes it easier to style the sidebar with Tailwind classes.\n  const state = open ? \"expanded\" : \"collapsed\"\n\n  const contextValue = React.useMemo<SidebarContextProps>(\n    () => ({\n      state,\n      open,\n      setOpen,\n      isMobile,\n      openMobile,\n      setOpenMobile,\n      toggleSidebar,\n    }),\n    [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar]\n  )\n\n  return (\n    <SidebarContext.Provider value={contextValue}>\n      <TooltipProvider delayDuration={0}>\n        <div\n          data-slot=\"sidebar-wrapper\"\n          style={\n            {\n              \"--sidebar-width\": SIDEBAR_WIDTH,\n              \"--sidebar-width-icon\": SIDEBAR_WIDTH_ICON,\n              ...style,\n            } as React.CSSProperties\n          }\n          className={cn(\n            \"group/sidebar-wrapper has-data-[variant=inset]:bg-sidebar flex min-h-svh w-full\",\n            className\n          )}\n          {...props}\n        >\n          {children}\n        </div>\n      </TooltipProvider>\n    </SidebarContext.Provider>\n  )\n}\n\nfunction Sidebar({\n  side = \"left\",\n  variant = \"sidebar\",\n  collapsible = \"offcanvas\",\n  className,\n  children,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  side?: \"left\" | \"right\"\n  variant?: \"sidebar\" | \"floating\" | \"inset\"\n  collapsible?: \"offcanvas\" | \"icon\" | \"none\"\n}) {\n  const { isMobile, state, openMobile, setOpenMobile } = useSidebar()\n\n  if (collapsible === \"none\") {\n    return (\n      <div\n        data-slot=\"sidebar\"\n        className={cn(\n          \"bg-sidebar text-sidebar-foreground flex h-full w-[var(--sidebar-width)] flex-col\",\n          className\n        )}\n        {...props}\n      >\n        {children}\n      </div>\n    )\n  }\n\n  if (isMobile) {\n    return (\n      <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>\n        <SheetContent\n          data-sidebar=\"sidebar\"\n          data-slot=\"sidebar\"\n          data-mobile=\"true\"\n          className=\"bg-sidebar text-sidebar-foreground w-[var(--sidebar-width)] p-0 [&>button]:hidden\"\n          style={\n            {\n              \"--sidebar-width\": SIDEBAR_WIDTH_MOBILE,\n            } as React.CSSProperties\n          }\n          side={side}\n        >\n          <SheetHeader className=\"sr-only\">\n            <SheetTitle>Sidebar</SheetTitle>\n            <SheetDescription>Displays the mobile sidebar.</SheetDescription>\n          </SheetHeader>\n          <div className=\"flex h-full w-full flex-col\">{children}</div>\n        </SheetContent>\n      </Sheet>\n    )\n  }\n\n  return (\n    <div\n      className=\"group peer text-sidebar-foreground hidden md:block\"\n      data-state={state}\n      data-collapsible={state === \"collapsed\" ? collapsible : \"\"}\n      data-variant={variant}\n      data-side={side}\n      data-slot=\"sidebar\"\n    >\n      {/* This is what handles the sidebar gap on desktop */}\n      <div\n        data-slot=\"sidebar-gap\"\n        className={cn(\n          \"relative w-[var(--sidebar-width)] bg-transparent transition-[width] duration-200 ease-linear\",\n          \"group-data-[collapsible=offcanvas]:w-0\",\n          \"group-data-[side=right]:rotate-180\",\n          variant === \"floating\" || variant === \"inset\"\n            ? \"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+var(--spacing-4))]\"\n            : \"group-data-[collapsible=icon]:w-[var(--sidebar-width-icon)]\"\n        )}\n      />\n      <div\n        data-slot=\"sidebar-container\"\n        className={cn(\n          \"fixed inset-y-0 z-10 hidden h-svh w-[var(--sidebar-width)] transition-[left,right,width] duration-200 ease-linear md:flex\",\n          side === \"left\"\n            ? \"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]\"\n            : \"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]\",\n          // Adjust the padding for floating and inset variants.\n          variant === \"floating\" || variant === \"inset\"\n            ? \"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+var(--spacing-4)+2px)]\"\n            : \"group-data-[collapsible=icon]:w-[var(--sidebar-width-icon)] group-data-[side=left]:border-r group-data-[side=right]:border-l\",\n          className\n        )}\n        {...props}\n      >\n        <div\n          data-sidebar=\"sidebar\"\n          data-slot=\"sidebar-inner\"\n          className=\"bg-sidebar group-data-[variant=floating]:border-sidebar-border flex h-full w-full flex-col group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:shadow-sm\"\n        >\n          {children}\n        </div>\n      </div>\n    </div>\n  )\n}\n\nfunction SidebarTrigger({\n  className,\n  onClick,\n  ...props\n}: React.ComponentProps<typeof Button>) {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <Button\n      data-sidebar=\"trigger\"\n      data-slot=\"sidebar-trigger\"\n      variant=\"ghost\"\n      size=\"icon\"\n      className={cn(\"h-7 w-7\", className)}\n      onClick={(event) => {\n        onClick?.(event)\n        toggleSidebar()\n      }}\n      {...props}\n    >\n      <PanelLeftIcon />\n      <span className=\"sr-only\">Toggle Sidebar</span>\n    </Button>\n  )\n}\n\nfunction SidebarRail({ className, ...props }: React.ComponentProps<\"button\">) {\n  const { toggleSidebar } = useSidebar()\n\n  // Note: Tailwind v3.4 doesn't support \"in-\" selectors. So the rail won't work perfectly.\n  return (\n    <button\n      data-sidebar=\"rail\"\n      data-slot=\"sidebar-rail\"\n      aria-label=\"Toggle Sidebar\"\n      tabIndex={-1}\n      onClick={toggleSidebar}\n      title=\"Toggle Sidebar\"\n      className={cn(\n        \"hover:after:bg-sidebar-border absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear group-data-[side=left]:-right-4 group-data-[side=right]:left-0 after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] sm:flex\",\n        \"in-data-[side=left]:cursor-w-resize in-data-[side=right]:cursor-e-resize\",\n        \"[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize\",\n        \"hover:group-data-[collapsible=offcanvas]:bg-sidebar group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full\",\n        \"[[data-side=left][data-collapsible=offcanvas]_&]:-right-2\",\n        \"[[data-side=right][data-collapsible=offcanvas]_&]:-left-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarInset({ className, ...props }: React.ComponentProps<\"main\">) {\n  return (\n    <main\n      data-slot=\"sidebar-inset\"\n      className={cn(\n        \"bg-background relative flex w-full flex-1 flex-col\",\n        \"md:peer-data-[variant=inset]:m-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow-sm md:peer-data-[variant=inset]:peer-data-[state=collapsed]:ml-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarInput({\n  className,\n  ...props\n}: React.ComponentProps<typeof Input>) {\n  return (\n    <Input\n      data-slot=\"sidebar-input\"\n      data-sidebar=\"input\"\n      className={cn(\"bg-background h-8 w-full shadow-none\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarHeader({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-header\"\n      data-sidebar=\"header\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarFooter({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-footer\"\n      data-sidebar=\"footer\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarSeparator({\n  className,\n  ...props\n}: React.ComponentProps<typeof Separator>) {\n  return (\n    <Separator\n      data-slot=\"sidebar-separator\"\n      data-sidebar=\"separator\"\n      className={cn(\"bg-sidebar-border mx-2 w-auto\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarContent({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-content\"\n      data-sidebar=\"content\"\n      className={cn(\n        \"flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroup({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-group\"\n      data-sidebar=\"group\"\n      className={cn(\"relative flex w-full min-w-0 flex-col p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupLabel({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"div\"> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"div\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-group-label\"\n      data-sidebar=\"group-label\"\n      className={cn(\n        \"text-sidebar-foreground/70 ring-sidebar-ring flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium outline-hidden transition-[margin,opacity] duration-200 ease-linear focus-visible:ring-2 [&>svg]:h-4 [&>svg]:w-4 [&>svg]:shrink-0\",\n        \"group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupAction({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"button\"> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-group-action\"\n      data-sidebar=\"group-action\"\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground absolute top-3.5 right-3 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 md:after:hidden\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupContent({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-group-content\"\n      data-sidebar=\"group-content\"\n      className={cn(\"w-full text-sm\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenu({ className, ...props }: React.ComponentProps<\"ul\">) {\n  return (\n    <ul\n      data-slot=\"sidebar-menu\"\n      data-sidebar=\"menu\"\n      className={cn(\"flex w-full min-w-0 flex-col gap-1\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuItem({ className, ...props }: React.ComponentProps<\"li\">) {\n  return (\n    <li\n      data-slot=\"sidebar-menu-item\"\n      data-sidebar=\"menu-item\"\n      className={cn(\"group/menu-item relative\", className)}\n      {...props}\n    />\n  )\n}\n\nconst sidebarMenuButtonVariants = cva(\n  \"peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-hidden ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-data-[sidebar=menu-action]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:w-8! group-data-[collapsible=icon]:h-8! group-data-[collapsible=icon]:p-2! [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground\",\n        outline:\n          \"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]\",\n      },\n      size: {\n        default: \"h-8 text-sm\",\n        sm: \"h-7 text-xs\",\n        lg: \"h-12 text-sm group-data-[collapsible=icon]:p-0!\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nfunction SidebarMenuButton({\n  asChild = false,\n  isActive = false,\n  variant = \"default\",\n  size = \"default\",\n  tooltip,\n  className,\n  ...props\n}: React.ComponentProps<\"button\"> & {\n  asChild?: boolean\n  isActive?: boolean\n  tooltip?: string | React.ComponentProps<typeof TooltipContent>\n} & VariantProps<typeof sidebarMenuButtonVariants>) {\n  const Comp = asChild ? Slot : \"button\"\n  const { isMobile, state } = useSidebar()\n\n  const button = (\n    <Comp\n      data-slot=\"sidebar-menu-button\"\n      data-sidebar=\"menu-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(sidebarMenuButtonVariants({ variant, size }), className)}\n      {...props}\n    />\n  )\n\n  if (!tooltip) {\n    return button\n  }\n\n  if (typeof tooltip === \"string\") {\n    tooltip = {\n      children: tooltip,\n    }\n  }\n\n  return (\n    <Tooltip>\n      <TooltipTrigger asChild>{button}</TooltipTrigger>\n      <TooltipContent\n        side=\"right\"\n        align=\"center\"\n        hidden={state !== \"collapsed\" || isMobile}\n        {...tooltip}\n      />\n    </Tooltip>\n  )\n}\n\nfunction SidebarMenuAction({\n  className,\n  asChild = false,\n  showOnHover = false,\n  ...props\n}: React.ComponentProps<\"button\"> & {\n  asChild?: boolean\n  showOnHover?: boolean\n}) {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-menu-action\"\n      data-sidebar=\"menu-action\"\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground peer-hover/menu-button:text-sidebar-accent-foreground absolute top-1.5 right-1 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 md:after:hidden\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        showOnHover &&\n          \"peer-data-[active=true]/menu-button:text-sidebar-accent-foreground group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 md:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuBadge({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-menu-badge\"\n      data-sidebar=\"menu-badge\"\n      className={cn(\n        \"text-sidebar-foreground pointer-events-none absolute right-1 flex h-5 min-w-5 items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums select-none\",\n        \"peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSkeleton({\n  className,\n  showIcon = false,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  showIcon?: boolean\n}) {\n  // Random width between 50 to 90%.\n  const width = React.useMemo(() => {\n    return `${Math.floor(Math.random() * 40) + 50}%`\n  }, [])\n\n  return (\n    <div\n      data-slot=\"sidebar-menu-skeleton\"\n      data-sidebar=\"menu-skeleton\"\n      className={cn(\"flex h-8 items-center gap-2 rounded-md px-2\", className)}\n      {...props}\n    >\n      {showIcon && (\n        <Skeleton\n          className=\"size-4 rounded-md\"\n          data-sidebar=\"menu-skeleton-icon\"\n        />\n      )}\n      <Skeleton\n        className=\"h-4 max-w-[var(--skeleton-width)] flex-1\"\n        data-sidebar=\"menu-skeleton-text\"\n        style={\n          {\n            \"--skeleton-width\": width,\n          } as React.CSSProperties\n        }\n      />\n    </div>\n  )\n}\n\nfunction SidebarMenuSub({ className, ...props }: React.ComponentProps<\"ul\">) {\n  return (\n    <ul\n      data-slot=\"sidebar-menu-sub\"\n      data-sidebar=\"menu-sub\"\n      className={cn(\n        \"border-sidebar-border mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l px-2.5 py-0.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSubItem({\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) {\n  return (\n    <li\n      data-slot=\"sidebar-menu-sub-item\"\n      data-sidebar=\"menu-sub-item\"\n      className={cn(\"group/menu-sub-item relative\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSubButton({\n  asChild = false,\n  size = \"md\",\n  isActive = false,\n  className,\n  ...props\n}: React.ComponentProps<\"a\"> & {\n  asChild?: boolean\n  size?: \"sm\" | \"md\"\n  isActive?: boolean\n}) {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-menu-sub-button\"\n      data-sidebar=\"menu-sub-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground active:bg-sidebar-accent active:text-sidebar-accent-foreground [&>svg]:text-sidebar-accent-foreground flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 outline outline-2 outline-transparent outline-offset-2 focus-visible:ring-2 disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n        \"data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground\",\n        size === \"sm\" && \"text-xs\",\n        size === \"md\" && \"text-sm\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport {\n  Sidebar,\n  SidebarContent,\n  SidebarFooter,\n  SidebarGroup,\n  SidebarGroupAction,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarHeader,\n  SidebarInput,\n  SidebarInset,\n  SidebarMenu,\n  SidebarMenuAction,\n  SidebarMenuBadge,\n  SidebarMenuButton,\n  SidebarMenuItem,\n  SidebarMenuSkeleton,\n  SidebarMenuSub,\n  SidebarMenuSubButton,\n  SidebarMenuSubItem,\n  SidebarProvider,\n  SidebarRail,\n  SidebarSeparator,\n  SidebarTrigger,\n  useSidebar,\n}\n","size_bytes":21846},"client/src/pages/Register.tsx":{"content":"import { useState } from \"react\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Alert, AlertDescription } from \"@/components/ui/alert\";\nimport { Copy, Check, Shield, Key } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useTranslation } from \"react-i18next\";\n\nexport default function Register() {\n  const { t } = useTranslation();\n  const [name, setName] = useState(\"\");\n  const [domain, setDomain] = useState(\"\");\n  const [isLoading, setIsLoading] = useState(false);\n  const [registeredKeys, setRegisteredKeys] = useState<{\n    sitekey: string;\n    secretkey: string;\n    name: string;\n    domain: string;\n  } | null>(null);\n  const [copiedSitekey, setCopiedSitekey] = useState(false);\n  const [copiedSecretkey, setCopiedSecretkey] = useState(false);\n  const { toast } = useToast();\n\n  const handleRegister = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setIsLoading(true);\n\n    try {\n      const response = await fetch(\"/proofCaptcha/api/register\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ name, domain }),\n      });\n\n      if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.message || t('register.registrationError'));\n      }\n\n      const data = await response.json();\n      setRegisteredKeys({\n        sitekey: data.publicKey,\n        secretkey: data.privateKey,\n        name: data.name,\n        domain: data.domain,\n      });\n\n      toast({\n        title: t('register.registrationSuccess'),\n        description: t('register.apiKeysCreated'),\n      });\n\n      setName(\"\");\n      setDomain(\"\");\n    } catch (error: any) {\n      toast({\n        title: t('register.registrationFailed'),\n        description: error.message || t('register.registrationError'),\n        variant: \"destructive\",\n      });\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const copyToClipboard = (text: string, type: \"sitekey\" | \"secretkey\") => {\n    navigator.clipboard.writeText(text);\n    if (type === \"sitekey\") {\n      setCopiedSitekey(true);\n      setTimeout(() => setCopiedSitekey(false), 2000);\n    } else {\n      setCopiedSecretkey(true);\n      setTimeout(() => setCopiedSecretkey(false), 2000);\n    }\n    toast({\n      title: t('register.copied'),\n      description: t('register.copiedToClipboard', { type: type === \"sitekey\" ? t('register.sitekeyText') : t('register.secretkeyText') }),\n    });\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 dark:from-gray-900 dark:to-gray-800 px-4 py-6 sm:p-6\">\n      <div className=\"max-w-4xl mx-auto space-y-4 sm:space-y-6\">\n        <div className=\"text-center space-y-2\">\n          <div className=\"flex items-center justify-center gap-2\">\n            <Shield className=\"w-8 h-8 sm:w-10 sm:h-10 text-blue-600 dark:text-blue-400\" />\n            <h1 className=\"text-3xl sm:text-4xl font-bold text-gray-900 dark:text-white\">{t('register.pageTitle')}</h1>\n          </div>\n          <p className=\"text-sm sm:text-base text-gray-600 dark:text-gray-400\">\n            {t('register.pageSubtitle')}\n          </p>\n        </div>\n\n        {!registeredKeys ? (\n          <Card data-testid=\"card-registration\">\n            <CardHeader>\n              <CardTitle>{t('register.registrationTitle')}</CardTitle>\n              <CardDescription>\n                {t('register.registrationDescription')}\n              </CardDescription>\n            </CardHeader>\n            <CardContent>\n              <form onSubmit={handleRegister} className=\"space-y-4\">\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"name\">{t('register.appNameLabel')}</Label>\n                  <Input\n                    id=\"name\"\n                    data-testid=\"input-app-name\"\n                    type=\"text\"\n                    placeholder={t('register.appNamePlaceholder')}\n                    value={name}\n                    onChange={(e) => setName(e.target.value)}\n                    required\n                  />\n                </div>\n\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"domain\">{t('register.domainLabel')}</Label>\n                  <Input\n                    id=\"domain\"\n                    data-testid=\"input-domain\"\n                    type=\"text\"\n                    placeholder={t('register.domainPlaceholder')}\n                    value={domain}\n                    onChange={(e) => setDomain(e.target.value)}\n                    required\n                  />\n                  <p className=\"text-sm text-gray-500 dark:text-gray-400\">\n                    {t('register.domainHelpText')}\n                  </p>\n                </div>\n\n                <Button\n                  type=\"submit\"\n                  data-testid=\"button-register\"\n                  className=\"w-full\"\n                  disabled={isLoading}\n                >\n                  {isLoading ? t('register.registering') : t('register.registerNow')}\n                </Button>\n              </form>\n            </CardContent>\n          </Card>\n        ) : (\n          <div className=\"space-y-6\">\n            <Alert className=\"bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800\">\n              <Key className=\"h-4 w-4 text-green-600 dark:text-green-400\" />\n              <AlertDescription className=\"text-green-800 dark:text-green-200\">\n                {t('register.successMessage')}\n              </AlertDescription>\n            </Alert>\n\n            <Card data-testid=\"card-keys-result\">\n              <CardHeader>\n                <CardTitle>{t('register.yourApiKeys')}</CardTitle>\n                <CardDescription>\n                  {registeredKeys.name} - {registeredKeys.domain}\n                </CardDescription>\n              </CardHeader>\n              <CardContent className=\"space-y-4\">\n                <div className=\"space-y-2\">\n                  <Label>{t('register.sitekeyLabel')}</Label>\n                  <div className=\"flex gap-2\">\n                    <Input\n                      data-testid=\"text-sitekey\"\n                      value={registeredKeys.sitekey}\n                      readOnly\n                      className=\"font-mono text-sm\"\n                    />\n                    <Button\n                      data-testid=\"button-copy-sitekey\"\n                      variant=\"outline\"\n                      size=\"icon\"\n                      onClick={() => copyToClipboard(registeredKeys.sitekey, \"sitekey\")}\n                    >\n                      {copiedSitekey ? <Check className=\"w-4 h-4\" /> : <Copy className=\"w-4 h-4\" />}\n                    </Button>\n                  </div>\n                  <p className=\"text-xs text-gray-500 dark:text-gray-400\">\n                    {t('register.sitekeyHelpText')}\n                  </p>\n                </div>\n\n                <div className=\"space-y-2\">\n                  <Label>{t('register.secretkeyLabel')}</Label>\n                  <div className=\"flex gap-2\">\n                    <Input\n                      data-testid=\"text-secretkey\"\n                      value={registeredKeys.secretkey}\n                      readOnly\n                      className=\"font-mono text-sm\"\n                    />\n                    <Button\n                      data-testid=\"button-copy-secretkey\"\n                      variant=\"outline\"\n                      size=\"icon\"\n                      onClick={() => copyToClipboard(registeredKeys.secretkey, \"secretkey\")}\n                    >\n                      {copiedSecretkey ? <Check className=\"w-4 h-4\" /> : <Copy className=\"w-4 h-4\" />}\n                    </Button>\n                  </div>\n                  <p className=\"text-xs text-gray-500 dark:text-gray-400\">\n                    {t('register.secretkeyHelpText')}\n                  </p>\n                </div>\n\n                <div className=\"pt-4 border-t\">\n                  <h3 className=\"font-semibold mb-2\">{t('register.howToUse')}</h3>\n                  <div className=\"space-y-3 text-sm\">\n                    <div>\n                      <p className=\"font-medium mb-1\">{t('register.step1Title')}</p>\n                      <pre className=\"bg-gray-100 dark:bg-gray-800 p-3 rounded overflow-x-auto\">\n{`<!-- Load proofCaptcha API -->\n<script src=\"${window.location.origin}/proofCaptcha/api.js\" async defer></script>\n\n<!-- Widget CAPTCHA -->\n<div class=\"proof-captcha\" data-sitekey=\"${registeredKeys.sitekey}\"></div>`}\n                      </pre>\n                    </div>\n\n                    <div>\n                      <p className=\"font-medium mb-1\">{t('register.step2Title')}</p>\n                      <pre className=\"bg-gray-100 dark:bg-gray-800 p-3 rounded overflow-x-auto\">\n{`$secret_key = \"${registeredKeys.secretkey}\";\n$response = $_POST['proof-captcha-response'];\n$verify = file_get_contents(\"${window.location.origin}/proofCaptcha/api/siteverify?secret={$secret_key}&response={$response}\");\n$result = json_decode($verify);\n\nif ($result->success) {\n    // CAPTCHA valid\n} else {\n    // CAPTCHA tidak valid\n}`}\n                      </pre>\n                    </div>\n                  </div>\n                </div>\n\n                <Button\n                  data-testid=\"button-register-another\"\n                  variant=\"outline\"\n                  onClick={() => setRegisteredKeys(null)}\n                  className=\"w-full\"\n                >\n                  {t('register.registerAnotherApp')}\n                </Button>\n              </CardContent>\n            </Card>\n          </div>\n        )}\n\n        <Card>\n          <CardHeader>\n            <CardTitle>{t('register.featuresTitle')}</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"grid md:grid-cols-3 gap-4\">\n              <div className=\"space-y-2\">\n                <div className=\"w-10 h-10 bg-blue-100 dark:bg-blue-900 rounded-lg flex items-center justify-center\">\n                  <Shield className=\"w-6 h-6 text-blue-600 dark:text-blue-400\" />\n                </div>\n                <h3 className=\"font-semibold\">{t('register.powSecurityTitle')}</h3>\n                <p className=\"text-sm text-gray-600 dark:text-gray-400\">\n                  {t('register.powSecurityDesc')}\n                </p>\n              </div>\n              <div className=\"space-y-2\">\n                <div className=\"w-10 h-10 bg-green-100 dark:bg-green-900 rounded-lg flex items-center justify-center\">\n                  <Key className=\"w-6 h-6 text-green-600 dark:text-green-400\" />\n                </div>\n                <h3 className=\"font-semibold\">{t('register.easyIntegrationTitle')}</h3>\n                <p className=\"text-sm text-gray-600 dark:text-gray-400\">\n                  {t('register.easyIntegrationDesc')}\n                </p>\n              </div>\n              <div className=\"space-y-2\">\n                <div className=\"w-10 h-10 bg-purple-100 dark:bg-purple-900 rounded-lg flex items-center justify-center\">\n                  <Shield className=\"w-6 h-6 text-purple-600 dark:text-purple-400\" />\n                </div>\n                <h3 className=\"font-semibold\">{t('register.realtimeAnalyticsTitle')}</h3>\n                <p className=\"text-sm text-gray-600 dark:text-gray-400\">\n                  {t('register.realtimeAnalyticsDesc')}\n                </p>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}\n","size_bytes":11634},"client/src/pages/Login.tsx":{"content":"import { useState, useEffect, useRef } from \"react\";\nimport { useAuth } from \"@/hooks/use-auth\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Card, CardContent, CardDescription, CardFooter, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Label } from \"@/components/ui/label\";\nimport { Shield, ArrowRight } from \"lucide-react\";\nimport { Link } from \"wouter\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useTranslation } from \"react-i18next\";\nimport LanguageToggle from \"@/components/LanguageToggle\";\nimport ThemeToggle from \"@/components/ThemeToggle\";\n\nconst DEMO_PUBLIC_KEY = \"pk_ab6c4ac2c8976668e6d92fe401386cae18df4c9b4f5193cb140266f6d9546f1c\";\n\n// Declare global ProofCaptcha API\ndeclare global {\n  interface Window {\n    ProofCaptcha: {\n      render: (container: string | HTMLElement, params: any) => number;\n      getResponse: (widgetId?: number) => string | null;\n      reset: (widgetId?: number) => void;\n      ready: (callback: () => void) => void;\n    };\n    onCaptchaSuccess?: (token: string) => void;\n    onCaptchaError?: (error: string) => void;\n  }\n}\n\nexport default function Login() {\n  const [email, setEmail] = useState(\"\");\n  const [password, setPassword] = useState(\"\");\n  const [isLoading, setIsLoading] = useState(false);\n  const [captchaToken, setCaptchaToken] = useState<string>(\"\");\n  const [widgetId, setWidgetId] = useState<number | null>(null);\n  const captchaContainerRef = useRef<HTMLDivElement>(null);\n  const { login } = useAuth();\n  const { toast } = useToast();\n  const { t } = useTranslation();\n\n  useEffect(() => {\n    // Load api.js script\n    const script = document.createElement('script');\n    script.src = '/proofCaptcha/api.js';\n    script.async = true;\n    script.onload = () => {\n      // Define global callback functions\n      window.onCaptchaSuccess = (token: string) => {\n        console.log('[CAPTCHA] Success callback received:', token);\n        setCaptchaToken(token);\n      };\n\n      window.onCaptchaError = (error: string) => {\n        console.log('[CAPTCHA] Error callback received:', error);\n        setCaptchaToken(\"\");\n        toast({\n          title: t('auth.captchaError'),\n          description: error,\n          variant: \"destructive\",\n        });\n      };\n\n      // Render captcha widget using ProofCaptcha API\n      if (window.ProofCaptcha && captchaContainerRef.current) {\n        const id = window.ProofCaptcha.render(captchaContainerRef.current, {\n          sitekey: DEMO_PUBLIC_KEY,\n          type: 'random',\n          callback: 'onCaptchaSuccess',\n          'error-callback': 'onCaptchaError',\n          theme: 'auto'\n        });\n        setWidgetId(id);\n        console.log('[CAPTCHA] Widget rendered with ID:', id);\n      }\n    };\n    document.head.appendChild(script);\n\n    return () => {\n      // Cleanup\n      if (script.parentNode) {\n        script.parentNode.removeChild(script);\n      }\n      delete window.onCaptchaSuccess;\n      delete window.onCaptchaError;\n    };\n  }, [toast]);\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    \n    if (!captchaToken) {\n      toast({\n        title: t('toast.error'),\n        description: t('auth.completeCaptcha'),\n        variant: \"destructive\",\n      });\n      return;\n    }\n    \n    setIsLoading(true);\n\n    try {\n      await login(email, password, captchaToken);\n      setCaptchaToken(\"\");\n      if (window.ProofCaptcha && widgetId !== null) {\n        window.ProofCaptcha.reset(widgetId);\n      }\n    } catch (error: any) {\n      toast({\n        title: t('toast.error'),\n        description: error.message || t('auth.completeCaptcha'),\n        variant: \"destructive\",\n      });\n      setCaptchaToken(\"\");\n      if (window.ProofCaptcha && widgetId !== null) {\n        window.ProofCaptcha.reset(widgetId);\n      }\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen relative overflow-hidden\" data-testid=\"page-login\">\n      {/* Animated gradient background */}\n      <div className=\"absolute inset-0 -z-10\">\n        <div className=\"absolute top-0 -left-4 w-96 h-96 bg-primary/30 rounded-full mix-blend-multiply filter blur-3xl opacity-70 animate-blob\" />\n        <div className=\"absolute top-0 -right-4 w-96 h-96 bg-purple-300/30 rounded-full mix-blend-multiply filter blur-3xl opacity-70 animate-blob animation-delay-2000\" />\n        <div className=\"absolute -bottom-8 left-20 w-96 h-96 bg-blue-300/30 rounded-full mix-blend-multiply filter blur-3xl opacity-70 animate-blob animation-delay-4000\" />\n      </div>\n\n      {/* Header with glassmorphism */}\n      <header className=\"sticky top-0 z-50 backdrop-blur-md bg-background/80 border-b border-border/50\">\n        <div className=\"container mx-auto px-4 py-4 flex items-center justify-between\">\n          <Link href=\"/\">\n            <div className=\"flex items-center gap-3 group hover-elevate active-elevate-2\">\n              <div className=\"relative\">\n                <Shield className=\"h-7 w-7 text-primary transition-all duration-300 group-hover:scale-110 group-hover:rotate-12\" />\n                <div className=\"absolute inset-0 bg-primary/20 rounded-full blur-md group-hover:blur-lg transition-all\" />\n              </div>\n              <span className=\"font-bold text-xl bg-gradient-to-r from-primary to-purple-600 bg-clip-text text-transparent\">\n                ProofCaptcha\n              </span>\n            </div>\n          </Link>\n          <div className=\"flex items-center gap-2\">\n            <LanguageToggle />\n            <ThemeToggle />\n          </div>\n        </div>\n      </header>\n\n      <div className=\"flex items-center justify-center p-4 py-12 sm:py-16\">\n        <Card className=\"w-full max-w-md border-2 shadow-2xl relative overflow-hidden\">\n          {/* Card gradient overlay */}\n          <div className=\"absolute inset-0 bg-gradient-to-br from-primary/5 via-purple-500/5 to-blue-500/5 pointer-events-none\" />\n          \n          <CardHeader className=\"space-y-4 relative\">\n            {/* Floating 3D icon */}\n            <div className=\"flex justify-center\">\n              <div className=\"relative transform-gpu hover:scale-110 transition-all duration-500 floating\">\n                <div className=\"absolute inset-0 bg-gradient-to-br from-primary/50 to-purple-500/50 rounded-2xl blur-xl opacity-60 animate-pulse-slow\" />\n                <div className=\"relative bg-gradient-to-br from-primary to-purple-600 p-5 rounded-2xl shadow-xl transform rotate-3 hover:rotate-0 transition-all duration-500\">\n                  <Shield className=\"h-10 w-10 text-white drop-shadow-lg\" />\n                </div>\n              </div>\n            </div>\n            \n            <div className=\"space-y-2\">\n              <CardTitle className=\"text-3xl text-center font-bold bg-gradient-to-r from-foreground to-muted-foreground bg-clip-text text-transparent\" data-testid=\"text-login-title\">\n                {t('auth.loginTitle')}\n              </CardTitle>\n              <CardDescription className=\"text-center text-base\">\n                {t('auth.loginSubtitle')}\n              </CardDescription>\n            </div>\n          </CardHeader>\n          \n          <form onSubmit={handleSubmit}>\n            <CardContent className=\"space-y-4 relative\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"email\" className=\"text-sm font-medium\">{t('common.email')}</Label>\n                <Input\n                  id=\"email\"\n                  type=\"email\"\n                  placeholder={t('auth.emailPlaceholder')}\n                  value={email}\n                  onChange={(e) => setEmail(e.target.value)}\n                  required\n                  className=\"h-11 rounded-lg border-2 focus:border-primary transition-colors\"\n                  data-testid=\"input-email\"\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <div className=\"flex items-center justify-between\">\n                  <Label htmlFor=\"password\" className=\"text-sm font-medium\">{t('common.password')}</Label>\n                  <Link \n                    href=\"/forgot-password\" \n                    className=\"text-sm text-primary hover:underline font-medium transition-colors\" \n                    data-testid=\"link-forgot-password\"\n                  >\n                    Lupa Password?\n                  </Link>\n                </div>\n                <Input\n                  id=\"password\"\n                  type=\"password\"\n                  placeholder={t('auth.passwordPlaceholder')}\n                  value={password}\n                  onChange={(e) => setPassword(e.target.value)}\n                  required\n                  className=\"h-11 rounded-lg border-2 focus:border-primary transition-colors\"\n                  data-testid=\"input-password\"\n                />\n              </div>\n              <div ref={captchaContainerRef} data-testid=\"captcha-container\"></div>\n            </CardContent>\n            \n            <CardFooter className=\"flex flex-col space-y-4 relative\">\n              <Button \n                type=\"submit\" \n                className=\"w-full h-11 rounded-xl shadow-lg hover:shadow-xl transition-all duration-300 text-base group\" \n                disabled={isLoading || !captchaToken} \n                data-testid=\"button-login\"\n              >\n                <span className=\"flex items-center gap-2\">\n                  {isLoading ? t('auth.verifyingCaptcha') : t('auth.loginButton')}\n                  {!isLoading && <ArrowRight className=\"w-4 h-4 group-hover:translate-x-1 transition-transform\" />}\n                </span>\n              </Button>\n              \n              <div className=\"text-sm text-center text-muted-foreground\">\n                {t('auth.noAccount')}{\" \"}\n                <Link href=\"/register\" className=\"text-primary hover:underline font-medium transition-colors\" data-testid=\"link-register\">\n                  {t('auth.signUpLink')}\n                </Link>\n              </div>\n            </CardFooter>\n          </form>\n        </Card>\n      </div>\n    </div>\n  );\n}\n","size_bytes":10117},"vite.config.ts":{"content":"import { defineConfig } from \"vite\";\nimport react from \"@vitejs/plugin-react\";\nimport path from \"path\";\nimport runtimeErrorOverlay from \"@replit/vite-plugin-runtime-error-modal\";\n\nexport default defineConfig({\n  plugins: [\n    react(),\n    runtimeErrorOverlay(),\n    ...(process.env.NODE_ENV !== \"production\" &&\n    process.env.REPL_ID !== undefined\n      ? [\n          await import(\"@replit/vite-plugin-cartographer\").then((m) =>\n            m.cartographer(),\n          ),\n          await import(\"@replit/vite-plugin-dev-banner\").then((m) =>\n            m.devBanner(),\n          ),\n        ]\n      : []),\n  ],\n  resolve: {\n    alias: {\n      \"@\": path.resolve(import.meta.dirname, \"client\", \"src\"),\n      \"@shared\": path.resolve(import.meta.dirname, \"shared\"),\n      \"@assets\": path.resolve(import.meta.dirname, \"attached_assets\"),\n    },\n  },\n  root: path.resolve(import.meta.dirname, \"client\"),\n  build: {\n    outDir: path.resolve(import.meta.dirname, \"dist/public\"),\n    emptyOutDir: true,\n  },\n  server: {\n    fs: {\n      strict: true,\n      deny: [\"**/.*\"],\n    },\n  },\n});\n","size_bytes":1080},"client/src/components/ui/accordion.tsx":{"content":"import * as React from \"react\"\nimport * as AccordionPrimitive from \"@radix-ui/react-accordion\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Accordion = AccordionPrimitive.Root\n\nconst AccordionItem = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <AccordionPrimitive.Item\n    ref={ref}\n    className={cn(\"border-b\", className)}\n    {...props}\n  />\n))\nAccordionItem.displayName = \"AccordionItem\"\n\nconst AccordionTrigger = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Header className=\"flex\">\n    <AccordionPrimitive.Trigger\n      ref={ref}\n      className={cn(\n        \"flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <ChevronDown className=\"h-4 w-4 shrink-0 transition-transform duration-200\" />\n    </AccordionPrimitive.Trigger>\n  </AccordionPrimitive.Header>\n))\nAccordionTrigger.displayName = AccordionPrimitive.Trigger.displayName\n\nconst AccordionContent = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Content\n    ref={ref}\n    className=\"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down\"\n    {...props}\n  >\n    <div className={cn(\"pb-4 pt-0\", className)}>{children}</div>\n  </AccordionPrimitive.Content>\n))\n\nAccordionContent.displayName = AccordionPrimitive.Content.displayName\n\nexport { Accordion, AccordionItem, AccordionTrigger, AccordionContent }\n","size_bytes":1977},"client/src/hooks/use-mobile.tsx":{"content":"import * as React from \"react\"\n\nconst MOBILE_BREAKPOINT = 768\n\nexport function useIsMobile() {\n  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined)\n\n  React.useEffect(() => {\n    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`)\n    const onChange = () => {\n      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    }\n    mql.addEventListener(\"change\", onChange)\n    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    return () => mql.removeEventListener(\"change\", onChange)\n  }, [])\n\n  return !!isMobile\n}\n","size_bytes":565},"client/src/components/ui/toast.tsx":{"content":"import * as React from \"react\"\nimport * as ToastPrimitives from \"@radix-ui/react-toast\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ToastProvider = ToastPrimitives.Provider\n\nconst ToastViewport = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Viewport>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Viewport>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Viewport\n    ref={ref}\n    className={cn(\n      \"fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]\",\n      className\n    )}\n    {...props}\n  />\n))\nToastViewport.displayName = ToastPrimitives.Viewport.displayName\n\nconst toastVariants = cva(\n  \"group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full\",\n  {\n    variants: {\n      variant: {\n        default: \"border bg-background text-foreground\",\n        destructive:\n          \"destructive group border-destructive bg-destructive text-destructive-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Toast = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Root> &\n    VariantProps<typeof toastVariants>\n>(({ className, variant, ...props }, ref) => {\n  return (\n    <ToastPrimitives.Root\n      ref={ref}\n      className={cn(toastVariants({ variant }), className)}\n      {...props}\n    />\n  )\n})\nToast.displayName = ToastPrimitives.Root.displayName\n\nconst ToastAction = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Action>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Action>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Action\n    ref={ref}\n    className={cn(\n      \"inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive\",\n      className\n    )}\n    {...props}\n  />\n))\nToastAction.displayName = ToastPrimitives.Action.displayName\n\nconst ToastClose = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Close>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Close>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Close\n    ref={ref}\n    className={cn(\n      \"absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600\",\n      className\n    )}\n    toast-close=\"\"\n    {...props}\n  >\n    <X className=\"h-4 w-4\" />\n  </ToastPrimitives.Close>\n))\nToastClose.displayName = ToastPrimitives.Close.displayName\n\nconst ToastTitle = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Title>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Title>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Title\n    ref={ref}\n    className={cn(\"text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nToastTitle.displayName = ToastPrimitives.Title.displayName\n\nconst ToastDescription = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Description>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Description>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Description\n    ref={ref}\n    className={cn(\"text-sm opacity-90\", className)}\n    {...props}\n  />\n))\nToastDescription.displayName = ToastPrimitives.Description.displayName\n\ntype ToastProps = React.ComponentPropsWithoutRef<typeof Toast>\n\ntype ToastActionElement = React.ReactElement<typeof ToastAction>\n\nexport {\n  type ToastProps,\n  type ToastActionElement,\n  ToastProvider,\n  ToastViewport,\n  Toast,\n  ToastTitle,\n  ToastDescription,\n  ToastClose,\n  ToastAction,\n}\n","size_bytes":4845},"client/src/lib/automation-detector.ts":{"content":"export function detectClientAutomation(): string[] {\n  const detections: string[] = [];\n  \n  try {\n    // Check for webdriver - HIGH CONFIDENCE\n    if (navigator.webdriver === true) {\n      detections.push('webdriver');\n    }\n    \n    // Check for automation flags - HIGH CONFIDENCE\n    if (document.documentElement.getAttribute('webdriver')) {\n      detections.push('webdriver-attribute');\n    }\n    \n    // Check for missing critical window properties - HIGH CONFIDENCE\n    if (!window.localStorage || !window.sessionStorage) {\n      detections.push('missing-storage');\n    }\n    \n    // Check for languages mismatch - MEDIUM CONFIDENCE\n    if (navigator.languages && navigator.languages.length === 0) {\n      detections.push('no-languages');\n    }\n    \n    // Check for automation variables\n    const automationVars = [\n      '__webdriver_evaluate',\n      '__selenium_evaluate',\n      '__webdriver_script_function',\n      '__webdriver_script_func',\n      '__webdriver_script_fn',\n      '__fxdriver_evaluate',\n      '__driver_unwrapped',\n      '__webdriver_unwrapped',\n      '__driver_evaluate',\n      '__selenium_unwrapped',\n      '__fxdriver_unwrapped',\n      '_Selenium_IDE_Recorder',\n      '_selenium',\n      'calledSelenium',\n      '_WEBDRIVER_ELEM_CACHE',\n      'ChromeDriverw',\n      'driver-evaluate',\n      'webdriver-evaluate',\n      'selenium-evaluate',\n      'webdriverCommand',\n      'webdriver-evaluate-response',\n      '__webdriverFunc',\n      '__webdriver_script_fn',\n      '__$webdriverAsyncExecutor',\n      'domAutomation',\n      'domAutomationController',\n      '__nightmare',\n      '_phantom',\n      'callPhantom',\n      '__phantomas'\n    ];\n    \n    for (const varName of automationVars) {\n      if ((window as any)[varName] || (document as any)[varName]) {\n        detections.push(`automation-var-${varName}`);\n      }\n    }\n    \n    // Check for Puppeteer-specific properties\n    if ((window as any)._phantom || (window as any).callPhantom) {\n      detections.push('phantom');\n    }\n    \n    // Check for CDP (Chrome DevTools Protocol)\n    if ((window as any).__playwright || (window as any).__pw_manual) {\n      detections.push('playwright');\n    }\n    \n    // Check for inconsistencies in navigator\n    if (navigator.platform === '') {\n      detections.push('empty-platform');\n    }\n    \n    // Check for touch support inconsistency\n    const hasTouch = 'ontouchstart' in window || navigator.maxTouchPoints > 0;\n    if (!hasTouch && navigator.userAgent.includes('Mobile')) {\n      detections.push('touch-mismatch');\n    }\n    \n  } catch (error) {\n    console.error('Error detecting automation:', error);\n  }\n  \n  return detections;\n}\n","size_bytes":2661},"server/public/proofCaptcha/proofcaptcha-widget.css":{"content":"/**\n * ProofCaptcha Widget Styles\n * Standalone CSS matching React/Tailwind styling from CaptchaWidget.tsx\n * Compatible with both light and dark themes\n */\n\n/* ==========================================\n   CSS Variables (matching index.css)\n   ========================================== */\n:root {\n  /* Light mode colors */\n  --pc-primary: 214 95% 48%;\n  --pc-primary-foreground: 210 20% 98%;\n  --pc-background: 0 0% 100%;\n  --pc-foreground: 220 10% 15%;\n  --pc-card: 220 4% 98%;\n  --pc-card-foreground: 220 10% 15%;\n  --pc-border: 220 8% 88%;\n  --pc-muted: 220 10% 94%;\n  --pc-muted-foreground: 220 8% 40%;\n  --pc-accent: 220 12% 92%;\n  --pc-success: 142 76% 36%;\n  --pc-success-bg: 142 76% 95%;\n  --pc-error: 0 84% 60%;\n  --pc-error-bg: 0 84% 95%;\n  --pc-warning: 38 92% 50%;\n  --pc-warning-bg: 38 92% 95%;\n}\n\n/* Dark mode colors */\n.dark .proofcaptcha-root,\n[data-theme=\"dark\"] .proofcaptcha-root {\n  --pc-background: 220 13% 9%;\n  --pc-foreground: 210 20% 98%;\n  --pc-card: 220 13% 12%;\n  --pc-card-foreground: 210 20% 98%;\n  --pc-border: 220 13% 20%;\n  --pc-muted: 220 13% 18%;\n  --pc-muted-foreground: 220 8% 60%;\n  --pc-accent: 220 13% 18%;\n  --pc-success-bg: 142 76% 15%;\n  --pc-error-bg: 0 84% 20%;\n  --pc-warning-bg: 38 92% 20%;\n}\n\n/* ==========================================\n   Base Styles\n   ========================================== */\n.proofcaptcha-root {\n  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n/* ==========================================\n   Widget Container (matching Card component)\n   ========================================== */\n.proofcaptcha-widget {\n  width: 100%;\n  max-width: 24rem; /* 384px - same as max-w-sm in Tailwind */\n  min-width: 280px; /* Minimum width for mobile */\n  border-radius: 0.5rem; /* 8px - matching rounded-lg */\n  border: 2px solid hsl(var(--pc-border));\n  background-color: hsl(var(--pc-card));\n  color: hsl(var(--pc-card-foreground));\n  box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);\n  overflow: hidden;\n  margin: 0 auto; /* Center the widget */\n}\n\n/* Widget Content (Header area) */\n.proofcaptcha-content {\n  padding: 0.75rem; /* 12px - matching p-3 */\n  border-bottom: 1px solid hsl(var(--pc-border));\n  background: linear-gradient(to right, hsl(var(--pc-card)), hsl(var(--pc-muted)));\n}\n\n.proofcaptcha-inner {\n  display: flex;\n  align-items: center;\n  gap: 0.75rem; /* 12px - matching gap-3 */\n}\n\n/* Checkbox Container */\n.proofcaptcha-checkbox-container {\n  flex-shrink: 0;\n}\n\n.proofcaptcha-checkbox {\n  width: 1.75rem; /* 28px */\n  height: 1.75rem;\n  cursor: pointer;\n  accent-color: hsl(var(--pc-primary));\n  border-radius: 0.25rem;\n}\n\n.proofcaptcha-checkbox:disabled {\n  cursor: not-allowed;\n  opacity: 0.5;\n}\n\n/* Success/Error Icon Container */\n.proofcaptcha-icon-container {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 2rem; /* 32px - matching w-8 */\n  height: 2rem;\n  border-radius: 0.25rem;\n}\n\n.proofcaptcha-icon-container.success {\n  background-color: hsl(var(--pc-success-bg));\n}\n\n.proofcaptcha-icon-container.error {\n  background-color: hsl(var(--pc-error-bg));\n}\n\n.proofcaptcha-icon-container.warning {\n  background-color: hsl(var(--pc-warning-bg));\n}\n\n.proofcaptcha-icon-container svg {\n  width: 1.25rem; /* 20px - matching h-5 w-5 */\n  height: 1.25rem;\n}\n\n.proofcaptcha-icon-container.success svg {\n  color: hsl(var(--pc-success));\n}\n\n.proofcaptcha-icon-container.error svg {\n  color: hsl(var(--pc-error));\n}\n\n.proofcaptcha-icon-container.warning svg {\n  color: hsl(var(--pc-warning));\n}\n\n/* Text Content */\n.proofcaptcha-text {\n  flex: 1;\n  font-size: 0.875rem; /* 14px - matching text-sm */\n  font-weight: 600;\n  color: hsl(var(--pc-card-foreground));\n}\n\n.proofcaptcha-text-status {\n  font-weight: 600;\n}\n\n.proofcaptcha-text-attempts {\n  font-size: 0.75rem; /* 12px - matching text-xs */\n  color: hsl(var(--pc-muted-foreground));\n  font-weight: 400;\n}\n\n/* Logo/Status Icon */\n.proofcaptcha-logo {\n  width: 2.5rem; /* 40px */\n  height: 2.5rem;\n  border-radius: 0.375rem; /* 6px */\n  background: linear-gradient(135deg, #3b82f6, #4f46e5);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);\n  color: white;\n  flex-shrink: 0;\n}\n\n.proofcaptcha-logo.success {\n  background: linear-gradient(135deg, #10b981, #059669);\n}\n\n.proofcaptcha-logo.error {\n  background: linear-gradient(135deg, #ef4444, #dc2626);\n}\n\n.proofcaptcha-logo.warning {\n  background: linear-gradient(135deg, #f97316, #f59e0b);\n}\n\n.proofcaptcha-logo svg {\n  width: 1.5rem; /* 24px */\n  height: 1.5rem;\n}\n\n/* Footer */\n.proofcaptcha-footer {\n  padding: 0.5rem 0.75rem; /* 8px 12px */\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  font-size: 0.625rem; /* 10px */\n  color: hsl(var(--pc-muted-foreground));\n  background-color: hsl(var(--pc-background));\n}\n\n.proofcaptcha-footer span {\n  cursor: pointer;\n  opacity: 0.7;\n  transition: opacity 0.2s;\n}\n\n.proofcaptcha-footer span:hover {\n  opacity: 1;\n}\n\n.proofcaptcha-footer-brand {\n  font-weight: 700;\n  letter-spacing: 0.05em;\n}\n\n/* ==========================================\n   Modal Overlay\n   ========================================== */\n.proofcaptcha-overlay {\n  display: none;\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: rgba(0, 0, 0, 0.5);\n  backdrop-filter: blur(8px);\n  z-index: 9999;\n  align-items: center;\n  justify-content: center;\n  padding: 1.25rem; /* 20px */\n  animation: pc-fadeIn 0.2s ease-in-out;\n  pointer-events: auto;\n  touch-action: none;\n  -webkit-tap-highlight-color: transparent;\n}\n\n.proofcaptcha-overlay.active {\n  display: flex;\n}\n\n.proofcaptcha-modal {\n  background: hsl(var(--pc-card));\n  border-radius: 0.75rem; /* 12px */\n  max-width: 31.25rem; /* 500px */\n  width: 100%;\n  box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.3), 0 10px 10px -5px rgba(0, 0, 0, 0.04);\n  color: hsl(var(--pc-card-foreground));\n  animation: pc-slideUp 0.2s ease-in-out;\n  pointer-events: auto;\n  position: relative;\n  z-index: 10000;\n}\n\n/* ==========================================\n   Challenge Components\n   ========================================== */\n\n/* Challenge Header */\n.proofcaptcha-challenge-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 1.5rem; /* 24px */\n}\n\n.proofcaptcha-challenge-title {\n  font-size: 1.125rem; /* 18px */\n  font-weight: 600;\n  margin: 0;\n  color: hsl(var(--pc-foreground));\n}\n\n.proofcaptcha-challenge-description {\n  font-size: 0.875rem;\n  color: hsl(var(--pc-muted-foreground));\n  margin: 0.25rem 0 0 0;\n}\n\n/* Challenge Actions */\n.proofcaptcha-challenge-actions {\n  display: flex;\n  gap: 0.25rem;\n}\n\n/* Buttons */\n.proofcaptcha-btn {\n  display: inline-flex;\n  align-items: center;\n  justify-content: center;\n  border-radius: 0.375rem;\n  font-size: 0.875rem;\n  font-weight: 500;\n  transition: all 0.2s;\n  cursor: pointer;\n  border: 1px solid transparent;\n  outline: none;\n}\n\n.proofcaptcha-btn:focus-visible {\n  outline: 2px solid hsl(var(--pc-primary));\n  outline-offset: 2px;\n}\n\n.proofcaptcha-btn:disabled {\n  pointer-events: none;\n  opacity: 0.5;\n}\n\n/* Button Ghost */\n.proofcaptcha-btn-ghost {\n  background: transparent;\n  color: hsl(var(--pc-foreground));\n  padding: 0.5rem;\n}\n\n.proofcaptcha-btn-ghost:hover:not(:disabled) {\n  background: hsl(var(--pc-accent));\n}\n\n/* Button Icon */\n.proofcaptcha-btn-icon {\n  height: 2.25rem; /* 36px - matching h-9 */\n  width: 2.25rem;\n  padding: 0;\n}\n\n.proofcaptcha-btn-icon svg {\n  width: 1.25rem;\n  height: 1.25rem;\n}\n\n/* Button Primary */\n.proofcaptcha-btn-primary {\n  background: hsl(var(--pc-primary));\n  color: hsl(var(--pc-primary-foreground));\n  padding: 0.5rem 1rem;\n  min-height: 2.25rem;\n}\n\n.proofcaptcha-btn-primary:hover:not(:disabled) {\n  background: hsl(var(--pc-primary) / 0.9);\n}\n\n/* Button Outline */\n.proofcaptcha-btn-outline {\n  border: 1px solid hsl(var(--pc-border));\n  background: transparent;\n  color: hsl(var(--pc-foreground));\n  padding: 0.5rem 1rem;\n  min-height: 2.25rem;\n}\n\n.proofcaptcha-btn-outline:hover:not(:disabled) {\n  background: hsl(var(--pc-accent));\n}\n\n/* Button Large */\n.proofcaptcha-btn-lg {\n  min-height: 2.5rem; /* 40px */\n  padding: 0.625rem 1.25rem;\n}\n\n/* Grid Challenge */\n.proofcaptcha-grid-container {\n  display: grid;\n  gap: 0.75rem; /* 12px */\n  padding: 2rem; /* 32px */\n  background: linear-gradient(to bottom right, hsl(var(--pc-muted)), hsl(var(--pc-accent)));\n  border-radius: 0.75rem;\n  margin-bottom: 1rem;\n}\n\n.proofcaptcha-grid-cell {\n  aspect-ratio: 1;\n  border-radius: 0.75rem; /* 12px */\n  border: 2px solid hsl(var(--pc-border));\n  background: hsl(var(--pc-background));\n  cursor: pointer;\n  transition: all 0.2s;\n  font-size: 2.25rem; /* 36px */\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  position: relative;\n  transform: scale(1);\n}\n\n.proofcaptcha-grid-cell:hover:not(:disabled) {\n  transform: scale(1.05);\n  border-color: hsl(var(--pc-primary));\n}\n\n.proofcaptcha-grid-cell.selected {\n  background: linear-gradient(135deg, #3b82f6, #6366f1);\n  border-color: #60a5fa;\n  box-shadow: 0 10px 15px -3px rgba(59, 130, 246, 0.3);\n  transform: scale(0.95);\n}\n\n.proofcaptcha-grid-cell.selected .proofcaptcha-grid-emoji {\n  opacity: 0.3;\n}\n\n.proofcaptcha-grid-cell:disabled {\n  opacity: 0.5;\n  cursor: not-allowed;\n}\n\n.proofcaptcha-grid-check {\n  position: absolute;\n  inset: 0;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n\n.proofcaptcha-grid-check svg {\n  width: 2.5rem;\n  height: 2.5rem;\n  color: white;\n}\n\n/* Jigsaw Challenge */\n.proofcaptcha-jigsaw-container {\n  display: grid;\n  grid-template-columns: repeat(4, 1fr);\n  gap: 1rem;\n  padding: 1.5rem;\n  background: linear-gradient(to bottom right, hsl(var(--pc-muted)), hsl(var(--pc-accent)));\n  border-radius: 0.75rem;\n  margin-bottom: 1rem;\n}\n\n.proofcaptcha-jigsaw-piece {\n  height: 7rem; /* 112px */\n  border-radius: 0.75rem;\n  border: 2px solid hsl(var(--pc-border));\n  cursor: pointer;\n  transition: all 0.2s;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  gap: 0.25rem;\n  position: relative;\n}\n\n.proofcaptcha-jigsaw-piece:hover:not(:disabled) {\n  transform: scale(1.05);\n  border-color: white;\n}\n\n.proofcaptcha-jigsaw-piece.selected {\n  border-color: white;\n  transform: scale(0.95);\n  box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.5);\n}\n\n.proofcaptcha-jigsaw-piece:disabled {\n  opacity: 0.5;\n  cursor: not-allowed;\n}\n\n.proofcaptcha-jigsaw-emoji {\n  font-size: 2.25rem;\n  filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.1));\n}\n\n.proofcaptcha-jigsaw-order {\n  position: absolute;\n  top: -0.5rem;\n  right: -0.5rem;\n  background: hsl(var(--pc-background));\n  border: 2px solid hsl(var(--pc-primary));\n  border-radius: 9999px;\n  width: 2rem;\n  height: 2rem;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  font-size: 0.875rem;\n  font-weight: 700;\n}\n\n/* Piece Colors */\n.proofcaptcha-jigsaw-piece.color-0 {\n  background-color: #f87171; /* red-400 */\n}\n\n.proofcaptcha-jigsaw-piece.color-1 {\n  background-color: #60a5fa; /* blue-400 */\n}\n\n.proofcaptcha-jigsaw-piece.color-2 {\n  background-color: #4ade80; /* green-400 */\n}\n\n.proofcaptcha-jigsaw-piece.color-3 {\n  background-color: #facc15; /* yellow-400 */\n}\n\n/* Progress Bar */\n.proofcaptcha-progress {\n  height: 0.5rem; /* 8px */\n  width: 100%;\n  background: hsl(var(--pc-muted));\n  border-radius: 9999px;\n  overflow: hidden;\n  margin-top: 1rem;\n}\n\n.proofcaptcha-progress-bar {\n  height: 100%;\n  background: hsl(var(--pc-primary));\n  transition: width 0.3s;\n}\n\n/* Success/Error States */\n.proofcaptcha-result {\n  display: flex;\n  align-items: center;\n  gap: 0.75rem;\n  padding: 1.5rem;\n  border-radius: 0.5rem;\n  margin-bottom: 1rem;\n}\n\n.proofcaptcha-result.success {\n  background: hsl(var(--pc-success-bg));\n  color: hsl(var(--pc-success));\n}\n\n.proofcaptcha-result.error {\n  background: hsl(var(--pc-error-bg));\n  color: hsl(var(--pc-error));\n}\n\n.proofcaptcha-result svg {\n  width: 2rem;\n  height: 2rem;\n  flex-shrink: 0;\n}\n\n.proofcaptcha-result-text {\n  font-weight: 600;\n}\n\n/* Button Grid */\n.proofcaptcha-button-grid {\n  display: grid;\n  grid-template-columns: repeat(2, 1fr);\n  gap: 0.75rem;\n}\n\n/* Info Text */\n.proofcaptcha-info-text {\n  text-align: center;\n  font-size: 0.875rem;\n  color: hsl(var(--pc-muted-foreground));\n  margin: 1rem 0;\n}\n\n/* ==========================================\n   Animations\n   ========================================== */\n@keyframes pc-fadeIn {\n  from {\n    opacity: 0;\n  }\n  to {\n    opacity: 1;\n  }\n}\n\n@keyframes pc-slideUp {\n  from {\n    opacity: 0;\n    transform: translateY(1.25rem) scale(0.95);\n  }\n  to {\n    opacity: 1;\n    transform: translateY(0) scale(1);\n  }\n}\n\n@keyframes pc-spin {\n  from {\n    transform: rotate(0deg);\n  }\n  to {\n    transform: rotate(360deg);\n  }\n}\n\n.proofcaptcha-spin {\n  animation: pc-spin 1s linear infinite;\n}\n\n/* ==========================================\n   Utility Classes\n   ========================================== */\n.proofcaptcha-hidden {\n  display: none !important;\n}\n\n.proofcaptcha-flex {\n  display: flex;\n}\n\n.proofcaptcha-items-center {\n  align-items: center;\n}\n\n.proofcaptcha-justify-between {\n  justify-content: space-between;\n}\n\n.proofcaptcha-gap-3 {\n  gap: 0.75rem;\n}\n\n.proofcaptcha-p-6 {\n  padding: 1.5rem;\n}\n\n/* ==========================================\n   Responsive Design - Mobile First\n   ========================================== */\n\n/* Mobile phones (< 640px) */\n@media (max-width: 639px) {\n  .proofcaptcha-widget {\n    min-width: 100%;\n    max-width: 100%;\n    border-radius: 0.375rem;\n  }\n  \n  .proofcaptcha-modal {\n    margin: 0.75rem;\n    max-width: calc(100vw - 1.5rem);\n  }\n  \n  .proofcaptcha-content {\n    padding: 0.625rem;\n  }\n  \n  .proofcaptcha-inner {\n    gap: 0.5rem;\n  }\n  \n  .proofcaptcha-text {\n    font-size: 0.8125rem;\n  }\n  \n  .proofcaptcha-logo {\n    width: 2rem;\n    height: 2rem;\n  }\n  \n  .proofcaptcha-logo svg {\n    width: 1.25rem;\n    height: 1.25rem;\n  }\n  \n  .proofcaptcha-grid-container,\n  .proofcaptcha-jigsaw-container {\n    padding: 0.75rem;\n    gap: 0.5rem;\n  }\n  \n  .proofcaptcha-grid-cell {\n    font-size: 1.5rem;\n  }\n  \n  .proofcaptcha-jigsaw-piece {\n    height: 5rem;\n  }\n  \n  .proofcaptcha-challenge-title {\n    font-size: 1rem;\n  }\n  \n  .proofcaptcha-challenge-description {\n    font-size: 0.8125rem;\n  }\n  \n  .proofcaptcha-p-6 {\n    padding: 1rem;\n  }\n  \n  .proofcaptcha-btn-lg {\n    min-height: 2.25rem;\n    padding: 0.5rem 1rem;\n    font-size: 0.8125rem;\n  }\n}\n\n/* Tablets (640px - 1023px) */\n@media (min-width: 640px) and (max-width: 1023px) {\n  .proofcaptcha-widget {\n    max-width: 22rem;\n  }\n  \n  .proofcaptcha-modal {\n    max-width: 28rem;\n  }\n  \n  .proofcaptcha-grid-container,\n  .proofcaptcha-jigsaw-container {\n    padding: 1.25rem;\n  }\n}\n\n/* Desktop (>= 1024px) */\n@media (min-width: 1024px) {\n  .proofcaptcha-widget {\n    max-width: 24rem;\n  }\n  \n  .proofcaptcha-modal {\n    max-width: 31.25rem;\n  }\n  \n  .proofcaptcha-grid-container,\n  .proofcaptcha-jigsaw-container {\n    padding: 2rem;\n  }\n}\n\n/* Landscape orientation on mobile devices */\n@media (max-height: 500px) and (orientation: landscape) {\n  .proofcaptcha-modal {\n    max-height: 90vh;\n    overflow-y: auto;\n  }\n  \n  .proofcaptcha-grid-container,\n  .proofcaptcha-jigsaw-container {\n    padding: 0.75rem;\n  }\n  \n  .proofcaptcha-p-6 {\n    padding: 0.75rem;\n  }\n}\n\n/* ==========================================\n   ANTI-DEBUGGER CHEATER MODE ANIMATIONS\n   Premium quality animations for DevTools detection\n   ========================================== */\n\n/* Cheater Mode Widget Styling */\n.proofcaptcha-cheater-mode {\n  border-color: #ef4444 !important;\n  background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%) !important;\n  box-shadow: \n    0 0 0 3px rgba(239, 68, 68, 0.2),\n    0 10px 30px rgba(239, 68, 68, 0.4),\n    0 0 40px rgba(239, 68, 68, 0.3) !important;\n  animation: pc-alert-glow 2s ease-in-out infinite;\n  /* Allow footer to remain visible when content expands */\n  overflow: visible;\n}\n\n/* Keep content area properly contained */\n.proofcaptcha-cheater-mode .proofcaptcha-content {\n  overflow: hidden;\n}\n\n.dark .proofcaptcha-cheater-mode,\n[data-theme=\"dark\"] .proofcaptcha-cheater-mode {\n  background: linear-gradient(135deg, #7f1d1d 0%, #991b1b 100%) !important;\n}\n\n/* Cracker Icon Container */\n.proofcaptcha-logo.cheater {\n  background: linear-gradient(145deg, #fee2e2, #fca5a5);\n  border-radius: 50%;\n  width: 60px;\n  height: 60px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  box-shadow: \n    0 4px 12px rgba(239, 68, 68, 0.3),\n    inset 0 2px 4px rgba(255, 255, 255, 0.3);\n}\n\n/* Cheater Text Styling */\n.proofcaptcha-cheater-text {\n  font-weight: 900;\n  font-size: 20px;\n  color: #dc2626;\n  text-shadow: \n    2px 2px 4px rgba(0, 0, 0, 0.2),\n    0 0 10px rgba(239, 68, 68, 0.5);\n  letter-spacing: 3px;\n  animation: pc-pulse-intense 1.2s ease-in-out infinite;\n  background: linear-gradient(90deg, #dc2626, #ef4444, #dc2626);\n  background-size: 200% 100%;\n  -webkit-background-clip: text;\n  -webkit-text-fill-color: transparent;\n  background-clip: text;\n}\n\n.proofcaptcha-cheater-subtitle {\n  font-size: 11px;\n  color: #991b1b;\n  margin-top: 4px;\n  font-weight: 700;\n  text-transform: uppercase;\n  letter-spacing: 1px;\n  opacity: 0.9;\n}\n\n/* Warning Icon with Pulse */\n.proofcaptcha-icon-container.cheater {\n  background: linear-gradient(135deg, #fee2e2, #fecaca) !important;\n  border: 2px solid #ef4444 !important;\n  animation: pc-pulse-scale 1.5s ease-in-out infinite;\n  cursor: pointer !important;\n  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n}\n\n.proofcaptcha-icon-container.cheater:hover {\n  transform: scale(1.1);\n  box-shadow: 0 0 20px rgba(239, 68, 68, 0.6);\n}\n\n.proofcaptcha-icon-container.cheater:active {\n  transform: scale(0.95);\n}\n\n/* Police Animation Overlay */\n.proofcaptcha-police-overlay {\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: linear-gradient(135deg, rgba(239, 68, 68, 0.1), rgba(220, 38, 38, 0.15));\n  border-radius: 8px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 1000;\n  overflow: hidden;\n  backdrop-filter: blur(2px);\n}\n\n.police-car {\n  font-size: 36px;\n  position: absolute;\n  left: -60px;\n  animation: pc-slideInPolice 1.8s cubic-bezier(0.68, -0.55, 0.27, 1.55) forwards;\n  filter: drop-shadow(3px 3px 6px rgba(0,0,0,0.4));\n}\n\n.attacker-icon {\n  font-size: 32px;\n  position: absolute;\n  right: 30px;\n  animation: pc-catchAttacker 1.8s cubic-bezier(0.68, -0.55, 0.27, 1.55) forwards;\n  filter: drop-shadow(3px 3px 6px rgba(0,0,0,0.4));\n}\n\n.stop-sign {\n  font-size: 56px;\n  position: absolute;\n  opacity: 0;\n  animation: pc-showStop 1.8s cubic-bezier(0.68, -0.55, 0.27, 1.55) forwards;\n  filter: drop-shadow(0 6px 12px rgba(239, 68, 68, 0.6));\n}\n\n/* Cracker Icon Animations */\n.proofcaptcha-cracker-icon {\n  font-size: 52px;\n  animation: \n    pc-shake 0.6s ease-in-out infinite,\n    pc-rotate3d 3s ease-in-out infinite;\n  filter: drop-shadow(0 5px 10px rgba(239, 68, 68, 0.5));\n  transform-style: preserve-3d;\n  display: inline-block;\n}\n\n/* ==========================================\n   KEYFRAME ANIMATIONS\n   ========================================== */\n\n/* Alert Glow Effect */\n@keyframes pc-alert-glow {\n  0%, 100% {\n    box-shadow: \n      0 0 0 3px rgba(239, 68, 68, 0.2),\n      0 10px 30px rgba(239, 68, 68, 0.4),\n      0 0 40px rgba(239, 68, 68, 0.3);\n  }\n  50% {\n    box-shadow: \n      0 0 0 3px rgba(239, 68, 68, 0.4),\n      0 10px 30px rgba(239, 68, 68, 0.6),\n      0 0 60px rgba(239, 68, 68, 0.5);\n  }\n}\n\n/* Intense Pulse */\n@keyframes pc-pulse-intense {\n  0%, 100% {\n    opacity: 1;\n    transform: scale(1);\n  }\n  50% {\n    opacity: 0.85;\n    transform: scale(1.08);\n  }\n}\n\n/* Scale Pulse */\n@keyframes pc-pulse-scale {\n  0%, 100% {\n    transform: scale(1);\n    box-shadow: 0 2px 8px rgba(239, 68, 68, 0.3);\n  }\n  50% {\n    transform: scale(1.12);\n    box-shadow: 0 4px 16px rgba(239, 68, 68, 0.6);\n  }\n}\n\n/* Shake Animation */\n@keyframes pc-shake {\n  0%, 100% {\n    transform: translateX(0) rotate(0deg);\n  }\n  10%, 30%, 50%, 70%, 90% {\n    transform: translateX(-6px) rotate(-6deg);\n  }\n  20%, 40%, 60%, 80% {\n    transform: translateX(6px) rotate(6deg);\n  }\n}\n\n/* 3D Rotation */\n@keyframes pc-rotate3d {\n  0% {\n    transform: rotateY(0deg) rotateX(0deg);\n  }\n  25% {\n    transform: rotateY(180deg) rotateX(5deg);\n  }\n  50% {\n    transform: rotateY(360deg) rotateX(0deg);\n  }\n  75% {\n    transform: rotateY(180deg) rotateX(-5deg);\n  }\n  100% {\n    transform: rotateY(0deg) rotateX(0deg);\n  }\n}\n\n/* Police Car Slide In */\n@keyframes pc-slideInPolice {\n  0% {\n    left: -60px;\n    transform: scale(0.8) rotate(-10deg);\n    opacity: 0;\n  }\n  30% {\n    opacity: 1;\n  }\n  60% {\n    left: 50%;\n    transform: scale(1.3) translateX(-50%) rotate(5deg);\n  }\n  80% {\n    transform: scale(1.15) translateX(-50%) rotate(-2deg);\n  }\n  100% {\n    left: 50%;\n    transform: scale(1) translateX(-50%) rotate(0deg);\n  }\n}\n\n/* Attacker Being Caught */\n@keyframes pc-catchAttacker {\n  0% {\n    right: 30px;\n    opacity: 1;\n    transform: scale(1) rotate(0deg);\n  }\n  40% {\n    right: 30px;\n    transform: scale(1) rotate(0deg);\n  }\n  50% {\n    right: 50%;\n    opacity: 1;\n    transform: scale(0.9) translateX(50%) rotate(15deg);\n  }\n  70% {\n    right: 50%;\n    opacity: 0.6;\n    transform: scale(0.6) translateX(50%) rotate(90deg);\n  }\n  85% {\n    right: 50%;\n    opacity: 0.2;\n    transform: scale(0.3) translateX(50%) rotate(180deg);\n  }\n  100% {\n    right: 50%;\n    opacity: 0;\n    transform: scale(0) translateX(50%) rotate(270deg);\n  }\n}\n\n/* Stop Sign Appear */\n@keyframes pc-showStop {\n  0% {\n    opacity: 0;\n    transform: scale(0) rotate(-180deg);\n  }\n  60% {\n    opacity: 0;\n  }\n  70% {\n    opacity: 1;\n    transform: scale(1.6) rotate(15deg);\n  }\n  80% {\n    transform: scale(1.3) rotate(-10deg);\n  }\n  90% {\n    transform: scale(1.15) rotate(5deg);\n  }\n  100% {\n    opacity: 1;\n    transform: scale(1) rotate(0deg);\n  }\n}\n\n/* Gradient Animation for Text */\n@keyframes pc-gradient-shift {\n  0% {\n    background-position: 0% 50%;\n  }\n  50% {\n    background-position: 100% 50%;\n  }\n  100% {\n    background-position: 0% 50%;\n  }\n}\n\n/* Modern Success Animations */\n@keyframes proofcaptcha-scale-in {\n  0% {\n    opacity: 0;\n    transform: scale(0.5);\n  }\n  50% {\n    transform: scale(1.05);\n  }\n  100% {\n    opacity: 1;\n    transform: scale(1);\n  }\n}\n\n@keyframes proofcaptcha-fade-in {\n  0% {\n    opacity: 0;\n    transform: translateY(-8px);\n  }\n  100% {\n    opacity: 1;\n    transform: translateY(0);\n  }\n}\n\n/* ==========================================\n   MODERN SUCCESS CELEBRATION STYLES\n   ========================================== */\n\n/* Success Celebration Container */\n.proofcaptcha-success-celebration {\n  position: relative;\n  padding: 3rem 2rem;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  gap: 1.5rem;\n  background: linear-gradient(135deg, \n    hsl(var(--pc-success-bg)) 0%, \n    hsl(142 76% 98%) 50%,\n    hsl(var(--pc-success-bg)) 100%\n  );\n  border-radius: 1rem;\n  overflow: hidden;\n  animation: pc-success-slide-in 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);\n}\n\n.dark .proofcaptcha-success-celebration,\n[data-theme=\"dark\"] .proofcaptcha-success-celebration {\n  background: linear-gradient(135deg, \n    hsl(142 76% 15%) 0%, \n    hsl(142 76% 18%) 50%,\n    hsl(142 76% 15%) 100%\n  );\n}\n\n/* Sparkles Animation */\n.proofcaptcha-success-sparkles {\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  pointer-events: none;\n  overflow: hidden;\n}\n\n.sparkle {\n  position: absolute;\n  font-size: 1.5rem;\n  opacity: 0;\n  animation: pc-sparkle-float 2s ease-in-out;\n}\n\n.sparkle-1 {\n  top: 20%;\n  left: 15%;\n  animation-delay: 0.1s;\n}\n\n.sparkle-2 {\n  top: 15%;\n  right: 20%;\n  animation-delay: 0.3s;\n}\n\n.sparkle-3 {\n  top: 60%;\n  left: 10%;\n  animation-delay: 0.5s;\n}\n\n.sparkle-4 {\n  top: 70%;\n  right: 15%;\n  animation-delay: 0.2s;\n}\n\n.sparkle-5 {\n  top: 40%;\n  left: 25%;\n  animation-delay: 0.4s;\n}\n\n.sparkle-6 {\n  top: 50%;\n  right: 30%;\n  animation-delay: 0.6s;\n}\n\n/* Success Icon Wrapper */\n.proofcaptcha-success-icon-wrapper {\n  position: relative;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 7rem;\n  height: 7rem;\n  z-index: 1;\n}\n\n.proofcaptcha-success-icon {\n  position: relative;\n  z-index: 3;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 5rem;\n  height: 5rem;\n  background: linear-gradient(135deg, #10b981, #059669);\n  border-radius: 50%;\n  box-shadow: \n    0 10px 25px rgba(16, 185, 129, 0.3),\n    0 0 0 8px hsl(var(--pc-success-bg)),\n    0 0 0 12px rgba(16, 185, 129, 0.1);\n  animation: pc-success-icon-bounce 0.8s cubic-bezier(0.34, 1.56, 0.64, 1);\n}\n\n.dark .proofcaptcha-success-icon,\n[data-theme=\"dark\"] .proofcaptcha-success-icon {\n  box-shadow: \n    0 10px 25px rgba(16, 185, 129, 0.4),\n    0 0 0 8px hsl(142 76% 15%),\n    0 0 0 12px rgba(16, 185, 129, 0.15);\n}\n\n.proofcaptcha-success-icon svg {\n  width: 2.5rem;\n  height: 2.5rem;\n  color: white;\n  stroke-width: 3;\n  filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.2));\n}\n\n/* Animated Rings */\n.proofcaptcha-success-ring,\n.proofcaptcha-success-ring-2 {\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  transform: translate(-50%, -50%);\n  width: 5rem;\n  height: 5rem;\n  border: 3px solid hsl(var(--pc-success));\n  border-radius: 50%;\n  opacity: 0.6;\n  animation: pc-success-ring-expand 1.5s cubic-bezier(0.34, 1.56, 0.64, 1) infinite;\n}\n\n.proofcaptcha-success-ring-2 {\n  animation-delay: 0.75s;\n}\n\n/* Success Content */\n.proofcaptcha-success-content {\n  text-align: center;\n  z-index: 1;\n}\n\n.proofcaptcha-success-title {\n  font-size: 2rem;\n  font-weight: 800;\n  margin: 0 0 0.5rem 0;\n  background: linear-gradient(135deg, #059669, #10b981, #34d399);\n  background-size: 200% 200%;\n  -webkit-background-clip: text;\n  -webkit-text-fill-color: transparent;\n  background-clip: text;\n  animation: pc-gradient-flow 3s ease infinite;\n  letter-spacing: -0.02em;\n  text-shadow: 0 2px 10px rgba(16, 185, 129, 0.3);\n}\n\n.proofcaptcha-success-message {\n  font-size: 1rem;\n  color: hsl(var(--pc-success));\n  margin: 0;\n  font-weight: 600;\n  opacity: 0;\n  animation: pc-fade-in-up 0.6s ease forwards;\n  animation-delay: 0.3s;\n}\n\n.dark .proofcaptcha-success-message,\n[data-theme=\"dark\"] .proofcaptcha-success-message {\n  color: #6ee7b7;\n}\n\n/* ==========================================\n   SUCCESS ANIMATIONS\n   ========================================== */\n\n@keyframes pc-success-slide-in {\n  0% {\n    opacity: 0;\n    transform: scale(0.8) translateY(20px);\n  }\n  100% {\n    opacity: 1;\n    transform: scale(1) translateY(0);\n  }\n}\n\n@keyframes pc-sparkle-float {\n  0% {\n    opacity: 0;\n    transform: translateY(0) scale(0) rotate(0deg);\n  }\n  20% {\n    opacity: 1;\n    transform: translateY(-20px) scale(1) rotate(180deg);\n  }\n  80% {\n    opacity: 1;\n    transform: translateY(-60px) scale(1.2) rotate(360deg);\n  }\n  100% {\n    opacity: 0;\n    transform: translateY(-80px) scale(0.8) rotate(540deg);\n  }\n}\n\n@keyframes pc-success-icon-bounce {\n  0% {\n    opacity: 0;\n    transform: scale(0);\n  }\n  50% {\n    opacity: 1;\n    transform: scale(1.15);\n  }\n  70% {\n    transform: scale(0.95);\n  }\n  100% {\n    opacity: 1;\n    transform: scale(1);\n  }\n}\n\n@keyframes pc-success-ring-expand {\n  0% {\n    width: 5rem;\n    height: 5rem;\n    opacity: 0.6;\n  }\n  100% {\n    width: 9rem;\n    height: 9rem;\n    opacity: 0;\n  }\n}\n\n@keyframes pc-gradient-flow {\n  0%, 100% {\n    background-position: 0% 50%;\n  }\n  50% {\n    background-position: 100% 50%;\n  }\n}\n\n@keyframes pc-fade-in-up {\n  0% {\n    opacity: 0;\n    transform: translateY(10px);\n  }\n  100% {\n    opacity: 1;\n    transform: translateY(0);\n  }\n}\n\n/* ==========================================\n   Captcha Slide Transition Animations\n   ========================================== */\n\n/* Slide out to left when replacing captcha */\n@keyframes pc-slide-out-left {\n  0% {\n    transform: translateX(0);\n    opacity: 1;\n  }\n  100% {\n    transform: translateX(-100%);\n    opacity: 0;\n  }\n}\n\n/* Slide in from right for new captcha */\n@keyframes pc-slide-in-right {\n  0% {\n    transform: translateX(100%);\n    opacity: 0;\n  }\n  100% {\n    transform: translateX(0);\n    opacity: 1;\n  }\n}\n\n/* Animation classes */\n.proofcaptcha-slide-out {\n  animation: pc-slide-out-left 0.4s cubic-bezier(0.4, 0.0, 0.2, 1) forwards;\n}\n\n.proofcaptcha-slide-in {\n  animation: pc-slide-in-right 0.4s cubic-bezier(0.4, 0.0, 0.2, 1) forwards;\n}\n\n/* Responsive adjustments for success celebration */\n@media (max-width: 639px) {\n  .proofcaptcha-success-celebration {\n    padding: 2rem 1.5rem;\n    gap: 1rem;\n  }\n  \n  .proofcaptcha-success-icon-wrapper {\n    width: 5rem;\n    height: 5rem;\n  }\n  \n  .proofcaptcha-success-icon {\n    width: 3.5rem;\n    height: 3.5rem;\n  }\n  \n  .proofcaptcha-success-icon svg {\n    width: 2rem;\n    height: 2rem;\n  }\n  \n  .proofcaptcha-success-title {\n    font-size: 1.5rem;\n  }\n  \n  .proofcaptcha-success-message {\n    font-size: 0.875rem;\n  }\n  \n  .sparkle {\n    font-size: 1.25rem;\n  }\n}\n","size_bytes":29209},"server/behavioral-analysis.ts":{"content":"import type { Request } from \"express\";\n\nexport interface BehavioralPattern {\n  isBot: boolean;\n  confidence: number;\n  patterns: string[];\n}\n\ninterface RequestHistory {\n  timestamps: number[];\n  userAgents: Set<string>;\n  endpoints: string[];\n}\n\nconst ipHistory = new Map<string, RequestHistory>();\n\nconst MAX_HISTORY_SIZE = 100;\nconst HISTORY_WINDOW_MS = 60 * 60 * 1000;\n\nfunction getClientIP(req: Request): string {\n  return (\n    (req.headers[\"x-forwarded-for\"] as string)?.split(\",\")[0].trim() ||\n    (req.headers[\"x-real-ip\"] as string) ||\n    req.socket.remoteAddress ||\n    \"unknown\"\n  );\n}\n\nexport function analyzeBehavior(req: Request): BehavioralPattern {\n  const patterns: string[] = [];\n  let confidence = 0;\n\n  const clientIP = getClientIP(req);\n  const now = Date.now();\n  const userAgent = req.headers[\"user-agent\"] || \"\";\n  const endpoint = req.path;\n\n  if (!ipHistory.has(clientIP)) {\n    ipHistory.set(clientIP, {\n      timestamps: [],\n      userAgents: new Set(),\n      endpoints: [],\n    });\n  }\n\n  const history = ipHistory.get(clientIP)!;\n\n  history.timestamps = history.timestamps.filter(t => now - t < HISTORY_WINDOW_MS);\n  history.timestamps.push(now);\n  history.userAgents.add(userAgent);\n  history.endpoints.push(endpoint);\n\n  if (history.timestamps.length > MAX_HISTORY_SIZE) {\n    history.timestamps = history.timestamps.slice(-MAX_HISTORY_SIZE);\n    history.endpoints = history.endpoints.slice(-MAX_HISTORY_SIZE);\n  }\n\n  if (history.timestamps.length >= 5) {\n    const intervals: number[] = [];\n    for (let i = 1; i < history.timestamps.length; i++) {\n      intervals.push(history.timestamps[i] - history.timestamps[i - 1]);\n    }\n\n    const avgInterval = intervals.reduce((a, b) => a + b, 0) / intervals.length;\n    const variance = intervals.reduce((sum, interval) => {\n      return sum + Math.pow(interval - avgInterval, 2);\n    }, 0) / intervals.length;\n    const stdDev = Math.sqrt(variance);\n\n    if (stdDev < 100 && avgInterval < 2000) {\n      patterns.push(\"perfectly-timed-requests\");\n      confidence += 30;\n    }\n\n    if (avgInterval < 500) {\n      patterns.push(\"too-fast-requests\");\n      confidence += 25;\n    }\n  }\n\n  if (history.userAgents.size > 3) {\n    patterns.push(\"multiple-user-agents\");\n    confidence += 20;\n  }\n\n  const recentRequests = history.timestamps.filter(t => now - t < 10000);\n  if (recentRequests.length > 10) {\n    patterns.push(\"burst-pattern\");\n    confidence += 25;\n  }\n\n  // Extract behavioral telemetry from request body (sent from frontend)\n  const mouseMovements = (req.body as any)?.mouseMovements;\n  const keyboardEvents = (req.body as any)?.keyboardEvents;\n  const submissionTime = (req.body as any)?.submissionTime;\n  \n  // Debug logging\n  if (endpoint.includes(\"/challenge\") || endpoint.includes(\"/verify\")) {\n    console.log(`[BEHAVIORAL DEBUG] Endpoint: ${endpoint}, Mouse: ${mouseMovements}, Keyboard: ${keyboardEvents}, Time: ${submissionTime}`);\n  }\n  \n  // Analyze behavioral data for bot detection\n  if (typeof mouseMovements === 'number' && typeof keyboardEvents === 'number' && typeof submissionTime === 'number') {\n    // Bot pattern: Too fast submission (< 500ms is suspicious)\n    if (submissionTime < 500) {\n      patterns.push(\"suspiciously-fast-submission\");\n      confidence += 30;\n    }\n    \n    // Bot pattern: No interaction (0 mouse and 0 keyboard)\n    if (mouseMovements === 0 && keyboardEvents === 0) {\n      patterns.push(\"no-human-interaction\");\n      confidence += 40;\n    }\n    \n    // Bot pattern: Very low interaction for the time spent\n    const interactionRate = (mouseMovements + keyboardEvents) / (submissionTime / 1000); // interactions per second\n    if (interactionRate < 0.5 && submissionTime > 2000) {\n      patterns.push(\"low-interaction-rate\");\n      confidence += 20;\n    }\n    \n    // Good sign: Natural interaction pattern\n    if (mouseMovements > 10 && keyboardEvents > 3 && submissionTime > 1000) {\n      confidence = Math.max(0, confidence - 25); // Reduce suspicion\n    }\n  } else if (endpoint.includes(\"/verify\") || endpoint.includes(\"/challenge\")) {\n    // Missing behavioral data is suspicious for verify/challenge endpoints\n    patterns.push(\"missing-behavioral-data\");\n    confidence += 15;\n  }\n\n  const isBot = confidence >= 40;\n\n  return {\n    isBot,\n    confidence,\n    patterns,\n  };\n}\n\nexport function clearOldHistory(): void {\n  const now = Date.now();\n  for (const [ip, history] of Array.from(ipHistory.entries())) {\n    history.timestamps = history.timestamps.filter((t: number) => now - t < HISTORY_WINDOW_MS);\n    if (history.timestamps.length === 0) {\n      ipHistory.delete(ip);\n    }\n  }\n}\n\nsetInterval(clearOldHistory, 5 * 60 * 1000);\n","size_bytes":4681},"server/risk-scoring.ts":{"content":"import type { Request } from \"express\";\nimport type { DeviceFingerprint } from \"./device-fingerprint\";\nimport type { AutomationCheckResult } from \"./automation-detector\";\n\nexport interface RiskAssessment {\n  riskLevel: \"low\" | \"medium\" | \"high\" | \"critical\";\n  riskScore: number;\n  recommendedDifficulty: number;\n  factors: string[];\n  shouldChallenge: boolean;\n}\n\nexport interface RiskFactors {\n  ipReputation: number;\n  automationScore: number;\n  deviceScore: number;\n  requestPatterns: number;\n  timeToSolve?: number;\n}\n\nexport function calculateRiskScore(\n  req: Request,\n  automationCheck: AutomationCheckResult,\n  deviceFingerprint: DeviceFingerprint,\n  ipBlockCount: number = 0,\n  previousFailures: number = 0\n): RiskAssessment {\n  const factors: string[] = [];\n  let totalScore = 0;\n\n  const automationScore = automationCheck.score;\n  if (automationScore > 0) {\n    totalScore += automationScore;\n    factors.push(`automation-detection: ${automationScore}`);\n  }\n\n  const deviceScore = deviceFingerprint.score;\n  if (deviceScore > 0) {\n    totalScore += deviceScore;\n    factors.push(`device-fingerprint: ${deviceScore}`);\n  }\n\n  const ipReputationScore = ipBlockCount * 10 + previousFailures * 5;\n  if (ipReputationScore > 0) {\n    totalScore += ipReputationScore;\n    factors.push(`ip-reputation: ${ipReputationScore}`);\n  }\n\n  const requestFrequency = (req as any).rateLimit?.current || 0;\n  if (requestFrequency > 20) {\n    const frequencyScore = Math.min((requestFrequency - 20) * 2, 30);\n    totalScore += frequencyScore;\n    factors.push(`high-frequency: ${frequencyScore}`);\n  }\n\n  const hasSecFetchHeaders = req.headers[\"sec-fetch-site\"] !== undefined;\n  if (!hasSecFetchHeaders) {\n    totalScore += 5;\n    factors.push(\"missing-sec-fetch-headers: 5\");\n  }\n\n  const hasModernBrowserFeatures = \n    req.headers[\"sec-ch-ua\"] !== undefined ||\n    req.headers[\"sec-fetch-dest\"] !== undefined;\n  \n  if (!hasModernBrowserFeatures) {\n    totalScore += 10;\n    factors.push(\"old-browser-or-bot: 10\");\n  }\n\n  let riskLevel: \"low\" | \"medium\" | \"high\" | \"critical\";\n  let recommendedDifficulty: number;\n  let shouldChallenge: boolean;\n\n  if (totalScore >= 80) {\n    riskLevel = \"critical\";\n    recommendedDifficulty = 7;\n    shouldChallenge = true;\n  } else if (totalScore >= 50) {\n    riskLevel = \"high\";\n    recommendedDifficulty = 6;\n    shouldChallenge = true;\n  } else if (totalScore >= 25) {\n    riskLevel = \"medium\";\n    recommendedDifficulty = 5;\n    shouldChallenge = true;\n  } else {\n    riskLevel = \"low\";\n    recommendedDifficulty = 4;\n    shouldChallenge = false;\n  }\n\n  return {\n    riskLevel,\n    riskScore: totalScore,\n    recommendedDifficulty,\n    factors,\n    shouldChallenge,\n  };\n}\n\nexport function calculateAdaptiveDifficulty(\n  baselineDifficulty: number,\n  riskAssessment: RiskAssessment,\n  solveTimeMs?: number\n): number {\n  let difficulty = Math.max(baselineDifficulty, riskAssessment.recommendedDifficulty);\n\n  if (solveTimeMs !== undefined) {\n    if (solveTimeMs < 500) {\n      difficulty = Math.min(difficulty + 2, 8);\n    } else if (solveTimeMs < 1000) {\n      difficulty = Math.min(difficulty + 1, 8);\n    }\n  }\n\n  return Math.min(Math.max(difficulty, 4), 8);\n}\n","size_bytes":3199},"client/src/components/ui/aspect-ratio.tsx":{"content":"import * as AspectRatioPrimitive from \"@radix-ui/react-aspect-ratio\"\n\nconst AspectRatio = AspectRatioPrimitive.Root\n\nexport { AspectRatio }\n","size_bytes":140},"client/src/components/ui/form.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport {\n  Controller,\n  FormProvider,\n  useFormContext,\n  type ControllerProps,\n  type FieldPath,\n  type FieldValues,\n} from \"react-hook-form\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Label } from \"@/components/ui/label\"\n\nconst Form = FormProvider\n\ntype FormFieldContextValue<\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n> = {\n  name: TName\n}\n\nconst FormFieldContext = React.createContext<FormFieldContextValue>(\n  {} as FormFieldContextValue\n)\n\nconst FormField = <\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n>({\n  ...props\n}: ControllerProps<TFieldValues, TName>) => {\n  return (\n    <FormFieldContext.Provider value={{ name: props.name }}>\n      <Controller {...props} />\n    </FormFieldContext.Provider>\n  )\n}\n\nconst useFormField = () => {\n  const fieldContext = React.useContext(FormFieldContext)\n  const itemContext = React.useContext(FormItemContext)\n  const { getFieldState, formState } = useFormContext()\n\n  const fieldState = getFieldState(fieldContext.name, formState)\n\n  if (!fieldContext) {\n    throw new Error(\"useFormField should be used within <FormField>\")\n  }\n\n  const { id } = itemContext\n\n  return {\n    id,\n    name: fieldContext.name,\n    formItemId: `${id}-form-item`,\n    formDescriptionId: `${id}-form-item-description`,\n    formMessageId: `${id}-form-item-message`,\n    ...fieldState,\n  }\n}\n\ntype FormItemContextValue = {\n  id: string\n}\n\nconst FormItemContext = React.createContext<FormItemContextValue>(\n  {} as FormItemContextValue\n)\n\nconst FormItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const id = React.useId()\n\n  return (\n    <FormItemContext.Provider value={{ id }}>\n      <div ref={ref} className={cn(\"space-y-2\", className)} {...props} />\n    </FormItemContext.Provider>\n  )\n})\nFormItem.displayName = \"FormItem\"\n\nconst FormLabel = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  const { error, formItemId } = useFormField()\n\n  return (\n    <Label\n      ref={ref}\n      className={cn(error && \"text-destructive\", className)}\n      htmlFor={formItemId}\n      {...props}\n    />\n  )\n})\nFormLabel.displayName = \"FormLabel\"\n\nconst FormControl = React.forwardRef<\n  React.ElementRef<typeof Slot>,\n  React.ComponentPropsWithoutRef<typeof Slot>\n>(({ ...props }, ref) => {\n  const { error, formItemId, formDescriptionId, formMessageId } = useFormField()\n\n  return (\n    <Slot\n      ref={ref}\n      id={formItemId}\n      aria-describedby={\n        !error\n          ? `${formDescriptionId}`\n          : `${formDescriptionId} ${formMessageId}`\n      }\n      aria-invalid={!!error}\n      {...props}\n    />\n  )\n})\nFormControl.displayName = \"FormControl\"\n\nconst FormDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => {\n  const { formDescriptionId } = useFormField()\n\n  return (\n    <p\n      ref={ref}\n      id={formDescriptionId}\n      className={cn(\"text-sm text-muted-foreground\", className)}\n      {...props}\n    />\n  )\n})\nFormDescription.displayName = \"FormDescription\"\n\nconst FormMessage = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, children, ...props }, ref) => {\n  const { error, formMessageId } = useFormField()\n  const body = error ? String(error?.message ?? \"\") : children\n\n  if (!body) {\n    return null\n  }\n\n  return (\n    <p\n      ref={ref}\n      id={formMessageId}\n      className={cn(\"text-sm font-medium text-destructive\", className)}\n      {...props}\n    >\n      {body}\n    </p>\n  )\n})\nFormMessage.displayName = \"FormMessage\"\n\nexport {\n  useFormField,\n  Form,\n  FormItem,\n  FormLabel,\n  FormControl,\n  FormDescription,\n  FormMessage,\n  FormField,\n}\n","size_bytes":4120},"server/public/php/backend.php":{"content":"<?php\n/**\n * ProofCaptcha PHP Backend Example\n * \n * File ini mendemonstrasikan cara memvalidasi token captcha\n * dari frontend ke server Replit menggunakan PHP\n */\n\n// Set header untuk JSON response\nheader('Content-Type: application/json');\n\n// ============================================\n// KONFIGURASI - GANTI DENGAN NILAI ANDA!\n// ============================================\n\n// Domain Replit ProofCaptcha Server (tanpa https://)\n// Server ini yang akan memvalidasi token captcha\ndefine('REPLIT_DOMAIN', 'fc9a75ad-79f4-4da3-a6eb-c6432598fa48-00-oske09t7hckq.sisko.replit.dev');\n\n// Secret Key dari dashboard ProofCaptcha (RAHASIA!)\n// ‚ö†Ô∏è PENTING: Ganti dengan Secret Key Anda!\n// Best practice: Gunakan environment variable untuk production\n// define('API_SECRET_KEY', getenv('CAPTCHA_SECRET_KEY'));\ndefine('API_SECRET_KEY', 'YOUR_SECRET_KEY_HERE');\n\n// ============================================\n// FUNGSI VALIDASI CAPTCHA\n// ============================================\n\n/**\n * Validasi token captcha ke server Replit\n * \n * @param string $token Token dari frontend\n * @return array Response dari server\n */\nfunction validateCaptcha($token) {\n    $url = 'https://' . REPLIT_DOMAIN . '/api/captcha/verify-token';\n    \n    // Prepare request data\n    $data = json_encode([\n        'token' => $token\n    ]);\n    \n    // Initialize cURL\n    $ch = curl_init($url);\n    \n    // Set cURL options\n    curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);\n    curl_setopt($ch, CURLOPT_POST, true);\n    curl_setopt($ch, CURLOPT_POSTFIELDS, $data);\n    curl_setopt($ch, CURLOPT_HTTPHEADER, [\n        'Content-Type: application/json',\n        'Authorization: Bearer ' . API_SECRET_KEY\n    ]);\n    curl_setopt($ch, CURLOPT_TIMEOUT, 10);\n    \n    // Execute request\n    $response = curl_exec($ch);\n    $httpCode = curl_getinfo($ch, CURLINFO_HTTP_CODE);\n    $error = curl_error($ch);\n    \n    curl_close($ch);\n    \n    // Check for cURL errors\n    if ($error) {\n        return [\n            'success' => false,\n            'error' => 'cURL Error: ' . $error\n        ];\n    }\n    \n    // Check HTTP response code\n    if ($httpCode !== 200) {\n        return [\n            'success' => false,\n            'error' => 'HTTP Error: ' . $httpCode,\n            'response' => $response\n        ];\n    }\n    \n    // Parse JSON response\n    $result = json_decode($response, true);\n    \n    if (json_last_error() !== JSON_ERROR_NONE) {\n        return [\n            'success' => false,\n            'error' => 'JSON Parse Error: ' . json_last_error_msg()\n        ];\n    }\n    \n    return $result;\n}\n\n// ============================================\n// HANDLE REQUEST\n// ============================================\n\nif ($_SERVER['REQUEST_METHOD'] === 'POST') {\n    // Get form data\n    $name = $_POST['name'] ?? '';\n    $email = $_POST['email'] ?? '';\n    $captchaToken = $_POST['captcha_token'] ?? '';\n    \n    // Validate required fields\n    if (empty($name) || empty($email) || empty($captchaToken)) {\n        echo json_encode([\n            'success' => false,\n            'message' => 'Semua field harus diisi dan captcha harus diselesaikan'\n        ]);\n        exit;\n    }\n    \n    // Validate email format\n    if (!filter_var($email, FILTER_VALIDATE_EMAIL)) {\n        echo json_encode([\n            'success' => false,\n            'message' => 'Format email tidak valid'\n        ]);\n        exit;\n    }\n    \n    // ============================================\n    // VALIDASI CAPTCHA (PENTING!)\n    // ============================================\n    \n    $captchaResult = validateCaptcha($captchaToken);\n    \n    if (!$captchaResult['success']) {\n        // Log error untuk debugging\n        error_log('Captcha validation failed: ' . json_encode($captchaResult));\n        \n        echo json_encode([\n            'success' => false,\n            'message' => 'Verifikasi CAPTCHA gagal. Silakan coba lagi.',\n            'error' => $captchaResult['error'] ?? 'Unknown error',\n            'debug' => $captchaResult // Hanya untuk development\n        ]);\n        exit;\n    }\n    \n    // ============================================\n    // PROSES REGISTRASI\n    // (Captcha sudah valid)\n    // ============================================\n    \n    // Di sini Anda bisa:\n    // 1. Simpan ke database\n    // 2. Kirim email verifikasi\n    // 3. Create user session\n    // 4. dll\n    \n    // Contoh: Simpan ke database (pseudo-code)\n    /*\n    try {\n        $pdo = new PDO('mysql:host=localhost;dbname=mydb', 'username', 'password');\n        $stmt = $pdo->prepare('INSERT INTO users (name, email) VALUES (?, ?)');\n        $stmt->execute([$name, $email]);\n        $userId = $pdo->lastInsertId();\n    } catch (PDOException $e) {\n        echo json_encode([\n            'success' => false,\n            'message' => 'Database error: ' . $e->getMessage()\n        ]);\n        exit;\n    }\n    */\n    \n    // Log successful registration\n    error_log(\"New registration: $name ($email) - Captcha verified\");\n    \n    // Return success response\n    echo json_encode([\n        'success' => true,\n        'message' => 'Registrasi berhasil! Captcha terverifikasi.',\n        'data' => [\n            'name' => htmlspecialchars($name),\n            'email' => htmlspecialchars($email),\n            'captcha_verified' => true,\n            'captcha_data' => [\n                'domain' => $captchaResult['data']['domain'] ?? 'unknown',\n                'type' => $captchaResult['data']['type'] ?? 'unknown',\n                'timestamp' => date('Y-m-d H:i:s')\n            ]\n        ]\n    ]);\n    \n} else {\n    // Method not allowed\n    http_response_code(405);\n    echo json_encode([\n        'success' => false,\n        'message' => 'Method not allowed. Use POST.'\n    ]);\n}\n?>\n","size_bytes":5729},"client/src/lib/encryption.ts":{"content":"/**\n * Client-side encryption library for end-to-end challenge/solution protection\n * \n * Architecture:\n * 1. ECDH handshake with server establishes session key\n * 2. HKDF derives per-challenge child keys from master\n * 3. AES-256-GCM encrypts/decrypts payloads\n * \n * Features:\n * - Web Crypto API (ECDH P-256, HKDF, AES-GCM)\n * - Session caching with automatic expiry\n * - Automatic handshake retry on expiration\n * - Graceful fallback to plaintext if encryption unavailable\n */\n\nexport interface EncryptedPayload {\n  ciphertext: string; // base64\n  iv: string; // base64\n  tag: string; // base64\n}\n\nexport interface HandshakeResponse {\n  serverPublicKey: string; // base64\n  timestamp: number;\n  expiresIn: number; // seconds\n  nonce: string;\n  signature: string;\n}\n\nexport interface SessionInfo {\n  masterKey: CryptoKey;\n  serverPublicKey: ArrayBuffer;\n  clientPublicKey: ArrayBuffer;\n  clientPrivateKey: CryptoKey;\n  timestamp: number;\n  expiresAt: number;\n  nonce: string;\n}\n\nlet currentSession: SessionInfo | null = null;\n\n/**\n * Check if Web Crypto API is available\n */\nexport function isEncryptionAvailable(): boolean {\n  return typeof crypto !== 'undefined' && \n         typeof crypto.subtle !== 'undefined' &&\n         typeof crypto.getRandomValues !== 'undefined';\n}\n\n/**\n * Generate client ECDH key pair using P-256 curve\n * Note: Web Crypto doesn't support X25519, so we use P-256 (secp256r1)\n */\nasync function generateClientKeyPair(): Promise<{ publicKey: CryptoKey; privateKey: CryptoKey }> {\n  const keyPair = await crypto.subtle.generateKey(\n    {\n      name: 'ECDH',\n      namedCurve: 'P-256', // Web Crypto standard curve\n    },\n    true, // extractable\n    ['deriveKey', 'deriveBits']\n  );\n\n  return keyPair;\n}\n\n/**\n * Export public key to raw format for transmission\n */\nasync function exportPublicKey(publicKey: CryptoKey): Promise<ArrayBuffer> {\n  return await crypto.subtle.exportKey('raw', publicKey);\n}\n\n/**\n * Import server's public key from raw format\n */\nasync function importServerPublicKey(rawKey: ArrayBuffer): Promise<CryptoKey> {\n  return await crypto.subtle.importKey(\n    'raw',\n    rawKey,\n    {\n      name: 'ECDH',\n      namedCurve: 'P-256',\n    },\n    true,\n    []\n  );\n}\n\n/**\n * Derive shared secret using ECDH\n */\nasync function deriveSharedSecret(\n  clientPrivateKey: CryptoKey,\n  serverPublicKey: CryptoKey\n): Promise<ArrayBuffer> {\n  return await crypto.subtle.deriveBits(\n    {\n      name: 'ECDH',\n      public: serverPublicKey,\n    },\n    clientPrivateKey,\n    256 // 256 bits\n  );\n}\n\n/**\n * Derive master session key from ECDH shared secret using HKDF\n * Binds server public key + nonce to prevent small-subgroup attacks\n */\nasync function deriveMasterKey(\n  sharedSecret: ArrayBuffer,\n  serverPublicKey: ArrayBuffer,\n  serverNonce: string,\n  info: string = 'captcha-session-v1'\n): Promise<CryptoKey> {\n  // Create salt from server public key + nonce\n  const encoder = new TextEncoder();\n  const nonceBytes = encoder.encode(serverNonce);\n  const salt = new Uint8Array(serverPublicKey.byteLength + nonceBytes.length);\n  salt.set(new Uint8Array(serverPublicKey), 0);\n  salt.set(nonceBytes, serverPublicKey.byteLength);\n\n  // Import shared secret as HKDF key material\n  const baseKey = await crypto.subtle.importKey(\n    'raw',\n    sharedSecret,\n    'HKDF',\n    false,\n    ['deriveKey']\n  );\n\n  // Derive master key using HKDF\n  const masterKey = await crypto.subtle.deriveKey(\n    {\n      name: 'HKDF',\n      hash: 'SHA-256',\n      salt: salt,\n      info: encoder.encode(info),\n    },\n    baseKey,\n    {\n      name: 'AES-GCM',\n      length: 256,\n    },\n    true, // MUST be extractable for child key derivation\n    ['encrypt', 'decrypt']\n  );\n\n  return masterKey;\n}\n\n/**\n * Derive per-challenge child key from master session key using HKDF\n */\nasync function deriveChildKey(\n  masterKey: CryptoKey,\n  challengeId: string,\n  direction: 'encrypt' | 'decrypt'\n): Promise<CryptoKey> {\n  const encoder = new TextEncoder();\n  \n  // Hash the challenge ID to ensure it's always short (64 hex chars)\n  // This prevents HKDF info parameter from exceeding 1024 byte limit\n  const challengeIdBuffer = encoder.encode(challengeId);\n  const hashBuffer = await crypto.subtle.digest('SHA-256', challengeIdBuffer);\n  const hashArray = Array.from(new Uint8Array(hashBuffer));\n  const challengeIdHash = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');\n  \n  const info = `captcha-challenge-v1:${direction}:${challengeIdHash}`;\n\n  // Export master key to derive child\n  const masterKeyBits = await crypto.subtle.exportKey('raw', masterKey);\n  \n  // Import as HKDF key\n  const hkdfKey = await crypto.subtle.importKey(\n    'raw',\n    masterKeyBits,\n    'HKDF',\n    false,\n    ['deriveKey']\n  );\n\n  // Derive child key\n  const childKey = await crypto.subtle.deriveKey(\n    {\n      name: 'HKDF',\n      hash: 'SHA-256',\n      salt: new Uint8Array(0), // No salt for child derivation\n      info: encoder.encode(info),\n    },\n    hkdfKey,\n    {\n      name: 'AES-GCM',\n      length: 256,\n    },\n    false,\n    ['encrypt', 'decrypt']\n  );\n\n  return childKey;\n}\n\n/**\n * Encrypt payload using AES-256-GCM\n */\nasync function encryptPayload(\n  plaintext: string | ArrayBuffer,\n  key: CryptoKey,\n  additionalData?: string\n): Promise<EncryptedPayload> {\n  // Generate random 96-bit IV (12 bytes) - GCM recommended size\n  const iv = crypto.getRandomValues(new Uint8Array(12));\n\n  const encoder = new TextEncoder();\n  const plaintextBuffer = typeof plaintext === 'string' \n    ? encoder.encode(plaintext)\n    : new Uint8Array(plaintext);\n\n  const algorithm: AesGcmParams = {\n    name: 'AES-GCM',\n    iv: iv,\n    tagLength: 128, // 16 bytes auth tag\n  };\n\n  // Add authenticated data if provided\n  if (additionalData) {\n    algorithm.additionalData = encoder.encode(additionalData);\n  }\n\n  const ciphertext = await crypto.subtle.encrypt(\n    algorithm,\n    key,\n    plaintextBuffer\n  );\n\n  // In AES-GCM, the ciphertext includes the auth tag at the end\n  const ciphertextArray = new Uint8Array(ciphertext);\n  const ciphertextOnly = ciphertextArray.slice(0, -16); // Remove last 16 bytes (tag)\n  const tag = ciphertextArray.slice(-16); // Last 16 bytes\n\n  return {\n    ciphertext: arrayBufferToBase64(ciphertextOnly),\n    iv: arrayBufferToBase64(iv),\n    tag: arrayBufferToBase64(tag),\n  };\n}\n\n/**\n * Decrypt payload using AES-256-GCM\n */\nasync function decryptPayload(\n  encrypted: EncryptedPayload,\n  key: CryptoKey,\n  additionalData?: string\n): Promise<ArrayBuffer | null> {\n  try {\n    const iv = base64ToArrayBuffer(encrypted.iv);\n    const ciphertext = base64ToArrayBuffer(encrypted.ciphertext);\n    const tag = base64ToArrayBuffer(encrypted.tag);\n\n    // Combine ciphertext + tag for AES-GCM\n    const combined = new Uint8Array(ciphertext.byteLength + tag.byteLength);\n    combined.set(new Uint8Array(ciphertext), 0);\n    combined.set(new Uint8Array(tag), ciphertext.byteLength);\n\n    const encoder = new TextEncoder();\n    const algorithm: AesGcmParams = {\n      name: 'AES-GCM',\n      iv: iv,\n      tagLength: 128,\n    };\n\n    if (additionalData) {\n      algorithm.additionalData = encoder.encode(additionalData);\n    }\n\n    const plaintext = await crypto.subtle.decrypt(\n      algorithm,\n      key,\n      combined\n    );\n\n    return plaintext;\n  } catch (error) {\n    console.error('[ENCRYPTION] Decryption failed:', error);\n    return null;\n  }\n}\n\n/**\n * Perform ECDH handshake with server\n */\nexport async function performHandshake(publicKey: string, apiBaseUrl: string = ''): Promise<SessionInfo | null> {\n  if (!isEncryptionAvailable()) {\n    console.warn('[ENCRYPTION] Web Crypto API not available, encryption disabled');\n    return null;\n  }\n\n  try {\n    // Generate client key pair\n    const clientKeyPair = await generateClientKeyPair();\n    const clientPublicKeyRaw = await exportPublicKey(clientKeyPair.publicKey);\n\n    // Send handshake request\n    const response = await fetch(`${apiBaseUrl}/api/captcha/handshake`, {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({\n        publicKey: publicKey,\n        clientPublicKey: arrayBufferToBase64(clientPublicKeyRaw),\n      }),\n      credentials: 'include',\n    });\n\n    if (!response.ok) {\n      const error = await response.json();\n      console.error('[ENCRYPTION] Handshake failed:', error);\n      return null;\n    }\n\n    const handshakeData: HandshakeResponse = await response.json();\n\n    // Import server's public key\n    const serverPublicKeyRaw = base64ToArrayBuffer(handshakeData.serverPublicKey);\n    const serverPublicKey = await importServerPublicKey(serverPublicKeyRaw);\n\n    // Derive shared secret via ECDH\n    const sharedSecret = await deriveSharedSecret(clientKeyPair.privateKey, serverPublicKey);\n\n    // Derive master session key via HKDF\n    const masterKey = await deriveMasterKey(\n      sharedSecret,\n      serverPublicKeyRaw,\n      handshakeData.nonce\n    );\n\n    // Create session info\n    const session: SessionInfo = {\n      masterKey,\n      serverPublicKey: serverPublicKeyRaw,\n      clientPublicKey: clientPublicKeyRaw,\n      clientPrivateKey: clientKeyPair.privateKey,\n      timestamp: handshakeData.timestamp,\n      expiresAt: Date.now() + (handshakeData.expiresIn * 1000),\n      nonce: handshakeData.nonce,\n    };\n\n    // Cache session\n    currentSession = session;\n\n    console.log('[ENCRYPTION] Handshake successful, session established');\n    return session;\n  } catch (error) {\n    console.error('[ENCRYPTION] Handshake error:', error);\n    return null;\n  }\n}\n\n/**\n * Get current session or perform new handshake if expired\n */\nexport async function getOrCreateSession(publicKey: string, apiBaseUrl: string = ''): Promise<SessionInfo | null> {\n  // Check if current session is still valid\n  if (currentSession && Date.now() < currentSession.expiresAt) {\n    return currentSession;\n  }\n\n  // Session expired or doesn't exist, perform new handshake\n  console.log('[ENCRYPTION] Session expired or missing, performing handshake');\n  return await performHandshake(publicKey, apiBaseUrl);\n}\n\n/**\n * Clear current session (useful for testing or explicit logout)\n */\nexport function clearSession(): void {\n  currentSession = null;\n  console.log('[ENCRYPTION] Session cleared');\n}\n\n/**\n * Encrypt challenge data for transmission to server\n */\nexport async function encryptChallengeData(\n  challengeData: any,\n  challengeId: string,\n  publicKey: string,\n  apiBaseUrl: string = ''\n): Promise<EncryptedPayload | null> {\n  const session = await getOrCreateSession(publicKey, apiBaseUrl);\n  if (!session) {\n    return null;\n  }\n\n  const childKey = await deriveChildKey(session.masterKey, challengeId, 'encrypt');\n  const plaintext = JSON.stringify(challengeData);\n\n  return await encryptPayload(plaintext, childKey, challengeId);\n}\n\n/**\n * Decrypt solution data from server\n */\nexport async function decryptSolutionData(\n  encrypted: EncryptedPayload,\n  challengeId: string,\n  publicKey: string,\n  apiBaseUrl: string = ''\n): Promise<any | null> {\n  const session = await getOrCreateSession(publicKey, apiBaseUrl);\n  if (!session) {\n    return null;\n  }\n\n  const childKey = await deriveChildKey(session.masterKey, challengeId, 'encrypt');\n  const plaintext = await decryptPayload(encrypted, childKey, challengeId);\n\n  if (!plaintext) {\n    return null;\n  }\n\n  try {\n    const decoder = new TextDecoder();\n    return JSON.parse(decoder.decode(plaintext));\n  } catch {\n    return null;\n  }\n}\n\n/**\n * Decrypt challenge data received from server\n */\nexport async function decryptChallengeData(\n  encrypted: EncryptedPayload,\n  challengeId: string,\n  publicKey: string,\n  apiBaseUrl: string = ''\n): Promise<any | null> {\n  const session = await getOrCreateSession(publicKey, apiBaseUrl);\n  if (!session) {\n    return null;\n  }\n\n  const childKey = await deriveChildKey(session.masterKey, challengeId, 'encrypt');\n  const plaintext = await decryptPayload(encrypted, childKey, challengeId);\n\n  if (!plaintext) {\n    return null;\n  }\n\n  try {\n    const decoder = new TextDecoder();\n    return JSON.parse(decoder.decode(plaintext));\n  } catch {\n    return null;\n  }\n}\n\n/**\n * Encrypt solution data for verification\n */\nexport async function encryptSolutionData(\n  solutionData: any,\n  challengeId: string,\n  publicKey: string,\n  apiBaseUrl: string = ''\n): Promise<EncryptedPayload | null> {\n  const session = await getOrCreateSession(publicKey, apiBaseUrl);\n  if (!session) {\n    return null;\n  }\n\n  const childKey = await deriveChildKey(session.masterKey, challengeId, 'decrypt');\n  const plaintext = JSON.stringify(solutionData);\n\n  return await encryptPayload(plaintext, childKey, challengeId);\n}\n\n// ==========================================\n// UTILITY FUNCTIONS\n// ==========================================\n\nfunction arrayBufferToBase64(buffer: ArrayBuffer): string {\n  const bytes = new Uint8Array(buffer);\n  let binary = '';\n  for (let i = 0; i < bytes.byteLength; i++) {\n    binary += String.fromCharCode(bytes[i]);\n  }\n  return btoa(binary);\n}\n\nfunction base64ToArrayBuffer(base64: string): ArrayBuffer {\n  const binary = atob(base64);\n  const bytes = new Uint8Array(binary.length);\n  for (let i = 0; i < binary.length; i++) {\n    bytes[i] = binary.charCodeAt(i);\n  }\n  return bytes.buffer;\n}\n","size_bytes":13259},"client/src/components/ui/switch.tsx":{"content":"import * as React from \"react\"\nimport * as SwitchPrimitives from \"@radix-ui/react-switch\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Switch = React.forwardRef<\n  React.ElementRef<typeof SwitchPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof SwitchPrimitives.Root>\n>(({ className, ...props }, ref) => (\n  <SwitchPrimitives.Root\n    className={cn(\n      \"peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  >\n    <SwitchPrimitives.Thumb\n      className={cn(\n        \"pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0\"\n      )}\n    />\n  </SwitchPrimitives.Root>\n))\nSwitch.displayName = SwitchPrimitives.Root.displayName\n\nexport { Switch }\n","size_bytes":1139},"server/upside-down-generator.ts":{"content":"import crypto from \"crypto\";\nimport { nanoid } from \"nanoid\";\nimport { UPSIDE_DOWN_CONFIG, type AnimalSprite, type UpsideDownChallengeData, type UpsideDownSolution } from \"./upside-down-config\";\n\nexport type { UpsideDownChallengeData, AnimalSprite, UpsideDownSolution };\n\n/**\n * SECURITY FIX: Cryptographically secure random integer generation\n * Replaces Math.random() to prevent prediction attacks\n */\nfunction randomInt(min: number, max: number): number {\n  return crypto.randomInt(min, max + 1);\n}\n\n/**\n * SECURITY FIX: Cryptographically secure random float generation\n * Note: crypto.randomInt doesn't support floats, so we generate a large int and normalize\n */\nfunction randomFloat(min: number, max: number): number {\n  const randomInt = crypto.randomInt(0, 1000000);\n  const normalized = randomInt / 1000000;\n  return min + (normalized * (max - min));\n}\n\n/**\n * SECURITY FIX: Fisher-Yates shuffle using cryptographically secure random\n */\nfunction shuffleArray<T>(array: T[]): T[] {\n  const shuffled = [...array];\n  for (let i = shuffled.length - 1; i > 0; i--) {\n    const j = crypto.randomInt(0, i + 1);\n    [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];\n  }\n  return shuffled;\n}\n\nfunction doSpritesOverlap(\n  sprite1: { x: number; y: number; size: number },\n  sprite2: { x: number; y: number; size: number },\n  minDistance: number = 20\n): boolean {\n  const dx = sprite1.x - sprite2.x;\n  const dy = sprite1.y - sprite2.y;\n  const distance = Math.sqrt(dx * dx + dy * dy);\n  const minRequiredDistance = (sprite1.size + sprite2.size) / 2 + minDistance;\n  return distance < minRequiredDistance;\n}\n\nexport function generateUpsideDownChallenge(): Omit<UpsideDownChallengeData, 'backgroundUrl'> {\n  const { canvas, animals: animalTemplates, backgrounds, minAnimals, maxAnimals, upsideDownPercentage, tolerance } = UPSIDE_DOWN_CONFIG;\n  \n  const numAnimals = randomInt(minAnimals, maxAnimals);\n  const numUpsideDown = Math.max(1, Math.floor(numAnimals * upsideDownPercentage));\n  \n  const backgroundIndex = randomInt(0, backgrounds.length - 1);\n  \n  const animalPlacements: AnimalSprite[] = [];\n  const maxAttempts = 100;\n  \n  const orientations: Array<'upright' | 'upside_down'> = [\n    ...Array(numUpsideDown).fill('upside_down'),\n    ...Array(numAnimals - numUpsideDown).fill('upright'),\n  ];\n  const shuffledOrientations = shuffleArray(orientations);\n  \n  for (let i = 0; i < numAnimals; i++) {\n    const animalTemplate = animalTemplates[randomInt(0, animalTemplates.length - 1)];\n    const orientation = shuffledOrientations[i];\n    \n    let placed = false;\n    let attempts = 0;\n    \n    while (!placed && attempts < maxAttempts) {\n      const padding = animalTemplate.size / 2 + 10;\n      const x = randomInt(padding, canvas.width - padding);\n      const y = randomInt(padding, canvas.height - padding);\n      \n      const newSprite = { x, y, size: animalTemplate.size };\n      \n      const overlaps = animalPlacements.some(existing => \n        doSpritesOverlap(newSprite, { x: existing.x, y: existing.y, size: animalTemplate.size }, 30)\n      );\n      \n      if (!overlaps) {\n        animalPlacements.push({\n          id: nanoid(8),\n          x,\n          y,\n          orientation,\n          animalType: animalTemplate.id,\n          path: animalTemplate.path,\n        });\n        placed = true;\n      }\n      \n      attempts++;\n    }\n    \n    if (!placed) {\n      const padding = animalTemplate.size / 2 + 10;\n      animalPlacements.push({\n        id: nanoid(8),\n        x: randomInt(padding, canvas.width - padding),\n        y: randomInt(padding, canvas.height - padding),\n        orientation,\n        animalType: animalTemplate.id,\n        path: animalTemplate.path,\n      });\n    }\n  }\n  \n  return {\n    backgroundIndex,\n    animals: animalPlacements,\n    canvasWidth: canvas.width,\n    canvasHeight: canvas.height,\n    tolerance,\n  };\n}\n\nexport function getUpsideDownAnimals(challengeData: UpsideDownChallengeData): AnimalSprite[] {\n  return challengeData.animals.filter(animal => animal.orientation === 'upside_down');\n}\n\nexport function validateUpsideDownSolution(\n  challengeData: UpsideDownChallengeData,\n  clicks: Array<{ x: number; y: number }>\n): { valid: boolean; reason?: string; details?: any } {\n  const upsideDownAnimals = getUpsideDownAnimals(challengeData);\n  const tolerance = challengeData.tolerance;\n  \n  if (clicks.length === 0) {\n    return { valid: false, reason: 'No clicks provided' };\n  }\n  \n  if (clicks.length < upsideDownAnimals.length) {\n    return { \n      valid: false, \n      reason: 'Not all upside-down animals were selected',\n      details: {\n        required: upsideDownAnimals.length,\n        provided: clicks.length,\n      }\n    };\n  }\n  \n  if (clicks.length > upsideDownAnimals.length) {\n    return { \n      valid: false, \n      reason: 'Too many clicks - you selected animals that are not upside-down',\n      details: {\n        required: upsideDownAnimals.length,\n        provided: clicks.length,\n      }\n    };\n  }\n  \n  const matchedAnimals = new Set<string>();\n  const unmatchedClicks: Array<{ x: number; y: number }> = [];\n  \n  for (const click of clicks) {\n    let matched = false;\n    \n    for (const animal of upsideDownAnimals) {\n      if (matchedAnimals.has(animal.id)) continue;\n      \n      const dx = click.x - animal.x;\n      const dy = click.y - animal.y;\n      const distance = Math.sqrt(dx * dx + dy * dy);\n      \n      if (distance <= tolerance) {\n        matchedAnimals.add(animal.id);\n        matched = true;\n        break;\n      }\n    }\n    \n    if (!matched) {\n      unmatchedClicks.push(click);\n    }\n  }\n  \n  if (matchedAnimals.size !== upsideDownAnimals.length) {\n    return { \n      valid: false, \n      reason: 'Some upside-down animals were not clicked correctly',\n      details: {\n        matched: matchedAnimals.size,\n        required: upsideDownAnimals.length,\n        unmatchedClicks,\n      }\n    };\n  }\n  \n  if (unmatchedClicks.length > 0) {\n    return { \n      valid: false, \n      reason: 'Some clicks do not match any upside-down animal',\n      details: {\n        unmatchedClicks,\n      }\n    };\n  }\n  \n  return { valid: true };\n}\n","size_bytes":6127},"client/src/components/ui/collapsible.tsx":{"content":"\"use client\"\n\nimport * as CollapsiblePrimitive from \"@radix-ui/react-collapsible\"\n\nconst Collapsible = CollapsiblePrimitive.Root\n\nconst CollapsibleTrigger = CollapsiblePrimitive.CollapsibleTrigger\n\nconst CollapsibleContent = CollapsiblePrimitive.CollapsibleContent\n\nexport { Collapsible, CollapsibleTrigger, CollapsibleContent }\n","size_bytes":329},"client/src/pages/Dashboard.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { motion } from \"framer-motion\";\nimport { Shield, CheckCircle, XCircle, Clock, Users, Filter, Activity, TrendingUp, Zap, BarChart3 } from \"lucide-react\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Label } from \"@/components/ui/label\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport CircularProgress from \"@/components/CircularProgress\";\nimport TimeSeriesChart from \"@/components/TimeSeriesChart\";\nimport BarChartCard from \"@/components/BarChartCard\";\nimport CountryAnalyticsCard from \"@/components/CountryAnalyticsCard\";\nimport type { ApiKey } from \"@shared/schema\";\nimport { useTranslation } from \"react-i18next\";\n\ninterface Stats {\n  totalApiKeys: number;\n  activeApiKeys: number;\n  totalVerifications: number;\n  successfulVerifications: number;\n  failedVerifications: number;\n  successRate: string;\n  uniqueIps: number;\n  avgTimeToSolve: number;\n}\n\ninterface TimeSeriesData {\n  time: string;\n  success: number;\n  failed: number;\n  total: number;\n}\n\ninterface ChallengeTypeData {\n  label: string;\n  value: number;\n}\n\ninterface CountryAnalyticsData {\n  country: string;\n  countryName: string;\n  totalVerifications: number;\n  successfulVerifications: number;\n  failedVerifications: number;\n  successRate: string;\n  uniqueIps: number;\n  averageTimeToSolve: number | null;\n}\n\nexport default function Dashboard() {\n  const [selectedApiKeyId, setSelectedApiKeyId] = useState<string>(\"all\");\n  const { t } = useTranslation();\n\n  const { data: apiKeys, isLoading: apiKeysLoading } = useQuery<ApiKey[]>({\n    queryKey: [\"/api/keys\"],\n  });\n\n  const statsUrl = selectedApiKeyId === \"all\" \n    ? \"/api/admin/stats\"\n    : `/api/admin/stats?apiKeyId=${selectedApiKeyId}`;\n\n  const timeseriesUrl = selectedApiKeyId === \"all\"\n    ? \"/api/admin/timeseries\"\n    : `/api/admin/timeseries?apiKeyId=${selectedApiKeyId}`;\n\n  const challengeTypesUrl = selectedApiKeyId === \"all\"\n    ? \"/api/admin/challenge-types\"\n    : `/api/admin/challenge-types?apiKeyId=${selectedApiKeyId}`;\n\n  const countryAnalyticsUrl = selectedApiKeyId === \"all\"\n    ? \"/api/admin/country-analytics?limit=20\"\n    : `/api/admin/country-analytics?apiKeyId=${selectedApiKeyId}&limit=20`;\n\n  // Auto-refresh every 5 seconds for real-time data\n  const { data: stats, isLoading: statsLoading } = useQuery<Stats>({\n    queryKey: [statsUrl],\n    refetchInterval: 5000,\n  });\n\n  const { data: timeseriesData, isLoading: timeseriesLoading } = useQuery<TimeSeriesData[]>({\n    queryKey: [timeseriesUrl],\n    refetchInterval: 5000,\n  });\n\n  const { data: challengeTypesData, isLoading: challengeTypesLoading } = useQuery<ChallengeTypeData[]>({\n    queryKey: [challengeTypesUrl],\n    refetchInterval: 10000,\n  });\n\n  const { data: countryAnalyticsData, isLoading: countryAnalyticsLoading } = useQuery<CountryAnalyticsData[]>({\n    queryKey: [countryAnalyticsUrl],\n    refetchInterval: 10000,\n  });\n\n  if (apiKeysLoading || statsLoading) {\n    return (\n      <div className=\"flex items-center justify-center h-full bg-background\">\n        <motion.div\n          initial={{ opacity: 0, scale: 0.8 }}\n          animate={{ opacity: 1, scale: 1 }}\n          transition={{ duration: 0.5 }}\n          className=\"flex flex-col items-center gap-4\"\n        >\n          <div className=\"relative\">\n            <div className=\"h-16 w-16 animate-spin rounded-full border-4 border-purple-500 border-t-transparent\" />\n            <div className=\"absolute inset-0 h-16 w-16 animate-ping rounded-full border-4 border-purple-500 opacity-20\" />\n          </div>\n          <p className=\"text-muted-foreground font-medium\">{t('dashboard.loadingDashboard')}</p>\n        </motion.div>\n      </div>\n    );\n  }\n\n  const totalVerifications = stats?.totalVerifications || 0;\n  const successRate = parseFloat(stats?.successRate || \"0\");\n  // Calculate failed rate properly - only show percentage if there are verifications\n  const failedRate = totalVerifications > 0 \n    ? ((stats?.failedVerifications || 0) / totalVerifications) * 100 \n    : 0;\n\n  return (\n    <div className=\"min-h-screen bg-background relative overflow-hidden\">\n      {/* Animated Background Gradients */}\n      <div className=\"fixed inset-0 overflow-hidden pointer-events-none\">\n        <div className=\"absolute top-0 right-0 w-[400px] md:w-[600px] h-[400px] md:h-[600px] bg-purple-500/5 dark:bg-purple-500/10 rounded-full blur-[100px] md:blur-[120px] animate-pulse\" />\n        <div className=\"absolute bottom-0 left-0 w-[350px] md:w-[500px] h-[350px] md:h-[500px] bg-blue-500/5 dark:bg-blue-500/10 rounded-full blur-[100px] md:blur-[120px] animate-pulse\" style={{ animationDelay: '1s' }} />\n        <div className=\"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[300px] md:w-[400px] h-[300px] md:h-[400px] bg-pink-500/5 dark:bg-pink-500/10 rounded-full blur-[80px] md:blur-[100px] animate-pulse\" style={{ animationDelay: '2s' }} />\n      </div>\n\n      <div className=\"relative z-10 px-3 py-4 sm:px-6 sm:py-6 lg:px-8 lg:py-8 space-y-4 sm:space-y-6\" data-testid=\"page-dashboard\">\n        {/* Header */}\n        <motion.div\n          initial={{ opacity: 0, y: -20 }}\n          animate={{ opacity: 1, y: 0 }}\n          transition={{ duration: 0.6 }}\n          className=\"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-3 sm:gap-4\"\n        >\n          <div className=\"space-y-2\">\n            <div className=\"flex items-center gap-2 sm:gap-3\">\n              <div className=\"p-1.5 sm:p-2 bg-gradient-to-br from-purple-500 to-blue-600 rounded-lg shadow-lg shadow-purple-500/30\">\n                <BarChart3 className=\"h-5 w-5 sm:h-6 sm:w-6 text-white\" />\n              </div>\n              <h1 className=\"text-2xl sm:text-3xl lg:text-4xl font-bold text-foreground\" data-testid=\"text-title\">\n                {t('dashboard.title')}\n              </h1>\n            </div>\n            <p className=\"text-xs sm:text-sm text-muted-foreground flex flex-wrap items-center gap-2 ml-8 sm:ml-11 lg:ml-14\" data-testid=\"text-subtitle\">\n              <span className=\"hidden sm:inline\">{t('dashboard.subtitle')}</span>\n              <span className=\"inline-flex items-center gap-1 sm:gap-1.5 text-xs px-2 sm:px-2.5 py-0.5 sm:py-1 rounded-full bg-green-500/20 text-green-400 dark:text-green-300 border border-green-500/30\">\n                <Activity className=\"h-2.5 w-2.5 sm:h-3 sm:w-3 animate-pulse\" />\n                <span className=\"text-[10px] sm:text-xs\">{t('dashboard.realtime')}</span>\n              </span>\n            </p>\n          </div>\n\n          <motion.div\n            initial={{ opacity: 0, x: 20 }}\n            animate={{ opacity: 1, x: 0 }}\n            transition={{ delay: 0.3 }}\n            className=\"w-full lg:w-auto lg:min-w-[280px]\"\n            data-testid=\"container-filter\"\n          >\n            <Card className=\"shadow-md hover:shadow-lg transition-shadow\">\n              <CardContent className=\"p-3 sm:p-4\">\n                <div className=\"flex items-center gap-2 sm:gap-3\">\n                  <div className=\"p-1.5 sm:p-2 bg-purple-500/20 rounded-lg\">\n                    <Filter className=\"h-3.5 w-3.5 sm:h-4 sm:w-4 text-purple-400\" data-testid=\"icon-filter\" />\n                  </div>\n                  <div className=\"flex-1 space-y-1 sm:space-y-1.5\">\n                    <Label htmlFor=\"api-key-filter\" className=\"text-xs text-muted-foreground\">\n                      {t('dashboard.filterByApiKey')}\n                    </Label>\n                    <Select value={selectedApiKeyId} onValueChange={setSelectedApiKeyId}>\n                      <SelectTrigger id=\"api-key-filter\" data-testid=\"select-api-key-filter\" className=\"h-8 sm:h-9\">\n                        <SelectValue placeholder={t('dashboard.filterByApiKey')} />\n                      </SelectTrigger>\n                      <SelectContent data-testid=\"content-api-key-filter\">\n                        <SelectItem value=\"all\" data-testid=\"option-all-keys\">{t('dashboard.allApiKeys')}</SelectItem>\n                        {apiKeys?.map((key) => (\n                          <SelectItem key={key.id} value={key.id} data-testid={`option-key-${key.id}`}>\n                            {key.name}\n                          </SelectItem>\n                        ))}\n                      </SelectContent>\n                    </Select>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          </motion.div>\n        </motion.div>\n\n        {/* Main Content Grid */}\n        <div className=\"grid gap-4 sm:gap-6 lg:grid-cols-12\">\n          {/* Left Section - Stats Cards */}\n          <div className=\"lg:col-span-8 space-y-4 sm:space-y-6\">\n            {/* Top Metrics */}\n            <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4\">\n              <motion.div\n                initial={{ opacity: 0, y: 20 }}\n                animate={{ opacity: 1, y: 0 }}\n                transition={{ delay: 0.1 }}\n                whileHover={{ y: -8, rotateX: 5, rotateY: 5, scale: 1.02 }}\n                style={{ transformStyle: 'preserve-3d', perspective: 1000 }}\n              >\n                <Card className=\"overflow-hidden group hover-elevate transition-all shadow-lg hover:shadow-xl card-3d\" data-testid=\"card-total-verifications\">\n                  <div className=\"absolute inset-0 bg-gradient-to-br from-purple-500/10 to-transparent opacity-0 group-hover:opacity-100 transition-opacity\" />\n                  <CardContent className=\"p-4 sm:p-6 relative\">\n                    <div className=\"flex items-start justify-between mb-3 sm:mb-4\">\n                      <div className=\"p-2 sm:p-3 bg-purple-500/20 dark:bg-purple-500/30 rounded-xl shadow-md\">\n                        <Shield className=\"h-5 w-5 sm:h-6 sm:w-6 text-purple-600 dark:text-purple-400\" />\n                      </div>\n                      <TrendingUp className=\"h-4 w-4 sm:h-5 sm:w-5 text-green-600 dark:text-green-400\" />\n                    </div>\n                    <div className=\"space-y-0.5 sm:space-y-1\">\n                      <p className=\"text-xs sm:text-sm text-muted-foreground\">{t('dashboard.cards.totalVerifications')}</p>\n                      <p className=\"text-2xl sm:text-4xl font-bold text-foreground\">{totalVerifications.toLocaleString()}</p>\n                      <p className=\"text-[10px] sm:text-xs text-muted-foreground\">{t('dashboard.cards.allTimeChallenges')}</p>\n                    </div>\n                  </CardContent>\n                </Card>\n              </motion.div>\n\n              <motion.div\n                initial={{ opacity: 0, y: 20 }}\n                animate={{ opacity: 1, y: 0 }}\n                transition={{ delay: 0.2 }}\n                whileHover={{ y: -8, rotateX: 5, rotateY: -5, scale: 1.02 }}\n                style={{ transformStyle: 'preserve-3d', perspective: 1000 }}\n              >\n                <Card className=\"overflow-hidden group hover-elevate transition-all shadow-lg hover:shadow-xl card-3d\" data-testid=\"card-avg-time\">\n                  <div className=\"absolute inset-0 bg-gradient-to-br from-blue-500/10 to-transparent opacity-0 group-hover:opacity-100 transition-opacity\" />\n                  <CardContent className=\"p-4 sm:p-6 relative\">\n                    <div className=\"flex items-start justify-between mb-3 sm:mb-4\">\n                      <div className=\"p-2 sm:p-3 bg-blue-500/20 dark:bg-blue-500/30 rounded-xl shadow-md\">\n                        <Clock className=\"h-5 w-5 sm:h-6 sm:w-6 text-blue-600 dark:text-blue-400\" />\n                      </div>\n                      <Zap className=\"h-4 w-4 sm:h-5 sm:w-5 text-yellow-600 dark:text-yellow-400\" />\n                    </div>\n                    <div className=\"space-y-0.5 sm:space-y-1\">\n                      <p className=\"text-xs sm:text-sm text-muted-foreground\">{t('dashboard.cards.avgSolveTime')}</p>\n                      <p className=\"text-2xl sm:text-4xl font-bold text-foreground\">{stats?.avgTimeToSolve || 0}<span className=\"text-base sm:text-xl text-muted-foreground\">ms</span></p>\n                      <p className=\"text-[10px] sm:text-xs text-muted-foreground\">{t('dashboard.cards.averageResponse')}</p>\n                    </div>\n                  </CardContent>\n                </Card>\n              </motion.div>\n            </div>\n\n            {/* Time Series Chart */}\n            <motion.div\n              initial={{ opacity: 0, y: 20 }}\n              animate={{ opacity: 1, y: 0 }}\n              transition={{ delay: 0.3 }}\n              whileHover={{ scale: 1.01, y: -4 }}\n            >\n              <Card className=\"shadow-lg hover:shadow-xl transition-all card-3d\" data-testid=\"card-timeseries\">\n                <CardHeader className=\"pb-2 sm:pb-3\">\n                  <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2\">\n                    <CardTitle className=\"text-base sm:text-lg font-semibold text-foreground flex items-center gap-2\">\n                      <Activity className=\"h-4 w-4 sm:h-5 sm:w-5 text-purple-600 dark:text-purple-400\" />\n                      {t('dashboard.cards.verificationsTimeline')}\n                    </CardTitle>\n                    <span className=\"text-[10px] sm:text-xs text-muted-foreground\">{t('dashboard.cards.last24Hours')}</span>\n                  </div>\n                </CardHeader>\n                <CardContent className=\"px-3 sm:px-6\">\n                  {!timeseriesLoading && timeseriesData ? (\n                    <TimeSeriesChart\n                      data={timeseriesData.map(d => ({ time: d.time, value: d.total }))}\n                      title=\"\"\n                      color=\"rgb(168, 85, 247)\"\n                      height={window.innerWidth < 640 ? 200 : 280}\n                    />\n                  ) : (\n                    <div className=\"h-[200px] sm:h-[280px] flex items-center justify-center text-muted-foreground\">\n                      <div className=\"animate-spin rounded-full h-6 w-6 sm:h-8 sm:w-8 border-2 border-purple-500 border-t-transparent\" />\n                    </div>\n                  )}\n                </CardContent>\n              </Card>\n            </motion.div>\n\n            {/* Bottom Stats */}\n            <div className=\"grid grid-cols-1 sm:grid-cols-3 gap-3 sm:gap-4\">\n              <motion.div\n                initial={{ opacity: 0, y: 20 }}\n                animate={{ opacity: 1, y: 0 }}\n                transition={{ delay: 0.4 }}\n                whileHover={{ scale: 1.03, rotateY: 5, y: -4 }}\n                style={{ transformStyle: 'preserve-3d' }}\n              >\n                <Card className=\"hover-elevate transition-all shadow-md hover:shadow-lg card-3d\">\n                  <CardContent className=\"p-3 sm:p-4\">\n                    <div className=\"flex items-center gap-2 sm:gap-3\">\n                      <div className=\"p-2 sm:p-2.5 bg-green-500/20 dark:bg-green-500/30 rounded-lg shadow-sm\">\n                        <Activity className=\"h-4 w-4 sm:h-5 sm:w-5 text-green-600 dark:text-green-400\" />\n                      </div>\n                      <div>\n                        <p className=\"text-xl sm:text-2xl font-bold text-foreground\">{stats?.activeApiKeys || 0}</p>\n                        <p className=\"text-[10px] sm:text-xs text-muted-foreground\">{t('dashboard.cards.activeApiKeys')}</p>\n                      </div>\n                    </div>\n                  </CardContent>\n                </Card>\n              </motion.div>\n\n              <motion.div\n                initial={{ opacity: 0, y: 20 }}\n                animate={{ opacity: 1, y: 0 }}\n                transition={{ delay: 0.5 }}\n                whileHover={{ scale: 1.03, rotateY: 5, y: -4 }}\n                style={{ transformStyle: 'preserve-3d' }}\n              >\n                <Card className=\"hover-elevate transition-all shadow-md hover:shadow-lg card-3d\">\n                  <CardContent className=\"p-3 sm:p-4\">\n                    <div className=\"flex items-center gap-2 sm:gap-3\">\n                      <div className=\"p-2 sm:p-2.5 bg-cyan-500/20 dark:bg-cyan-500/30 rounded-lg shadow-sm\">\n                        <Users className=\"h-4 w-4 sm:h-5 sm:w-5 text-cyan-600 dark:text-cyan-400\" />\n                      </div>\n                      <div>\n                        <p className=\"text-xl sm:text-2xl font-bold text-foreground\">{stats?.uniqueIps || 0}</p>\n                        <p className=\"text-[10px] sm:text-xs text-muted-foreground\">{t('dashboard.cards.uniqueVisitors')}</p>\n                      </div>\n                    </div>\n                  </CardContent>\n                </Card>\n              </motion.div>\n\n              <motion.div\n                initial={{ opacity: 0, y: 20 }}\n                animate={{ opacity: 1, y: 0 }}\n                transition={{ delay: 0.6 }}\n                whileHover={{ scale: 1.03, rotateY: 5, y: -4 }}\n                style={{ transformStyle: 'preserve-3d' }}\n              >\n                <Card className=\"hover-elevate transition-all shadow-md hover:shadow-lg card-3d\">\n                  <CardContent className=\"p-3 sm:p-4\">\n                    <div className=\"flex items-center gap-2 sm:gap-3\">\n                      <div className=\"p-2 sm:p-2.5 bg-red-500/20 dark:bg-red-500/30 rounded-lg shadow-sm\">\n                        <XCircle className=\"h-4 w-4 sm:h-5 sm:w-5 text-red-600 dark:text-red-400\" />\n                      </div>\n                      <div>\n                        <p className=\"text-xl sm:text-2xl font-bold text-foreground\">{stats?.failedVerifications || 0}</p>\n                        <p className=\"text-[10px] sm:text-xs text-muted-foreground\">{t('dashboard.cards.failedAttempts')}</p>\n                      </div>\n                    </div>\n                  </CardContent>\n                </Card>\n              </motion.div>\n            </div>\n          </div>\n\n          {/* Right Section - Circular Progress */}\n          <div className=\"lg:col-span-4 space-y-3 sm:space-y-4\">\n            {/* Success Rate */}\n            <motion.div\n              initial={{ opacity: 0, x: 20 }}\n              animate={{ opacity: 1, x: 0 }}\n              transition={{ delay: 0.3 }}\n              whileHover={{ scale: 1.02, rotateX: -5, y: -4 }}\n              style={{ transformStyle: 'preserve-3d' }}\n            >\n              <Card className=\"shadow-lg hover:shadow-xl transition-all card-3d\" data-testid=\"card-success-rate\">\n                <CardHeader className=\"pb-2 sm:pb-3\">\n                  <CardTitle className=\"text-xs sm:text-sm font-medium text-foreground flex items-center gap-2\">\n                    <CheckCircle className=\"h-3.5 w-3.5 sm:h-4 sm:w-4 text-green-600 dark:text-green-400\" />\n                    {t('dashboard.cards.successRate')}\n                  </CardTitle>\n                </CardHeader>\n                <CardContent className=\"flex justify-center pb-4 sm:pb-6\">\n                  <CircularProgress\n                    value={successRate}\n                    max={100}\n                    size={window.innerWidth < 640 ? 140 : 160}\n                    strokeWidth={12}\n                    label=\"\"\n                    subLabel={`${stats?.successfulVerifications || 0} ${t('dashboard.cards.successful')}`}\n                    color=\"rgb(34, 197, 94)\"\n                  />\n                </CardContent>\n              </Card>\n            </motion.div>\n\n            {/* Failed Rate */}\n            <motion.div\n              initial={{ opacity: 0, x: 20 }}\n              animate={{ opacity: 1, x: 0 }}\n              transition={{ delay: 0.4 }}\n              whileHover={{ scale: 1.02, rotateX: -5, y: -4 }}\n              style={{ transformStyle: 'preserve-3d' }}\n            >\n              <Card className=\"shadow-lg hover:shadow-xl transition-all card-3d\">\n                <CardHeader className=\"pb-2 sm:pb-3\">\n                  <CardTitle className=\"text-xs sm:text-sm font-medium text-foreground flex items-center gap-2\">\n                    <XCircle className=\"h-3.5 w-3.5 sm:h-4 sm:w-4 text-red-600 dark:text-red-400\" />\n                    {t('dashboard.cards.failureRate')}\n                  </CardTitle>\n                </CardHeader>\n                <CardContent className=\"flex justify-center pb-4 sm:pb-6\">\n                  <CircularProgress\n                    value={failedRate}\n                    max={100}\n                    size={window.innerWidth < 640 ? 140 : 160}\n                    strokeWidth={12}\n                    label=\"\"\n                    subLabel={`${stats?.failedVerifications || 0} ${t('dashboard.cards.failed')}`}\n                    color=\"rgb(239, 68, 68)\"\n                  />\n                </CardContent>\n              </Card>\n            </motion.div>\n\n            {/* Challenge Types */}\n            {!challengeTypesLoading && challengeTypesData && challengeTypesData.length > 0 && (\n              <motion.div\n                initial={{ opacity: 0, x: 20 }}\n                animate={{ opacity: 1, x: 0 }}\n                transition={{ delay: 0.5 }}\n                whileHover={{ scale: 1.02, y: -4 }}\n              >\n                <Card className=\"shadow-lg hover:shadow-xl transition-all card-3d\">\n                  <CardHeader className=\"pb-2 sm:pb-3\">\n                    <CardTitle className=\"text-xs sm:text-sm font-medium text-foreground\">{t('dashboard.cards.challengeTypes')}</CardTitle>\n                  </CardHeader>\n                  <CardContent>\n                    <div className=\"space-y-2.5 sm:space-y-3\">\n                      {challengeTypesData.slice(0, 5).map((item, idx) => (\n                        <div key={item.label} className=\"space-y-1 sm:space-y-1.5\">\n                          <div className=\"flex items-center justify-between text-[10px] sm:text-xs\">\n                            <span className=\"text-muted-foreground\">{item.label}</span>\n                            <span className=\"text-foreground font-medium\">{item.value}</span>\n                          </div>\n                          <div className=\"h-1.5 sm:h-2 bg-muted rounded-full overflow-hidden\">\n                            <motion.div\n                              className=\"h-full rounded-full shadow-sm\"\n                              style={{\n                                background: `linear-gradient(90deg, ${\n                                  ['rgb(168, 85, 247)', 'rgb(59, 130, 246)', 'rgb(34, 197, 94)', 'rgb(234, 179, 8)', 'rgb(239, 68, 68)'][idx % 5]\n                                }, ${\n                                  ['rgb(139, 92, 246)', 'rgb(96, 165, 250)', 'rgb(74, 222, 128)', 'rgb(250, 204, 21)', 'rgb(248, 113, 113)'][idx % 5]\n                                })`\n                              }}\n                              initial={{ width: 0 }}\n                              animate={{\n                                width: `${Math.min((item.value / (challengeTypesData[0]?.value || 1)) * 100, 100)}%`\n                              }}\n                              transition={{ duration: 1, delay: 0.5 + idx * 0.1 }}\n                            />\n                          </div>\n                        </div>\n                      ))}\n                    </div>\n                  </CardContent>\n                </Card>\n              </motion.div>\n            )}\n          </div>\n        </div>\n\n        {/* Country Analytics Section - Full Width */}\n        <motion.div\n          initial={{ opacity: 0, y: 20 }}\n          animate={{ opacity: 1, y: 0 }}\n          transition={{ delay: 0.7 }}\n          whileHover={{ scale: 1.005, y: -4 }}\n          className=\"lg:col-span-12\"\n        >\n          <div className=\"shadow-lg hover:shadow-xl transition-all rounded-lg card-3d\">\n            <CountryAnalyticsCard \n              data={countryAnalyticsData ?? []} \n              isLoading={countryAnalyticsLoading} \n            />\n          </div>\n        </motion.div>\n      </div>\n    </div>\n  );\n}\n","size_bytes":23946},"server/enhancements/advanced-fingerprint.ts":{"content":"import crypto from 'crypto';\n\nexport interface CanvasFingerprintData {\n  canvasHash?: string;\n  webglHash?: string;\n  audioHash?: string;\n  fonts?: string[];\n  screenFingerprint?: string;\n}\n\nexport interface AdvancedFingerprint {\n  hash: string;\n  components: {\n    canvas?: string;\n    webgl?: string;\n    audio?: string;\n    fonts?: string;\n    screen?: string;\n    plugins?: string;\n    timezone?: string;\n    platform?: string;\n    hardwareConcurrency?: string;\n    deviceMemory?: string;\n    colorDepth?: string;\n    pixelRatio?: string;\n  };\n  confidence: number;\n  isReliable: boolean;\n}\n\nexport function generateAdvancedFingerprint(\n  clientData: CanvasFingerprintData & {\n    plugins?: string[];\n    timezone?: string;\n    platform?: string;\n    hardwareConcurrency?: number;\n    deviceMemory?: number;\n    colorDepth?: number;\n    pixelRatio?: number;\n  }\n): AdvancedFingerprint {\n  const components: AdvancedFingerprint['components'] = {};\n  let confidence = 0;\n\n  if (clientData.canvasHash) {\n    components.canvas = clientData.canvasHash;\n    confidence += 20;\n  }\n\n  if (clientData.webglHash) {\n    components.webgl = clientData.webglHash;\n    confidence += 20;\n  }\n\n  if (clientData.audioHash) {\n    components.audio = clientData.audioHash;\n    confidence += 15;\n  }\n\n  if (clientData.fonts && clientData.fonts.length > 0) {\n    components.fonts = clientData.fonts.sort().join(',');\n    confidence += 10;\n  }\n\n  if (clientData.screenFingerprint) {\n    components.screen = clientData.screenFingerprint;\n    confidence += 10;\n  }\n\n  if (clientData.plugins && clientData.plugins.length > 0) {\n    components.plugins = clientData.plugins.sort().join(',');\n    confidence += 5;\n  }\n\n  if (clientData.timezone) {\n    components.timezone = clientData.timezone;\n    confidence += 5;\n  }\n\n  if (clientData.platform) {\n    components.platform = clientData.platform;\n    confidence += 5;\n  }\n\n  if (clientData.hardwareConcurrency !== undefined) {\n    components.hardwareConcurrency = String(clientData.hardwareConcurrency);\n    confidence += 3;\n  }\n\n  if (clientData.deviceMemory !== undefined) {\n    components.deviceMemory = String(clientData.deviceMemory);\n    confidence += 3;\n  }\n\n  if (clientData.colorDepth !== undefined) {\n    components.colorDepth = String(clientData.colorDepth);\n    confidence += 2;\n  }\n\n  if (clientData.pixelRatio !== undefined) {\n    components.pixelRatio = String(clientData.pixelRatio);\n    confidence += 2;\n  }\n\n  const fingerprintString = Object.entries(components)\n    .sort(([a], [b]) => a.localeCompare(b))\n    .map(([key, value]) => `${key}:${value}`)\n    .join('|');\n\n  const hash = crypto\n    .createHash('sha256')\n    .update(fingerprintString)\n    .digest('hex');\n\n  return {\n    hash,\n    components,\n    confidence: Math.min(confidence, 100),\n    isReliable: confidence >= 60,\n  };\n}\n\nexport function compareFingerprints(\n  fp1: AdvancedFingerprint,\n  fp2: AdvancedFingerprint\n): { similarity: number; matchedComponents: string[]; mismatchedComponents: string[] } {\n  if (fp1.hash === fp2.hash) {\n    return {\n      similarity: 100,\n      matchedComponents: Object.keys(fp1.components),\n      mismatchedComponents: [],\n    };\n  }\n\n  const allKeys = Array.from(new Set([\n    ...Object.keys(fp1.components),\n    ...Object.keys(fp2.components),\n  ]));\n\n  const matchedComponents: string[] = [];\n  const mismatchedComponents: string[] = [];\n\n  for (const key of allKeys) {\n    const val1 = fp1.components[key as keyof typeof fp1.components];\n    const val2 = fp2.components[key as keyof typeof fp2.components];\n\n    if (val1 === val2) {\n      matchedComponents.push(key);\n    } else {\n      mismatchedComponents.push(key);\n    }\n  }\n\n  const similarity = (matchedComponents.length / allKeys.length) * 100;\n\n  return {\n    similarity,\n    matchedComponents,\n    mismatchedComponents,\n  };\n}\n\nexport const CLIENT_FINGERPRINT_SCRIPT = `\n(function() {\n  const fingerprint = {};\n\n  try {\n    const canvas = document.createElement('canvas');\n    const ctx = canvas.getContext('2d');\n    if (ctx) {\n      canvas.width = 200;\n      canvas.height = 50;\n      ctx.textBaseline = 'top';\n      ctx.font = '14px Arial';\n      ctx.fillStyle = '#f60';\n      ctx.fillRect(125, 1, 62, 20);\n      ctx.fillStyle = '#069';\n      ctx.fillText('ProofCaptcha üîí', 2, 15);\n      ctx.fillStyle = 'rgba(102, 204, 0, 0.7)';\n      ctx.fillText('ProofCaptcha üîí', 4, 17);\n      \n      fingerprint.canvasHash = canvas.toDataURL().slice(-100);\n    }\n  } catch (e) {\n    fingerprint.canvasHash = 'error';\n  }\n\n  try {\n    const canvas = document.createElement('canvas');\n    const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');\n    if (gl) {\n      const debugInfo = gl.getExtension('WEBGL_debug_renderer_info');\n      fingerprint.webglHash = debugInfo ? \n        gl.getParameter(debugInfo.UNMASKED_RENDERER_WEBGL) : \n        'no-debug-info';\n    }\n  } catch (e) {\n    fingerprint.webglHash = 'error';\n  }\n\n  try {\n    const AudioContext = window.AudioContext || window.webkitAudioContext;\n    if (AudioContext) {\n      const context = new AudioContext();\n      const oscillator = context.createOscillator();\n      const analyser = context.createAnalyser();\n      const gainNode = context.createGain();\n      const scriptProcessor = context.createScriptProcessor(4096, 1, 1);\n\n      gainNode.gain.value = 0;\n      oscillator.type = 'triangle';\n      oscillator.connect(analyser);\n      analyser.connect(scriptProcessor);\n      scriptProcessor.connect(gainNode);\n      gainNode.connect(context.destination);\n\n      oscillator.start(0);\n      \n      scriptProcessor.onaudioprocess = function(event) {\n        const output = event.outputBuffer.getChannelData(0);\n        fingerprint.audioHash = Array.from(output.slice(0, 30))\n          .reduce((acc, val) => acc + Math.abs(val), 0)\n          .toString()\n          .slice(0, 20);\n        \n        oscillator.stop();\n        scriptProcessor.disconnect();\n      };\n    }\n  } catch (e) {\n    fingerprint.audioHash = 'error';\n  }\n\n  const testFonts = [\n    'Arial', 'Verdana', 'Times New Roman', 'Courier New', 'Georgia',\n    'Palatino', 'Garamond', 'Bookman', 'Comic Sans MS', 'Trebuchet MS',\n    'Impact', 'Lucida Console', 'Tahoma', 'Helvetica'\n  ];\n  \n  fingerprint.fonts = testFonts.filter(font => {\n    const baseline = document.createElement('span');\n    baseline.style.fontFamily = 'monospace';\n    baseline.textContent = 'mmmmmmmmmmlli';\n    document.body.appendChild(baseline);\n    const baselineWidth = baseline.offsetWidth;\n    baseline.style.fontFamily = font + ', monospace';\n    const testWidth = baseline.offsetWidth;\n    document.body.removeChild(baseline);\n    return testWidth !== baselineWidth;\n  });\n\n  fingerprint.screenFingerprint = [\n    screen.width,\n    screen.height,\n    screen.availWidth,\n    screen.availHeight,\n    screen.colorDepth,\n    screen.pixelDepth\n  ].join('x');\n\n  fingerprint.plugins = Array.from(navigator.plugins || [])\n    .map(p => p.name)\n    .slice(0, 10);\n\n  fingerprint.timezone = Intl.DateTimeFormat().resolvedOptions().timeZone;\n  fingerprint.platform = navigator.platform;\n  fingerprint.hardwareConcurrency = navigator.hardwareConcurrency;\n  fingerprint.deviceMemory = navigator.deviceMemory;\n  fingerprint.colorDepth = screen.colorDepth;\n  fingerprint.pixelRatio = window.devicePixelRatio;\n\n  return fingerprint;\n})();\n`;\n","size_bytes":7363},"client/src/components/ui/hover-card.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as HoverCardPrimitive from \"@radix-ui/react-hover-card\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst HoverCard = HoverCardPrimitive.Root\n\nconst HoverCardTrigger = HoverCardPrimitive.Trigger\n\nconst HoverCardContent = React.forwardRef<\n  React.ElementRef<typeof HoverCardPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof HoverCardPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <HoverCardPrimitive.Content\n    ref={ref}\n    align={align}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 w-64 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-hover-card-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nHoverCardContent.displayName = HoverCardPrimitive.Content.displayName\n\nexport { HoverCard, HoverCardTrigger, HoverCardContent }\n","size_bytes":1251},"client/src/components/ui/select.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SelectPrimitive from \"@radix-ui/react-select\"\nimport { Check, ChevronDown, ChevronUp } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Select = SelectPrimitive.Root\n\nconst SelectGroup = SelectPrimitive.Group\n\nconst SelectValue = SelectPrimitive.Value\n\nconst SelectTrigger = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex h-9 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <SelectPrimitive.Icon asChild>\n      <ChevronDown className=\"h-4 w-4 opacity-50\" />\n    </SelectPrimitive.Icon>\n  </SelectPrimitive.Trigger>\n))\nSelectTrigger.displayName = SelectPrimitive.Trigger.displayName\n\nconst SelectScrollUpButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollUpButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronUp className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollUpButton>\n))\nSelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName\n\nconst SelectScrollDownButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollDownButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronDown className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollDownButton>\n))\nSelectScrollDownButton.displayName =\n  SelectPrimitive.ScrollDownButton.displayName\n\nconst SelectContent = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>\n>(({ className, children, position = \"popper\", ...props }, ref) => (\n  <SelectPrimitive.Portal>\n    <SelectPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]\",\n        position === \"popper\" &&\n          \"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1\",\n        className\n      )}\n      position={position}\n      {...props}\n    >\n      <SelectScrollUpButton />\n      <SelectPrimitive.Viewport\n        className={cn(\n          \"p-1\",\n          position === \"popper\" &&\n            \"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]\"\n        )}\n      >\n        {children}\n      </SelectPrimitive.Viewport>\n      <SelectScrollDownButton />\n    </SelectPrimitive.Content>\n  </SelectPrimitive.Portal>\n))\nSelectContent.displayName = SelectPrimitive.Content.displayName\n\nconst SelectLabel = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Label\n    ref={ref}\n    className={cn(\"py-1.5 pl-8 pr-2 text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nSelectLabel.displayName = SelectPrimitive.Label.displayName\n\nconst SelectItem = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <SelectPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </SelectPrimitive.ItemIndicator>\n    </span>\n\n    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>\n  </SelectPrimitive.Item>\n))\nSelectItem.displayName = SelectPrimitive.Item.displayName\n\nconst SelectSeparator = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nSelectSeparator.displayName = SelectPrimitive.Separator.displayName\n\nexport {\n  Select,\n  SelectGroup,\n  SelectValue,\n  SelectTrigger,\n  SelectContent,\n  SelectLabel,\n  SelectItem,\n  SelectSeparator,\n  SelectScrollUpButton,\n  SelectScrollDownButton,\n}\n","size_bytes":5741},"client/src/components/ui/tooltip.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as TooltipPrimitive from \"@radix-ui/react-tooltip\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst TooltipProvider = TooltipPrimitive.Provider\n\nconst Tooltip = TooltipPrimitive.Root\n\nconst TooltipTrigger = TooltipPrimitive.Trigger\n\nconst TooltipContent = React.forwardRef<\n  React.ElementRef<typeof TooltipPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TooltipPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <TooltipPrimitive.Content\n    ref={ref}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nTooltipContent.displayName = TooltipPrimitive.Content.displayName\n\nexport { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }\n","size_bytes":1209},"client/src/App.tsx":{"content":"import { Switch, Route, Link, useLocation, Redirect } from \"wouter\";\nimport { queryClient } from \"./lib/queryClient\";\nimport { QueryClientProvider } from \"@tanstack/react-query\";\nimport { Toaster } from \"@/components/ui/toaster\";\nimport { TooltipProvider } from \"@/components/ui/tooltip\";\nimport { SidebarProvider, Sidebar, SidebarContent, SidebarGroup, SidebarGroupContent, SidebarGroupLabel, SidebarMenu, SidebarMenuButton, SidebarMenuItem, SidebarTrigger } from \"@/components/ui/sidebar\";\nimport { Button } from \"@/components/ui/button\";\nimport ThemeToggle from \"@/components/ThemeToggle\";\nimport LanguageToggle from \"@/components/LanguageToggle\";\nimport { Shield, Key, LayoutDashboard, FileText, LogOut, Code2 } from \"lucide-react\";\nimport { AuthProvider, useAuth } from \"@/hooks/use-auth\";\nimport { useTranslation } from \"react-i18next\";\nimport \"@/i18n/config\";\nimport Home from \"@/pages/Home\";\nimport Dashboard from \"@/pages/Dashboard\";\nimport ApiKeys from \"@/pages/ApiKeys\";\nimport Login from \"@/pages/Login\";\nimport RegisterPage from \"@/pages/RegisterPage\";\nimport ApiDocs from \"@/pages/ApiDocs\";\nimport IntegrationHelper from \"@/pages/integration-helper\";\nimport VerifyEmailPage from \"@/pages/VerifyEmailPage\";\nimport ForgotPasswordPage from \"@/pages/ForgotPasswordPage\";\nimport VerifyResetCodePage from \"@/pages/VerifyResetCodePage\";\nimport ResetPasswordPage from \"@/pages/ResetPasswordPage\";\nimport Privacy from \"@/pages/Privacy\";\nimport Terms from \"@/pages/Terms\";\nimport NotFound from \"@/pages/not-found\";\n\nconst dashboardMenuItems = [\n  { titleKey: \"nav.dashboard\", url: \"/dashboard\", icon: LayoutDashboard },\n  { titleKey: \"nav.apiKeys\", url: \"/api-keys\", icon: Key },\n  { titleKey: \"nav.integrationHelper\", url: \"/integration-helper\", icon: Code2 },\n  { titleKey: \"nav.apiDocs\", url: \"/api-docs\", icon: FileText },\n];\n\nfunction AppSidebar() {\n  const [location] = useLocation();\n  const { developer, logout } = useAuth();\n  const { t } = useTranslation();\n\n  if (!developer) return null;\n\n  return (\n    <Sidebar data-testid=\"sidebar-main\">\n      <SidebarContent>\n        <SidebarGroup>\n          <div className=\"px-4 py-4 flex items-center gap-2\">\n            <Shield className=\"h-6 w-6 text-primary\" data-testid=\"icon-logo\" />\n            <SidebarGroupLabel className=\"text-lg font-bold\">ProofCaptcha</SidebarGroupLabel>\n          </div>\n          <SidebarGroupContent>\n            <SidebarMenu>\n              {dashboardMenuItems.map((item) => (\n                <SidebarMenuItem key={item.titleKey}>\n                  <SidebarMenuButton\n                    asChild\n                    isActive={location === item.url}\n                    data-testid={`menu-item-${item.titleKey.split('.')[1]}`}\n                  >\n                    <Link href={item.url}>\n                      <item.icon className=\"h-4 w-4\" />\n                      <span>{t(item.titleKey)}</span>\n                    </Link>\n                  </SidebarMenuButton>\n                </SidebarMenuItem>\n              ))}\n            </SidebarMenu>\n          </SidebarGroupContent>\n        </SidebarGroup>\n      </SidebarContent>\n    </Sidebar>\n  );\n}\n\nfunction ProtectedRoute({ component: Component, requireVerification = true }: { component: () => JSX.Element; requireVerification?: boolean }) {\n  const { developer, isLoading } = useAuth();\n  const { t } = useTranslation();\n  const [location] = useLocation();\n\n  if (isLoading) {\n    return <div className=\"flex items-center justify-center min-h-screen\">{t('common.loading')}</div>;\n  }\n\n  if (!developer) {\n    return <Redirect to=\"/login\" />;\n  }\n\n  // If user is not verified and trying to access protected pages (not verify-email itself)\n  if (requireVerification && !developer.isEmailVerified && location !== \"/verify-email\") {\n    return <Redirect to=\"/verify-email\" />;\n  }\n\n  // If user is already verified and trying to access verify-email page\n  if (developer.isEmailVerified && location === \"/verify-email\") {\n    return <Redirect to=\"/dashboard\" />;\n  }\n\n  return <Component />;\n}\n\nfunction PublicRoute({ component: Component }: { component: () => JSX.Element }) {\n  const { developer, isLoading } = useAuth();\n  const { t } = useTranslation();\n\n  if (isLoading) {\n    return <div className=\"flex items-center justify-center min-h-screen\">{t('common.loading')}</div>;\n  }\n\n  if (developer) {\n    return <Redirect to=\"/dashboard\" />;\n  }\n\n  return <Component />;\n}\n\nfunction Router() {\n  return (\n    <Switch>\n      <Route path=\"/\" component={Home} />\n      <Route path=\"/login\">{() => <PublicRoute component={Login} />}</Route>\n      <Route path=\"/register\">{() => <PublicRoute component={RegisterPage} />}</Route>\n      <Route path=\"/forgot-password\">{() => <PublicRoute component={ForgotPasswordPage} />}</Route>\n      <Route path=\"/verify-reset-code\">{() => <PublicRoute component={VerifyResetCodePage} />}</Route>\n      <Route path=\"/reset-password\">{() => <PublicRoute component={ResetPasswordPage} />}</Route>\n      <Route path=\"/privacy\" component={Privacy} />\n      <Route path=\"/terms\" component={Terms} />\n      <Route path=\"/verify-email\">{() => <ProtectedRoute component={VerifyEmailPage} requireVerification={false} />}</Route>\n      <Route path=\"/dashboard\">{() => <ProtectedRoute component={Dashboard} />}</Route>\n      <Route path=\"/api-keys\">{() => <ProtectedRoute component={ApiKeys} />}</Route>\n      <Route path=\"/integration-helper\">{() => <ProtectedRoute component={IntegrationHelper} />}</Route>\n      <Route path=\"/api-docs\">{() => <ProtectedRoute component={ApiDocs} />}</Route>\n      <Route component={NotFound} />\n    </Switch>\n  );\n}\n\nfunction AppContent() {\n  const { developer, logout } = useAuth();\n  const { t } = useTranslation();\n  const style = {\n    \"--sidebar-width\": \"16rem\",\n    \"--sidebar-width-icon\": \"3rem\",\n  };\n\n  if (!developer) {\n    return (\n      <div className=\"min-h-screen\">\n        <Router />\n      </div>\n    );\n  }\n\n  return (\n    <SidebarProvider style={style as React.CSSProperties}>\n      <div className=\"flex h-screen w-full\">\n        <AppSidebar />\n        <div className=\"flex flex-col flex-1\">\n          <header className=\"flex items-center justify-between p-4 border-b\">\n            <div className=\"flex items-center gap-2\">\n              <SidebarTrigger data-testid=\"button-sidebar-toggle\" />\n              <span className=\"text-sm text-muted-foreground\" data-testid=\"text-developer-email\">\n                {developer.email}\n              </span>\n            </div>\n            <div className=\"flex items-center gap-2\">\n              <LanguageToggle />\n              <ThemeToggle />\n              <Button variant=\"ghost\" size=\"sm\" onClick={logout} data-testid=\"button-logout\">\n                <LogOut className=\"h-4 w-4 mr-2\" />\n                {t('nav.logout')}\n              </Button>\n            </div>\n          </header>\n          <main className=\"flex-1 overflow-auto\">\n            <Router />\n          </main>\n        </div>\n      </div>\n    </SidebarProvider>\n  );\n}\n\nexport default function App() {\n  return (\n    <QueryClientProvider client={queryClient}>\n      <TooltipProvider>\n        <AuthProvider>\n          <AppContent />\n          <Toaster />\n        </AuthProvider>\n      </TooltipProvider>\n    </QueryClientProvider>\n  );\n}\n","size_bytes":7256},"client/src/index.css":{"content":"@tailwind base;\n@tailwind components;\n@tailwind utilities;\n\n/* LIGHT MODE */\n:root {\n  --button-outline: rgba(0,0,0, .10);\n  --badge-outline: rgba(0,0,0, .05);\n\n  /* Automatic computation of border around primary / danger buttons */\n  --opaque-button-border-intensity: -8; /* In terms of percentages */\n\n  /* Backgrounds applied on top of other backgrounds when hovered/active */\n  --elevate-1: rgba(0,0,0, .03);\n  --elevate-2: rgba(0,0,0, .08);\n\n  --background: 0 0% 100%;\n\n  --foreground: 220 10% 15%;\n\n  --border: 220 8% 88%;\n\n  --card: 220 4% 98%;\n\n  --card-foreground: 220 10% 15%;\n\n  --card-border: 220 8% 92%;\n\n  --sidebar: 220 5% 96%;\n\n  --sidebar-foreground: 220 10% 15%;\n\n  --sidebar-border: 220 8% 90%;\n\n  --sidebar-primary: 214 95% 48%;\n\n  --sidebar-primary-foreground: 210 20% 98%;\n\n  --sidebar-accent: 220 8% 92%;\n\n  --sidebar-accent-foreground: 220 10% 20%;\n\n  --sidebar-ring: 214 95% 48%;\n\n  --popover: 220 6% 94%;\n\n  --popover-foreground: 220 10% 15%;\n\n  --popover-border: 220 8% 88%;\n\n  --primary: 214 95% 48%;\n\n  --primary-foreground: 210 20% 98%;\n\n  --secondary: 220 8% 90%;\n\n  --secondary-foreground: 220 10% 20%;\n\n  --muted: 220 10% 94%;\n\n  --muted-foreground: 220 8% 40%;\n\n  --accent: 220 12% 92%;\n\n  --accent-foreground: 220 10% 18%;\n\n  --destructive: 0 84% 45%;\n\n  --destructive-foreground: 0 20% 98%;\n\n  --input: 220 10% 75%;\n  --ring: 214 95% 48%;\n  --chart-1: 214 95% 48%;\n  --chart-2: 173 70% 42%;\n  --chart-3: 280 75% 52%;\n  --chart-4: 45 95% 50%;\n  --chart-5: 32 88% 55%;\n\n  --font-sans: Inter, -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, sans-serif;\n  --font-serif: Georgia, serif;\n  --font-mono: \"JetBrains Mono\", Menlo, Monaco, \"Courier New\", monospace;\n  --radius: .5rem; /* 8px */\n  --shadow-2xs: 0px 1px 2px 0px hsl(220 10% 15% / 0.04);\n  --shadow-xs: 0px 1px 3px 0px hsl(220 10% 15% / 0.08);\n  --shadow-sm: 0px 2px 4px 0px hsl(220 10% 15% / 0.06), 0px 1px 2px -1px hsl(220 10% 15% / 0.04);\n  --shadow: 0px 4px 6px 0px hsl(220 10% 15% / 0.07), 0px 2px 3px -1px hsl(220 10% 15% / 0.05);\n  --shadow-md: 0px 6px 12px 0px hsl(220 10% 15% / 0.08), 0px 3px 5px -2px hsl(220 10% 15% / 0.06);\n  --shadow-lg: 0px 10px 20px 0px hsl(220 10% 15% / 0.10), 0px 4px 8px -2px hsl(220 10% 15% / 0.08);\n  --shadow-xl: 0px 16px 32px 0px hsl(220 10% 15% / 0.12), 0px 6px 12px -4px hsl(220 10% 15% / 0.10);\n  --shadow-2xl: 0px 24px 48px 0px hsl(220 10% 15% / 0.16);\n  --tracking-normal: 0em;\n  --spacing: 0.25rem;\n\n  /* Automatically computed borders - intensity can be controlled by the user by the --opaque-button-border-intensity setting */\n\n  /* Fallback for older browsers */\n  --sidebar-primary-border: hsl(var(--sidebar-primary));\n  --sidebar-primary-border: hsl(from hsl(var(--sidebar-primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --sidebar-accent-border: hsl(var(--sidebar-accent));\n  --sidebar-accent-border: hsl(from hsl(var(--sidebar-accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --primary-border: hsl(var(--primary));\n  --primary-border: hsl(from hsl(var(--primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --secondary-border: hsl(var(--secondary));\n  --secondary-border: hsl(from hsl(var(--secondary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --muted-border: hsl(var(--muted));\n  --muted-border: hsl(from hsl(var(--muted)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --accent-border: hsl(var(--accent));\n  --accent-border: hsl(from hsl(var(--accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --destructive-border: hsl(var(--destructive));\n  --destructive-border: hsl(from hsl(var(--destructive)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n}\n\n.dark {\n  --button-outline: rgba(255,255,255, .10);\n  --badge-outline: rgba(255,255,255, .05);\n\n  --opaque-button-border-intensity: 9;  /* In terms of percentages */\n\n  /* Backgrounds applied on top of other backgrounds when hovered/active */\n  --elevate-1: rgba(255,255,255, .04);\n  --elevate-2: rgba(255,255,255, .09);\n\n  --background: 220 6% 9%;\n\n  --foreground: 220 8% 92%;\n\n  --border: 220 6% 18%;\n\n  --card: 220 5% 11%;\n\n  --card-foreground: 220 8% 92%;\n\n  --card-border: 220 6% 16%;\n\n  --sidebar: 220 5% 13%;\n\n  --sidebar-foreground: 220 8% 92%;\n\n  --sidebar-border: 220 6% 20%;\n\n  --sidebar-primary: 214 92% 55%;\n\n  --sidebar-primary-foreground: 210 20% 98%;\n\n  --sidebar-accent: 220 8% 18%;\n\n  --sidebar-accent-foreground: 220 8% 88%;\n\n  --sidebar-ring: 214 92% 55%;\n\n  --popover: 220 5% 15%;\n\n  --popover-foreground: 220 8% 92%;\n\n  --popover-border: 220 6% 22%;\n\n  --primary: 214 92% 55%;\n\n  --primary-foreground: 210 20% 98%;\n\n  --secondary: 220 8% 20%;\n\n  --secondary-foreground: 220 8% 88%;\n\n  --muted: 220 8% 17%;\n\n  --muted-foreground: 220 6% 65%;\n\n  --accent: 220 10% 18%;\n\n  --accent-foreground: 220 8% 90%;\n\n  --destructive: 0 80% 50%;\n\n  --destructive-foreground: 0 20% 98%;\n\n  --input: 220 8% 35%;\n  --ring: 214 92% 55%;\n  --chart-1: 214 92% 65%;\n  --chart-2: 173 65% 58%;\n  --chart-3: 280 70% 68%;\n  --chart-4: 45 90% 65%;\n  --chart-5: 32 85% 65%;\n\n  --shadow-2xs: 0px 1px 2px 0px hsl(220 10% 0% / 0.20);\n  --shadow-xs: 0px 1px 3px 0px hsl(220 10% 0% / 0.30);\n  --shadow-sm: 0px 2px 4px 0px hsl(220 10% 0% / 0.25), 0px 1px 2px -1px hsl(220 10% 0% / 0.20);\n  --shadow: 0px 4px 6px 0px hsl(220 10% 0% / 0.30), 0px 2px 3px -1px hsl(220 10% 0% / 0.25);\n  --shadow-md: 0px 6px 12px 0px hsl(220 10% 0% / 0.35), 0px 3px 5px -2px hsl(220 10% 0% / 0.28);\n  --shadow-lg: 0px 10px 20px 0px hsl(220 10% 0% / 0.40), 0px 4px 8px -2px hsl(220 10% 0% / 0.32);\n  --shadow-xl: 0px 16px 32px 0px hsl(220 10% 0% / 0.45), 0px 6px 12px -4px hsl(220 10% 0% / 0.38);\n  --shadow-2xl: 0px 24px 48px 0px hsl(220 10% 0% / 0.50);\n\n}\n\n@layer base {\n  * {\n    @apply border-border;\n  }\n\n  body {\n    @apply font-sans antialiased bg-background text-foreground;\n  }\n}\n\n/**\n * Using the elevate system.\n * Automatic contrast adjustment.\n *\n * <element className=\"hover-elevate\" />\n * <element className=\"active-elevate-2\" />\n *\n * // Using the tailwind utility when a data attribute is \"on\"\n * <element className=\"toggle-elevate data-[state=on]:toggle-elevated\" />\n * // Or manually controlling the toggle state\n * <element className=\"toggle-elevate toggle-elevated\" />\n *\n * Elevation systems have to handle many states.\n * - not-hovered, vs. hovered vs. active  (three mutually exclusive states)\n * - toggled or not\n * - focused or not (this is not handled with these utilities)\n *\n * Even without handling focused or not, this is six possible combinations that\n * need to be distinguished from eachother visually.\n */\n@layer utilities {\n\n  /* Hide ugly search cancel button in Chrome until we can style it properly */\n  input[type=\"search\"]::-webkit-search-cancel-button {\n    @apply hidden;\n  }\n\n  /* Placeholder styling for contentEditable div */\n  [contenteditable][data-placeholder]:empty::before {\n    content: attr(data-placeholder);\n    color: hsl(var(--muted-foreground));\n    pointer-events: none;\n  }\n\n  /* .no-default-hover-elevate/no-default-active-elevate is an escape hatch so consumers of\n   * buttons/badges can remove the automatic brightness adjustment on interactions\n   * and program their own. */\n  .no-default-hover-elevate {}\n\n  .no-default-active-elevate {}\n\n\n  /**\n   * Toggleable backgrounds go behind the content. Hoverable/active goes on top.\n   * This way they can stack/compound. Both will overlap the parent's borders!\n   * So borders will be automatically adjusted both on toggle, and hover/active,\n   * and they will be compounded.\n   */\n  .toggle-elevate::before,\n  .toggle-elevate-2::before {\n    content: \"\";\n    pointer-events: none;\n    position: absolute;\n    inset: 0px;\n    /*border-radius: inherit;   match rounded corners */\n    border-radius: inherit;\n    z-index: -1;\n    /* sits behind content but above backdrop */\n  }\n\n  .toggle-elevate.toggle-elevated::before {\n    background-color: var(--elevate-2);\n  }\n\n  /* If there's a 1px border, adjust the inset so that it covers that parent's border */\n  .border.toggle-elevate::before {\n    inset: -1px;\n  }\n\n  /* Does not work on elements with overflow:hidden! */\n  .hover-elevate:not(.no-default-hover-elevate),\n  .active-elevate:not(.no-default-active-elevate),\n  .hover-elevate-2:not(.no-default-hover-elevate),\n  .active-elevate-2:not(.no-default-active-elevate) {\n    position: relative;\n    z-index: 0;\n  }\n\n  .hover-elevate:not(.no-default-hover-elevate)::after,\n  .active-elevate:not(.no-default-active-elevate)::after,\n  .hover-elevate-2:not(.no-default-hover-elevate)::after,\n  .active-elevate-2:not(.no-default-active-elevate)::after {\n    content: \"\";\n    pointer-events: none;\n    position: absolute;\n    inset: 0px;\n    /*border-radius: inherit;   match rounded corners */\n    border-radius: inherit;\n    z-index: 999;\n    /* sits in front of content */\n  }\n\n  .hover-elevate:hover:not(.no-default-hover-elevate)::after,\n  .active-elevate:active:not(.no-default-active-elevate)::after {\n    background-color: var(--elevate-1);\n  }\n\n  .hover-elevate-2:hover:not(.no-default-hover-elevate)::after,\n  .active-elevate-2:active:not(.no-default-active-elevate)::after {\n    background-color: var(--elevate-2);\n  }\n\n  /* If there's a 1px border, adjust the inset so that it covers that parent's border */\n  .border.hover-elevate:not(.no-hover-interaction-elevate)::after,\n  .border.active-elevate:not(.no-active-interaction-elevate)::after,\n  .border.hover-elevate-2:not(.no-hover-interaction-elevate)::after,\n  .border.active-elevate-2:not(.no-active-interaction-elevate)::after,\n  .border.hover-elevate:not(.no-hover-interaction-elevate)::after {\n    inset: -1px;\n  }\n}\n\n/* Modern Dashboard Gradients and 3D Effects */\n.dashboard-gradient {\n  background: \n    radial-gradient(ellipse at top left, hsl(var(--primary) / 0.05) 0%, transparent 50%),\n    radial-gradient(ellipse at bottom right, hsl(var(--chart-2) / 0.05) 0%, transparent 50%),\n    radial-gradient(ellipse at top right, hsl(var(--chart-3) / 0.03) 0%, transparent 50%),\n    hsl(var(--background));\n  background-attachment: fixed;\n}\n\n.dark .dashboard-gradient {\n  background: \n    radial-gradient(ellipse at top left, hsl(var(--primary) / 0.08) 0%, transparent 50%),\n    radial-gradient(ellipse at bottom right, hsl(var(--chart-2) / 0.08) 0%, transparent 50%),\n    radial-gradient(ellipse at top right, hsl(var(--chart-3) / 0.05) 0%, transparent 50%),\n    hsl(var(--background));\n  background-attachment: fixed;\n}\n\n/* Glassmorphism effect */\n@supports (backdrop-filter: blur(10px)) {\n  .glass-effect {\n    background: linear-gradient(\n      135deg,\n      rgba(255, 255, 255, 0.1),\n      rgba(255, 255, 255, 0.05)\n    );\n    backdrop-filter: blur(10px) saturate(180%);\n    border: 1px solid rgba(255, 255, 255, 0.18);\n  }\n\n  .dark .glass-effect {\n    background: linear-gradient(\n      135deg,\n      rgba(255, 255, 255, 0.05),\n      rgba(255, 255, 255, 0.02)\n    );\n    backdrop-filter: blur(10px) saturate(180%);\n    border: 1px solid rgba(255, 255, 255, 0.1);\n  }\n}\n\n/* 3D Card Transforms */\n@media (prefers-reduced-motion: no-preference) {\n  .card-3d {\n    transform-style: preserve-3d;\n    transition: all 0.3s cubic-bezier(0.22, 1, 0.36, 1);\n  }\n\n  .card-3d:hover {\n    transform: translateY(-8px) rotateX(5deg);\n  }\n\n  .card-3d::before {\n    content: \"\";\n    position: absolute;\n    inset: 0;\n    border-radius: inherit;\n    background: linear-gradient(\n      135deg,\n      transparent 0%,\n      rgba(255, 255, 255, 0.05) 50%,\n      transparent 100%\n    );\n    opacity: 0;\n    transition: opacity 0.3s;\n    pointer-events: none;\n  }\n\n  .card-3d:hover::before {\n    opacity: 1;\n  }\n}\n\n/* Animated gradient text */\n@keyframes gradient-shift {\n  0%, 100% {\n    background-position: 0% 50%;\n  }\n  50% {\n    background-position: 100% 50%;\n  }\n}\n\n.animate-gradient {\n  background-size: 200% 200%;\n  animation: gradient-shift 3s ease infinite;\n}\n\n/* Smooth scrollbar */\n::-webkit-scrollbar {\n  width: 8px;\n  height: 8px;\n}\n\n::-webkit-scrollbar-track {\n  background: hsl(var(--muted) / 0.3);\n  border-radius: 4px;\n}\n\n::-webkit-scrollbar-thumb {\n  background: hsl(var(--muted-foreground) / 0.3);\n  border-radius: 4px;\n  transition: background 0.2s;\n}\n\n::-webkit-scrollbar-thumb:hover {\n  background: hsl(var(--muted-foreground) / 0.5);\n}\n\n/* Code blocks responsive styling */\npre, code {\n  overflow-wrap: break-word;\n  word-wrap: break-word;\n  word-break: break-word;\n}\n\npre {\n  overflow-x: auto !important;\n  max-width: 100%;\n}\n\n@media (max-width: 640px) {\n  pre, code {\n    font-size: 0.65rem !important;\n  }\n  \n  pre {\n    padding: 0.75rem !important;\n  }\n}\n\n/* 3D and Modern Animations */\n@keyframes blob {\n  0%, 100% {\n    transform: translate(0, 0) scale(1);\n  }\n  25% {\n    transform: translate(20px, -50px) scale(1.1);\n  }\n  50% {\n    transform: translate(-20px, 20px) scale(0.9);\n  }\n  75% {\n    transform: translate(50px, 50px) scale(1.05);\n  }\n}\n\n@keyframes floating {\n  0%, 100% {\n    transform: translateY(0px) rotateZ(0deg);\n  }\n  50% {\n    transform: translateY(-20px) rotateZ(3deg);\n  }\n}\n\n@keyframes pulse-slow {\n  0%, 100% {\n    opacity: 0.6;\n  }\n  50% {\n    opacity: 0.8;\n  }\n}\n\n.animate-blob {\n  animation: blob 7s infinite;\n}\n\n.animation-delay-2000 {\n  animation-delay: 2s;\n}\n\n.animation-delay-4000 {\n  animation-delay: 4s;\n}\n\n.floating {\n  animation: floating 3s ease-in-out infinite;\n}\n\n.animate-pulse-slow {\n  animation: pulse-slow 4s ease-in-out infinite;\n}\n\n.perspective-1000 {\n  perspective: 1000px;\n}\n\n.transform-gpu {\n  transform: translateZ(0);\n  backface-visibility: hidden;\n}\n\n/* Glassmorphism effects */\n.glass {\n  background: rgba(255, 255, 255, 0.1);\n  backdrop-filter: blur(10px);\n  -webkit-backdrop-filter: blur(10px);\n  border: 1px solid rgba(255, 255, 255, 0.2);\n}\n\n.dark .glass {\n  background: rgba(0, 0, 0, 0.2);\n  border: 1px solid rgba(255, 255, 255, 0.1);\n}\n\n/* Enhanced shadow for 3D effect */\n.shadow-3xl {\n  box-shadow: 0 35px 60px -15px rgba(0, 0, 0, 0.3);\n}\n\n/* Bouncing text animation */\n@keyframes bounce-letter {\n  0%, 16.67%, 100% {\n    transform: translateY(0);\n  }\n  8.33% {\n    transform: translateY(-20px);\n  }\n}\n\n.bounce-letter {\n  display: inline-block;\n  animation: bounce-letter 3.6s ease-in-out infinite;\n  animation-fill-mode: both;\n}\n\n/* Captcha overlay animations (matching api.js) */\n@keyframes fadeIn {\n  from {\n    opacity: 0;\n  }\n  to {\n    opacity: 1;\n  }\n}\n\n@keyframes slideUp {\n  from {\n    opacity: 0;\n    transform: translateY(20px) scale(0.95);\n  }\n  to {\n    opacity: 1;\n    transform: translateY(0) scale(1);\n  }\n}\n\n.captcha-overlay-fade {\n  animation: fadeIn 0.2s ease-in-out;\n}\n\n.captcha-modal-slide {\n  animation: slideUp 0.2s ease-in-out;\n}\n\n/* Accessibility: Disable animations for users who prefer reduced motion */\n@media (prefers-reduced-motion: reduce) {\n  .bounce-letter,\n  .captcha-overlay-fade,\n  .captcha-modal-slide {\n    animation: none;\n  }\n}","size_bytes":15153},"server/enhancements/session-binding.ts":{"content":"/**\n * Session Fingerprint Binding\n * \n * Bind challenge tokens ke session fingerprint untuk mencegah\n * token stealing dan replay attacks dari device/browser lain\n */\n\nimport crypto from \"crypto\";\nimport { Request } from \"express\";\n\nexport interface SessionFingerprint {\n  hash: string;           // Final fingerprint hash\n  components: string[];   // Components yang digunakan\n  confidence: number;     // Confidence score 0-100\n  isReliable: boolean;    // Apakah fingerprint cukup reliable\n}\n\n/**\n * Generate session fingerprint dari request\n */\nexport function generateSessionFingerprint(req: Request): SessionFingerprint {\n  const components: string[] = [];\n  let confidence = 0;\n  \n  // Component 1: User Agent (weight: 20)\n  const userAgent = req.headers['user-agent'];\n  if (userAgent) {\n    components.push(`ua:${userAgent}`);\n    confidence += 20;\n  }\n  \n  // Component 2: Accept Language (weight: 10)\n  const acceptLanguage = req.headers['accept-language'];\n  if (acceptLanguage) {\n    components.push(`lang:${acceptLanguage}`);\n    confidence += 10;\n  }\n  \n  // Component 3: Accept Encoding (weight: 10)\n  const acceptEncoding = req.headers['accept-encoding'];\n  if (acceptEncoding) {\n    components.push(`enc:${acceptEncoding}`);\n    confidence += 10;\n  }\n  \n  // Component 4: Sec-CH-UA (Chrome User Agent Client Hints) (weight: 15)\n  const secChUa = req.headers['sec-ch-ua'];\n  if (secChUa) {\n    components.push(`chu:${secChUa}`);\n    confidence += 15;\n  }\n  \n  // Component 5: Sec-CH-UA-Platform (weight: 10)\n  const secChUaPlatform = req.headers['sec-ch-ua-platform'];\n  if (secChUaPlatform) {\n    components.push(`chp:${secChUaPlatform}`);\n    confidence += 10;\n  }\n  \n  // Component 6: Sec-CH-UA-Mobile (weight: 5)\n  const secChUaMobile = req.headers['sec-ch-ua-mobile'];\n  if (secChUaMobile) {\n    components.push(`chm:${secChUaMobile}`);\n    confidence += 5;\n  }\n  \n  // Component 7: IP Address (weight: 20)\n  const ip = req.socket.remoteAddress || req.headers['x-forwarded-for'];\n  if (ip) {\n    components.push(`ip:${ip}`);\n    confidence += 20;\n  }\n  \n  // Component 8: TLS Cipher (weight: 10)\n  const tlsCipher = (req.socket as any).getCipher?.();\n  if (tlsCipher) {\n    components.push(`tls:${tlsCipher.name}`);\n    confidence += 10;\n  }\n  \n  // Generate hash dari semua components\n  const fingerprintString = components.join('|');\n  const hash = crypto\n    .createHash('sha256')\n    .update(fingerprintString)\n    .digest('hex');\n  \n  return {\n    hash,\n    components,\n    confidence: Math.min(confidence, 100),\n    isReliable: confidence >= 50, // Minimum 50% confidence\n  };\n}\n\n/**\n * Verify session fingerprint matches\n */\nexport function verifySessionFingerprint(\n  storedFingerprint: string,\n  currentRequest: Request,\n  allowPartialMatch: boolean = false\n): boolean {\n  const currentFingerprint = generateSessionFingerprint(currentRequest);\n  \n  // Exact match\n  if (currentFingerprint.hash === storedFingerprint) {\n    return true;\n  }\n  \n  // If partial match allowed, check if fingerprint is still reliable\n  if (allowPartialMatch) {\n    // Dalam kasus edge (network changes, VPN switch, dll)\n    // kita bisa allow kalau confidence masih tinggi\n    return currentFingerprint.isReliable;\n  }\n  \n  return false;\n}\n\n/**\n * Compare two fingerprints and calculate similarity score\n */\nexport function calculateFingerprintSimilarity(\n  fp1: SessionFingerprint,\n  fp2: SessionFingerprint\n): number {\n  if (fp1.hash === fp2.hash) {\n    return 1.0; // 100% match\n  }\n  \n  // Calculate component overlap\n  const set1 = new Set(fp1.components);\n  const set2 = new Set(fp2.components);\n  \n  const intersection = new Set(Array.from(set1).filter(x => set2.has(x)));\n  const union = new Set([...Array.from(set1), ...Array.from(set2)]);\n  \n  // Jaccard similarity\n  return intersection.size / union.size;\n}\n\n/**\n * Enhanced session binding dengan fuzzy matching\n */\nexport interface SessionBindingConfig {\n  strictMode: boolean;          // Require exact match\n  similarityThreshold: number;  // Minimum similarity untuk fuzzy match (0-1)\n  allowIpChange: boolean;       // Allow IP address changes\n}\n\nexport const DEFAULT_SESSION_BINDING_CONFIG: SessionBindingConfig = {\n  strictMode: false,\n  similarityThreshold: 0.7, // 70% similarity required\n  allowIpChange: false,\n};\n\nexport function verifySessionBinding(\n  storedFingerprint: string,\n  currentRequest: Request,\n  config: SessionBindingConfig = DEFAULT_SESSION_BINDING_CONFIG\n): { isValid: boolean; similarity?: number; reason?: string } {\n  const currentFp = generateSessionFingerprint(currentRequest);\n  \n  // Exact match\n  if (currentFp.hash === storedFingerprint) {\n    return { isValid: true, similarity: 1.0 };\n  }\n  \n  // Strict mode requires exact match\n  if (config.strictMode) {\n    return { \n      isValid: false, \n      reason: 'Strict mode requires exact fingerprint match',\n      similarity: 0\n    };\n  }\n  \n  // Fuzzy matching untuk handle edge cases\n  // (Note: kita perlu stored fingerprint components untuk fuzzy matching)\n  // Untuk simplifikasi, kita assume partial match OK jika fingerprint reliable\n  if (currentFp.isReliable && currentFp.confidence >= 70) {\n    return { \n      isValid: true, \n      similarity: 0.7,\n      reason: 'Partial match with high confidence'\n    };\n  }\n  \n  return { \n    isValid: false, \n    similarity: 0,\n    reason: 'Fingerprint mismatch and low confidence'\n  };\n}\n\n/**\n * Example usage:\n * \n * // During challenge creation:\n * const fingerprint = generateSessionFingerprint(req);\n * challenge.sessionFingerprint = fingerprint.hash;\n * \n * // During verification:\n * const bindingCheck = verifySessionBinding(\n *   challenge.sessionFingerprint,\n *   req\n * );\n * if (!bindingCheck.isValid) {\n *   return res.json({\n *     success: false,\n *     error: \"Session fingerprint mismatch\",\n *     reason: bindingCheck.reason\n *   });\n * }\n */\n","size_bytes":5871},"client/src/components/ui/textarea.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Textarea = React.forwardRef<\n  HTMLTextAreaElement,\n  React.ComponentProps<\"textarea\">\n>(({ className, ...props }, ref) => {\n  return (\n    <textarea\n      className={cn(\n        \"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  )\n})\nTextarea.displayName = \"Textarea\"\n\nexport { Textarea }\n","size_bytes":689},"server/public/php/README_PHP.md":{"content":"# üêò PHP ProofCaptcha Integration\n\nFile-file ini untuk **diupload ke server Anda sendiri** (seperti api-server.cloud), bukan di Replit.\n\n---\n\n## üìÅ Files\n\n```\nphp/\n‚îú‚îÄ‚îÄ index.html       ‚Üê Form HTML dengan ProofCaptcha widget\n‚îú‚îÄ‚îÄ backend.php      ‚Üê PHP backend untuk validasi token\n‚îî‚îÄ‚îÄ README_PHP.md    ‚Üê File ini\n```\n\n---\n\n## üöÄ Quick Setup (5 Menit)\n\n### Step 1: Download Files\n\nDownload kedua file:\n- `index.html`\n- `backend.php`\n\nAtau download seluruh folder `php`.\n\n---\n\n### Step 2: Konfigurasi index.html\n\nBuka `index.html` dan edit **2 tempat**:\n\n#### A. Ganti Sitekey (Baris ~102)\n\n```html\n<!-- CARI BARIS INI -->\n<div \n    class=\"proof-captcha\"\n    data-sitekey=\"YOUR_SITEKEY_HERE\"  ‚Üê GANTI INI!\n    data-theme=\"light\"\n    data-type=\"random\"\n    data-callback=\"onCaptchaSuccess\"\n></div>\n```\n\nGanti `YOUR_SITEKEY_HERE` dengan **Sitekey** dari dashboard ProofCaptcha.\n\n**Contoh:**\n```html\ndata-sitekey=\"pk_abc123def456...\"\n```\n\n#### B. Ganti Domain Replit (Baris ~161)\n\n```html\n<!-- CARI BARIS INI -->\n<script src=\"https://fc9a75ad-...-replit.dev/proofCaptcha/api.js\"></script>\n```\n\nJika domain Replit Anda berbeda, ganti dengan domain Anda.\n\n---\n\n### Step 3: Konfigurasi backend.php\n\nBuka `backend.php` dan edit **2 nilai** di bagian konfigurasi (baris 17-22):\n\n```php\n<?php\n// CARI BAGIAN INI\n\n// 1. Domain Replit ProofCaptcha Server\ndefine('REPLIT_DOMAIN', 'fc9a75ad-...-replit.dev');  // ‚Üê Ganti jika perlu\n\n// 2. Secret Key dari dashboard (RAHASIA!)\ndefine('API_SECRET_KEY', 'YOUR_SECRET_KEY_HERE');  // ‚Üê GANTI INI!\n```\n\n**‚ö†Ô∏è PENTING:**\n- **Ganti** `YOUR_SECRET_KEY_HERE` dengan **Secret Key** (bukan Sitekey!)\n- Secret Key dimulai dengan `sk_...`\n- **JANGAN** share secret key ke publik!\n\n**Contoh:**\n```php\ndefine('API_SECRET_KEY', 'sk_xyz789abc123...');\n```\n\n---\n\n### Step 4: Upload ke Server\n\nUpload kedua file ke server Anda:\n\n```bash\n# Via FTP/SFTP\n/var/www/html/php/index.html\n/var/www/html/php/backend.php\n\n# Via command line\nscp index.html backend.php user@api-server.cloud:/var/www/html/php/\n```\n\n**Struktur di server:**\n```\napi-server.cloud/\n‚îî‚îÄ‚îÄ php/\n    ‚îú‚îÄ‚îÄ index.html\n    ‚îî‚îÄ‚îÄ backend.php\n```\n\n---\n\n### Step 5: Set Permissions (Jika Perlu)\n\nPastikan PHP bisa execute `backend.php`:\n\n```bash\nchmod 644 index.html\nchmod 644 backend.php\n```\n\n---\n\n### Step 6: Test!\n\nBuka di browser:\n```\nhttps://api-server.cloud/php/index.html\n```\n\n**Testing checklist:**\n- [ ] Captcha widget muncul\n- [ ] Bisa solve captcha (checkbox/puzzle)\n- [ ] Form bisa disubmit\n- [ ] Dapat response success dari backend\n- [ ] Check browser console untuk errors\n\n---\n\n## üîß Cara Kerja\n\n```\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ                    Your Server (api-server.cloud)            ‚îÇ\n‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îÇ\n‚îÇ  ‚îÇ index.html   ‚îÇ   ‚Üí     ‚îÇ backend.php              ‚îÇ     ‚îÇ\n‚îÇ  ‚îÇ (Frontend)   ‚îÇ         ‚îÇ (Validasi token)         ‚îÇ     ‚îÇ\n‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îÇ\n‚îÇ        ‚Üì                            ‚Üì                        ‚îÇ\n‚îÇ   User solve                   Kirim token                  ‚îÇ\n‚îÇ   captcha                      ke Replit                    ‚îÇ\n‚îÇ        ‚Üì                            ‚Üì                        ‚îÇ\n‚îÇ   Get token ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                       ‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n                                       ‚Üì\n                        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n                        ‚îÇ  Replit ProofCaptcha Server  ‚îÇ\n                        ‚îÇ  (Validasi & return result)  ‚îÇ\n                        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n```\n\n**Flow Detail:**\n\n1. **User** buka `https://api-server.cloud/php/index.html`\n2. **Frontend** load ProofCaptcha widget dari server Replit\n3. **User** solve captcha (klik checkbox atau puzzle)\n4. **Frontend** dapat `verificationToken` dari callback\n5. **User** submit form ‚Üí data + token kirim ke `backend.php`\n6. **backend.php** validasi token ke `https://[REPLIT]/api/captcha/verify-token`\n7. **Replit** return success/failed\n8. **backend.php** proses registrasi jika token valid\n9. **backend.php** return response ke frontend\n10. **Frontend** tampilkan hasil ke user\n\n---\n\n## üîê Keamanan\n\n### ‚úÖ DO (Lakukan):\n\n1. **Simpan Secret Key di Environment Variable**\n   ```php\n   // Production\n   define('API_SECRET_KEY', getenv('CAPTCHA_SECRET_KEY'));\n   ```\n\n2. **Validasi Input di Backend**\n   ```php\n   if (!filter_var($email, FILTER_VALIDATE_EMAIL)) {\n       // Reject\n   }\n   ```\n\n3. **Use HTTPS**\n   ```\n   https://api-server.cloud/php/\n   ```\n\n4. **Set Proper Domain di API Key**\n   - Dashboard ‚Üí API Keys ‚Üí Domain: `api-server.cloud`\n\n5. **Enable Error Logging**\n   ```php\n   error_log('Captcha failed: ' . $error);\n   ```\n\n### ‚ùå DON'T (Jangan):\n\n1. **Jangan commit Secret Key ke Git**\n   ```php\n   // ‚ùå WRONG\n   define('API_SECRET_KEY', 'sk_real_secret_key_here');\n   ```\n\n2. **Jangan validasi token di frontend**\n   ```javascript\n   // ‚ùå WRONG - Token harus divalidasi di backend!\n   if (token.length > 0) { /* allow submit */ }\n   ```\n\n3. **Jangan expose error details ke user**\n   ```php\n   // ‚ùå WRONG\n   echo \"Database error: \" . $e->getMessage();\n   \n   // ‚úÖ CORRECT\n   error_log($e->getMessage());\n   echo \"An error occurred\";\n   ```\n\n4. **Jangan skip captcha validation**\n   ```php\n   // ‚ùå WRONG - Selalu validasi!\n   // if (!empty($token)) { /* process without validation */ }\n   \n   // ‚úÖ CORRECT\n   $result = validateCaptcha($token);\n   if ($result['success']) { /* process */ }\n   ```\n\n---\n\n## üß™ Testing\n\n### Test 1: Captcha Widget Muncul?\n\nBuka browser console (`F12`):\n```javascript\n// Cek script loaded\nconsole.log(window.ProofCaptcha);  // Should be object\n\n// Cek widget rendered\ndocument.querySelector('.proof-captcha');  // Should exist\n```\n\n### Test 2: Token Validation Works?\n\nSubmit form dan check network tab (`F12` ‚Üí Network):\n\n**Request to backend.php:**\n```\nPOST https://api-server.cloud/php/backend.php\ncaptcha_token: eyJhbGc...\nname: John Doe\nemail: john@example.com\n```\n\n**Response should be:**\n```json\n{\n  \"success\": true,\n  \"message\": \"Registrasi berhasil!\",\n  \"data\": {...}\n}\n```\n\n### Test 3: Error Handling Works?\n\nTry to submit **without** solving captcha:\n- Should show error: \"captcha harus diselesaikan\"\n\nTry with **invalid token**:\n- Should show error: \"Verifikasi CAPTCHA gagal\"\n\n---\n\n## üêõ Troubleshooting\n\n### Captcha Widget Tidak Muncul\n\n**Problem:** Widget kosong atau tidak render\n\n**Solutions:**\n1. Check browser console untuk error\n2. Pastikan script URL benar:\n   ```html\n   <script src=\"https://[REPLIT_DOMAIN]/proofCaptcha/api.js\"></script>\n   ```\n3. Pastikan sitekey benar (pk_...)\n4. Check CORS - pastikan domain allowed\n\n---\n\n### Error: \"Verifikasi CAPTCHA gagal\"\n\n**Problem:** Backend tidak bisa validasi token\n\n**Solutions:**\n1. **Check Secret Key**\n   ```php\n   define('API_SECRET_KEY', 'sk_...');  // Bukan pk_!\n   ```\n\n2. **Check Authorization Header**\n   ```php\n   'Authorization: Bearer ' . API_SECRET_KEY\n   ```\n\n3. **Check cURL installed**\n   ```bash\n   php -m | grep curl\n   ```\n\n4. **Enable error logging**\n   ```php\n   error_log(json_encode($captchaResult));\n   ```\n\n5. **Test endpoint directly**\n   ```bash\n   curl -X POST https://[REPLIT]/api/captcha/verify-token \\\n     -H \"Content-Type: application/json\" \\\n     -H \"Authorization: Bearer sk_your_key\" \\\n     -d '{\"token\": \"your_token\"}'\n   ```\n\n---\n\n### Error: \"Domain Mismatch\"\n\n**Problem:** Domain tidak match dengan API key setting\n\n**Solutions:**\n1. Check domain di dashboard API Keys\n2. Pastikan match dengan domain server Anda:\n   ```\n   Dashboard: api-server.cloud\n   Server:    api-server.cloud  ‚úì\n   ```\n3. Untuk testing, set domain ke `*` (wildcard)\n\n---\n\n### PHP Errors\n\n**Problem:** 500 Internal Server Error\n\n**Solutions:**\n1. **Enable PHP error display**\n   ```php\n   error_reporting(E_ALL);\n   ini_set('display_errors', 1);\n   ```\n\n2. **Check PHP error log**\n   ```bash\n   tail -f /var/log/apache2/error.log\n   # or\n   tail -f /var/log/php-fpm/error.log\n   ```\n\n3. **Check file permissions**\n   ```bash\n   ls -la backend.php  # Should be readable\n   ```\n\n---\n\n## üìù Customization\n\n### Change Form Fields\n\nEdit `index.html`:\n```html\n<div class=\"form-group\">\n    <label for=\"phone\">Phone Number</label>\n    <input type=\"tel\" id=\"phone\" name=\"phone\" required>\n</div>\n```\n\nEdit `backend.php`:\n```php\n$phone = $_POST['phone'] ?? '';\n\nif (empty($phone)) {\n    echo json_encode(['success' => false, 'message' => 'Phone required']);\n    exit;\n}\n```\n\n### Save to Database\n\nEdit `backend.php`:\n```php\n// After captcha validation success\ntry {\n    $pdo = new PDO('mysql:host=localhost;dbname=mydb', 'user', 'pass');\n    $stmt = $pdo->prepare('INSERT INTO users (name, email) VALUES (?, ?)');\n    $stmt->execute([$name, $email]);\n    \n    $userId = $pdo->lastInsertId();\n    \n    echo json_encode([\n        'success' => true,\n        'message' => 'User created',\n        'userId' => $userId\n    ]);\n} catch (PDOException $e) {\n    error_log('DB Error: ' . $e->getMessage());\n    echo json_encode([\n        'success' => false,\n        'message' => 'Database error'\n    ]);\n}\n```\n\n### Send Email After Registration\n\n```php\n// After captcha validation success\n$to = $email;\n$subject = 'Welcome to Our Site';\n$message = \"Hello $name, welcome!\";\n$headers = 'From: noreply@api-server.cloud';\n\nif (mail($to, $subject, $message, $headers)) {\n    error_log(\"Welcome email sent to $email\");\n}\n```\n\n### Custom Styling\n\nEdit `index.html` CSS section:\n```css\n.btn {\n    background: #your-brand-color;\n}\n\n.card {\n    border-radius: 24px;  /* More rounded */\n}\n```\n\n---\n\n## üìö Next Steps\n\n1. **Production Checklist:**\n   - [ ] Secret key di environment variable\n   - [ ] Domain spesifik (bukan `*`)\n   - [ ] HTTPS enabled\n   - [ ] Error logging setup\n   - [ ] Database integration\n   - [ ] Email notifications\n\n2. **Advanced Features:**\n   - Add rate limiting\n   - Add IP blocking for failed attempts\n   - Add email verification\n   - Add user dashboard\n   - Add admin panel\n\n3. **Monitoring:**\n   - Track captcha success rate\n   - Monitor failed validations\n   - Log suspicious activities\n   - Setup alerts for errors\n\n---\n\n## üÜò Need Help?\n\n**Resources:**\n- Full documentation: `INTEGRATION_GUIDE.md`\n- Quick start: `QUICK_START.md`\n- Code examples: `backend-example.js`\n- Test page: `test.html`\n\n**Common Issues:**\n- Check server error logs\n- Check browser console\n- Verify API keys\n- Test with curl\n\n---\n\n**Happy Coding! üéâ**\n\nMade with ‚ù§Ô∏è for PHP Developers\n","size_bytes":11279},"postcss.config.js":{"content":"export default {\n  plugins: {\n    tailwindcss: {},\n    autoprefixer: {},\n  },\n}\n","size_bytes":80},"client/src/components/ui/alert.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst alertVariants = cva(\n  \"relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-background text-foreground\",\n        destructive:\n          \"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Alert = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof alertVariants>\n>(({ className, variant, ...props }, ref) => (\n  <div\n    ref={ref}\n    role=\"alert\"\n    className={cn(alertVariants({ variant }), className)}\n    {...props}\n  />\n))\nAlert.displayName = \"Alert\"\n\nconst AlertTitle = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h5\n    ref={ref}\n    className={cn(\"mb-1 font-medium leading-none tracking-tight\", className)}\n    {...props}\n  />\n))\nAlertTitle.displayName = \"AlertTitle\"\n\nconst AlertDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm [&_p]:leading-relaxed\", className)}\n    {...props}\n  />\n))\nAlertDescription.displayName = \"AlertDescription\"\n\nexport { Alert, AlertTitle, AlertDescription }\n","size_bytes":1584},"client/src/components/ui/dialog.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as DialogPrimitive from \"@radix-ui/react-dialog\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Dialog = DialogPrimitive.Root\n\nconst DialogTrigger = DialogPrimitive.Trigger\n\nconst DialogPortal = DialogPrimitive.Portal\n\nconst DialogClose = DialogPrimitive.Close\n\nconst DialogOverlay = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Overlay\n    ref={ref}\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogOverlay.displayName = DialogPrimitive.Overlay.displayName\n\nconst DialogContent = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DialogPortal>\n    <DialogOverlay />\n    <DialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <DialogPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </DialogPrimitive.Close>\n    </DialogPrimitive.Content>\n  </DialogPortal>\n))\nDialogContent.displayName = DialogPrimitive.Content.displayName\n\nconst DialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-1.5 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogHeader.displayName = \"DialogHeader\"\n\nconst DialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogFooter.displayName = \"DialogFooter\"\n\nconst DialogTitle = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogTitle.displayName = DialogPrimitive.Title.displayName\n\nconst DialogDescription = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDialogDescription.displayName = DialogPrimitive.Description.displayName\n\nexport {\n  Dialog,\n  DialogPortal,\n  DialogOverlay,\n  DialogClose,\n  DialogTrigger,\n  DialogContent,\n  DialogHeader,\n  DialogFooter,\n  DialogTitle,\n  DialogDescription,\n}\n","size_bytes":3848},"shared/puzzle-utils.ts":{"content":"function seededRandom(seed: number): number {\n  const x = Math.sin(seed++) * 10000;\n  return x - Math.floor(x);\n}\n\nexport function generateJigsawPath(seed: number, size: number): string {\n  const baseSize = size;\n  const nubSize = baseSize * 0.25;\n  const nubDepth = baseSize * 0.15;\n  \n  const rng = (offset: number) => seededRandom(seed + offset);\n  \n  const topNubDir = rng(1) > 0.5 ? 1 : -1;\n  const rightNubDir = rng(2) > 0.5 ? 1 : -1;\n  \n  const topStart = baseSize * 0.35;\n  const topEnd = baseSize * 0.65;\n  const topMid = (topStart + topEnd) / 2;\n  \n  const rightStart = baseSize * 0.35;\n  const rightEnd = baseSize * 0.65;\n  const rightMid = (rightStart + rightEnd) / 2;\n  \n  let path = `M 0 0`;\n  path += ` L ${topStart} 0`;\n  path += ` Q ${topStart} ${-nubDepth * topNubDir * 0.3} ${topMid - nubSize / 2} ${-nubDepth * topNubDir}`;\n  path += ` Q ${topMid} ${-nubDepth * topNubDir * 1.2} ${topMid + nubSize / 2} ${-nubDepth * topNubDir}`;\n  path += ` Q ${topEnd} ${-nubDepth * topNubDir * 0.3} ${topEnd} 0`;\n  path += ` L ${baseSize} 0`;\n  path += ` L ${baseSize} ${rightStart}`;\n  path += ` Q ${baseSize + nubDepth * rightNubDir * 0.3} ${rightStart} ${baseSize + nubDepth * rightNubDir} ${rightMid - nubSize / 2}`;\n  path += ` Q ${baseSize + nubDepth * rightNubDir * 1.2} ${rightMid} ${baseSize + nubDepth * rightNubDir} ${rightMid + nubSize / 2}`;\n  path += ` Q ${baseSize + nubDepth * rightNubDir * 0.3} ${rightEnd} ${baseSize} ${rightEnd}`;\n  path += ` L ${baseSize} ${baseSize}`;\n  path += ` L 0 ${baseSize}`;\n  path += ` Z`;\n  \n  return path;\n}\n","size_bytes":1562},"client/src/components/ui/alert-dialog.tsx":{"content":"import * as React from \"react\"\nimport * as AlertDialogPrimitive from \"@radix-ui/react-alert-dialog\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nconst AlertDialog = AlertDialogPrimitive.Root\n\nconst AlertDialogTrigger = AlertDialogPrimitive.Trigger\n\nconst AlertDialogPortal = AlertDialogPrimitive.Portal\n\nconst AlertDialogOverlay = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nAlertDialogOverlay.displayName = AlertDialogPrimitive.Overlay.displayName\n\nconst AlertDialogContent = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPortal>\n    <AlertDialogOverlay />\n    <AlertDialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    />\n  </AlertDialogPortal>\n))\nAlertDialogContent.displayName = AlertDialogPrimitive.Content.displayName\n\nconst AlertDialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogHeader.displayName = \"AlertDialogHeader\"\n\nconst AlertDialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogFooter.displayName = \"AlertDialogFooter\"\n\nconst AlertDialogTitle = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold\", className)}\n    {...props}\n  />\n))\nAlertDialogTitle.displayName = AlertDialogPrimitive.Title.displayName\n\nconst AlertDialogDescription = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nAlertDialogDescription.displayName =\n  AlertDialogPrimitive.Description.displayName\n\nconst AlertDialogAction = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Action>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Action>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Action\n    ref={ref}\n    className={cn(buttonVariants(), className)}\n    {...props}\n  />\n))\nAlertDialogAction.displayName = AlertDialogPrimitive.Action.displayName\n\nconst AlertDialogCancel = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Cancel>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Cancel>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Cancel\n    ref={ref}\n    className={cn(\n      buttonVariants({ variant: \"outline\" }),\n      \"mt-2 sm:mt-0\",\n      className\n    )}\n    {...props}\n  />\n))\nAlertDialogCancel.displayName = AlertDialogPrimitive.Cancel.displayName\n\nexport {\n  AlertDialog,\n  AlertDialogPortal,\n  AlertDialogOverlay,\n  AlertDialogTrigger,\n  AlertDialogContent,\n  AlertDialogHeader,\n  AlertDialogFooter,\n  AlertDialogTitle,\n  AlertDialogDescription,\n  AlertDialogAction,\n  AlertDialogCancel,\n}\n","size_bytes":4420},"server/device-fingerprint.ts":{"content":"import type { Request } from \"express\";\nimport crypto from \"crypto\";\n\nexport interface DeviceFingerprint {\n  id: string;\n  score: number;\n  signals: string[];\n  isSuspicious: boolean;\n}\n\nexport function generateDeviceFingerprint(req: Request): DeviceFingerprint {\n  const signals: string[] = [];\n  let suspicionScore = 0;\n\n  const userAgent = req.headers[\"user-agent\"] || \"\";\n  const acceptLanguage = req.headers[\"accept-language\"] || \"\";\n  const acceptEncoding = req.headers[\"accept-encoding\"] || \"\";\n  const accept = req.headers[\"accept\"] || \"\";\n  \n  const clientIP = req.headers[\"x-forwarded-for\"] || \n                    req.headers[\"x-real-ip\"] || \n                    req.socket.remoteAddress || \"\";\n\n  const components = [\n    userAgent,\n    acceptLanguage,\n    acceptEncoding,\n    accept,\n    clientIP.toString().split(',')[0].trim()\n  ];\n\n  const fingerprintHash = crypto\n    .createHash(\"sha256\")\n    .update(components.join(\"|\"))\n    .digest(\"hex\")\n    .substring(0, 16);\n\n  if (!acceptLanguage) {\n    signals.push(\"missing-accept-language\");\n    suspicionScore += 10;\n  }\n\n  if (!acceptEncoding) {\n    signals.push(\"missing-accept-encoding\");\n    suspicionScore += 10;\n  }\n\n  const headerOrder = Object.keys(req.headers);\n  const normalBrowserHeaders = [\"host\", \"connection\", \"user-agent\", \"accept\"];\n  const hasNormalOrder = normalBrowserHeaders.every(h => headerOrder.includes(h));\n  \n  if (!hasNormalOrder) {\n    signals.push(\"abnormal-header-order\");\n    suspicionScore += 15;\n  }\n\n  const tls = (req as any).connection?.getCipher?.();\n  if (!tls && req.headers[\"x-forwarded-proto\"] !== \"https\") {\n    signals.push(\"no-tls-fingerprint\");\n    suspicionScore += 5;\n  }\n\n  if (userAgent.length < 50) {\n    signals.push(\"short-user-agent\");\n    suspicionScore += 20;\n  }\n\n  const isSuspicious = suspicionScore >= 30;\n\n  return {\n    id: fingerprintHash,\n    score: suspicionScore,\n    signals,\n    isSuspicious,\n  };\n}\n\nexport function trackDeviceFingerprint(fingerprint: DeviceFingerprint): void {\n  console.log(`Device fingerprint: ${fingerprint.id} (score: ${fingerprint.score}, suspicious: ${fingerprint.isSuspicious})`);\n  if (fingerprint.signals.length > 0) {\n    console.log(`  Signals: ${fingerprint.signals.join(\", \")}`);\n  }\n}\n","size_bytes":2249},"server/enhancements/token-expiration.ts":{"content":"/**\n * Enhanced Token Expiration Management\n * \n * Menambahkan grace period dan strict expiration checking\n * untuk mencegah token abuse\n */\n\nexport interface ExpirationConfig {\n  challengeLifetime: number;  // Lifetime challenge dalam ms\n  tokenGracePeriod: number;   // Grace period untuk network latency\n  strictMode: boolean;        // Strict mode tanpa grace period\n}\n\nexport const DEFAULT_EXPIRATION_CONFIG: ExpirationConfig = {\n  challengeLifetime: 5 * 60 * 1000,  // 5 menit\n  tokenGracePeriod: 30 * 1000,       // 30 detik\n  strictMode: false,\n};\n\nexport interface ExpirationCheckResult {\n  isValid: boolean;\n  errorCode?: string;\n  message?: string;\n  ageMs?: number;\n  expiresIn?: number;\n}\n\n/**\n * Check if challenge has expired dengan grace period\n */\nexport function checkChallengeExpiration(\n  createdAt: Date,\n  config: ExpirationConfig = DEFAULT_EXPIRATION_CONFIG\n): ExpirationCheckResult {\n  const now = Date.now();\n  const createdAtMs = new Date(createdAt).getTime();\n  const ageMs = now - createdAtMs;\n  \n  // Calculate expiration dengan atau tanpa grace period\n  const maxAge = config.strictMode \n    ? config.challengeLifetime\n    : config.challengeLifetime + config.tokenGracePeriod;\n  \n  if (ageMs > maxAge) {\n    const expiredBy = ageMs - config.challengeLifetime;\n    return {\n      isValid: false,\n      errorCode: 'timeout-or-duplicate',\n      message: `Challenge expired ${Math.ceil(expiredBy / 1000)} seconds ago`,\n      ageMs,\n      expiresIn: 0,\n    };\n  }\n  \n  const expiresInMs = config.challengeLifetime - ageMs;\n  return {\n    isValid: true,\n    ageMs,\n    expiresIn: Math.max(0, expiresInMs),\n  };\n}\n\n/**\n * Check if token akan expire dalam waktu dekat\n */\nexport function isNearExpiration(\n  createdAt: Date,\n  warningThresholdMs: number = 60 * 1000, // 1 menit warning\n  config: ExpirationConfig = DEFAULT_EXPIRATION_CONFIG\n): boolean {\n  const now = Date.now();\n  const createdAtMs = new Date(createdAt).getTime();\n  const ageMs = now - createdAtMs;\n  const expiresInMs = config.challengeLifetime - ageMs;\n  \n  return expiresInMs > 0 && expiresInMs <= warningThresholdMs;\n}\n\n/**\n * Get expiration metadata untuk logging/debugging\n */\nexport function getExpirationMetadata(createdAt: Date, config: ExpirationConfig = DEFAULT_EXPIRATION_CONFIG) {\n  const now = Date.now();\n  const createdAtMs = new Date(createdAt).getTime();\n  const ageMs = now - createdAtMs;\n  const expiresInMs = config.challengeLifetime - ageMs;\n  \n  return {\n    createdAt: createdAt.toISOString(),\n    ageSeconds: Math.floor(ageMs / 1000),\n    expiresInSeconds: Math.floor(Math.max(0, expiresInMs) / 1000),\n    isExpired: ageMs > config.challengeLifetime,\n    isNearExpiration: expiresInMs > 0 && expiresInMs <= 60000,\n    gracePeriodActive: ageMs > config.challengeLifetime && ageMs <= config.challengeLifetime + config.tokenGracePeriod,\n  };\n}\n\n/**\n * Cleanup expired challenges dari database\n */\nexport async function cleanupExpiredChallenges(\n  getChallenges: () => Promise<Array<{ id: string; createdAt: Date }>>,\n  deleteChallenge: (id: string) => Promise<void>,\n  config: ExpirationConfig = DEFAULT_EXPIRATION_CONFIG\n): Promise<number> {\n  const challenges = await getChallenges();\n  let deletedCount = 0;\n  \n  const cleanupThreshold = config.challengeLifetime + config.tokenGracePeriod + (60 * 60 * 1000); // +1 jam buffer\n  \n  for (const challenge of challenges) {\n    const check = checkChallengeExpiration(challenge.createdAt, {\n      ...config,\n      challengeLifetime: cleanupThreshold,\n      strictMode: true,\n    });\n    \n    if (!check.isValid) {\n      await deleteChallenge(challenge.id);\n      deletedCount++;\n    }\n  }\n  \n  return deletedCount;\n}\n\n/**\n * Example usage dalam siteverify endpoint:\n * \n * const expirationCheck = checkChallengeExpiration(challenge.createdAt);\n * if (!expirationCheck.isValid) {\n *   return res.json({\n *     success: false,\n *     \"error-codes\": [expirationCheck.errorCode],\n *     message: expirationCheck.message\n *   });\n * }\n */\n","size_bytes":3994},"client/src/components/ui/sheet.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SheetPrimitive from \"@radix-ui/react-dialog\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Sheet = SheetPrimitive.Root\n\nconst SheetTrigger = SheetPrimitive.Trigger\n\nconst SheetClose = SheetPrimitive.Close\n\nconst SheetPortal = SheetPrimitive.Portal\n\nconst SheetOverlay = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nSheetOverlay.displayName = SheetPrimitive.Overlay.displayName\n\nconst sheetVariants = cva(\n  \"fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500\",\n  {\n    variants: {\n      side: {\n        top: \"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top\",\n        bottom:\n          \"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom\",\n        left: \"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm\",\n        right:\n          \"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm\",\n      },\n    },\n    defaultVariants: {\n      side: \"right\",\n    },\n  }\n)\n\ninterface SheetContentProps\n  extends React.ComponentPropsWithoutRef<typeof SheetPrimitive.Content>,\n    VariantProps<typeof sheetVariants> {}\n\nconst SheetContent = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Content>,\n  SheetContentProps\n>(({ side = \"right\", className, children, ...props }, ref) => (\n  <SheetPortal>\n    <SheetOverlay />\n    <SheetPrimitive.Content\n      ref={ref}\n      className={cn(sheetVariants({ side }), className)}\n      {...props}\n    >\n      {children}\n      <SheetPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </SheetPrimitive.Close>\n    </SheetPrimitive.Content>\n  </SheetPortal>\n))\nSheetContent.displayName = SheetPrimitive.Content.displayName\n\nconst SheetHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetHeader.displayName = \"SheetHeader\"\n\nconst SheetFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetFooter.displayName = \"SheetFooter\"\n\nconst SheetTitle = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold text-foreground\", className)}\n    {...props}\n  />\n))\nSheetTitle.displayName = SheetPrimitive.Title.displayName\n\nconst SheetDescription = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nSheetDescription.displayName = SheetPrimitive.Description.displayName\n\nexport {\n  Sheet,\n  SheetPortal,\n  SheetOverlay,\n  SheetTrigger,\n  SheetClose,\n  SheetContent,\n  SheetHeader,\n  SheetFooter,\n  SheetTitle,\n  SheetDescription,\n}\n","size_bytes":4281},"client/src/hooks/use-auth.tsx":{"content":"import { createContext, useContext, ReactNode, useEffect } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { useLocation } from \"wouter\";\n\ntype Developer = {\n  id: string;\n  email: string;\n  name: string;\n  isEmailVerified?: boolean;\n};\n\ntype AuthContextType = {\n  developer: Developer | null;\n  isLoading: boolean;\n  login: (email: string, password: string, captchaToken: string) => Promise<void>;\n  register: (name: string, email: string, password: string, captchaToken: string) => Promise<void>;\n  logout: () => Promise<void>;\n};\n\nconst AuthContext = createContext<AuthContextType | null>(null);\n\nexport function AuthProvider({ children }: { children: ReactNode }) {\n  const [, setLocation] = useLocation();\n\n  const { data: developer, isLoading } = useQuery<Developer | null>({\n    queryKey: [\"/api/auth/user\"],\n    retry: false,\n    staleTime: Infinity,\n  });\n\n  const loginMutation = useMutation({\n    mutationFn: async ({ email, password, captchaToken }: { email: string; password: string; captchaToken: string }) => {\n      const res = await apiRequest(\"POST\", \"/api/auth/login\", { email, password, captchaToken });\n      return await res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/auth/user\"] });\n      setLocation(\"/dashboard\");\n    },\n  });\n\n  const registerMutation = useMutation({\n    mutationFn: async ({ name, email, password, captchaToken }: { name: string; email: string; password: string; captchaToken: string }) => {\n      const res = await apiRequest(\"POST\", \"/api/auth/register\", { name, email, password, captchaToken });\n      return await res.json();\n    },\n    onSuccess: (data) => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/auth/user\"] });\n      // Redirect to verify email if verification is required\n      if (data.requiresVerification) {\n        setLocation(\"/verify-email\");\n      } else {\n        setLocation(\"/dashboard\");\n      }\n    },\n  });\n\n  const logoutMutation = useMutation({\n    mutationFn: async () => {\n      await apiRequest(\"POST\", \"/api/auth/logout\");\n    },\n    onSuccess: () => {\n      queryClient.setQueryData([\"/api/auth/user\"], null);\n      queryClient.clear();\n      setLocation(\"/\");\n    },\n  });\n\n  const login = async (email: string, password: string, captchaToken: string) => {\n    await loginMutation.mutateAsync({ email, password, captchaToken });\n  };\n\n  const register = async (name: string, email: string, password: string, captchaToken: string) => {\n    await registerMutation.mutateAsync({ name, email, password, captchaToken });\n  };\n\n  const logout = async () => {\n    await logoutMutation.mutateAsync();\n  };\n\n  return (\n    <AuthContext.Provider value={{ developer: developer ?? null, isLoading, login, register, logout }}>\n      {children}\n    </AuthContext.Provider>\n  );\n}\n\nexport function useAuth() {\n  const context = useContext(AuthContext);\n  if (!context) {\n    throw new Error(\"useAuth must be used within AuthProvider\");\n  }\n  return context;\n}\n","size_bytes":3082},"client/src/components/ui/table.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Table = React.forwardRef<\n  HTMLTableElement,\n  React.HTMLAttributes<HTMLTableElement>\n>(({ className, ...props }, ref) => (\n  <div className=\"relative w-full overflow-auto\">\n    <table\n      ref={ref}\n      className={cn(\"w-full caption-bottom text-sm\", className)}\n      {...props}\n    />\n  </div>\n))\nTable.displayName = \"Table\"\n\nconst TableHeader = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <thead ref={ref} className={cn(\"[&_tr]:border-b\", className)} {...props} />\n))\nTableHeader.displayName = \"TableHeader\"\n\nconst TableBody = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tbody\n    ref={ref}\n    className={cn(\"[&_tr:last-child]:border-0\", className)}\n    {...props}\n  />\n))\nTableBody.displayName = \"TableBody\"\n\nconst TableFooter = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tfoot\n    ref={ref}\n    className={cn(\n      \"border-t bg-muted/50 font-medium [&>tr]:last:border-b-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableFooter.displayName = \"TableFooter\"\n\nconst TableRow = React.forwardRef<\n  HTMLTableRowElement,\n  React.HTMLAttributes<HTMLTableRowElement>\n>(({ className, ...props }, ref) => (\n  <tr\n    ref={ref}\n    className={cn(\n      \"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nTableRow.displayName = \"TableRow\"\n\nconst TableHead = React.forwardRef<\n  HTMLTableCellElement,\n  React.ThHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <th\n    ref={ref}\n    className={cn(\n      \"h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableHead.displayName = \"TableHead\"\n\nconst TableCell = React.forwardRef<\n  HTMLTableCellElement,\n  React.TdHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <td\n    ref={ref}\n    className={cn(\"p-4 align-middle [&:has([role=checkbox])]:pr-0\", className)}\n    {...props}\n  />\n))\nTableCell.displayName = \"TableCell\"\n\nconst TableCaption = React.forwardRef<\n  HTMLTableCaptionElement,\n  React.HTMLAttributes<HTMLTableCaptionElement>\n>(({ className, ...props }, ref) => (\n  <caption\n    ref={ref}\n    className={cn(\"mt-4 text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nTableCaption.displayName = \"TableCaption\"\n\nexport {\n  Table,\n  TableHeader,\n  TableBody,\n  TableFooter,\n  TableHead,\n  TableRow,\n  TableCell,\n  TableCaption,\n}\n","size_bytes":2765},"test-db-connection.js":{"content":"// Simple script to test database connection\nconsole.log('Checking DATABASE_URL...');\nconsole.log('DATABASE_URL exists:', !!process.env.DATABASE_URL);\nconsole.log('DATABASE_URL value:', process.env.DATABASE_URL ? 'Set (hidden for security)' : 'NOT SET');\n\nconsole.log('\\nAll database environment variables:');\nconsole.log('PGHOST:', process.env.PGHOST || 'NOT SET');\nconsole.log('PGUSER:', process.env.PGUSER || 'NOT SET');\nconsole.log('PGPASSWORD:', process.env.PGPASSWORD ? '***' : 'NOT SET');\nconsole.log('PGDATABASE:', process.env.PGDATABASE || 'NOT SET');\nconsole.log('PGPORT:', process.env.PGPORT || 'NOT SET');\n\nif (process.env.DATABASE_URL) {\n  console.log('\\n‚úì Database environment variables are loaded!');\n  console.log('You can now run: npm run setup-db --with-demo');\n} else {\n  console.log('\\n‚úó DATABASE_URL is not available in the environment');\n  console.log('\\nThis might mean:');\n  console.log('1. The Replit workspace needs to be reloaded');\n  console.log('2. The database was created but environment variables need manual refresh');\n  console.log('3. You may need to access the database through the Replit UI first');\n}\n","size_bytes":1143},"client/src/pages/integration-helper.tsx":{"content":"import { useState } from \"react\";\nimport { motion } from \"framer-motion\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Label } from \"@/components/ui/label\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Button } from \"@/components/ui/button\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Copy, Check, Code2, Sparkles } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useTranslation } from \"react-i18next\";\nimport { Prism as SyntaxHighlighter } from 'react-syntax-highlighter';\nimport { vscDarkPlus } from 'react-syntax-highlighter/dist/esm/styles/prism';\n\ntype Framework = \"html\" | \"react\" | \"nextjs\" | \"vue\" | \"php\" | \"python\" | \"nodejs\";\ntype ChallengeType = \"random\" | \"grid\" | \"jigsaw\" | \"gesture\" | \"upside_down\";\ntype Theme = \"light\" | \"dark\" | \"auto\";\n\nexport default function IntegrationHelper() {\n  const { t } = useTranslation();\n  const [framework, setFramework] = useState<Framework>(\"html\");\n  const [challengeType, setChallengeType] = useState<ChallengeType>(\"random\");\n  const [theme, setTheme] = useState<Theme>(\"light\");\n  const [apiKey, setApiKey] = useState(\"YOUR_PUBLIC_KEY\");\n  const [secretKey, setSecretKey] = useState(\"YOUR_SECRET_KEY\");\n  const [copiedTab, setCopiedTab] = useState<string | null>(null);\n  const { toast } = useToast();\n\n  const generateCode = () => {\n    switch (framework) {\n      case \"html\":\n        return {\n          frontend: `<!DOCTYPE html>\n<html>\n<head>\n  <title>ProofCaptcha Integration</title>\n</head>\n<body>\n  <form id=\"myForm\" action=\"/submit\" method=\"POST\">\n    <input type=\"text\" name=\"username\" placeholder=\"Username\" required>\n    <input type=\"email\" name=\"email\" placeholder=\"Email\" required>\n    \n    <!-- ProofCaptcha Widget -->\n    <div class=\"proof-captcha\" \n         data-sitekey=\"${apiKey}\"\n         data-type=\"${challengeType}\"\n         data-theme=\"${theme}\"\n         data-callback=\"onCaptchaSuccess\"\n         data-error-callback=\"onCaptchaError\">\n    </div>\n    \n    <!-- Hidden field for CAPTCHA token -->\n    <input type=\"hidden\" name=\"captcha_token\" id=\"captcha_token\" value=\"\">\n    \n    <button type=\"submit\" id=\"submitBtn\" disabled>Submit Form</button>\n  </form>\n\n  <script>\n    function onCaptchaSuccess(token) {\n      console.log('CAPTCHA verified! Token:', token);\n      // Set token to hidden input\n      document.getElementById('captcha_token').value = token;\n      // Enable submit button\n      document.getElementById('submitBtn').disabled = false;\n    }\n    \n    function onCaptchaError(error) {\n      console.error('CAPTCHA error:', error);\n      alert('CAPTCHA verification failed. Please try again.');\n    }\n  </script>\n  \n  <!-- Load ProofCaptcha API -->\n  <script src=\"https://your-domain.com/proofCaptcha/api.js\" async defer></script>\n</body>\n</html>`,\n          backend: `// Backend (Node.js/Express)\n// Dependencies: npm install express node-fetch@2\n\nconst express = require('express');\nconst fetch = require('node-fetch');\n\nconst app = express();\napp.use(express.urlencoded({ extended: true }));\n\napp.post('/submit', async (req, res) => {\n  // For form-encoded data, use snake_case\n  const captchaToken = req.body.captcha_token;\n  \n  // Validate CAPTCHA token\n  const verifyResponse = await fetch(\n    'https://your-domain.com/api/captcha/verify-token',\n    {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'Authorization': \\`Bearer ${secretKey}\\`\n      },\n      body: JSON.stringify({ token: captchaToken })\n    }\n  );\n  \n  const result = await verifyResponse.json();\n  \n  if (!result.success) {\n    return res.status(400).send('CAPTCHA verification failed');\n  }\n  \n  // Process your form here\n  const { username, email } = req.body;\n  console.log('Form submitted:', { username, email });\n  \n  res.send('Form submitted successfully!');\n});\n\napp.listen(3000, () => console.log('Server running on port 3000'));`\n        };\n\n      case \"react\":\n        return {\n          frontend: `import { useEffect, useRef, useState, type FormEvent } from 'react';\n\n// Declare ProofCaptcha on window\ndeclare global {\n  interface Window {\n    ProofCaptcha?: any;\n  }\n}\n\nfunction CaptchaForm() {\n  const captchaRef = useRef<HTMLDivElement>(null);\n  const [token, setToken] = useState('');\n\n  useEffect(() => {\n    // Load ProofCaptcha script\n    const script = document.createElement('script');\n    script.src = 'https://your-domain.com/proofCaptcha/api.js';\n    script.async = true;\n    script.defer = true;\n    \n    script.onload = () => {\n      if (window.ProofCaptcha && captchaRef.current) {\n        window.ProofCaptcha.render(captchaRef.current, {\n          sitekey: '${apiKey}',\n          type: '${challengeType}',\n          theme: '${theme}',\n          callback: (token: string) => {\n            console.log('CAPTCHA verified!', token);\n            setToken(token);\n          },\n          'error-callback': (error: any) => {\n            console.error('CAPTCHA error:', error);\n            alert('CAPTCHA verification failed');\n          }\n        });\n      }\n    };\n    \n    document.body.appendChild(script);\n    \n    return () => {\n      document.body.removeChild(script);\n    };\n  }, []);\n\n  const handleSubmit = async (e: FormEvent<HTMLFormElement>) => {\n    e.preventDefault();\n    \n    if (!token) {\n      alert('Please complete the CAPTCHA');\n      return;\n    }\n    \n    const formData = new FormData(e.currentTarget);\n    \n    const response = await fetch('/api/submit', {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n      },\n      body: JSON.stringify({\n        username: formData.get('username'),\n        email: formData.get('email'),\n        captchaToken: token\n      })\n    });\n    \n    if (response.ok) {\n      alert('Form submitted successfully!');\n    } else {\n      alert('Submission failed');\n    }\n  };\n\n  return (\n    <form onSubmit={handleSubmit}>\n      <input type=\"text\" name=\"username\" placeholder=\"Username\" required />\n      <input type=\"email\" name=\"email\" placeholder=\"Email\" required />\n      \n      <div ref={captchaRef}></div>\n      \n      <button type=\"submit\">Submit</button>\n    </form>\n  );\n}\n\nexport default CaptchaForm;`,\n          backend: `// Backend (Express.js API server)\n// Dependencies: npm install express node-fetch@2 cors\n\nconst express = require('express');\nconst fetch = require('node-fetch');\nconst cors = require('cors');\n\nconst app = express();\n\napp.use(cors());\napp.use(express.json());\n\napp.post('/api/submit', async (req, res) => {\n  const captchaToken = req.body.captchaToken;\n  \n  // Validate CAPTCHA token\n  const verifyResponse = await fetch(\n    'https://your-domain.com/api/captcha/verify-token',\n    {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'Authorization': \\`Bearer ${secretKey}\\`\n      },\n      body: JSON.stringify({ token: captchaToken })\n    }\n  );\n  \n  const result = await verifyResponse.json();\n  \n  if (!result.success) {\n    return res.status(400).json({ \n      error: 'CAPTCHA verification failed' \n    });\n  }\n  \n  // Process your form here\n  const { username, email } = req.body;\n  \n  res.json({ success: true, message: 'Form submitted!' });\n});\n\napp.listen(3001, () => console.log('API server on port 3001'));`\n        };\n\n      case \"nextjs\":\n        return {\n          frontend: `'use client';\n\nimport { useEffect, useRef, useState, type FormEvent } from 'react';\n\n// Declare ProofCaptcha on window\ndeclare global {\n  interface Window {\n    ProofCaptcha?: any;\n  }\n}\n\nexport default function ContactForm() {\n  const captchaRef = useRef<HTMLDivElement>(null);\n  const [token, setToken] = useState('');\n\n  useEffect(() => {\n    const script = document.createElement('script');\n    script.src = 'https://your-domain.com/proofCaptcha/api.js';\n    script.async = true;\n    script.defer = true;\n    \n    script.onload = () => {\n      if (window.ProofCaptcha && captchaRef.current) {\n        window.ProofCaptcha.render(captchaRef.current, {\n          sitekey: '${apiKey}',\n          type: '${challengeType}',\n          theme: '${theme}',\n          callback: setToken,\n        });\n      }\n    };\n    \n    document.body.appendChild(script);\n    return () => document.body.removeChild(script);\n  }, []);\n\n  const handleSubmit = async (e: FormEvent<HTMLFormElement>) => {\n    e.preventDefault();\n    \n    if (!token) {\n      alert('Please complete the CAPTCHA');\n      return;\n    }\n    \n    const formData = new FormData(e.target as HTMLFormElement);\n    \n    const response = await fetch('/api/submit', {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({\n        username: formData.get('username'),\n        email: formData.get('email'),\n        captchaToken: token\n      })\n    });\n    \n    const result = await response.json();\n    \n    if (result.success) {\n      alert('Form submitted successfully!');\n    }\n  };\n\n  return (\n    <form onSubmit={handleSubmit}>\n      <input type=\"text\" name=\"username\" placeholder=\"Username\" required />\n      <input type=\"email\" name=\"email\" placeholder=\"Email\" required />\n      <div ref={captchaRef}></div>\n      <button type=\"submit\">Submit</button>\n    </form>\n  );\n}`,\n          backend: `// app/api/submit/route.ts\nimport { NextRequest, NextResponse } from 'next/server';\n\nexport async function POST(request: NextRequest) {\n  const body = await request.json();\n  const captchaToken = body.captchaToken;\n  \n  // Validate CAPTCHA token\n  const verifyResponse = await fetch(\n    'https://your-domain.com/api/captcha/verify-token',\n    {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'Authorization': \\`Bearer ${secretKey}\\`\n      },\n      body: JSON.stringify({ token: captchaToken })\n    }\n  );\n  \n  const result = await verifyResponse.json();\n  \n  if (!result.success) {\n    return NextResponse.json(\n      { error: 'CAPTCHA verification failed' },\n      { status: 400 }\n    );\n  }\n  \n  // Process form\n  const { username, email } = body;\n  \n  return NextResponse.json({ \n    success: true, \n    message: 'Form submitted!' \n  });\n}`\n        };\n\n      case \"vue\":\n        return {\n          frontend: `<template>\n  <form @submit.prevent=\"handleSubmit\">\n    <input \n      v-model=\"formData.username\" \n      type=\"text\" \n      placeholder=\"Username\" \n      required \n    />\n    <input \n      v-model=\"formData.email\" \n      type=\"email\" \n      placeholder=\"Email\" \n      required \n    />\n    \n    <div ref=\"captchaRef\"></div>\n    \n    <button type=\"submit\">Submit</button>\n  </form>\n</template>\n\n<script setup>\nimport { ref, onMounted, onUnmounted } from 'vue';\n\nconst captchaRef = ref(null);\nconst token = ref('');\nconst formData = ref({\n  username: '',\n  email: ''\n});\n\nlet scriptElement = null;\n\nonMounted(() => {\n  scriptElement = document.createElement('script');\n  scriptElement.src = 'https://your-domain.com/proofCaptcha/api.js';\n  scriptElement.async = true;\n  scriptElement.defer = true;\n  \n  scriptElement.onload = () => {\n    if (window.ProofCaptcha && captchaRef.value) {\n      window.ProofCaptcha.render(captchaRef.value, {\n        sitekey: '${apiKey}',\n        type: '${challengeType}',\n        theme: '${theme}',\n        callback: (t) => { token.value = t; }\n      });\n    }\n  };\n  \n  document.body.appendChild(scriptElement);\n});\n\nonUnmounted(() => {\n  if (scriptElement) {\n    document.body.removeChild(scriptElement);\n  }\n});\n\nconst handleSubmit = async () => {\n  if (!token.value) {\n    alert('Please complete the CAPTCHA');\n    return;\n  }\n  \n  const response = await fetch('/api/submit', {\n    method: 'POST',\n    headers: { 'Content-Type': 'application/json' },\n    body: JSON.stringify({\n      ...formData.value,\n      captchaToken: token.value\n    })\n  });\n  \n  const result = await response.json();\n  \n  if (result.success) {\n    alert('Form submitted successfully!');\n  }\n};\n</script>`,\n          backend: `// Backend API (Node.js/Express)\n// Dependencies: npm install express node-fetch@2 body-parser\n\nconst express = require('express');\nconst fetch = require('node-fetch');\nconst bodyParser = require('body-parser');\n\nconst app = express();\n\napp.use(bodyParser.json());\napp.use(bodyParser.urlencoded({ extended: true }));\n\napp.post('/api/submit', async (req, res) => {\n  const captchaToken = req.body.captchaToken;\n  \n  const verifyResponse = await fetch(\n    'https://your-domain.com/api/captcha/verify-token',\n    {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'Authorization': \\`Bearer ${secretKey}\\`\n      },\n      body: JSON.stringify({ token: captchaToken })\n    }\n  );\n  \n  const result = await verifyResponse.json();\n  \n  if (!result.success) {\n    return res.status(400).json({ error: 'CAPTCHA failed' });\n  }\n  \n  // Process form\n  const { username, email } = req.body;\n  \n  res.json({ success: true, message: 'Form submitted!' });\n});\n\napp.listen(3000, () => console.log('Server running on port 3000'));`\n        };\n\n      case \"php\":\n        return {\n          frontend: `<!DOCTYPE html>\n<html>\n<head>\n  <title>ProofCaptcha PHP Integration</title>\n</head>\n<body>\n  <form action=\"submit.php\" method=\"POST\">\n    <input type=\"text\" name=\"username\" placeholder=\"Username\" required>\n    <input type=\"email\" name=\"email\" placeholder=\"Email\" required>\n    \n    <div class=\"proof-captcha\" \n         data-sitekey=\"${apiKey}\"\n         data-type=\"${challengeType}\"\n         data-theme=\"${theme}\"\n         data-callback=\"onCaptchaSuccess\">\n    </div>\n    \n    <!-- Hidden field for CAPTCHA token -->\n    <input type=\"hidden\" name=\"captcha_token\" id=\"captcha_token\">\n    \n    <button type=\"submit\" id=\"submitBtn\" disabled>Submit</button>\n  </form>\n  \n  <script>\n    function onCaptchaSuccess(token) {\n      document.getElementById('captcha_token').value = token;\n      document.getElementById('submitBtn').disabled = false;\n    }\n  </script>\n  <script src=\"https://your-domain.com/proofCaptcha/api.js\" async defer></script>\n</body>\n</html>`,\n          backend: `<?php\n// submit.php\n\nfunction validateCaptcha($token, $secretKey) {\n    $url = 'https://your-domain.com/api/captcha/verify-token';\n    \n    $ch = curl_init($url);\n    curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);\n    curl_setopt($ch, CURLOPT_POST, true);\n    curl_setopt($ch, CURLOPT_POSTFIELDS, json_encode([\n        'token' => $token\n    ]));\n    curl_setopt($ch, CURLOPT_HTTPHEADER, [\n        'Content-Type: application/json',\n        'Authorization: Bearer ' . $secretKey\n    ]);\n    \n    $response = curl_exec($ch);\n    $httpCode = curl_getinfo($ch, CURLINFO_HTTP_CODE);\n    curl_close($ch);\n    \n    if ($httpCode !== 200) {\n        return false;\n    }\n    \n    $result = json_decode($response, true);\n    return $result['success'] ?? false;\n}\n\n// Handle form submission\nif ($_SERVER['REQUEST_METHOD'] === 'POST') {\n    $captchaToken = $_POST['captcha_token'] ?? '';\n    $secretKey = '${secretKey}';\n    \n    if (!validateCaptcha($captchaToken, $secretKey)) {\n        die('CAPTCHA verification failed');\n    }\n    \n    // Process form\n    $username = $_POST['username'] ?? '';\n    $email = $_POST['email'] ?? '';\n    \n    // Save to database, send email, etc.\n    \n    echo 'Form submitted successfully!';\n}\n?>`\n        };\n\n      case \"python\":\n        return {\n          frontend: `<!-- templates/form.html -->\n<!DOCTYPE html>\n<html>\n<head>\n  <title>ProofCaptcha Flask Integration</title>\n</head>\n<body>\n  <form id=\"myForm\">\n    <input type=\"text\" name=\"username\" placeholder=\"Username\" required>\n    <input type=\"email\" name=\"email\" placeholder=\"Email\" required>\n    \n    <div class=\"proof-captcha\" \n         data-sitekey=\"${apiKey}\"\n         data-type=\"${challengeType}\"\n         data-theme=\"${theme}\"\n         data-callback=\"onCaptchaSuccess\">\n    </div>\n    \n    <button type=\"submit\" id=\"submitBtn\" disabled>Submit</button>\n  </form>\n  \n  <script>\n    let captchaToken = null;\n    \n    function onCaptchaSuccess(token) {\n      captchaToken = token;\n      document.getElementById('submitBtn').disabled = false;\n    }\n    \n    document.getElementById('myForm').addEventListener('submit', async (e) => {\n      e.preventDefault();\n      \n      const formData = new FormData(e.target);\n      const response = await fetch('/submit', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          username: formData.get('username'),\n          email: formData.get('email'),\n          captchaToken: captchaToken\n        })\n      });\n      \n      const result = await response.json();\n      if (result.success) {\n        alert('Form submitted successfully!');\n      } else {\n        alert('Error: ' + result.error);\n      }\n    });\n  </script>\n  <script src=\"https://your-domain.com/proofCaptcha/api.js\" async defer></script>\n</body>\n</html>`,\n          backend: `# app.py\n# Dependencies: pip install flask requests\n\nfrom flask import Flask, request, jsonify, render_template\nimport requests\nimport os\n\napp = Flask(__name__)\n\n# Set your secret key\nSECRET_KEY = '${secretKey}'  # Replace with your actual secret key\n\ndef validate_captcha(token):\n    \"\"\"Validate CAPTCHA token with ProofCaptcha server\"\"\"\n    url = 'https://your-domain.com/api/captcha/verify-token'\n    headers = {\n        'Content-Type': 'application/json',\n        'Authorization': f'Bearer {SECRET_KEY}'\n    }\n    data = {'token': token}\n    \n    try:\n        response = requests.post(url, json=data, headers=headers, timeout=5)\n        result = response.json()\n        return result.get('success', False)\n    except Exception as e:\n        print(f'CAPTCHA validation error: {e}')\n        return False\n\n@app.route('/')\ndef index():\n    return render_template('form.html')\n\n@app.route('/submit', methods=['POST'])\ndef submit_form():\n    data = request.get_json()\n    captcha_token = data.get('captchaToken', '')\n    \n    if not validate_captcha(captcha_token):\n        return jsonify({'error': 'CAPTCHA verification failed'}), 400\n    \n    # Process form\n    username = data.get('username')\n    email = data.get('email')\n    \n    # Save to database, send email, etc.\n    \n    return jsonify({'success': True, 'message': 'Form submitted!'})\n\nif __name__ == '__main__':\n    app.run(debug=True)`\n        };\n\n      case \"nodejs\":\n        return {\n          frontend: `<!-- Frontend HTML -->\n<!DOCTYPE html>\n<html>\n<head><title>ProofCaptcha Node.js</title></head>\n<body>\n  <form action=\"/submit\" method=\"POST\">\n    <input type=\"text\" name=\"username\" required>\n    <input type=\"email\" name=\"email\" required>\n    <div class=\"proof-captcha\" \n         data-sitekey=\"${apiKey}\" \n         data-type=\"${challengeType}\"\n         data-theme=\"${theme}\"\n         data-callback=\"onCaptchaSuccess\">\n    </div>\n    <input type=\"hidden\" name=\"captcha_token\" id=\"captcha_token\">\n    <button type=\"submit\" id=\"submitBtn\" disabled>Submit</button>\n  </form>\n  <script>\n    function onCaptchaSuccess(token) {\n      document.getElementById('captcha_token').value = token;\n      document.getElementById('submitBtn').disabled = false;\n    }\n  </script>\n  <script src=\"https://your-domain.com/proofCaptcha/api.js\" async defer></script>\n</body>\n</html>`,\n          backend: `// Backend (Node.js/Express)\n// Dependencies: npm install express node-fetch@2\n\nconst express = require('express');\nconst fetch = require('node-fetch');\nconst app = express();\n\napp.use(express.json());\napp.use(express.urlencoded({ extended: true }));\n\nasync function validateCaptcha(token) {\n  const response = await fetch(\n    'https://your-domain.com/api/captcha/verify-token',\n    {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'Authorization': \\`Bearer ${secretKey}\\`\n      },\n      body: JSON.stringify({ token })\n    }\n  );\n  \n  const result = await response.json();\n  return result.success;\n}\n\napp.post('/submit', async (req, res) => {\n  // For form-encoded data, use snake_case\n  const captchaToken = req.body.captcha_token;\n  \n  const isValid = await validateCaptcha(captchaToken);\n  \n  if (!isValid) {\n    return res.status(400).json({ error: 'CAPTCHA failed' });\n  }\n  \n  // Process form\n  const { username, email } = req.body;\n  \n  res.json({ success: true, message: 'Submitted!' });\n});\n\napp.listen(3000, () => console.log('Server on port 3000'));`\n        };\n\n      default:\n        return { frontend: \"\", backend: \"\" };\n    }\n  };\n\n  const code = generateCode();\n\n  const getLanguage = (type: 'frontend' | 'backend'): string => {\n    if (type === 'backend') {\n      switch (framework) {\n        case 'php':\n          return 'php';\n        case 'python':\n          return 'python';\n        case 'nextjs':\n          return 'typescript';\n        default:\n          return 'javascript';\n      }\n    }\n    \n    // Frontend language\n    switch (framework) {\n      case 'react':\n      case 'nextjs':\n        return 'typescript'; // Changed from 'tsx' to 'typescript'\n      case 'vue':\n        return 'javascript'; // Changed from 'vue' to 'javascript' (Vue SFC)\n      case 'php':\n      case 'python':\n      case 'nodejs':\n      case 'html':\n      default:\n        return 'html';\n    }\n  };\n\n  const copyToClipboard = async (text: string, tab: string) => {\n    await navigator.clipboard.writeText(text);\n    setCopiedTab(tab);\n    toast({\n      title: t('toast.success'),\n      description: t('integration.toast.codeCopied'),\n    });\n    setTimeout(() => setCopiedTab(null), 2000);\n  };\n\n  return (\n    <div className=\"min-h-screen bg-background relative overflow-hidden\">\n      {/* Animated Background */}\n      <div className=\"fixed inset-0 overflow-hidden pointer-events-none\">\n        <div className=\"absolute top-0 right-0 w-[300px] md:w-[500px] h-[300px] md:h-[500px] bg-purple-500/5 dark:bg-purple-500/10 rounded-full blur-[100px] animate-pulse\" />\n        <div className=\"absolute bottom-0 left-0 w-[250px] md:w-[400px] h-[250px] md:h-[400px] bg-blue-500/5 dark:bg-blue-500/10 rounded-full blur-[80px] animate-pulse\" style={{ animationDelay: '1.5s' }} />\n      </div>\n\n      <div className=\"relative z-10 container mx-auto px-3 py-4 sm:px-6 sm:py-6 lg:px-8 lg:py-8 max-w-7xl\">\n        <motion.div\n          initial={{ opacity: 0, y: -20 }}\n          animate={{ opacity: 1, y: 0 }}\n          transition={{ duration: 0.6 }}\n          className=\"mb-6 sm:mb-8\"\n        >\n          <div className=\"flex items-center gap-2 sm:gap-3 mb-2\">\n            <div className=\"p-1.5 sm:p-2 bg-gradient-to-br from-purple-500 to-blue-600 rounded-lg shadow-lg shadow-purple-500/30\">\n              <Sparkles className=\"w-5 h-5 sm:w-6 sm:w-6 text-white\" />\n            </div>\n            <h1 className=\"text-xl sm:text-2xl lg:text-3xl font-bold\">{t('integration.title')}</h1>\n          </div>\n          <p className=\"text-xs sm:text-sm text-muted-foreground ml-9 sm:ml-11\">\n            {t('integration.subtitle')}\n          </p>\n        </motion.div>\n\n        <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-3 sm:gap-4 lg:gap-6\">\n          <motion.div\n            initial={{ opacity: 0, x: -20 }}\n            animate={{ opacity: 1, x: 0 }}\n            transition={{ delay: 0.2 }}\n            className=\"lg:col-span-1\"\n          >\n            <Card className=\"shadow-lg hover:shadow-xl transition-all card-3d\">\n            <CardHeader>\n              <CardTitle className=\"text-base sm:text-lg\">{t('integration.configuration.title')}</CardTitle>\n              <CardDescription className=\"text-xs sm:text-sm\">{t('integration.configuration.description')}</CardDescription>\n            </CardHeader>\n            <CardContent className=\"space-y-3 sm:space-y-4\">\n              <div>\n                <Label htmlFor=\"framework\" className=\"text-xs sm:text-sm\">{t('integration.selectFramework')}</Label>\n                <Select value={framework} onValueChange={(v) => setFramework(v as Framework)}>\n                  <SelectTrigger id=\"framework\" data-testid=\"select-framework\" className=\"h-9 text-xs sm:text-sm\">\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"html\">{t('integration.frameworks.html')}</SelectItem>\n                    <SelectItem value=\"react\">{t('integration.frameworks.react')}</SelectItem>\n                    <SelectItem value=\"nextjs\">{t('integration.frameworks.nextjs')}</SelectItem>\n                    <SelectItem value=\"vue\">{t('integration.frameworks.vue')}</SelectItem>\n                    <SelectItem value=\"php\">{t('integration.frameworks.php')}</SelectItem>\n                    <SelectItem value=\"python\">{t('integration.frameworks.python')}</SelectItem>\n                    <SelectItem value=\"nodejs\">{t('integration.frameworks.nodejs')}</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n\n              <div>\n                <Label htmlFor=\"challenge-type\" className=\"text-xs sm:text-sm\">{t('integration.challengeType')}</Label>\n                <Select value={challengeType} onValueChange={(v) => setChallengeType(v as ChallengeType)}>\n                  <SelectTrigger id=\"challenge-type\" data-testid=\"select-challenge-type\" className=\"h-9 text-xs sm:text-sm\">\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"random\">{t('integration.challenges.random')}</SelectItem>\n                    <SelectItem value=\"grid\">{t('integration.challenges.grid')}</SelectItem>\n                    <SelectItem value=\"jigsaw\">{t('integration.challenges.jigsaw')}</SelectItem>\n                    <SelectItem value=\"gesture\">{t('integration.challenges.gesture')}</SelectItem>\n                    <SelectItem value=\"upside_down\">{t('integration.challenges.upside_down')}</SelectItem>\n                  </SelectContent>\n                </Select>\n                <p className=\"text-xs text-muted-foreground mt-1\">\n                  {t(`integration.challengeDescriptions.${challengeType}`)}\n                </p>\n              </div>\n\n              <div>\n                <Label htmlFor=\"theme\" className=\"text-xs sm:text-sm\">{t('integration.theme')}</Label>\n                <Select value={theme} onValueChange={(v) => setTheme(v as Theme)}>\n                  <SelectTrigger id=\"theme\" data-testid=\"select-theme\" className=\"h-9 text-xs sm:text-sm\">\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"light\">{t('integration.themes.light')}</SelectItem>\n                    <SelectItem value=\"dark\">{t('integration.themes.dark')}</SelectItem>\n                    <SelectItem value=\"auto\">{t('integration.themes.auto')}</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n\n              <div className=\"pt-3 sm:pt-4 border-t\">\n                <p className=\"text-xs sm:text-sm text-muted-foreground mb-2\">\n                  {t('integration.replacePlaceholder')}\n                </p>\n                <div className=\"space-y-1.5 sm:space-y-2 text-xs\">\n                  <div className=\"p-1.5 sm:p-2 bg-muted rounded\">\n                    <code className=\"text-[10px] sm:text-xs\">YOUR_PUBLIC_KEY</code>\n                  </div>\n                  <div className=\"p-1.5 sm:p-2 bg-muted rounded\">\n                    <code className=\"text-[10px] sm:text-xs\">YOUR_SECRET_KEY</code>\n                  </div>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n        </motion.div>\n\n        <motion.div\n          initial={{ opacity: 0, x: 20 }}\n          animate={{ opacity: 1, x: 0 }}\n          transition={{ delay: 0.3 }}\n          className=\"lg:col-span-2\"\n        >\n          <Card className=\"shadow-lg hover:shadow-xl transition-all card-3d\">\n            <CardHeader>\n              <div className=\"flex items-center gap-2\">\n                <Code2 className=\"w-4 h-4 sm:w-5 sm:h-5\" />\n                <CardTitle className=\"text-base sm:text-lg\">{t('integration.generatedCode.title')}</CardTitle>\n              </div>\n              <CardDescription className=\"text-xs sm:text-sm\">{t('integration.generatedCode.description')}</CardDescription>\n            </CardHeader>\n            <CardContent>\n              <Tabs defaultValue=\"frontend\" className=\"w-full\">\n                <TabsList className=\"grid w-full grid-cols-2 h-9\">\n                  <TabsTrigger value=\"frontend\" data-testid=\"tab-frontend\" className=\"text-xs sm:text-sm\">{t('integration.generatedCode.frontend')}</TabsTrigger>\n                  <TabsTrigger value=\"backend\" data-testid=\"tab-backend\" className=\"text-xs sm:text-sm\">{t('integration.generatedCode.backend')}</TabsTrigger>\n                </TabsList>\n                \n                <TabsContent value=\"frontend\" className=\"space-y-3 sm:space-y-4 mt-3 sm:mt-4\">\n                  <div className=\"relative rounded-md overflow-hidden\">\n                    <Button\n                      size=\"sm\"\n                      variant=\"outline\"\n                      className=\"absolute top-1.5 sm:top-2 right-1.5 sm:right-2 z-10 text-xs h-7 sm:h-8\"\n                      onClick={() => copyToClipboard(code.frontend, \"frontend\")}\n                      data-testid=\"button-copy-frontend\"\n                    >\n                      {copiedTab === \"frontend\" ? (\n                        <><Check className=\"w-3 h-3 sm:w-4 sm:h-4 mr-1\" /> <span className=\"hidden sm:inline\">{t('integration.generatedCode.copied')}</span><span className=\"sm:hidden\">OK</span></>\n                      ) : (\n                        <><Copy className=\"w-3 h-3 sm:w-4 sm:h-4 mr-1\" /> <span className=\"hidden sm:inline\">{t('integration.generatedCode.copy')}</span><span className=\"sm:hidden\">Copy</span></>\n                      )}\n                    </Button>\n                    <div className=\"overflow-auto max-h-[400px] w-full\">\n                      <SyntaxHighlighter\n                        language={getLanguage('frontend')}\n                        style={vscDarkPlus}\n                        customStyle={{\n                          margin: 0,\n                          borderRadius: '0.375rem',\n                          fontSize: window.innerWidth < 640 ? '0.65rem' : '0.75rem',\n                          lineHeight: '1.5',\n                          minWidth: '100%',\n                          width: 'max-content',\n                          overflow: 'visible'\n                        }}\n                        showLineNumbers\n                        wrapLines={false}\n                        wrapLongLines={false}\n                      >\n                        {code.frontend}\n                      </SyntaxHighlighter>\n                    </div>\n                  </div>\n                </TabsContent>\n                \n                <TabsContent value=\"backend\" className=\"space-y-3 sm:space-y-4 mt-3 sm:mt-4\">\n                  <div className=\"relative rounded-md overflow-hidden\">\n                    <Button\n                      size=\"sm\"\n                      variant=\"outline\"\n                      className=\"absolute top-1.5 sm:top-2 right-1.5 sm:right-2 z-10 text-xs h-7 sm:h-8\"\n                      onClick={() => copyToClipboard(code.backend, \"backend\")}\n                      data-testid=\"button-copy-backend\"\n                    >\n                      {copiedTab === \"backend\" ? (\n                        <><Check className=\"w-3 h-3 sm:w-4 sm:h-4 mr-1\" /> <span className=\"hidden sm:inline\">{t('integration.generatedCode.copied')}</span><span className=\"sm:hidden\">OK</span></>\n                      ) : (\n                        <><Copy className=\"w-3 h-3 sm:w-4 sm:h-4 mr-1\" /> <span className=\"hidden sm:inline\">{t('integration.generatedCode.copy')}</span><span className=\"sm:hidden\">Copy</span></>\n                      )}\n                    </Button>\n                    <div className=\"overflow-auto max-h-[400px] w-full\">\n                      <SyntaxHighlighter\n                        language={getLanguage('backend')}\n                        style={vscDarkPlus}\n                        customStyle={{\n                          margin: 0,\n                          borderRadius: '0.375rem',\n                          fontSize: window.innerWidth < 640 ? '0.65rem' : '0.75rem',\n                          lineHeight: '1.5',\n                          minWidth: '100%',\n                          width: 'max-content',\n                          overflow: 'visible'\n                        }}\n                        showLineNumbers\n                        wrapLines={false}\n                        wrapLongLines={false}\n                      >\n                        {code.backend}\n                      </SyntaxHighlighter>\n                    </div>\n                  </div>\n                </TabsContent>\n              </Tabs>\n\n              <div className=\"mt-4 sm:mt-6 p-3 sm:p-4 bg-blue-50 dark:bg-blue-950 rounded-md border border-blue-200 dark:border-blue-800\">\n                <h4 className=\"font-semibold text-xs sm:text-sm mb-2 flex items-center gap-2\">\n                  <Sparkles className=\"w-3 h-3 sm:w-4 sm:h-4 text-blue-600 dark:text-blue-400\" />\n                  {t('integration.quickStart.title')}\n                </h4>\n                <ol className=\"text-xs sm:text-sm space-y-1 list-decimal list-inside text-muted-foreground\">\n                  <li>{t('integration.quickStart.step1Text')} <a href=\"/dashboard/api-keys\" className=\"text-primary hover:underline\">{t('integration.quickStart.step1Link')}</a></li>\n                  <li>{t('integration.quickStart.step2')} <code className=\"bg-white dark:bg-gray-900 px-1 rounded text-[10px] sm:text-xs\">YOUR_PUBLIC_KEY</code> {t('integration.quickStart.step2And')} <code className=\"bg-white dark:bg-gray-900 px-1 rounded text-[10px] sm:text-xs\">YOUR_SECRET_KEY</code></li>\n                  <li>{t('integration.quickStart.step3')} <code className=\"bg-white dark:bg-gray-900 px-1 rounded text-[10px] sm:text-xs\">your-domain.com</code> {t('integration.quickStart.step3To')}</li>\n                  <li>{t('integration.quickStart.step4')}</li>\n                  <li>{t('integration.quickStart.step5')}</li>\n                  <li>{t('integration.quickStart.step6Text')} <a href=\"/api-docs\" className=\"text-primary hover:underline\">{t('integration.quickStart.step6Link')}</a></li>\n                </ol>\n              </div>\n            </CardContent>\n          </Card>\n        </motion.div>\n      </div>\n      </div>\n    </div>\n  );\n}\n","size_bytes":34605},"server/enhancements/csrf-protection.ts":{"content":"import { Request, Response, NextFunction } from 'express';\nimport crypto from 'crypto';\n\nexport interface CSRFConfig {\n  cookieName: string;\n  headerName: string;\n  tokenLength: number;\n  cookieOptions: {\n    httpOnly: boolean;\n    secure: boolean;\n    sameSite: 'strict' | 'lax' | 'none';\n    maxAge: number;\n  };\n}\n\nexport const DEFAULT_CSRF_CONFIG: CSRFConfig = {\n  cookieName: 'csrf_token',\n  headerName: 'x-csrf-token',\n  tokenLength: 32,\n  cookieOptions: {\n    httpOnly: false,\n    secure: process.env.NODE_ENV === 'production',\n    sameSite: 'strict',\n    maxAge: 3600000,\n  },\n};\n\nexport function generateCSRFToken(length: number = 32): string {\n  return crypto.randomBytes(length).toString('hex');\n}\n\nexport function createCSRFCookie(\n  res: Response,\n  config: CSRFConfig = DEFAULT_CSRF_CONFIG\n): string {\n  const token = generateCSRFToken(config.tokenLength);\n  \n  res.cookie(config.cookieName, token, config.cookieOptions);\n  \n  return token;\n}\n\nexport function verifyCSRFToken(\n  req: Request,\n  config: CSRFConfig = DEFAULT_CSRF_CONFIG\n): { valid: boolean; token?: string; error?: string } {\n  const cookieToken = req.cookies?.[config.cookieName];\n  const headerToken = req.headers[config.headerName] as string | undefined;\n  const bodyToken = req.body?.csrfToken;\n\n  if (!cookieToken) {\n    return {\n      valid: false,\n      error: 'CSRF token not found in cookie',\n    };\n  }\n\n  const submittedToken = headerToken || bodyToken;\n\n  if (!submittedToken) {\n    return {\n      valid: false,\n      error: 'CSRF token not found in request',\n    };\n  }\n\n  const cookieBuffer = Buffer.from(cookieToken);\n  const submittedBuffer = Buffer.from(submittedToken);\n  \n  if (cookieBuffer.length !== submittedBuffer.length) {\n    return {\n      valid: false,\n      error: 'CSRF token mismatch',\n    };\n  }\n\n  try {\n    if (!crypto.timingSafeEqual(cookieBuffer, submittedBuffer)) {\n      return {\n        valid: false,\n        error: 'CSRF token mismatch',\n      };\n    }\n  } catch (err) {\n    return {\n      valid: false,\n      error: 'CSRF token validation error',\n    };\n  }\n\n  return {\n    valid: true,\n    token: cookieToken,\n  };\n}\n\nexport function csrfMiddleware(config: CSRFConfig = DEFAULT_CSRF_CONFIG) {\n  return (req: Request, res: Response, next: NextFunction) => {\n    if (req.method === 'GET' || req.method === 'HEAD' || req.method === 'OPTIONS') {\n      const token = createCSRFCookie(res, config);\n      (req as any).csrfToken = token;\n      return next();\n    }\n\n    const verification = verifyCSRFToken(req, config);\n    \n    if (!verification.valid) {\n      console.log(`[CSRF] Token verification failed: ${verification.error}`);\n      return res.status(403).json({\n        success: false,\n        error: 'CSRF token validation failed',\n        message: verification.error,\n      });\n    }\n\n    (req as any).csrfToken = verification.token;\n    \n    const newToken = generateCSRFToken(config.tokenLength);\n    res.cookie(config.cookieName, newToken, config.cookieOptions);\n\n    next();\n  };\n}\n\nexport function getCSRFToken(req: Request): string | undefined {\n  return (req as any).csrfToken;\n}\n","size_bytes":3112},"client/src/pages/ApiKeys.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Plus, Key } from \"lucide-react\";\nimport { motion } from \"framer-motion\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n} from \"@/components/ui/dialog\";\nimport ApiKeyCard from \"@/components/ApiKeyCard\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport type { ApiKey } from \"@shared/schema\";\nimport { useTranslation } from \"react-i18next\";\n\nexport default function ApiKeys() {\n  const { t } = useTranslation();\n  const [isCreateOpen, setIsCreateOpen] = useState(false);\n  const [newKeyName, setNewKeyName] = useState(\"\");\n  const [newKeyDomain, setNewKeyDomain] = useState(\"\");\n  const [newKeyTheme, setNewKeyTheme] = useState(\"light\");\n  const { toast } = useToast();\n\n  const { data: apiKeys, isLoading } = useQuery<ApiKey[]>({\n    queryKey: [\"/api/keys\"],\n  });\n\n  const createMutation = useMutation({\n    mutationFn: async (data: { name: string; domain?: string; theme?: string }) => {\n      const res = await apiRequest(\"POST\", \"/api/keys\", data);\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/keys\"] });\n      setIsCreateOpen(false);\n      setNewKeyName(\"\");\n      setNewKeyDomain(\"\");\n      setNewKeyTheme(\"light\");\n      toast({\n        title: t('toast.success'),\n        description: t('toast.apiKeyCreated'),\n      });\n    },\n  });\n\n  const toggleStatusMutation = useMutation({\n    mutationFn: async (id: string) => {\n      await apiRequest(\"PATCH\", `/api/keys/${id}/toggle`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/keys\"] });\n      toast({\n        title: t('toast.success'),\n        description: t('toast.apiKeyUpdated'),\n      });\n    },\n  });\n\n  const deleteMutation = useMutation({\n    mutationFn: async (id: string) => {\n      await apiRequest(\"DELETE\", `/api/keys/${id}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/keys\"] });\n      toast({\n        title: t('toast.success'),\n        description: t('toast.apiKeyDeleted'),\n      });\n    },\n  });\n\n  const handleCreate = () => {\n    if (!newKeyName.trim()) {\n      toast({\n        title: t('toast.error'),\n        description: t('apiKeys.errors.nameRequired'),\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    if (!newKeyDomain.trim()) {\n      toast({\n        title: t('toast.error'),\n        description: t('apiKeys.errors.domainRequired'),\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    createMutation.mutate({\n      name: newKeyName,\n      domain: newKeyDomain,\n      theme: newKeyTheme,\n    });\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"flex items-center justify-center h-full\">\n        <motion.div\n          initial={{ opacity: 0, scale: 0.8 }}\n          animate={{ opacity: 1, scale: 1 }}\n          transition={{ duration: 0.5 }}\n          className=\"flex flex-col items-center gap-3\"\n        >\n          <div className=\"animate-spin rounded-full h-12 w-12 border-3 border-purple-500 border-t-transparent\" />\n          <p className=\"text-muted-foreground text-sm\">{t('apiKeys.loading')}</p>\n        </motion.div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-background relative overflow-hidden\">\n      {/* Animated Background */}\n      <div className=\"fixed inset-0 overflow-hidden pointer-events-none\">\n        <div className=\"absolute top-0 right-0 w-[300px] md:w-[500px] h-[300px] md:h-[500px] bg-purple-500/5 dark:bg-purple-500/10 rounded-full blur-[100px] animate-pulse\" />\n        <div className=\"absolute bottom-0 left-0 w-[250px] md:w-[400px] h-[250px] md:h-[400px] bg-blue-500/5 dark:bg-blue-500/10 rounded-full blur-[80px] animate-pulse\" style={{ animationDelay: '1.5s' }} />\n      </div>\n\n      <div className=\"relative z-10 px-3 py-4 sm:px-6 sm:py-6 lg:px-8 lg:py-8 space-y-4 sm:space-y-6 lg:space-y-8\" data-testid=\"page-api-keys\">\n        <motion.div\n          initial={{ opacity: 0, y: -20 }}\n          animate={{ opacity: 1, y: 0 }}\n          transition={{ duration: 0.6 }}\n          className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 sm:gap-4\"\n        >\n          <div className=\"space-y-1 sm:space-y-2\">\n            <div className=\"flex items-center gap-2 sm:gap-3\">\n              <div className=\"p-1.5 sm:p-2 bg-gradient-to-br from-purple-500 to-blue-600 rounded-lg shadow-lg shadow-purple-500/30\">\n                <Key className=\"h-4 w-4 sm:h-5 sm:w-5 text-white\" />\n              </div>\n              <h1 className=\"text-xl sm:text-2xl lg:text-3xl font-bold\" data-testid=\"text-title\">\n                {t('apiKeys.title')}\n              </h1>\n            </div>\n            <p className=\"text-xs sm:text-sm text-muted-foreground ml-9 sm:ml-11\" data-testid=\"text-subtitle\">\n              {t('apiKeys.subtitle')}\n            </p>\n          </div>\n\n          <Dialog open={isCreateOpen} onOpenChange={setIsCreateOpen}>\n            <DialogTrigger asChild>\n              <motion.div whileHover={{ scale: 1.05 }} whileTap={{ scale: 0.95 }}>\n                <Button className=\"shadow-md hover:shadow-lg transition-shadow\" data-testid=\"button-create-key\">\n                  <Plus className=\"h-4 w-4 mr-2\" />\n                  <span className=\"hidden sm:inline\">{t('apiKeys.dialog.createButton')}</span>\n                  <span className=\"sm:hidden\">{t('common.create')}</span>\n                </Button>\n              </motion.div>\n            </DialogTrigger>\n          <DialogContent data-testid=\"dialog-create-key\">\n            <DialogHeader>\n              <DialogTitle>{t('apiKeys.dialog.title')}</DialogTitle>\n              <DialogDescription>\n                {t('apiKeys.dialog.description')}\n              </DialogDescription>\n            </DialogHeader>\n\n            <div className=\"space-y-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"name\">{t('apiKeys.dialog.nameLabel')}</Label>\n                <Input\n                  id=\"name\"\n                  placeholder={t('apiKeys.dialog.namePlaceholder')}\n                  value={newKeyName}\n                  onChange={(e) => setNewKeyName(e.target.value)}\n                  data-testid=\"input-name\"\n                />\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"domain\">{t('apiKeys.dialog.domainRequired')}</Label>\n                <Input\n                  id=\"domain\"\n                  placeholder={t('apiKeys.dialog.domainPlaceholder')}\n                  value={newKeyDomain}\n                  onChange={(e) => setNewKeyDomain(e.target.value)}\n                  data-testid=\"input-domain\"\n                  required\n                />\n                <p className=\"text-xs text-muted-foreground\">\n                  {t('apiKeys.dialog.domainHelpText')}\n                </p>\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"theme\">{t('apiKeys.dialog.themeLabel')}</Label>\n                <Select value={newKeyTheme} onValueChange={setNewKeyTheme}>\n                  <SelectTrigger id=\"theme\" data-testid=\"select-theme\">\n                    <SelectValue placeholder={t('apiKeys.dialog.themePlaceholder')} />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"light\" data-testid=\"theme-light\">{t('apiKeys.dialog.lightTheme')}</SelectItem>\n                    <SelectItem value=\"dark\" data-testid=\"theme-dark\">{t('apiKeys.dialog.darkTheme')}</SelectItem>\n                    <SelectItem value=\"auto\" data-testid=\"theme-auto\">{t('apiKeys.dialog.autoTheme')}</SelectItem>\n                  </SelectContent>\n                </Select>\n                <p className=\"text-xs text-muted-foreground\">\n                  {t('apiKeys.dialog.themeHelpText')}\n                </p>\n              </div>\n            </div>\n\n            <DialogFooter>\n              <Button\n                variant=\"outline\"\n                onClick={() => setIsCreateOpen(false)}\n                data-testid=\"button-cancel\"\n              >\n                {t('common.cancel')}\n              </Button>\n              <Button\n                onClick={handleCreate}\n                disabled={createMutation.isPending}\n                data-testid=\"button-submit\"\n              >\n                {createMutation.isPending ? t('apiKeys.dialog.creating') : t('apiKeys.dialog.create')}\n              </Button>\n            </DialogFooter>\n          </DialogContent>\n        </Dialog>\n      </motion.div>\n\n      <motion.div\n        initial={{ opacity: 0, y: 20 }}\n        animate={{ opacity: 1, y: 0 }}\n        transition={{ delay: 0.2 }}\n        className=\"grid gap-3 sm:gap-4 md:gap-5 lg:gap-6 grid-cols-1 md:grid-cols-2 xl:grid-cols-3\"\n      >\n        {!apiKeys || apiKeys.length === 0 ? (\n          <motion.div\n            initial={{ opacity: 0, scale: 0.9 }}\n            animate={{ opacity: 1, scale: 1 }}\n            transition={{ duration: 0.5 }}\n            className=\"col-span-full text-center py-12 sm:py-16\"\n          >\n            <p className=\"text-sm sm:text-base text-muted-foreground\">{t('apiKeys.empty.title')}</p>\n          </motion.div>\n        ) : (\n          apiKeys.map((apiKey, index) => (\n            <motion.div\n              key={apiKey.id}\n              initial={{ opacity: 0, y: 20 }}\n              animate={{ opacity: 1, y: 0 }}\n              transition={{ delay: index * 0.1 }}\n              whileHover={{ y: -8, rotateX: 5, rotateY: 5, scale: 1.02 }}\n              style={{ transformStyle: 'preserve-3d', perspective: 1000 }}\n              className=\"card-3d\"\n            >\n              <ApiKeyCard\n                apiKey={apiKey}\n                onToggleStatus={(id) => toggleStatusMutation.mutate(id)}\n                onDelete={(id) => {\n                  if (confirm(t('apiKeys.card.confirmDelete'))) {\n                    deleteMutation.mutate(id);\n                  }\n                }}\n              />\n            </motion.div>\n          ))\n        )}\n      </motion.div>\n      </div>\n    </div>\n  );\n}\n","size_bytes":10484},"client/src/lib/queryClient.ts":{"content":"import { QueryClient, QueryFunction } from \"@tanstack/react-query\";\n\nasync function throwIfResNotOk(res: Response) {\n  if (!res.ok) {\n    const text = (await res.text()) || res.statusText;\n    throw new Error(`${res.status}: ${text}`);\n  }\n}\n\nfunction getCookie(name: string): string | null {\n  const value = `; ${document.cookie}`;\n  const parts = value.split(`; ${name}=`);\n  if (parts.length === 2) {\n    return parts.pop()?.split(';').shift() || null;\n  }\n  return null;\n}\n\nexport async function apiRequest(\n  method: string,\n  url: string,\n  data?: unknown | undefined,\n): Promise<Response> {\n  const headers: Record<string, string> = {};\n  \n  if (data) {\n    headers[\"Content-Type\"] = \"application/json\";\n  }\n  \n  const csrfToken = getCookie(\"csrf_token\");\n  if (csrfToken) {\n    headers[\"x-csrf-token\"] = csrfToken;\n  }\n  \n  const res = await fetch(url, {\n    method,\n    headers,\n    body: data ? JSON.stringify(data) : undefined,\n    credentials: \"include\",\n  });\n\n  await throwIfResNotOk(res);\n  return res;\n}\n\ntype UnauthorizedBehavior = \"returnNull\" | \"throw\";\nexport const getQueryFn: <T>(options: {\n  on401: UnauthorizedBehavior;\n}) => QueryFunction<T> =\n  ({ on401: unauthorizedBehavior }) =>\n  async ({ queryKey }) => {\n    const res = await fetch(queryKey.join(\"/\") as string, {\n      credentials: \"include\",\n    });\n\n    if (unauthorizedBehavior === \"returnNull\" && res.status === 401) {\n      return null;\n    }\n\n    await throwIfResNotOk(res);\n    return await res.json();\n  };\n\nexport const queryClient = new QueryClient({\n  defaultOptions: {\n    queries: {\n      queryFn: async ({ queryKey }) => {\n        const url = queryKey.join(\"/\") as string;\n        const res = await fetch(url, {\n          credentials: \"include\",\n        });\n\n        if (url.includes(\"/api/auth/user\") && res.status === 401) {\n          return null;\n        }\n\n        if (!res.ok) {\n          const text = (await res.text()) || res.statusText;\n          throw new Error(`${res.status}: ${text}`);\n        }\n\n        return await res.json();\n      },\n      refetchInterval: false,\n      refetchOnWindowFocus: false,\n      staleTime: Infinity,\n      retry: false,\n    },\n    mutations: {\n      retry: false,\n    },\n  },\n});\n","size_bytes":2220},"client/src/components/ui/navigation-menu.tsx":{"content":"import * as React from \"react\"\nimport * as NavigationMenuPrimitive from \"@radix-ui/react-navigation-menu\"\nimport { cva } from \"class-variance-authority\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst NavigationMenu = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative z-10 flex max-w-max flex-1 items-center justify-center\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <NavigationMenuViewport />\n  </NavigationMenuPrimitive.Root>\n))\nNavigationMenu.displayName = NavigationMenuPrimitive.Root.displayName\n\nconst NavigationMenuList = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.List\n    ref={ref}\n    className={cn(\n      \"group flex flex-1 list-none items-center justify-center space-x-1\",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuList.displayName = NavigationMenuPrimitive.List.displayName\n\nconst NavigationMenuItem = NavigationMenuPrimitive.Item\n\nconst navigationMenuTriggerStyle = cva(\n  \"group inline-flex h-10 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[state=open]:text-accent-foreground data-[state=open]:bg-accent/50 data-[state=open]:hover:bg-accent data-[state=open]:focus:bg-accent\"\n)\n\nconst NavigationMenuTrigger = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Trigger\n    ref={ref}\n    className={cn(navigationMenuTriggerStyle(), \"group\", className)}\n    {...props}\n  >\n    {children}{\" \"}\n    <ChevronDown\n      className=\"relative top-[1px] ml-1 h-3 w-3 transition duration-200 group-data-[state=open]:rotate-180\"\n      aria-hidden=\"true\"\n    />\n  </NavigationMenuPrimitive.Trigger>\n))\nNavigationMenuTrigger.displayName = NavigationMenuPrimitive.Trigger.displayName\n\nconst NavigationMenuContent = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto \",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuContent.displayName = NavigationMenuPrimitive.Content.displayName\n\nconst NavigationMenuLink = NavigationMenuPrimitive.Link\n\nconst NavigationMenuViewport = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Viewport>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Viewport>\n>(({ className, ...props }, ref) => (\n  <div className={cn(\"absolute left-0 top-full flex justify-center\")}>\n    <NavigationMenuPrimitive.Viewport\n      className={cn(\n        \"origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)]\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  </div>\n))\nNavigationMenuViewport.displayName =\n  NavigationMenuPrimitive.Viewport.displayName\n\nconst NavigationMenuIndicator = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Indicator>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Indicator>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Indicator\n    ref={ref}\n    className={cn(\n      \"top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in\",\n      className\n    )}\n    {...props}\n  >\n    <div className=\"relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-border shadow-md\" />\n  </NavigationMenuPrimitive.Indicator>\n))\nNavigationMenuIndicator.displayName =\n  NavigationMenuPrimitive.Indicator.displayName\n\nexport {\n  navigationMenuTriggerStyle,\n  NavigationMenu,\n  NavigationMenuList,\n  NavigationMenuItem,\n  NavigationMenuContent,\n  NavigationMenuTrigger,\n  NavigationMenuLink,\n  NavigationMenuIndicator,\n  NavigationMenuViewport,\n}\n","size_bytes":5128},"server/storage.ts":{"content":"import {\n  type Developer,\n  type InsertDeveloper,\n  type ApiKey,\n  type InsertApiKey,\n  type Challenge,\n  type InsertChallenge,\n  type Verification,\n  type InsertVerification,\n  type Analytics,\n  type InsertAnalytics,\n  type CountryAnalytics,\n  type InsertCountryAnalytics,\n} from \"@shared/schema\";\nimport { randomUUID } from \"crypto\";\nimport { nanoid } from \"nanoid\";\nimport { generateKeyPair } from \"./crypto-utils\";\n\nexport interface IStorage {\n  // Developers\n  createDeveloper(developer: InsertDeveloper): Promise<Developer>;\n  getDeveloper(id: string): Promise<Developer | undefined>;\n  getDeveloperById(id: string): Promise<Developer | undefined>;\n  getDeveloperByEmail(email: string): Promise<Developer | undefined>;\n  verifyDeveloperEmail(id: string): Promise<void>;\n  updateVerificationCode(id: string, code: string, expiry: Date): Promise<void>;\n  updateResetPasswordCode(email: string, code: string, expiry: Date): Promise<void>;\n  resetPassword(email: string, code: string, newPassword: string): Promise<boolean>;\n\n  // API Keys\n  createApiKey(apiKey: InsertApiKey, customKeys?: { sitekey: string; secretkey: string }): Promise<ApiKey>;\n  getApiKey(id: string): Promise<ApiKey | undefined>;\n  getApiKeyBySitekey(sitekey: string): Promise<ApiKey | undefined>;\n  getApiKeyBySecretkey(secretkey: string): Promise<ApiKey | undefined>;\n  getAllApiKeys(): Promise<ApiKey[]>;\n  getApiKeysByDeveloper(developerId: string): Promise<ApiKey[]>;\n  updateApiKeyStatus(id: string, isActive: boolean): Promise<void>;\n  updateApiKeySettings(id: string, settings: any): Promise<void>;\n  deleteApiKey(id: string): Promise<void>;\n\n  // Challenges\n  createChallenge(challenge: InsertChallenge): Promise<Challenge>;\n  getChallenge(id: string): Promise<Challenge | undefined>;\n  getChallengeByToken(token: string): Promise<Challenge | undefined>;\n  markChallengeAsUsed(id: string): Promise<boolean>;\n  getAllChallenges(): Promise<Challenge[]>;\n  deleteChallenge(id: string): Promise<void>;\n\n  // Verifications\n  createVerification(verification: InsertVerification): Promise<Verification>;\n  getVerificationsByApiKey(apiKeyId: string, limit?: number): Promise<Verification[]>;\n  getRecentVerifications(limit?: number): Promise<Verification[]>;\n\n  // Analytics\n  createOrUpdateAnalytics(analytics: InsertAnalytics): Promise<Analytics>;\n  getAnalyticsByApiKey(apiKeyId: string, startDate?: Date, endDate?: Date): Promise<Analytics[]>;\n  getAnalyticsByDateRange(startDate: Date, endDate: Date): Promise<Analytics[]>;\n  updateDailyAnalytics(apiKeyId: string): Promise<void>;\n  \n  // Country Analytics\n  createOrUpdateCountryAnalytics(analytics: InsertCountryAnalytics): Promise<CountryAnalytics>;\n  getCountryAnalyticsByApiKey(apiKeyId: string, startDate?: Date, endDate?: Date): Promise<CountryAnalytics[]>;\n  getCountryAnalyticsSummary(apiKeyId?: string, limit?: number): Promise<CountryAnalytics[]>;\n  updateDailyCountryAnalytics(apiKeyId: string): Promise<void>;\n}\n\nexport class MemStorage implements IStorage {\n  private developers: Map<string, Developer>;\n  private apiKeys: Map<string, ApiKey>;\n  private challenges: Map<string, Challenge>;\n  private verifications: Map<string, Verification>;\n  private analytics: Map<string, Analytics>;\n  private countryAnalytics: Map<string, CountryAnalytics>;\n\n  constructor() {\n    this.developers = new Map();\n    this.apiKeys = new Map();\n    this.challenges = new Map();\n    this.verifications = new Map();\n    this.analytics = new Map();\n    this.countryAnalytics = new Map();\n  }\n\n  async createDeveloper(insertDeveloper: InsertDeveloper): Promise<Developer> {\n    const id = randomUUID();\n    const developer: Developer = {\n      id,\n      email: insertDeveloper.email,\n      password: insertDeveloper.password,\n      name: insertDeveloper.name,\n      isEmailVerified: insertDeveloper.isEmailVerified ?? false,\n      verificationCode: insertDeveloper.verificationCode ?? null,\n      verificationCodeExpiry: insertDeveloper.verificationCodeExpiry ?? null,\n      resetPasswordCode: null,\n      resetPasswordCodeExpiry: null,\n      createdAt: new Date(),\n    };\n    this.developers.set(id, developer);\n    return developer;\n  }\n\n  async getDeveloper(id: string): Promise<Developer | undefined> {\n    return this.developers.get(id);\n  }\n\n  async getDeveloperById(id: string): Promise<Developer | undefined> {\n    return this.developers.get(id);\n  }\n\n  async getDeveloperByEmail(email: string): Promise<Developer | undefined> {\n    return Array.from(this.developers.values()).find((dev) => dev.email === email);\n  }\n\n  async verifyDeveloperEmail(id: string): Promise<void> {\n    const developer = this.developers.get(id);\n    if (developer) {\n      developer.isEmailVerified = true;\n      developer.verificationCode = null;\n      developer.verificationCodeExpiry = null;\n      this.developers.set(id, developer);\n    }\n  }\n\n  async updateVerificationCode(id: string, code: string, expiry: Date): Promise<void> {\n    const developer = this.developers.get(id);\n    if (developer) {\n      developer.verificationCode = code;\n      developer.verificationCodeExpiry = expiry;\n      this.developers.set(id, developer);\n    }\n  }\n\n  async updateResetPasswordCode(email: string, code: string, expiry: Date): Promise<void> {\n    const developer = Array.from(this.developers.values()).find(dev => dev.email === email);\n    if (developer) {\n      developer.resetPasswordCode = code;\n      developer.resetPasswordCodeExpiry = expiry;\n      this.developers.set(developer.id, developer);\n    }\n  }\n\n  async resetPassword(email: string, code: string, newPassword: string): Promise<boolean> {\n    const developer = Array.from(this.developers.values()).find(dev => dev.email === email);\n    if (!developer) {\n      return false;\n    }\n\n    if (!developer.resetPasswordCode || !developer.resetPasswordCodeExpiry) {\n      return false;\n    }\n\n    if (new Date() > developer.resetPasswordCodeExpiry) {\n      return false;\n    }\n\n    if (developer.resetPasswordCode !== code) {\n      return false;\n    }\n\n    developer.password = newPassword;\n    developer.resetPasswordCode = null;\n    developer.resetPasswordCodeExpiry = null;\n    this.developers.set(developer.id, developer);\n    return true;\n  }\n\n  // API Keys\n  async createApiKey(insertApiKey: InsertApiKey, customKeys?: { sitekey: string; secretkey: string }): Promise<ApiKey> {\n    const id = randomUUID();\n    const { siteKey, secretKey } = customKeys \n      ? { siteKey: customKeys.sitekey, secretKey: customKeys.secretkey }\n      : generateKeyPair();\n    const apiKey: ApiKey = {\n      id,\n      developerId: insertApiKey.developerId,\n      name: insertApiKey.name,\n      sitekey: siteKey,\n      secretkey: secretKey,\n      domain: insertApiKey.domain || null,\n      theme: insertApiKey.theme || 'light',\n      settings: null,\n      isActive: insertApiKey.isActive ?? true,\n      createdAt: new Date(),\n    };\n    this.apiKeys.set(id, apiKey);\n    return apiKey;\n  }\n\n  async getApiKey(id: string): Promise<ApiKey | undefined> {\n    return this.apiKeys.get(id);\n  }\n\n  async getApiKeyBySitekey(sitekey: string): Promise<ApiKey | undefined> {\n    return Array.from(this.apiKeys.values()).find((key) => key.sitekey === sitekey);\n  }\n\n  async getApiKeyBySecretkey(secretkey: string): Promise<ApiKey | undefined> {\n    return Array.from(this.apiKeys.values()).find((key) => key.secretkey === secretkey);\n  }\n\n  async getAllApiKeys(): Promise<ApiKey[]> {\n    return Array.from(this.apiKeys.values());\n  }\n\n  async getApiKeysByDeveloper(developerId: string): Promise<ApiKey[]> {\n    return Array.from(this.apiKeys.values()).filter((key) => key.developerId === developerId);\n  }\n\n  async updateApiKeyStatus(id: string, isActive: boolean): Promise<void> {\n    const apiKey = this.apiKeys.get(id);\n    if (apiKey) {\n      apiKey.isActive = isActive;\n      this.apiKeys.set(id, apiKey);\n    }\n  }\n\n  async updateApiKeySettings(id: string, settings: any): Promise<void> {\n    const apiKey = this.apiKeys.get(id);\n    if (apiKey) {\n      apiKey.settings = settings;\n      this.apiKeys.set(id, apiKey);\n    }\n  }\n\n  async deleteApiKey(id: string): Promise<void> {\n    this.apiKeys.delete(id);\n  }\n\n  // Challenges\n  async createChallenge(insertChallenge: InsertChallenge): Promise<Challenge> {\n    const id = randomUUID();\n    const challenge: Challenge = {\n      id,\n      token: insertChallenge.token,\n      difficulty: insertChallenge.difficulty ?? 4,\n      challengeData: insertChallenge.challengeData,\n      type: insertChallenge.type,\n      apiKeyId: insertChallenge.apiKeyId || null,\n      validatedDomain: insertChallenge.validatedDomain,\n      signature: insertChallenge.signature,\n      sessionFingerprint: insertChallenge.sessionFingerprint || null,\n      isUsed: insertChallenge.isUsed ?? false,\n      createdAt: new Date(),\n      expiresAt: insertChallenge.expiresAt,\n    };\n    this.challenges.set(id, challenge);\n    return challenge;\n  }\n\n  async getChallenge(id: string): Promise<Challenge | undefined> {\n    return this.challenges.get(id);\n  }\n\n  async getChallengeByToken(token: string): Promise<Challenge | undefined> {\n    return Array.from(this.challenges.values()).find((c) => c.token === token);\n  }\n\n  async markChallengeAsUsed(id: string): Promise<boolean> {\n    const challenge = this.challenges.get(id);\n    if (challenge && !challenge.isUsed) {\n      challenge.isUsed = true;\n      this.challenges.set(id, challenge);\n      return true;\n    }\n    return false;\n  }\n\n  async getAllChallenges(): Promise<Challenge[]> {\n    return Array.from(this.challenges.values());\n  }\n\n  async deleteChallenge(id: string): Promise<void> {\n    this.challenges.delete(id);\n  }\n\n  // Verifications\n  async createVerification(insertVerification: InsertVerification): Promise<Verification> {\n    const id = randomUUID();\n    const verification: Verification = {\n      id,\n      challengeId: insertVerification.challengeId || null,\n      apiKeyId: insertVerification.apiKeyId || null,\n      success: insertVerification.success,\n      ipAddress: insertVerification.ipAddress || null,\n      userAgent: insertVerification.userAgent || null,\n      country: insertVerification.country || null,\n      countryName: insertVerification.countryName || null,\n      region: insertVerification.region || null,\n      city: insertVerification.city || null,\n      latitude: insertVerification.latitude || null,\n      longitude: insertVerification.longitude || null,\n      timezone: insertVerification.timezone || null,\n      timeToSolve: insertVerification.timeToSolve || null,\n      attemptData: insertVerification.attemptData || null,\n      createdAt: new Date(),\n    };\n    this.verifications.set(id, verification);\n    return verification;\n  }\n\n  async getVerificationsByApiKey(apiKeyId: string, limit: number = 100): Promise<Verification[]> {\n    return Array.from(this.verifications.values())\n      .filter((v) => v.apiKeyId === apiKeyId)\n      .sort((a, b) => b.createdAt.getTime() - a.createdAt.getTime())\n      .slice(0, limit);\n  }\n\n  async getRecentVerifications(limit: number = 100): Promise<Verification[]> {\n    return Array.from(this.verifications.values())\n      .sort((a, b) => b.createdAt.getTime() - a.createdAt.getTime())\n      .slice(0, limit);\n  }\n\n  // Analytics\n  async createOrUpdateAnalytics(insertAnalytics: InsertAnalytics): Promise<Analytics> {\n    const existing = Array.from(this.analytics.values()).find(\n      (a) =>\n        a.apiKeyId === insertAnalytics.apiKeyId &&\n        a.date.toDateString() === insertAnalytics.date.toDateString()\n    );\n\n    if (existing) {\n      Object.assign(existing, insertAnalytics);\n      this.analytics.set(existing.id, existing);\n      return existing;\n    }\n\n    const id = randomUUID();\n    const analytics: Analytics = {\n      id,\n      apiKeyId: insertAnalytics.apiKeyId || null,\n      date: insertAnalytics.date,\n      totalChallenges: insertAnalytics.totalChallenges ?? 0,\n      successfulVerifications: insertAnalytics.successfulVerifications ?? 0,\n      failedVerifications: insertAnalytics.failedVerifications ?? 0,\n      averageTimeToSolve: insertAnalytics.averageTimeToSolve || null,\n      uniqueIps: insertAnalytics.uniqueIps ?? 0,\n    };\n    this.analytics.set(id, analytics);\n    return analytics;\n  }\n\n  async getAnalyticsByApiKey(\n    apiKeyId: string,\n    startDate?: Date,\n    endDate?: Date\n  ): Promise<Analytics[]> {\n    let results = Array.from(this.analytics.values()).filter((a) => a.apiKeyId === apiKeyId);\n\n    if (startDate) {\n      results = results.filter((a) => a.date >= startDate);\n    }\n    if (endDate) {\n      results = results.filter((a) => a.date <= endDate);\n    }\n\n    return results.sort((a, b) => a.date.getTime() - b.date.getTime());\n  }\n\n  async getAnalyticsByDateRange(startDate: Date, endDate: Date): Promise<Analytics[]> {\n    return Array.from(this.analytics.values())\n      .filter((a) => a.date >= startDate && a.date <= endDate)\n      .sort((a, b) => a.date.getTime() - b.date.getTime());\n  }\n\n  async updateDailyAnalytics(apiKeyId: string): Promise<void> {\n    const today = new Date();\n    today.setHours(0, 0, 0, 0);\n    \n    const tomorrow = new Date(today);\n    tomorrow.setDate(tomorrow.getDate() + 1);\n\n    // Get all verifications for today for this API key\n    const todayVerifications = Array.from(this.verifications.values()).filter(\n      v => v.apiKeyId === apiKeyId && \n      v.createdAt >= today && \n      v.createdAt < tomorrow\n    );\n\n    // Get all challenges created today for this API key\n    const todayChallenges = Array.from(this.challenges.values()).filter(\n      c => c.apiKeyId === apiKeyId && \n      c.createdAt >= today && \n      c.createdAt < tomorrow\n    );\n\n    // Calculate aggregates\n    const totalChallenges = todayChallenges.length;\n    const successfulVerifications = todayVerifications.filter(v => v.success).length;\n    const failedVerifications = todayVerifications.filter(v => !v.success).length;\n    \n    // Calculate average time to solve (only from successful verifications)\n    const successfulWithTime = todayVerifications.filter(v => v.success && v.timeToSolve !== null);\n    const averageTimeToSolve = successfulWithTime.length > 0\n      ? Math.round(successfulWithTime.reduce((sum, v) => sum + (v.timeToSolve || 0), 0) / successfulWithTime.length)\n      : null;\n    \n    // Count unique IPs\n    const uniqueIpsSet = new Set(todayVerifications.map(v => v.ipAddress).filter(ip => ip !== null));\n    const uniqueIps = uniqueIpsSet.size;\n\n    // Update or create analytics record\n    await this.createOrUpdateAnalytics({\n      apiKeyId,\n      date: today,\n      totalChallenges,\n      successfulVerifications,\n      failedVerifications,\n      averageTimeToSolve,\n      uniqueIps,\n    });\n\n    console.log(`[ANALYTICS] Updated daily analytics for ${apiKeyId}: ${successfulVerifications}/${totalChallenges} successful, ${uniqueIps} unique IPs, avg ${averageTimeToSolve}ms`);\n  }\n\n  // Country Analytics\n  async createOrUpdateCountryAnalytics(insertCountryAnalytics: InsertCountryAnalytics): Promise<CountryAnalytics> {\n    const existing = Array.from(this.countryAnalytics.values()).find(\n      (a) =>\n        a.apiKeyId === insertCountryAnalytics.apiKeyId &&\n        a.country === insertCountryAnalytics.country &&\n        a.date.toDateString() === insertCountryAnalytics.date.toDateString()\n    );\n\n    if (existing) {\n      Object.assign(existing, insertCountryAnalytics);\n      this.countryAnalytics.set(existing.id, existing);\n      return existing;\n    }\n\n    const id = randomUUID();\n    const countryAnalytics: CountryAnalytics = {\n      id,\n      apiKeyId: insertCountryAnalytics.apiKeyId || null,\n      country: insertCountryAnalytics.country,\n      countryName: insertCountryAnalytics.countryName,\n      date: insertCountryAnalytics.date,\n      totalVerifications: insertCountryAnalytics.totalVerifications ?? 0,\n      successfulVerifications: insertCountryAnalytics.successfulVerifications ?? 0,\n      failedVerifications: insertCountryAnalytics.failedVerifications ?? 0,\n      averageTimeToSolve: insertCountryAnalytics.averageTimeToSolve || null,\n      uniqueIps: insertCountryAnalytics.uniqueIps ?? 0,\n    };\n    this.countryAnalytics.set(id, countryAnalytics);\n    return countryAnalytics;\n  }\n\n  async getCountryAnalyticsByApiKey(\n    apiKeyId: string,\n    startDate?: Date,\n    endDate?: Date\n  ): Promise<CountryAnalytics[]> {\n    let results = Array.from(this.countryAnalytics.values()).filter((a) => a.apiKeyId === apiKeyId);\n\n    if (startDate) {\n      results = results.filter((a) => a.date >= startDate);\n    }\n    if (endDate) {\n      results = results.filter((a) => a.date <= endDate);\n    }\n\n    return results.sort((a, b) => b.totalVerifications - a.totalVerifications);\n  }\n\n  async getCountryAnalyticsSummary(apiKeyId?: string, limit: number = 20): Promise<CountryAnalytics[]> {\n    let results = Array.from(this.countryAnalytics.values());\n\n    if (apiKeyId) {\n      results = results.filter((a) => a.apiKeyId === apiKeyId);\n    }\n\n    const countryMap = new Map<string, CountryAnalytics>();\n    \n    results.forEach(analytics => {\n      const existing = countryMap.get(analytics.country);\n      if (existing) {\n        existing.totalVerifications += analytics.totalVerifications;\n        existing.successfulVerifications += analytics.successfulVerifications;\n        existing.failedVerifications += analytics.failedVerifications;\n        existing.uniqueIps += analytics.uniqueIps;\n        \n        const totalTime = (existing.averageTimeToSolve || 0) + (analytics.averageTimeToSolve || 0);\n        existing.averageTimeToSolve = Math.round(totalTime / 2);\n      } else {\n        countryMap.set(analytics.country, { ...analytics });\n      }\n    });\n\n    return Array.from(countryMap.values())\n      .sort((a, b) => b.totalVerifications - a.totalVerifications)\n      .slice(0, limit);\n  }\n\n  async updateDailyCountryAnalytics(apiKeyId: string): Promise<void> {\n    const today = new Date();\n    today.setHours(0, 0, 0, 0);\n    \n    const tomorrow = new Date(today);\n    tomorrow.setDate(tomorrow.getDate() + 1);\n\n    // Get all verifications for today for this API key\n    const todayVerifications = Array.from(this.verifications.values()).filter(\n      v => v.apiKeyId === apiKeyId && \n      v.createdAt >= today && \n      v.createdAt < tomorrow\n    );\n\n    // Group verifications by country\n    const countriesMap = new Map<string, {\n      country: string;\n      countryName: string;\n      verifications: typeof todayVerifications;\n    }>();\n\n    for (const verification of todayVerifications) {\n      const country = verification.country || 'Unknown';\n      const countryName = verification.countryName || 'Unknown';\n      \n      if (!countriesMap.has(country)) {\n        countriesMap.set(country, {\n          country,\n          countryName,\n          verifications: [],\n        });\n      }\n      countriesMap.get(country)!.verifications.push(verification);\n    }\n\n    // Update analytics for each country\n    for (const [country, data] of Array.from(countriesMap)) {\n      const totalVerifications = data.verifications.length;\n      const successfulVerifications = data.verifications.filter(v => v.success).length;\n      const failedVerifications = data.verifications.filter(v => !v.success).length;\n      \n      // Calculate average time to solve (only from successful verifications)\n      const successfulWithTime = data.verifications.filter(v => v.success && v.timeToSolve !== null);\n      const averageTimeToSolve = successfulWithTime.length > 0\n        ? Math.round(successfulWithTime.reduce((sum, v) => sum + (v.timeToSolve || 0), 0) / successfulWithTime.length)\n        : null;\n      \n      // Count unique IPs\n      const uniqueIpsSet = new Set(data.verifications.map(v => v.ipAddress).filter(ip => ip !== null));\n      const uniqueIps = uniqueIpsSet.size;\n\n      // Update or create country analytics record\n      await this.createOrUpdateCountryAnalytics({\n        apiKeyId,\n        country: data.country,\n        countryName: data.countryName,\n        date: today,\n        totalVerifications,\n        successfulVerifications,\n        failedVerifications,\n        averageTimeToSolve,\n        uniqueIps,\n      });\n\n      console.log(`[ANALYTICS] Updated country analytics for ${apiKeyId} - ${data.countryName} (${data.country}): ${successfulVerifications}/${totalVerifications} successful, ${uniqueIps} unique IPs`);\n    }\n  }\n}\n\nimport { DatabaseStorage } from \"./db-storage\";\n\nlet storageInstance: IStorage | null = null;\nlet storageInitialized = false;\n\nasync function initializeStorage(): Promise<IStorage> {\n  if (!process.env.DATABASE_URL) {\n    console.log('[STORAGE] No DATABASE_URL configured, using in-memory storage (MemStorage)');\n    return new MemStorage();\n  }\n\n  console.log('[STORAGE] DATABASE_URL configured, attempting database connection...');\n  const dbStorage = new DatabaseStorage(process.env.DATABASE_URL);\n  await dbStorage.getAllApiKeys();\n  console.log('[STORAGE] Database connection successful, using DatabaseStorage');\n  return dbStorage;\n}\n\nexport async function getStorage(migrationsSuccessful = false): Promise<IStorage> {\n  if (storageInstance && !migrationsSuccessful) {\n    return storageInstance;\n  }\n  \n  if (migrationsSuccessful && process.env.DATABASE_URL) {\n    console.log('[STORAGE] Reinitializing storage after successful migrations...');\n    const dbStorage = new DatabaseStorage(process.env.DATABASE_URL);\n    await dbStorage.getAllApiKeys();\n    console.log('[STORAGE] Using DatabaseStorage (migrations successful)');\n    storageInstance = dbStorage;\n    storageInitialized = true;\n    return dbStorage;\n  }\n  \n  if (!storageInitialized) {\n    console.log('[STORAGE] First-time initialization...');\n    try {\n      storageInstance = await initializeStorage();\n      storageInitialized = true;\n    } catch (err: any) {\n      console.error('[STORAGE] Failed to initialize storage:', err);\n      if (process.env.DATABASE_URL) {\n        console.error('[STORAGE] DATABASE_URL is configured but connection failed!');\n        console.error('[STORAGE] Please check your database configuration or run migrations.');\n        console.error('[STORAGE] Error details:', err?.message || err);\n        console.error('[STORAGE] Application cannot continue without database connection.');\n        throw err;\n      } else {\n        console.log('[STORAGE] No DATABASE_URL configured, falling back to MemStorage');\n        storageInstance = new MemStorage();\n        storageInitialized = true;\n      }\n    }\n  }\n  \n  return storageInstance!;\n}\n\nexport const storage = new Proxy({} as IStorage, {\n  get(_target, prop) {\n    if (!storageInstance) {\n      throw new Error('Storage not initialized. Make sure to await storage initialization before using it.');\n    }\n    return (storageInstance as any)[prop];\n  }\n});\n","size_bytes":22792},"client/src/components/ui/card.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Card = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"shadcn-card rounded-xl border bg-card border-card-border text-card-foreground shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n));\nCard.displayName = \"Card\"\n\nconst CardHeader = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex flex-col space-y-1.5 p-6\", className)}\n    {...props}\n  />\n));\nCardHeader.displayName = \"CardHeader\"\n\nconst CardTitle = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"text-2xl font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nCardTitle.displayName = \"CardTitle\"\n\nconst CardDescription = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n));\nCardDescription.displayName = \"CardDescription\"\n\nconst CardContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"p-6 pt-0\", className)} {...props} />\n))\nCardContent.displayName = \"CardContent\"\n\nconst CardFooter = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex items-center p-6 pt-0\", className)}\n    {...props}\n  />\n))\nCardFooter.displayName = \"CardFooter\"\nexport {\n  Card,\n  CardHeader,\n  CardFooter,\n  CardTitle,\n  CardDescription,\n  CardContent,\n}\n","size_bytes":1904},"client/src/components/ui/badge.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst badgeVariants = cva(\n  // Whitespace-nowrap: Badges should never wrap.\n  \"whitespace-nowrap inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\" +\n  \" hover-elevate \" ,\n  {\n    variants: {\n      variant: {\n        default:\n          \"border-transparent bg-primary text-primary-foreground shadow-xs\",\n        secondary: \"border-transparent bg-secondary text-secondary-foreground\",\n        destructive:\n          \"border-transparent bg-destructive text-destructive-foreground shadow-xs\",\n\n        outline: \" border [border-color:var(--badge-outline)] shadow-xs\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  },\n)\n\nexport interface BadgeProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof badgeVariants> {}\n\nfunction Badge({ className, variant, ...props }: BadgeProps) {\n  return (\n    <div className={cn(badgeVariants({ variant }), className)} {...props} />\n  );\n}\n\nexport { Badge, badgeVariants }\n","size_bytes":1202},"README.md":{"content":"# ProofCaptcha\n\n<div align=\"center\">\n  <img src=\"attached_assets/generated_images/ProofCaptcha_shield_logo_98b0f54f.png\" alt=\"ProofCaptcha Logo\" width=\"200\"/>\n  \n  **Advanced Proof-of-Work CAPTCHA System**\n  \n  Self-hosted, privacy-first bot protection with end-to-end encryption and multi-language support\n  \n  [![License: MIT](https://img.shields.io/badge/License-MIT-blue.svg)](LICENSE)\n  [![Security: A+](https://img.shields.io/badge/Security-A%2B-green.svg)](SECURITY.md)\n</div>\n\n---\n\n## üìñ Table of Contents\n\n- [Overview](#overview)\n- [Key Features](#key-features)\n- [How It Works](#how-it-works)\n- [Quick Start](#quick-start)\n  - [Installation](#installation)\n  - [Environment Setup](#environment-setup)\n  - [Database Setup](#database-setup)\n  - [Running the Application](#running-the-application)\n- [Integration Guide](#integration-guide)\n  - [Frontend Integration](#frontend-integration)\n  - [Backend Verification](#backend-verification)\n- [Challenge Types](#challenge-types)\n- [API Reference](#api-reference)\n- [Security Features](#security-features)\n- [Advanced Configuration](#advanced-configuration)\n- [Obfuscation & Anti-Debugger](#obfuscation--anti-debugger)\n- [Analytics Dashboard](#analytics-dashboard)\n- [Internationalization (i18n)](#internationalization-i18n)\n- [Development](#development)\n- [Troubleshooting](#troubleshooting)\n- [Contributing](#contributing)\n\n---\n\n## üéØ Overview\n\n**ProofCaptcha** adalah sistem CAPTCHA modern berbasis proof-of-work yang dirancang untuk melindungi website dari bot dan automated attacks. Berbeda dengan CAPTCHA tradisional, ProofCaptcha menawarkan:\n\n- üîê **End-to-End Encryption**: Semua challenge dan solution data terenkripsi dengan ECDH + AES-GCM\n- üõ°Ô∏è **Multi-Layer Security**: Fingerprinting, anti-debugger, behavioral analysis, dan obfuscation\n- üåç **Multi-Language Support**: Support bahasa Indonesia dan Inggris dengan i18next\n- üìä **Analytics Dashboard**: Monitor traffic, success rate, dan geographic distribution\n- üé® **4 Challenge Types**: Grid, Jigsaw, Gesture, dan Upside-Down\n- üîí **Privacy-First**: Self-hosted, tidak melacak pengguna, tidak menjual data\n\n### Mengapa ProofCaptcha?\n\n- ‚úÖ **Lebih Aman**: End-to-end encryption dengan server-side control mencegah downgrade attacks\n- ‚úÖ **Lebih Modern**: Interactive challenges yang engaging untuk user\n- ‚úÖ **Developer-Friendly**: Easy integration dengan API yang simple dan dokumentasi lengkap\n- ‚úÖ **Privacy First**: Self-hosted, kontrol penuh atas data Anda\n- ‚úÖ **Production-Ready**: Code obfuscation, anti-debugger, dan security hardening built-in\n\n---\n\n## üöÄ Key Features\n\n### Security Features\n- üîê **End-to-End Encryption**: ECDH (P-256) + HKDF + AES-256-GCM\n- üõ°Ô∏è **Server-Side Encryption Control**: Server determines encryption mode, prevents downgrade attacks\n- üîë **Session-Based Key Management**: Unique encryption keys per session with hourly rotation\n- üéØ **Domain Validation**: API keys tied to specific domains with strict validation\n- ‚è±Ô∏è **Token Expiration**: Configurable challenge and verification token expiry\n- üö´ **Replay Attack Prevention**: Single-use tokens with HMAC signatures\n- üìä **Risk Scoring**: Automated risk analysis of each request\n- ü§ñ **Bot Detection**: Multi-layer detection (fingerprint, behavior, automation tools)\n- üîí **Anti-Debugger**: Detects and prevents DevTools usage with premium animations\n- üé≠ **Code Obfuscation**: RC4 string encryption, control flow flattening, dead code injection\n- üçØ **Honeypot Detection**: Invisible form fields and timing analysis\n- üåê **IP & Country Blocking**: Per-API-key IP and country blocking configuration\n\n### Developer Experience\n- üì¶ **Easy Integration**: 3 lines of code to add CAPTCHA widget\n- üîÑ **reCAPTCHA v2 Compatible**: Drop-in replacement API\n- üé® **4 Challenge Types**: Grid, Jigsaw, Gesture, Upside-Down\n- üì± **Responsive Design**: Mobile and desktop optimized\n- üåê **Multi-Language**: Built-in i18n with English and Indonesian\n- üìà **Analytics Dashboard**: Real-time traffic monitoring and insights\n- ‚öôÔ∏è **Per-API-Key Settings**: Configure security features for each application\n- üîß **Flexible Configuration**: Customize difficulty, timeouts, rate limits, and more\n\n### Analytics & Monitoring\n- üìä **Real-Time Dashboard**: Monitor challenges, verifications, success rates\n- üåç **Geographic Analytics**: Track traffic by country with detailed location data\n- üìà **Performance Metrics**: Average solve time, unique IPs, challenge distribution\n- üö® **Security Events**: Track blocked IPs, failed attempts, automation detection\n- üìÖ **Historical Data**: Daily, weekly, monthly analytics aggregation\n\n---\n\n## üîÑ How It Works\n\nProofCaptcha menggunakan arsitektur three-step verification dengan end-to-end encryption:\n\n### Step 1: Challenge Generation\n\n```\nClient                          Server\n  |                               |\n  |---(1) Request Challenge------>|\n  |    POST /api/captcha/challenge|\n  |    { publicKey, type }        |\n  |                               |\n  |                               |---(2) Create Session\n  |                               |    Generate ECDH keypair\n  |                               |    Derive shared secret (HKDF)\n  |                               |\n  |<--(3) Encrypted Challenge-----|\n  |    { token, encrypted: {      |\n  |      ciphertext,              |\n  |      iv, authTag } }          |\n```\n\n**Security Highlights:**\n- Server **ALWAYS** determines encryption mode (prevents client from forcing plaintext)\n- ECDH (P-256) for secure key exchange\n- HKDF for deriving AES and HMAC keys\n- Session fingerprint binding for additional security\n\n### Step 2: Solution Verification\n\n```\nClient                          Server\n  |                               |\n  |---(5) Solve Challenge-------->|\n  |    (Proof-of-work,            |\n  |     puzzle solution, etc)     |\n  |                               |\n  |---(6) Encrypt Solution------->|\n  |    Using session key          |\n  |                               |\n  |---(7) Submit Solution-------->|\n  |    POST /api/captcha/verify   |\n  |    { token, encrypted: {      |\n  |      ciphertext, iv,          |\n  |      authTag } }              |\n  |                               |\n  |<--(9) Verification Token------|\n  |    { success: true,           |\n  |      verificationToken }      |\n```\n\n### Step 3: Backend Token Validation\n\n```\nYour Backend                 ProofCaptcha Server\n     |                            |\n     |---(11) Validate Token----->|\n     |    POST /api/captcha/      |\n     |    verify-token            |\n     |    Authorization: Bearer   |\n     |    { token }               |\n     |                            |\n     |<---(13) Success/Fail-------|\n     |    { success: true/false } |\n```\n\n**‚ö†Ô∏è CRITICAL**: Backend validation adalah **WAJIB**. Frontend validation dapat di-bypass oleh attacker.\n\n---\n\n## üì¶ Quick Start\n\n### Installation\n\n1. **Clone Repository**\n\n```bash\ngit clone https://github.com/your-org/proofcaptcha.git\ncd proofcaptcha\n```\n\n2. **Install Dependencies**\n\n```bash\nnpm install\n```\n\n### Environment Setup\n\n1. **Copy Environment Template**\n\n```bash\ncp .env.example .env\n```\n\n2. **Configure Environment Variables**\n\nEdit `.env` dan set nilai berikut:\n\n```bash\n# Application Settings\nNODE_ENV=development\nSESSION_SECRET=your-strong-random-secret-here\n\n# Database (PostgreSQL - Required for production)\nDATABASE_URL=postgresql://username:password@host:port/database\n\n# SMTP Email Configuration (Required for email verification)\nSMTP_HOST=your-smtp-host.com\nSMTP_PORT=465\nSMTP_USER=your-email@domain.com\nSMTP_PASSWORD=your-smtp-password\nSMTP_FROM_EMAIL=noreply@domain.com\n\n# Optional: TLS Configuration\nSMTP_TLS_REJECT_UNAUTHORIZED=true\nSMTP_TLS_SERVERNAME=your-smtp-servername.com\n\n# Optional: Trust proxy (if behind reverse proxy)\nTRUST_PROXY=true\n```\n\n**Environment Variable Descriptions:**\n\n- `SESSION_SECRET`: Secret key untuk enkripsi session cookies. Generate dengan `openssl rand -base64 32`\n- `DATABASE_URL`: PostgreSQL connection string (format: `postgresql://user:password@host:port/database`)\n- `SMTP_*`: Email server configuration untuk email verification dan password reset\n- `TRUST_PROXY`: Set `true` jika aplikasi behind reverse proxy (Nginx, Apache, Cloudflare, dll)\n\n### Database Setup\n\nProofCaptcha menggunakan PostgreSQL dengan Drizzle ORM.\n\n**Option 1: Setup Database dengan Script (Recommended)**\n\n```bash\n# Setup database dan run migrations\nnpm run setup-db\n\n# Setup database dengan demo data (for testing)\nnpm run setup-db:demo\n```\n\nScript ini akan:\n1. Validate database connection\n2. Run all migrations automatically\n3. Create necessary tables\n4. (Optional) Create demo developer account dan API key\n\n**Option 2: Manual Migration**\n\n```bash\n# Push schema changes to database\nnpm run db:push\n\n# Open Drizzle Studio (database GUI)\nnpm run db:studio\n```\n\n### Running the Application\n\n**Development Mode**\n\n```bash\nnpm run dev\n```\n\nApplication akan berjalan di `http://localhost:5000`\n\n**Production Mode**\n\n```bash\n# Build dengan obfuscation (recommended)\nnpm run build:obfuscate\n\n# Start production server\nnpm start\n```\n\n**Default Credentials (Demo Mode)**\n\nJika menggunakan `npm run setup-db:demo`, demo account akan dibuat:\n\n```\nEmail: demo@proofcaptcha.local\nPassword: demo123\n```\n\nDemo API Key juga akan otomatis dibuat dan ditampilkan di console.\n\n---\n\n## üîó Integration Guide\n\n### Frontend Integration\n\n#### Option 1: Auto-Render (Easiest)\n\n```html\n<!DOCTYPE html>\n<html>\n<head>\n  <title>ProofCaptcha Demo</title>\n</head>\n<body>\n  <form id=\"myForm\" method=\"POST\" action=\"/submit\">\n    <input type=\"text\" name=\"username\" placeholder=\"Username\" required>\n    <input type=\"email\" name=\"email\" placeholder=\"Email\" required>\n    \n    <!-- ProofCaptcha Widget -->\n    <div class=\"proofCaptcha\" \n         data-sitekey=\"YOUR_PUBLIC_KEY\"\n         data-type=\"random\"\n         data-callback=\"onCaptchaSuccess\"\n         data-error-callback=\"onCaptchaError\">\n    </div>\n    \n    <button type=\"submit\">Submit</button>\n  </form>\n\n  <script>\n    function onCaptchaSuccess(token) {\n      console.log('CAPTCHA verified! Token:', token);\n      // Token akan otomatis di-submit dengan form sebagai 'g-recaptcha-response'\n    }\n    \n    function onCaptchaError(error) {\n      console.error('CAPTCHA error:', error);\n      alert('CAPTCHA verification failed. Please try again.');\n    }\n  </script>\n  \n  <!-- Load ProofCaptcha API -->\n  <script src=\"https://your-domain.com/proofCaptcha/api.js\" async defer></script>\n</body>\n</html>\n```\n\n#### Option 2: Manual Render\n\n```html\n<div id=\"captcha-container\"></div>\n\n<script>\n  // Wait for ProofCaptcha to load\n  window.onload = function() {\n    const widgetId = proofCaptcha.render('captcha-container', {\n      sitekey: 'YOUR_PUBLIC_KEY',\n      type: 'grid', // or 'jigsaw', 'gesture', 'upside_down', 'random'\n      callback: function(token) {\n        console.log('Success!', token);\n        // Process form submission\n      },\n      'expired-callback': function() {\n        console.log('Token expired, challenge reset');\n      },\n      'error-callback': function(error) {\n        console.error('Error:', error);\n      }\n    });\n  };\n</script>\n<script src=\"https://your-domain.com/proofCaptcha/api.js\" async defer></script>\n```\n\n**Widget Data Attributes:**\n\n- `data-sitekey` (required): Your public API key (starts with `pk_`)\n- `data-type`: Challenge type - `random`, `grid`, `jigsaw`, `gesture`, `upside_down`\n- `data-callback`: Function name called on success (receives verification token)\n- `data-expired-callback`: Function name called when token expires\n- `data-error-callback`: Function name called on error\n\n### Backend Verification\n\n‚ö†Ô∏è **CRITICAL**: Anda **WAJIB** memvalidasi token di backend! Frontend validation dapat di-bypass.\n\n#### Node.js/Express Example\n\n```javascript\nconst express = require('express');\nconst fetch = require('node-fetch');\n\nconst app = express();\napp.use(express.urlencoded({ extended: true }));\napp.use(express.json());\n\napp.post('/submit-form', async (req, res) => {\n  const { username, email, 'g-recaptcha-response': captchaToken } = req.body;\n\n  // Validate CAPTCHA token\n  try {\n    const verifyResponse = await fetch(\n      'https://your-domain.com/api/captcha/verify-token',\n      {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${process.env.CAPTCHA_SECRET_KEY}`,\n        },\n        body: JSON.stringify({ token: captchaToken })\n      }\n    );\n\n    const result = await verifyResponse.json();\n\n    if (!result.success) {\n      return res.status(400).json({ \n        error: 'CAPTCHA verification failed',\n        message: result.error || 'Invalid CAPTCHA token'\n      });\n    }\n\n    // CAPTCHA verified! Process your form\n    // ... save to database, send email, etc.\n    \n    res.json({ success: true, message: 'Form submitted successfully' });\n  } catch (error) {\n    console.error('CAPTCHA verification error:', error);\n    res.status(500).json({ \n      error: 'Internal server error',\n      message: 'Failed to verify CAPTCHA'\n    });\n  }\n});\n\napp.listen(3000, () => {\n  console.log('Server running on port 3000');\n});\n```\n\n#### PHP Example\n\n```php\n<?php\nfunction validateCaptcha($token) {\n    $url = 'https://your-domain.com/api/captcha/verify-token';\n    $secretKey = getenv('CAPTCHA_SECRET_KEY');\n    \n    $ch = curl_init($url);\n    curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);\n    curl_setopt($ch, CURLOPT_POST, true);\n    curl_setopt($ch, CURLOPT_POSTFIELDS, json_encode(['token' => $token]));\n    curl_setopt($ch, CURLOPT_HTTPHEADER, [\n        'Content-Type: application/json',\n        'Authorization: Bearer ' . $secretKey\n    ]);\n    \n    $response = curl_exec($ch);\n    $httpCode = curl_getinfo($ch, CURLINFO_HTTP_CODE);\n    curl_close($ch);\n    \n    if ($httpCode !== 200) {\n        return ['success' => false, 'error' => 'HTTP Error: ' . $httpCode];\n    }\n    \n    return json_decode($response, true);\n}\n\n// Handle form submission\nif ($_SERVER['REQUEST_METHOD'] === 'POST') {\n    $captchaToken = $_POST['g-recaptcha-response'] ?? '';\n    \n    if (empty($captchaToken)) {\n        die(json_encode(['error' => 'CAPTCHA token missing']));\n    }\n    \n    $result = validateCaptcha($captchaToken);\n    \n    if (!$result['success']) {\n        http_response_code(400);\n        die(json_encode([\n            'error' => 'CAPTCHA verification failed',\n            'message' => $result['error'] ?? 'Invalid token'\n        ]));\n    }\n    \n    // CAPTCHA verified! Process form\n    // ...\n    \n    echo json_encode(['success' => true]);\n}\n?>\n```\n\n#### Python/Flask Example\n\n```python\nimport requests\nimport os\nfrom flask import Flask, request, jsonify\n\napp = Flask(__name__)\n\ndef validate_captcha(token):\n    url = 'https://your-domain.com/api/captcha/verify-token'\n    secret_key = os.getenv('CAPTCHA_SECRET_KEY')\n    \n    try:\n        response = requests.post(\n            url,\n            headers={\n                'Content-Type': 'application/json',\n                'Authorization': f'Bearer {secret_key}'\n            },\n            json={'token': token},\n            timeout=5\n        )\n        \n        response.raise_for_status()\n        return response.json()\n    except requests.exceptions.RequestException as e:\n        return {'success': False, 'error': str(e)}\n\n@app.route('/submit-form', methods=['POST'])\ndef submit_form():\n    data = request.get_json()\n    captcha_token = data.get('g-recaptcha-response')\n    \n    if not captcha_token:\n        return jsonify({'error': 'CAPTCHA token missing'}), 400\n    \n    # Validate CAPTCHA\n    result = validate_captcha(captcha_token)\n    \n    if not result.get('success'):\n        return jsonify({\n            'error': 'CAPTCHA verification failed',\n            'message': result.get('error', 'Invalid token')\n        }), 400\n    \n    # CAPTCHA verified! Process form\n    # ...\n    \n    return jsonify({'success': True})\n\nif __name__ == '__main__':\n    app.run(port=3000)\n```\n\n#### reCAPTCHA v2 Compatible Endpoint\n\nProofCaptcha juga mendukung reCAPTCHA v2 API untuk backward compatibility:\n\n```javascript\n// Using reCAPTCHA v2 compatible endpoint\nconst response = await fetch(\n  'https://your-domain.com/proofCaptcha/api/siteverify',\n  {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/x-www-form-urlencoded',\n    },\n    body: new URLSearchParams({\n      secret: process.env.CAPTCHA_SECRET_KEY,\n      response: captchaToken\n    })\n  }\n);\n\nconst result = await response.json();\n// { success: true/false, challenge_ts: \"...\", hostname: \"...\" }\n```\n\n---\n\n## üéÆ Challenge Types\n\nProofCaptcha menawarkan 4 tipe challenge yang berbeda:\n\n### 1. **Grid Selection**\nUser memilih gambar (emoji) yang sesuai kriteria.\n\n**Characteristics:**\n- Familiar interface (seperti \"pilih semua traffic light\")\n- 3x3 grid dengan 9 opsi\n- Dynamic category selection\n- Mobile-friendly\n\n```html\n<div class=\"proofCaptcha\" \n     data-sitekey=\"YOUR_KEY\"\n     data-type=\"grid\">\n</div>\n```\n\n### 2. **Jigsaw Puzzle**\nUser drag puzzle piece ke posisi yang benar.\n\n**Characteristics:**\n- Interactive dan engaging\n- Behavioral analysis dari drag pattern\n- Pixel-perfect position validation\n- Touch and mouse support\n\n```html\n<div class=\"proofCaptcha\" \n     data-sitekey=\"YOUR_KEY\"\n     data-type=\"jigsaw\">\n</div>\n```\n\n### 3. **Gesture Pattern**\nUser gambar pattern pada grid (seperti Android pattern lock).\n\n**Characteristics:**\n- Unique dan sulit di-bot\n- Touch dan mouse support\n- Pattern complexity validation\n- Engaging user experience\n\n```html\n<div class=\"proofCaptcha\" \n     data-sitekey=\"YOUR_KEY\"\n     data-type=\"gesture\">\n</div>\n```\n\n### 4. **Upside-Down Animals**\nUser identifikasi hewan yang posisinya terbalik.\n\n**Characteristics:**\n- Fun dan engaging\n- Cognitive challenge (requires human perception)\n- Multiple animal types (dog, cat, bird, fish, etc.)\n- Fast completion time\n\n```html\n<div class=\"proofCaptcha\" \n     data-sitekey=\"YOUR_KEY\"\n     data-type=\"upside_down\">\n</div>\n```\n\n### **Random** (Recommended)\nServer secara random memilih challenge type.\n\n```html\n<div class=\"proofCaptcha\" \n     data-sitekey=\"YOUR_KEY\"\n     data-type=\"random\">\n</div>\n```\n\n---\n\n## üîß API Reference\n\n### Client-Side API\n\n#### `proofCaptcha.render(container, options)`\n\nRender CAPTCHA widget ke dalam container element.\n\n**Parameters:**\n- `container` (string | HTMLElement): Container element ID atau DOM element\n- `options` (object): Configuration options\n\n**Options:**\n```javascript\n{\n  sitekey: string,              // Required: Public API key\n  type: string,                 // Challenge type (default: 'random')\n  callback: function(token),    // Success callback\n  'expired-callback': function(), // Token expired callback\n  'error-callback': function(error) // Error callback\n}\n```\n\n**Returns:** `widgetId` (number)\n\n**Example:**\n```javascript\nconst widgetId = proofCaptcha.render('captcha-container', {\n  sitekey: 'pk_abc123...',\n  type: 'grid',\n  callback: (token) => console.log('Success:', token)\n});\n```\n\n#### `proofCaptcha.getResponse(widgetId)`\n\nGet verification token dari widget.\n\n**Parameters:**\n- `widgetId` (number): Widget ID dari `render()`\n\n**Returns:** Verification token (string) atau `null`\n\n**Example:**\n```javascript\nconst token = proofCaptcha.getResponse(widgetId);\nif (token) {\n  console.log('Token:', token);\n}\n```\n\n#### `proofCaptcha.reset(widgetId)`\n\nReset widget ke initial state.\n\n**Parameters:**\n- `widgetId` (number): Widget ID dari `render()`\n\n**Example:**\n```javascript\nproofCaptcha.reset(widgetId);\n```\n\n#### `proofCaptcha.execute(widgetId)`\n\nManually trigger challenge execution (for invisible mode).\n\n**Parameters:**\n- `widgetId` (number): Widget ID dari `render()`\n\n**Example:**\n```javascript\nproofCaptcha.execute(widgetId);\n```\n\n### Server-Side API\n\n#### POST `/api/captcha/verify-token`\n\nValidate verification token dari client.\n\n**Request:**\n```bash\ncurl -X POST https://your-domain.com/api/captcha/verify-token \\\n  -H \"Content-Type: application/json\" \\\n  -H \"Authorization: Bearer YOUR_SECRET_KEY\" \\\n  -d '{\"token\": \"verification_token_here\"}'\n```\n\n**Request Body:**\n```json\n{\n  \"token\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...\"\n}\n```\n\n**Response (Success):**\n```json\n{\n  \"success\": true,\n  \"data\": {\n    \"challengeId\": \"challenge_abc123\",\n    \"domain\": \"example.com\",\n    \"timestamp\": 1699776000000\n  }\n}\n```\n\n**Response (Failure):**\n```json\n{\n  \"success\": false,\n  \"error\": \"Invalid Token\",\n  \"message\": \"Token verification failed or expired\"\n}\n```\n\n**Error Codes:**\n- `400`: Invalid request or missing token\n- `401`: Invalid secret key\n- `403`: Token verification failed (expired, invalid signature, replay attack)\n- `500`: Internal server error\n\n#### POST `/proofCaptcha/api/siteverify`\n\nreCAPTCHA v2 compatible verification endpoint.\n\n**Request:**\n```bash\ncurl -X POST https://your-domain.com/proofCaptcha/api/siteverify \\\n  -d \"secret=YOUR_SECRET_KEY\" \\\n  -d \"response=verification_token_here\"\n```\n\n**Response:**\n```json\n{\n  \"success\": true,\n  \"challenge_ts\": \"2025-11-17T12:00:00Z\",\n  \"hostname\": \"example.com\"\n}\n```\n\n#### POST `/api/captcha/challenge`\n\nGenerate new challenge (called automatically by widget).\n\n**Request:**\n```json\n{\n  \"publicKey\": \"pk_abc123...\",\n  \"type\": \"grid\",\n  \"deviceFingerprint\": {...}\n}\n```\n\n**Response:**\n```json\n{\n  \"token\": \"challenge_token\",\n  \"encrypted\": {\n    \"ciphertext\": \"...\",\n    \"iv\": \"...\",\n    \"authTag\": \"...\"\n  },\n  \"requiresEncryption\": true\n}\n```\n\n#### POST `/api/captcha/verify`\n\nVerify challenge solution (called automatically by widget).\n\n**Request:**\n```json\n{\n  \"token\": \"challenge_token\",\n  \"encrypted\": {\n    \"ciphertext\": \"...\",\n    \"iv\": \"...\",\n    \"authTag\": \"...\"\n  }\n}\n```\n\n**Response:**\n```json\n{\n  \"success\": true,\n  \"verificationToken\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...\"\n}\n```\n\n---\n\n## üõ°Ô∏è Security Features\n\nProofCaptcha implements multiple layers of security:\n\n### 1. **End-to-End Encryption**\n\n- **ECDH (P-256)**: Secure key exchange without transmitting private keys\n- **HKDF**: Key derivation untuk AES dan HMAC keys\n- **AES-256-GCM**: Authenticated encryption dengan confidentiality dan integrity\n- **Session Binding**: Keys bound to session fingerprints\n\n**Server-Side Control**: Server **ALWAYS** determines encryption mode, preventing client from forcing plaintext (downgrade attack prevention).\n\n### 2. **Multi-Layer Bot Detection**\n\n**Advanced Fingerprinting:**\n- Canvas fingerprinting\n- WebGL rendering fingerprint\n- Audio context fingerprint\n- Font detection\n- Screen resolution dan color depth\n- Timezone dan language\n- Platform dan user agent analysis\n\n**Automation Detection:**\n- WebDriver detection\n- Headless browser detection (Puppeteer, Playwright, Selenium)\n- Automation framework signatures\n- DevTools detection\n\n**Behavioral Analysis:**\n- Mouse movement patterns\n- Keyboard timing analysis\n- Click/tap patterns\n- Form fill timing\n- Request frequency analysis\n\n### 3. **Anti-Debugger Protection**\n\nBuilt-in anti-debugger system dengan multiple detection methods:\n\n- Debugger statement traps\n- Console monitoring\n- DevTools viewport detection\n- Timing-based debugger detection\n- Function integrity checks\n- Premium \"CHEATERS!!\" animation mode\n\n**Enable/Disable per API Key:**\n```javascript\n// Configured in Dashboard > API Keys > Settings\n{\n  \"antiDebugger\": true,  // Enable anti-debugger\n  \"advancedFingerprinting\": true\n}\n```\n\n### 4. **Code Obfuscation**\n\nProofCaptcha supports multiple levels of code obfuscation for production:\n\n**Backend/API Obfuscation (Maximum Protection):**\n- RC4 string encryption\n- Control flow flattening\n- Dead code injection\n- Self-defending code\n- Debug protection\n\n**Frontend Obfuscation (Balanced):**\n- Base64 string encoding\n- Control flow flattening\n- Moderate dead code injection\n- Better performance\n\n**Build with Obfuscation:**\n```bash\nnpm run build:obfuscate\n```\n\n### 5. **Domain Validation**\n\nStrict domain validation untuk prevent unauthorized usage:\n\n- Origin header validation\n- Referer header validation\n- Domain whitelist per API key\n- Wildcard subdomain support\n\n**Example Configuration:**\n```\nAllowed Domains:\n- example.com\n- *.example.com (all subdomains)\n- localhost (development only)\n```\n\n### 6. **Rate Limiting**\n\nConfigurable rate limiting per API key:\n\n- Challenge generation rate limit\n- Verification attempt rate limit\n- Token validation rate limit\n- Per-IP rate limiting\n\n**Default Limits:**\n- 30 requests per minute per IP\n- Configurable via Security Settings\n\n### 7. **IP & Country Blocking**\n\nBlock requests by IP address atau country:\n\n```javascript\n{\n  \"blockedIps\": [\n    \"192.168.1.1\",\n    \"10.0.0.0/8\"  // CIDR notation supported\n  ],\n  \"blockedCountries\": [\n    \"CN\",  // China\n    \"RU\"   // Russia\n  ]\n}\n```\n\n---\n\n## ‚öôÔ∏è Advanced Configuration\n\n### Per-API-Key Security Settings\n\nSetiap API key dapat memiliki konfigurasi security yang berbeda. Configure via Dashboard > API Keys > Security Settings.\n\n**Available Settings:**\n\n```typescript\n{\n  // Security Features (Enable/Disable)\n  antiDebugger: boolean,              // Anti-debugger protection (default: true)\n  advancedFingerprinting: boolean,    // Advanced device fingerprinting (default: true)\n  sessionBinding: boolean,            // Session fingerprint binding (default: true)\n  csrfProtection: boolean,            // CSRF token validation (default: true)\n  ipRateLimiting: boolean,            // IP-based rate limiting (default: true)\n  automationDetection: boolean,       // Detect automation tools (default: true)\n  behavioralAnalysis: boolean,        // Behavioral pattern analysis (default: true)\n  riskAdaptiveDifficulty: boolean,    // Adaptive PoW difficulty (default: true)\n  \n  // IP and Country Blocking\n  blockedIps: string[],               // Array of blocked IPs (CIDR supported)\n  blockedCountries: string[],         // Array of ISO country codes\n  \n  // Proof of Work\n  proofOfWorkDifficulty: number,      // 1-10 (default: 4)\n  \n  // Rate Limiting\n  rateLimitWindowMs: number,          // Time window in ms (default: 60000)\n  rateLimitMaxRequests: number,       // Max requests per window (default: 30)\n  \n  // Timeouts\n  challengeTimeoutMs: number,         // Challenge expiry (10s-5min, default: 60s)\n  tokenExpiryMs: number,              // Token expiry (30s-10min, default: 60s)\n  \n  // Challenge Types\n  enabledChallengeTypes: string[]     // Enabled challenge types\n}\n```\n\n**Example Configuration:**\n\n```javascript\n// High-security configuration for sensitive applications\n{\n  \"antiDebugger\": true,\n  \"advancedFingerprinting\": true,\n  \"sessionBinding\": true,\n  \"automationDetection\": true,\n  \"behavioralAnalysis\": true,\n  \"riskAdaptiveDifficulty\": true,\n  \"proofOfWorkDifficulty\": 8,        // Very high difficulty\n  \"challengeTimeoutMs\": 30000,        // 30 seconds\n  \"tokenExpiryMs\": 30000,\n  \"rateLimitMaxRequests\": 10,\n  \"blockedCountries\": [\"CN\", \"RU\"],\n  \"enabledChallengeTypes\": [\"grid\", \"jigsaw\", \"gesture\"]\n}\n\n// Low-security configuration for internal applications\n{\n  \"antiDebugger\": false,\n  \"advancedFingerprinting\": false,\n  \"automationDetection\": false,\n  \"proofOfWorkDifficulty\": 2,\n  \"challengeTimeoutMs\": 300000,       // 5 minutes\n  \"rateLimitMaxRequests\": 100,\n  \"enabledChallengeTypes\": [\"grid\", \"jigsaw\"]\n}\n```\n\n**‚ö†Ô∏è Note:** Core security features (Domain Validation, End-to-End Encryption) are **ALWAYS ENFORCED** dan tidak dapat disabled.\n\n---\n\n## üé≠ Obfuscation & Anti-Debugger\n\nProofCaptcha includes built-in protection against reverse engineering dan tampering.\n\n### Code Obfuscation\n\n**Build Production dengan Obfuscation:**\n\n```bash\n# Build + Obfuscate (Recommended untuk production)\nnpm run build:obfuscate\n```\n\nThis will:\n1. Build aplikasi dengan Vite dan esbuild\n2. Obfuscate backend code dengan maksimum protection (RC4 encryption)\n3. Obfuscate frontend code dengan balanced protection (Base64 encoding)\n\n**Obfuscation Features:**\n\n**Backend (Maximum Protection):**\n- RC4 String Encryption\n- Control Flow Flattening (100%)\n- Dead Code Injection (50%)\n- Self-Defending Code\n- Debug Protection (4s interval)\n- Console Output Disabled\n- String Array Wrapping (5 layers)\n\n**Frontend (Balanced):**\n- Base64 String Encoding\n- Control Flow Flattening (50%)\n- Dead Code Injection (20%)\n- String Array Wrapping (2 layers)\n- No debug protection (better performance)\n\n### Source Code Obfuscation (Advanced)\n\n‚ö†Ô∏è **ADVANCED USAGE** - Obfuscate source files directly:\n\n```bash\n# Obfuscate source code (with automatic backup)\nnpm run obfuscate:source\n\n# Restore original source code\nnpm run restore:source\n```\n\n**Warning:**\n- Creates backup di `backup/backup-YYYYMMDD-HHMMSS/`\n- Obfuscated source code **cannot** be recompiled\n- Use only untuk final production deployment\n- Always keep backup\n\n### Anti-Debugger Configuration\n\nAnti-debugger dapat di-configure per API key:\n\n**Enable Anti-Debugger:**\n```javascript\n// In Dashboard > API Keys > Security Settings\n{\n  \"antiDebugger\": true\n}\n```\n\n**Anti-Debugger Features:**\n- Debugger trap detection\n- Console monitoring\n- DevTools viewport detection\n- Timing-based detection\n- Function integrity checks\n- Premium \"CHEATERS!!\" animation\n\n**For Development:**\nDisable anti-debugger untuk development API keys agar tidak mengganggu debugging.\n\n---\n\n## üìä Analytics Dashboard\n\nProofCaptcha menyediakan analytics dashboard yang comprehensive:\n\n### Available Metrics\n\n**Overview:**\n- Total challenges generated\n- Successful verifications\n- Failed verifications\n- Success rate (%)\n- Average solve time\n- Unique IPs\n\n**Geographic Analytics:**\n- Traffic by country\n- Interactive world map\n- Country-specific success rates\n- Top countries by volume\n\n**Challenge Type Distribution:**\n- Breakdown by challenge type\n- Success rate per type\n- Average solve time per type\n\n**Security Events:**\n- Blocked IPs\n- Blocked countries\n- Automation detection events\n- Failed verification attempts\n\n**Time Series:**\n- Daily/Weekly/Monthly aggregation\n- Trends dan patterns\n- Peak usage times\n\n### Accessing Analytics\n\nNavigate to: `https://your-domain.com/dashboard/analytics`\n\nLogin dengan developer account untuk melihat analytics semua API keys Anda.\n\n---\n\n## üåê Internationalization (i18n)\n\nProofCaptcha fully supports multi-language dengan i18next.\n\n### Supported Languages\n\n- üá¨üáß English (en)\n- üáÆüá© Indonesian (id)\n\n### Language Switching\n\nUser dapat switch language via UI di homepage dan dashboard.\n\n### Adding New Languages\n\n1. **Add Translation Files**\n\nCreate new translation file di `client/src/locales/`:\n\n```\nclient/src/locales/\n  ‚îú‚îÄ‚îÄ en.json\n  ‚îú‚îÄ‚îÄ id.json\n  ‚îî‚îÄ‚îÄ fr.json  # New language\n```\n\n2. **Configure i18next**\n\nUpdate `client/src/i18n.ts`:\n\n```typescript\ni18n\n  .use(initReactI18next)\n  .init({\n    resources: {\n      en: { translation: enTranslations },\n      id: { translation: idTranslations },\n      fr: { translation: frTranslations }  // Add new language\n    },\n    lng: 'en',\n    fallbackLng: 'en'\n  });\n```\n\n3. **Update Language Selector**\n\nUpdate language selector component untuk include new language.\n\n### Translation Keys\n\nAll UI text menggunakan translation keys. Example:\n\n```typescript\nimport { useTranslation } from 'react-i18next';\n\nfunction MyComponent() {\n  const { t } = useTranslation();\n  \n  return (\n    <div>\n      <h1>{t('home.hero.title')}</h1>\n      <p>{t('home.hero.subtitle')}</p>\n    </div>\n  );\n}\n```\n\n---\n\n## üíª Development\n\n### Project Structure\n\n```\nproofcaptcha/\n‚îú‚îÄ‚îÄ client/                    # Frontend React application\n‚îÇ   ‚îú‚îÄ‚îÄ src/\n‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ components/       # Reusable UI components\n‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ pages/            # Page components\n‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ lib/              # Utilities (encryption, query client)\n‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ locales/          # i18n translation files\n‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ App.tsx           # Main app component\n‚îú‚îÄ‚îÄ server/                    # Backend Express application\n‚îÇ   ‚îú‚îÄ‚îÄ routes.ts             # API route handlers\n‚îÇ   ‚îú‚îÄ‚îÄ storage.ts            # Database storage interface\n‚îÇ   ‚îú‚îÄ‚îÄ encryption.ts         # Server-side encryption\n‚îÇ   ‚îú‚îÄ‚îÄ crypto-utils.ts       # Cryptographic utilities\n‚îÇ   ‚îú‚îÄ‚îÄ automation-detector.ts\n‚îÇ   ‚îú‚îÄ‚îÄ behavioral-analysis.ts\n‚îÇ   ‚îú‚îÄ‚îÄ device-fingerprint.ts\n‚îÇ   ‚îú‚îÄ‚îÄ risk-scoring.ts\n‚îÇ   ‚îî‚îÄ‚îÄ public/               # Static files\n‚îÇ       ‚îî‚îÄ‚îÄ proofCaptcha/     # CAPTCHA widget files\n‚îÇ           ‚îî‚îÄ‚îÄ api.js        # Client-side widget API\n‚îú‚îÄ‚îÄ shared/                    # Shared code (types, schemas)\n‚îÇ   ‚îî‚îÄ‚îÄ schema.ts             # Drizzle database schema\n‚îú‚îÄ‚îÄ scripts/                   # Utility scripts\n‚îÇ   ‚îú‚îÄ‚îÄ setup-database.ts     # Database setup script\n‚îÇ   ‚îú‚îÄ‚îÄ obfuscate.js          # Obfuscation script\n‚îÇ   ‚îú‚îÄ‚îÄ obfuscate-source.js   # Source obfuscation\n‚îÇ   ‚îî‚îÄ‚îÄ restore-source.js     # Source restore\n‚îú‚îÄ‚îÄ migrations/                # Database migrations\n‚îú‚îÄ‚îÄ .env.example              # Environment template\n‚îú‚îÄ‚îÄ package.json\n‚îú‚îÄ‚îÄ vite.config.ts\n‚îú‚îÄ‚îÄ drizzle.config.ts\n‚îî‚îÄ‚îÄ README.md\n```\n\n### Available Scripts\n\n```bash\n# Development\nnpm run dev                # Start dev server (port 5000)\n\n# Database\nnpm run db:push            # Push schema changes to database\nnpm run db:studio          # Open Drizzle Studio (database GUI)\nnpm run setup-db           # Setup database with migrations\nnpm run setup-db:demo      # Setup database with demo data\n\n# Build\nnpm run build              # Build for production\nnpm run build:obfuscate    # Build + obfuscate code\nnpm start                  # Start production server\n\n# Obfuscation\nnpm run obfuscate          # Obfuscate dist/ files\nnpm run obfuscate:source   # Obfuscate source code (advanced)\nnpm run restore:source     # Restore from backup\n\n# Type Checking\nnpm run check              # Run TypeScript type checking\n```\n\n### Adding New Challenge Types\n\n1. **Create Challenge Component**\n\n```typescript\n// client/src/components/challenges/MyChallenge.tsx\nexport function MyChallenge({ data, onSuccess, onError }) {\n  // Implement challenge UI\n  // Call onSuccess(solution) when solved\n}\n```\n\n2. **Add Server-Side Validation**\n\n```typescript\n// server/routes.ts\nfunction validateMyChallenge(solution, challengeData) {\n  // Validate solution\n  return isValid;\n}\n```\n\n3. **Register Challenge Type**\n\nUpdate challenge type enum dan enable in security settings.\n\n### Database Schema Changes\n\n1. **Modify Schema**\n\nEdit `shared/schema.ts`:\n\n```typescript\nexport const myTable = pgTable(\"my_table\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  // ... columns\n});\n```\n\n2. **Generate Migration**\n\n```bash\nnpm run db:push\n```\n\n3. **Verify Changes**\n\n```bash\nnpm run db:studio\n```\n\n---\n\n## üîç Troubleshooting\n\n### Common Issues\n\n#### \"Invalid or inactive API key\"\n\n**Cause**: Public key tidak valid atau tidak aktif.\n\n**Solution**:\n1. Verify API key di Dashboard > API Keys\n2. Ensure key status = \"Active\"\n3. Check key tidak expired\n4. Regenerate key jika perlu\n\n#### \"Domain validation failed\"\n\n**Cause**: Request dari domain yang tidak diizinkan.\n\n**Solution**:\n1. Check allowed domains di API key settings\n2. Verify `Origin` header match dengan allowed domain\n3. Add domain ke whitelist: Dashboard > API Keys > Edit > Allowed Domains\n4. Use `*` for development (all domains) - **NOT recommended for production**\n\n#### \"Token verification failed or expired\"\n\n**Cause**: Token sudah kadaluarsa atau invalid.\n\n**Solution**:\n1. Default token expiry: 60 seconds (configurable)\n2. Ensure user submits form immediately setelah complete CAPTCHA\n3. Implement auto-refresh if needed\n4. Check server time synchronization\n\n#### \"CAPTCHA widget tidak muncul\"\n\n**Cause**: JavaScript error atau network issue.\n\n**Solution**:\n1. Open browser console (F12), check for errors\n2. Verify `api.js` script loaded correctly (Network tab)\n3. Check `data-sitekey` attribute present dan valid\n4. Ensure no ad-blockers blocking script\n5. Check CSP headers allow script execution\n\n#### \"Database connection failed\"\n\n**Cause**: Invalid DATABASE_URL atau database tidak accessible.\n\n**Solution**:\n1. Verify `DATABASE_URL` format: `postgresql://user:password@host:port/database`\n2. Check database server is running\n3. Verify credentials (username, password)\n4. Check firewall allows connection\n5. Test connection: `npm run setup-db`\n\n#### \"Email verification tidak terkirim\"\n\n**Cause**: SMTP configuration invalid.\n\n**Solution**:\n1. Verify SMTP credentials di `.env`\n2. Check SMTP_HOST, SMTP_PORT, SMTP_USER, SMTP_PASSWORD\n3. Test SMTP connection manually\n4. Check spam folder\n5. Verify `SMTP_TLS_SERVERNAME` if using custom TLS\n\n### Debug Mode\n\nEnable debug logging untuk development:\n\n```bash\n# Set environment variable\nNODE_ENV=development npm run dev\n```\n\nCheck logs di console untuk detailed error messages.\n\n### Getting Help\n\n1. **Check Documentation**: Review this README dan SECURITY.md\n2. **Search Issues**: Check existing GitHub issues\n3. **Create Issue**: Provide detailed error messages, logs, and steps to reproduce\n4. **Discord/Slack**: Join community untuk real-time help (if available)\n\n---\n\n## ü§ù Contributing\n\nContributions are welcome! Please read our contributing guidelines.\n\n### Development Workflow\n\n1. **Fork the Repository**\n\n```bash\ngit clone https://github.com/your-username/proofcaptcha.git\ncd proofcaptcha\n```\n\n2. **Create Feature Branch**\n\n```bash\ngit checkout -b feature/my-new-feature\n```\n\n3. **Install Dependencies**\n\n```bash\nnpm install\n```\n\n4. **Setup Environment**\n\n```bash\ncp .env.example .env\n# Edit .env dengan config Anda\n```\n\n5. **Run Migrations**\n\n```bash\nnpm run setup-db:demo\n```\n\n6. **Start Development Server**\n\n```bash\nnpm run dev\n```\n\n7. **Make Changes**\n\n- Follow existing code style\n- Add tests jika applicable\n- Update documentation\n\n8. **Test Your Changes**\n\n```bash\nnpm run check  # Type checking\nnpm run build  # Verify build works\n```\n\n9. **Commit Changes**\n\n```bash\ngit add .\ngit commit -m \"feat: add new feature\"\n```\n\nUse conventional commits: `feat:`, `fix:`, `docs:`, `chore:`, etc.\n\n10. **Push and Create PR**\n\n```bash\ngit push origin feature/my-new-feature\n```\n\nCreate Pull Request di GitHub dengan detailed description.\n\n### Code Style\n\n- Use TypeScript untuk type safety\n- Follow ESLint configuration\n- Use Prettier untuk formatting\n- Write meaningful commit messages\n- Add comments untuk complex logic\n- Update documentation\n\n### Testing\n\n- Manual testing untuk UI changes\n- Test di multiple browsers (Chrome, Firefox, Safari)\n- Test responsive design (mobile, tablet, desktop)\n- Verify backward compatibility\n\n---\n\n## üìÑ License\n\nProofCaptcha is open-source software licensed under the [MIT License](LICENSE).\n\n---\n\n## üôè Acknowledgments\n\nBuilt with:\n- [React](https://react.dev/) - Frontend framework\n- [Express](https://expressjs.com/) - Backend framework\n- [Drizzle ORM](https://orm.drizzle.team/) - Database ORM\n- [PostgreSQL](https://www.postgresql.org/) - Database\n- [Vite](https://vitejs.dev/) - Build tool\n- [TailwindCSS](https://tailwindcss.com/) - Styling\n- [shadcn/ui](https://ui.shadcn.com/) - UI components\n- [i18next](https://www.i18next.com/) - Internationalization\n- [Node.js](https://nodejs.org/) - Runtime\n\n---\n\n## üîê Security\n\nFor security issues and vulnerability disclosure, please see [SECURITY.md](SECURITY.md).\n\n**Do NOT** create public GitHub issues untuk security vulnerabilities.\n\n---\n\n## üìû Support\n\n- **Documentation**: [README.md](README.md), [SECURITY.md](SECURITY.md)\n- **Issues**: [GitHub Issues](https://github.com/your-org/proofcaptcha/issues)\n- **Email**: support@proofcaptcha.com (if available)\n\n---\n\n<div align=\"center\">\n  Made with ‚ù§Ô∏è by the ProofCaptcha Team\n  \n  **Star ‚≠ê this repo if you find it helpful!**\n</div>\n","size_bytes":39849},"client/src/components/ui/tabs.tsx":{"content":"import * as React from \"react\"\nimport * as TabsPrimitive from \"@radix-ui/react-tabs\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Tabs = TabsPrimitive.Root\n\nconst TabsList = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.List\n    ref={ref}\n    className={cn(\n      \"inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsList.displayName = TabsPrimitive.List.displayName\n\nconst TabsTrigger = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsTrigger.displayName = TabsPrimitive.Trigger.displayName\n\nconst TabsContent = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsContent.displayName = TabsPrimitive.Content.displayName\n\nexport { Tabs, TabsList, TabsTrigger, TabsContent }\n","size_bytes":1883},"client/src/components/ui/slider.tsx":{"content":"import * as React from \"react\"\nimport * as SliderPrimitive from \"@radix-ui/react-slider\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Slider = React.forwardRef<\n  React.ElementRef<typeof SliderPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SliderPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <SliderPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex w-full touch-none select-none items-center\",\n      className\n    )}\n    {...props}\n  >\n    <SliderPrimitive.Track className=\"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary\">\n      <SliderPrimitive.Range className=\"absolute h-full bg-primary\" />\n    </SliderPrimitive.Track>\n    <SliderPrimitive.Thumb className=\"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50\" />\n  </SliderPrimitive.Root>\n))\nSlider.displayName = SliderPrimitive.Root.displayName\n\nexport { Slider }\n","size_bytes":1077},"client/src/components/ui/toggle.tsx":{"content":"import * as React from \"react\"\nimport * as TogglePrimitive from \"@radix-ui/react-toggle\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst toggleVariants = cva(\n  \"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 gap-2\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        outline:\n          \"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground\",\n      },\n      size: {\n        default: \"h-10 px-3 min-w-10\",\n        sm: \"h-9 px-2.5 min-w-9\",\n        lg: \"h-11 px-5 min-w-11\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst Toggle = React.forwardRef<\n  React.ElementRef<typeof TogglePrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof TogglePrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, ...props }, ref) => (\n  <TogglePrimitive.Root\n    ref={ref}\n    className={cn(toggleVariants({ variant, size, className }))}\n    {...props}\n  />\n))\n\nToggle.displayName = TogglePrimitive.Root.displayName\n\nexport { Toggle, toggleVariants }\n","size_bytes":1527},"server/crypto-utils.ts":{"content":"import crypto from \"crypto\";\nimport jwt from \"jsonwebtoken\";\n\n/**\n * Generate HMAC signature untuk bind challenge token dengan API private key\n * Ini mencegah replay attack dan memastikan challenge hanya valid untuk domain yang tervalidasi\n */\nexport function generateChallengeSignature(\n  token: string,\n  validatedDomain: string,\n  privateKey: string\n): string {\n  const hmac = crypto.createHmac(\"sha256\", privateKey);\n  const data = `${token}:${validatedDomain}`;\n  hmac.update(data);\n  return hmac.digest(\"hex\");\n}\n\n/**\n * Verify HMAC signature untuk memastikan challenge belum dimodifikasi\n * dan masih valid untuk domain yang sama\n */\nexport function verifyChallengeSignature(\n  token: string,\n  validatedDomain: string,\n  privateKey: string,\n  providedSignature: string\n): boolean {\n  const expectedSignature = generateChallengeSignature(token, validatedDomain, privateKey);\n  \n  // Gunakan timing-safe comparison untuk mencegah timing attack\n  return crypto.timingSafeEqual(\n    Buffer.from(expectedSignature),\n    Buffer.from(providedSignature)\n  );\n}\n\n/**\n * Normalize domain untuk perbandingan yang konsisten\n * - Lowercase untuk menghindari bypass case-sensitivity\n * - Remove www. prefix jika ada\n * - Trim whitespace dan trailing dots\n */\nexport function normalizeDomain(domain: string): string {\n  if (!domain) return '';\n  \n  let normalized = domain.toLowerCase().trim();\n  \n  // Remove trailing dots\n  normalized = normalized.replace(/\\.+$/, '');\n  \n  // Remove www. prefix (optional - bisa disesuaikan per kebutuhan)\n  // Uncomment jika ingin www.example.com dianggap sama dengan example.com\n  // normalized = normalized.replace(/^www\\./, '');\n  \n  return normalized;\n}\n\n/**\n * Extract domain dari request headers dengan fallback chain\n * Ini digunakan untuk validasi domain\n */\nexport function extractDomainFromRequest(req: any): string | null {\n  // Priority order: Origin > Referer > Host\n  const origin = req.headers.origin;\n  if (origin) {\n    try {\n      const url = new URL(origin);\n      return normalizeDomain(url.hostname);\n    } catch {\n      // Invalid origin URL\n    }\n  }\n\n  const referer = req.headers.referer || req.headers.referrer;\n  if (referer) {\n    try {\n      const url = new URL(referer);\n      return normalizeDomain(url.hostname);\n    } catch {\n      // Invalid referer URL\n    }\n  }\n\n  // Fallback to host header (least reliable)\n  const host = req.headers.host;\n  if (host) {\n    // Remove port if present\n    return normalizeDomain(host.split(':')[0]);\n  }\n\n  return null;\n}\n\n/**\n * Get server origin URL dari request headers\n * Menggunakan x-forwarded-proto dan x-forwarded-host untuk proxy support\n * dengan fallback ke req.protocol dan req.get('host')\n * \n * Ini digunakan untuk mengubah relative asset paths menjadi absolute URLs\n * agar assets bisa diakses dari external websites\n */\nexport function getServerOrigin(req: any): string {\n  // Support proxy headers (for production behind reverse proxy)\n  const proto = req.headers['x-forwarded-proto'] || req.protocol || 'http';\n  const host = req.headers['x-forwarded-host'] || req.get('host') || 'localhost:5000';\n  \n  return `${proto}://${host}`;\n}\n\n/**\n * Generate siteKey (public) dan secretKey (private) pair untuk developer\n * siteKey: digunakan di frontend, bisa di-expose\n * secretKey: rahasia, digunakan untuk verify di backend\n */\nexport function generateKeyPair(): { siteKey: string; secretKey: string } {\n  const siteKey = `pk_${crypto.randomBytes(32).toString('hex')}`;\n  const secretKey = `sk_${crypto.randomBytes(32).toString('hex')}`;\n  return { siteKey, secretKey };\n}\n\n/**\n * Create encrypted verification token yang dikirim ke developer's backend\n * Token ini berisi challenge ID, timestamp, dan metadata lainnya\n * Encrypted menggunakan secretKey agar hanya owner yang bisa verify\n */\nexport function createVerificationToken(\n  challengeId: string,\n  secretKey: string,\n  metadata: {\n    domain: string;\n    timestamp: number;\n    nonce: string;\n    fingerprint?: string;\n  }\n): string {\n  const payload = {\n    cid: challengeId,\n    dom: metadata.domain,\n    ts: metadata.timestamp,\n    nonce: metadata.nonce,\n    fp: metadata.fingerprint,\n    exp: Math.floor(Date.now() / 1000) + (5 * 60),\n  };\n\n  return jwt.sign(payload, secretKey, { algorithm: 'HS256' });\n}\n\n/**\n * Verify dan decode verification token menggunakan secretKey\n * Return decoded payload jika valid, null jika invalid/expired\n */\nexport function verifyVerificationToken(\n  token: string,\n  secretKey: string\n): {\n  challengeId: string;\n  domain: string;\n  timestamp: number;\n  nonce: string;\n  fingerprint?: string;\n} | null {\n  try {\n    const decoded = jwt.verify(token, secretKey, { algorithms: ['HS256'] }) as any;\n    \n    return {\n      challengeId: decoded.cid,\n      domain: decoded.dom,\n      timestamp: decoded.ts,\n      nonce: decoded.nonce,\n      fingerprint: decoded.fp,\n    };\n  } catch (error) {\n    return null;\n  }\n}\n\n/**\n * NOTE: Challenge data encryption\n * \n * STATUS: ‚úÖ IMPLEMENTED (November 2025)\n * \n * Application-level encryption now provides defense-in-depth against:\n * - Misconfigured TLS\n * - MITM proxies that decrypt HTTPS\n * - Intermediate logging/caching\n * - Pattern analysis for solver training\n * \n * IMPLEMENTATION:\n * ‚úÖ ECDH (X25519) handshake for session key exchange (see server/encryption.ts)\n * ‚úÖ HKDF for master session key + per-challenge child key derivation\n * ‚úÖ AES-256-GCM authenticated encryption for challenge/solution data\n * ‚úÖ Session cache with ephemeral key rotation (hourly) and expiry (5 min)\n * ‚úÖ Downgrade attack prevention: encryption required when session exists\n * ‚úÖ Backward compatibility: plaintext fallback for clients without session\n * \n * ENDPOINTS:\n * - POST /api/captcha/handshake - ECDH key exchange\n * - POST /api/captcha/challenge - Encrypted challenge delivery (when session exists)\n * - POST /api/captcha/verify - Encrypted solution decryption\n * \n * For full implementation details, see:\n * - server/encryption.ts - Crypto primitives\n * - server/session-cache.ts - Session management\n * - server/routes.ts - Endpoint integration\n * - SECURITY.md - Threat model and mitigation strategies\n */\n","size_bytes":6169},"client/src/components/ui/menubar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as MenubarPrimitive from \"@radix-ui/react-menubar\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction MenubarMenu({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Menu>) {\n  return <MenubarPrimitive.Menu {...props} />\n}\n\nfunction MenubarGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Group>) {\n  return <MenubarPrimitive.Group {...props} />\n}\n\nfunction MenubarPortal({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Portal>) {\n  return <MenubarPrimitive.Portal {...props} />\n}\n\nfunction MenubarRadioGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.RadioGroup>) {\n  return <MenubarPrimitive.RadioGroup {...props} />\n}\n\nfunction MenubarSub({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Sub>) {\n  return <MenubarPrimitive.Sub data-slot=\"menubar-sub\" {...props} />\n}\n\nconst Menubar = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"flex h-10 items-center space-x-1 rounded-md border bg-background p-1\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubar.displayName = MenubarPrimitive.Root.displayName\n\nconst MenubarTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-3 py-1.5 text-sm font-medium outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarTrigger.displayName = MenubarPrimitive.Trigger.displayName\n\nconst MenubarSubTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <MenubarPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </MenubarPrimitive.SubTrigger>\n))\nMenubarSubTrigger.displayName = MenubarPrimitive.SubTrigger.displayName\n\nconst MenubarSubContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarSubContent.displayName = MenubarPrimitive.SubContent.displayName\n\nconst MenubarContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Content>\n>(\n  (\n    { className, align = \"start\", alignOffset = -4, sideOffset = 8, ...props },\n    ref\n  ) => (\n    <MenubarPrimitive.Portal>\n      <MenubarPrimitive.Content\n        ref={ref}\n        align={align}\n        alignOffset={alignOffset}\n        sideOffset={sideOffset}\n        className={cn(\n          \"z-50 min-w-[12rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n          className\n        )}\n        {...props}\n      />\n    </MenubarPrimitive.Portal>\n  )\n)\nMenubarContent.displayName = MenubarPrimitive.Content.displayName\n\nconst MenubarItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarItem.displayName = MenubarPrimitive.Item.displayName\n\nconst MenubarCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <MenubarPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.CheckboxItem>\n))\nMenubarCheckboxItem.displayName = MenubarPrimitive.CheckboxItem.displayName\n\nconst MenubarRadioItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <MenubarPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.RadioItem>\n))\nMenubarRadioItem.displayName = MenubarPrimitive.RadioItem.displayName\n\nconst MenubarLabel = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarLabel.displayName = MenubarPrimitive.Label.displayName\n\nconst MenubarSeparator = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nMenubarSeparator.displayName = MenubarPrimitive.Separator.displayName\n\nconst MenubarShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nMenubarShortcut.displayname = \"MenubarShortcut\"\n\nexport {\n  Menubar,\n  MenubarMenu,\n  MenubarTrigger,\n  MenubarContent,\n  MenubarItem,\n  MenubarSeparator,\n  MenubarLabel,\n  MenubarCheckboxItem,\n  MenubarRadioGroup,\n  MenubarRadioItem,\n  MenubarPortal,\n  MenubarSubContent,\n  MenubarSubTrigger,\n  MenubarGroup,\n  MenubarSub,\n  MenubarShortcut,\n}\n","size_bytes":8605},"client/src/components/ui/resizable.tsx":{"content":"\"use client\"\n\nimport { GripVertical } from \"lucide-react\"\nimport * as ResizablePrimitive from \"react-resizable-panels\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ResizablePanelGroup = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelGroup>) => (\n  <ResizablePrimitive.PanelGroup\n    className={cn(\n      \"flex h-full w-full data-[panel-group-direction=vertical]:flex-col\",\n      className\n    )}\n    {...props}\n  />\n)\n\nconst ResizablePanel = ResizablePrimitive.Panel\n\nconst ResizableHandle = ({\n  withHandle,\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelResizeHandle> & {\n  withHandle?: boolean\n}) => (\n  <ResizablePrimitive.PanelResizeHandle\n    className={cn(\n      \"relative flex w-px items-center justify-center bg-border after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90\",\n      className\n    )}\n    {...props}\n  >\n    {withHandle && (\n      <div className=\"z-10 flex h-4 w-3 items-center justify-center rounded-sm border bg-border\">\n        <GripVertical className=\"h-2.5 w-2.5\" />\n      </div>\n    )}\n  </ResizablePrimitive.PanelResizeHandle>\n)\n\nexport { ResizablePanelGroup, ResizablePanel, ResizableHandle }\n","size_bytes":1723},"scripts/setup-database.ts":{"content":"#!/usr/bin/env tsx\n/**\n * ProofCaptcha Database Setup Script\n * \n * Script ini membantu setup database PostgreSQL untuk production.\n * Gunakan script ini untuk:\n * - Validasi database connection\n * - Run migrations otomatis\n * - Setup demo data (optional)\n * - Verify database tables\n */\n\nimport { Pool, neonConfig } from \"@neondatabase/serverless\";\nimport { drizzle } from \"drizzle-orm/neon-serverless\";\nimport { migrate } from \"drizzle-orm/neon-serverless/migrator\";\nimport ws from \"ws\";\nimport { generateKeyPair } from \"../server/crypto-utils\";\nimport bcrypt from \"bcryptjs\";\nimport * as schema from \"../shared/schema\";\n\nneonConfig.webSocketConstructor = ws;\n\nconst colors = {\n  reset: '\\x1b[0m',\n  bright: '\\x1b[1m',\n  green: '\\x1b[32m',\n  red: '\\x1b[31m',\n  yellow: '\\x1b[33m',\n  blue: '\\x1b[34m',\n  cyan: '\\x1b[36m',\n};\n\nfunction log(message: string, color: string = colors.reset) {\n  console.log(`${color}${message}${colors.reset}`);\n}\n\nfunction logStep(step: string) {\n  console.log(`\\n${colors.bright}${colors.blue}‚ñ∂ ${step}${colors.reset}`);\n}\n\nfunction logSuccess(message: string) {\n  console.log(`${colors.green}‚úì ${message}${colors.reset}`);\n}\n\nfunction logError(message: string) {\n  console.log(`${colors.red}‚úó ${message}${colors.reset}`);\n}\n\nfunction logWarning(message: string) {\n  console.log(`${colors.yellow}‚ö† ${message}${colors.reset}`);\n}\n\nasync function checkDatabaseConnection(connectionString: string): Promise<boolean> {\n  logStep(\"Checking database connection...\");\n  \n  try {\n    const pool = new Pool({ connectionString });\n    const client = await pool.connect();\n    \n    const result = await client.query('SELECT version()');\n    const version = result.rows[0].version;\n    \n    logSuccess(`Connected to: ${version.split(',')[0]}`);\n    \n    client.release();\n    await pool.end();\n    return true;\n  } catch (error: any) {\n    logError(`Connection failed: ${error.message}`);\n    return false;\n  }\n}\n\nasync function runDatabaseMigrations(connectionString: string): Promise<boolean> {\n  logStep(\"Running database migrations...\");\n  \n  try {\n    const pool = new Pool({ connectionString });\n    const db = drizzle({ client: pool });\n    \n    await migrate(db, { migrationsFolder: './migrations' });\n    \n    logSuccess(\"Migrations completed successfully\");\n    \n    await pool.end();\n    return true;\n  } catch (error: any) {\n    logError(`Migration failed: ${error.message}`);\n    return false;\n  }\n}\n\nasync function verifyTables(connectionString: string): Promise<void> {\n  logStep(\"Verifying database tables...\");\n  \n  const pool = new Pool({ connectionString });\n  const db = drizzle({ client: pool, schema });\n  \n  try {\n    const tables = ['developers', 'api_keys', 'challenges', 'verifications', 'analytics'];\n    \n    for (const tableName of tables) {\n      const result = await pool.query(\n        `SELECT EXISTS (\n          SELECT FROM information_schema.tables \n          WHERE table_schema = 'public' \n          AND table_name = $1\n        )`,\n        [tableName]\n      );\n      \n      if (result.rows[0].exists) {\n        logSuccess(`Table '${tableName}' exists`);\n      } else {\n        logWarning(`Table '${tableName}' not found`);\n      }\n    }\n    \n    const countResult = await pool.query(`\n      SELECT \n        (SELECT COUNT(*) FROM developers) as developers,\n        (SELECT COUNT(*) FROM api_keys) as api_keys,\n        (SELECT COUNT(*) FROM challenges) as challenges,\n        (SELECT COUNT(*) FROM verifications) as verifications,\n        (SELECT COUNT(*) FROM analytics) as analytics\n    `);\n    \n    const counts = countResult.rows[0];\n    console.log(`\\n${colors.cyan}Database Statistics:${colors.reset}`);\n    console.log(`  Developers: ${counts.developers}`);\n    console.log(`  API Keys: ${counts.api_keys}`);\n    console.log(`  Challenges: ${counts.challenges}`);\n    console.log(`  Verifications: ${counts.verifications}`);\n    console.log(`  Analytics: ${counts.analytics}`);\n    \n  } catch (error: any) {\n    logError(`Verification failed: ${error.message}`);\n  } finally {\n    await pool.end();\n  }\n}\n\nasync function setupDemoData(connectionString: string): Promise<void> {\n  logStep(\"Setting up demo data...\");\n  \n  const pool = new Pool({ connectionString });\n  const db = drizzle({ client: pool, schema });\n  \n  try {\n    const existingDev = await db.query.developers.findFirst({\n      where: (developers, { eq }) => eq(developers.email, 'demo@proofcaptcha.com')\n    });\n    \n    if (existingDev) {\n      logWarning(\"Demo account already exists\");\n      await pool.end();\n      return;\n    }\n    \n    const hashedPassword = await bcrypt.hash('demo123', 10);\n    const [developer] = await db.insert(schema.developers).values({\n      email: 'demo@proofcaptcha.com',\n      password: hashedPassword,\n      name: 'Demo User',\n    }).returning();\n    \n    logSuccess(`Demo developer created: ${developer.email}`);\n    \n    const { siteKey, secretKey } = generateKeyPair();\n    const customSiteKey = 'pk_ab6c4ac2c8976668e6d92fe401386cae18df4c9b4f5193cb140266f6d9546f1c';\n    \n    const [apiKey] = await db.insert(schema.apiKeys).values({\n      developerId: developer.id,\n      name: 'Demo API Key',\n      sitekey: customSiteKey,\n      secretkey: secretKey,\n      domain: null,\n      isActive: true,\n    }).returning();\n    \n    logSuccess(`Demo API key created: ${apiKey.sitekey}`);\n    \n  } catch (error: any) {\n    logError(`Demo data setup failed: ${error.message}`);\n  } finally {\n    await pool.end();\n  }\n}\n\nasync function main() {\n  console.log(`\n${colors.bright}${colors.cyan}‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n  ProofCaptcha Database Setup\n  Automated database configuration for production\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê${colors.reset}\n  `);\n  \n  const DATABASE_URL = process.env.DATABASE_URL;\n  \n  if (!DATABASE_URL) {\n    logError(\"DATABASE_URL environment variable not found!\");\n    console.log(`\n${colors.yellow}Setup Instructions:${colors.reset}\n\n1. Buka Replit Database tool di sidebar\n2. Klik \"Create a database\" \n3. Database credentials akan otomatis tersimpan sebagai environment variables\n4. Restart workflow/app Anda\n5. Jalankan script ini lagi\n\nAtau, jika Anda sudah punya database di Replit:\n- Pastikan environment variables sudah di-set di Secrets\n- Restart workflow untuk load variables\n\n${colors.cyan}Dokumentasi:${colors.reset} https://docs.replit.com/hosting/databases/postgresql\n    `);\n    process.exit(1);\n  }\n  \n  logSuccess(\"DATABASE_URL found and loaded securely\");\n  \n  const connected = await checkDatabaseConnection(DATABASE_URL);\n  if (!connected) {\n    logError(\"Failed to connect to database. Please check your DATABASE_URL\");\n    process.exit(1);\n  }\n  \n  const migrated = await runDatabaseMigrations(DATABASE_URL);\n  if (!migrated) {\n    logError(\"Failed to run migrations\");\n    process.exit(1);\n  }\n  \n  await verifyTables(DATABASE_URL);\n  \n  const args = process.argv.slice(2);\n  if (args.includes('--with-demo')) {\n    await setupDemoData(DATABASE_URL);\n  } else {\n    logWarning(\"Demo data skipped (use --with-demo flag to include)\");\n  }\n  \n  console.log(`\n${colors.bright}${colors.green}‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n  ‚úì Database Setup Complete!\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê${colors.reset}\n\n${colors.cyan}Next Steps:${colors.reset}\n1. Restart your application to use database storage\n2. Check that storage logs show \"DatabaseStorage\" instead of \"MemStorage\"\n3. Register developers and create API keys via the dashboard\n\n${colors.cyan}Useful Commands:${colors.reset}\n  npm run db:studio     - Open Drizzle Studio (database GUI)\n  npm run db:push       - Push schema changes to database\n  npm run setup-db      - Run this setup script again\n\n${colors.yellow}Production Tips:${colors.reset}\n- Regular backups dikelola otomatis oleh Replit Database\n- Monitor usage di Replit Database dashboard\n- Gunakan connection pooling untuk high traffic\n- Set up alerts untuk database metrics\n  `);\n}\n\nmain().catch((error) => {\n  logError(`Setup failed: ${error.message}`);\n  console.error(error);\n  process.exit(1);\n});\n","size_bytes":8561},"client/src/components/ui/calendar.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight } from \"lucide-react\"\nimport { DayPicker } from \"react-day-picker\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nexport type CalendarProps = React.ComponentProps<typeof DayPicker>\n\nfunction Calendar({\n  className,\n  classNames,\n  showOutsideDays = true,\n  ...props\n}: CalendarProps) {\n  return (\n    <DayPicker\n      showOutsideDays={showOutsideDays}\n      className={cn(\"p-3\", className)}\n      classNames={{\n        months: \"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0\",\n        month: \"space-y-4\",\n        caption: \"flex justify-center pt-1 relative items-center\",\n        caption_label: \"text-sm font-medium\",\n        nav: \"space-x-1 flex items-center\",\n        nav_button: cn(\n          buttonVariants({ variant: \"outline\" }),\n          \"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100\"\n        ),\n        nav_button_previous: \"absolute left-1\",\n        nav_button_next: \"absolute right-1\",\n        table: \"w-full border-collapse space-y-1\",\n        head_row: \"flex\",\n        head_cell:\n          \"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]\",\n        row: \"flex w-full mt-2\",\n        cell: \"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20\",\n        day: cn(\n          buttonVariants({ variant: \"ghost\" }),\n          \"h-9 w-9 p-0 font-normal aria-selected:opacity-100\"\n        ),\n        day_range_end: \"day-range-end\",\n        day_selected:\n          \"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground\",\n        day_today: \"bg-accent text-accent-foreground\",\n        day_outside:\n          \"day-outside text-muted-foreground aria-selected:bg-accent/50 aria-selected:text-muted-foreground\",\n        day_disabled: \"text-muted-foreground opacity-50\",\n        day_range_middle:\n          \"aria-selected:bg-accent aria-selected:text-accent-foreground\",\n        day_hidden: \"invisible\",\n        ...classNames,\n      }}\n      components={{\n        IconLeft: ({ className, ...props }) => (\n          <ChevronLeft className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n        IconRight: ({ className, ...props }) => (\n          <ChevronRight className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n      }}\n      {...props}\n    />\n  )\n}\nCalendar.displayName = \"Calendar\"\n\nexport { Calendar }\n","size_bytes":2695},"server/security-monitor.ts":{"content":"interface SecurityEvent {\n  timestamp: number;\n  type: \"challenge_request\" | \"verification_success\" | \"verification_failure\" | \"threat_blocked\" | \"replay_attack\";\n  ip: string;\n  riskLevel?: string;\n  riskScore?: number;\n  details?: Record<string, any>;\n}\n\ninterface SecurityMetrics {\n  totalRequests: number;\n  threatsBlocked: number;\n  verificationSuccess: number;\n  verificationFailure: number;\n  replayAttacks: number;\n  averageRiskScore: number;\n  highRiskRequests: number;\n  criticalRiskRequests: number;\n}\n\nclass SecurityMonitor {\n  private events: SecurityEvent[] = [];\n  private readonly MAX_EVENTS = 10000;\n  private readonly RETENTION_PERIOD_MS = 24 * 60 * 60 * 1000;\n\n  constructor() {\n    setInterval(() => this.cleanup(), 60 * 60 * 1000);\n  }\n\n  logEvent(event: Omit<SecurityEvent, \"timestamp\">): void {\n    const fullEvent: SecurityEvent = {\n      ...event,\n      timestamp: Date.now(),\n    };\n\n    this.events.push(fullEvent);\n\n    if (this.events.length > this.MAX_EVENTS) {\n      this.events = this.events.slice(-this.MAX_EVENTS);\n    }\n\n    if (event.type === \"threat_blocked\") {\n      console.log(`[SECURITY ALERT] Threat blocked from ${event.ip}: ${JSON.stringify(event.details)}`);\n    } else if (event.type === \"replay_attack\") {\n      console.log(`[SECURITY ALERT] Replay attack detected from ${event.ip}`);\n    }\n  }\n\n  getMetrics(timeWindowMs: number = 3600000): SecurityMetrics {\n    const now = Date.now();\n    const recentEvents = this.events.filter(e => now - e.timestamp < timeWindowMs);\n\n    const challengeRequests = recentEvents.filter(e => e.type === \"challenge_request\");\n    const riskScores = challengeRequests\n      .filter(e => e.riskScore !== undefined)\n      .map(e => e.riskScore!);\n\n    return {\n      totalRequests: challengeRequests.length,\n      threatsBlocked: recentEvents.filter(e => e.type === \"threat_blocked\").length,\n      verificationSuccess: recentEvents.filter(e => e.type === \"verification_success\").length,\n      verificationFailure: recentEvents.filter(e => e.type === \"verification_failure\").length,\n      replayAttacks: recentEvents.filter(e => e.type === \"replay_attack\").length,\n      averageRiskScore: riskScores.length > 0 ? riskScores.reduce((a, b) => a + b, 0) / riskScores.length : 0,\n      highRiskRequests: challengeRequests.filter(e => e.riskLevel === \"high\").length,\n      criticalRiskRequests: challengeRequests.filter(e => e.riskLevel === \"critical\").length,\n    };\n  }\n\n  getRecentThreats(limit: number = 50): SecurityEvent[] {\n    return this.events\n      .filter(e => e.type === \"threat_blocked\" || e.type === \"replay_attack\")\n      .slice(-limit)\n      .reverse();\n  }\n\n  getTopThreatIPs(limit: number = 10, timeWindowMs: number = 3600000): Array<{ip: string; count: number}> {\n    const now = Date.now();\n    const recentThreats = this.events.filter(\n      e => (e.type === \"threat_blocked\" || e.type === \"replay_attack\") && now - e.timestamp < timeWindowMs\n    );\n\n    const ipCounts = new Map<string, number>();\n    for (const event of recentThreats) {\n      ipCounts.set(event.ip, (ipCounts.get(event.ip) || 0) + 1);\n    }\n\n    return Array.from(ipCounts.entries())\n      .map(([ip, count]) => ({ ip, count }))\n      .sort((a, b) => b.count - a.count)\n      .slice(0, limit);\n  }\n\n  private cleanup(): void {\n    const now = Date.now();\n    const before = this.events.length;\n    this.events = this.events.filter(e => now - e.timestamp < this.RETENTION_PERIOD_MS);\n    const removed = before - this.events.length;\n\n    if (removed > 0) {\n      console.log(`[SECURITY MONITOR] Cleaned up ${removed} old security events`);\n    }\n  }\n\n  exportEvents(timeWindowMs: number = 3600000): SecurityEvent[] {\n    const now = Date.now();\n    return this.events.filter(e => now - e.timestamp < timeWindowMs);\n  }\n}\n\nexport const securityMonitor = new SecurityMonitor();\n","size_bytes":3840},"client/src/components/ApiKeyCard.tsx":{"content":"import { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Copy, Eye, EyeOff, Trash2, ToggleLeft, ToggleRight } from \"lucide-react\";\nimport { useState } from \"react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport type { ApiKey } from \"@shared/schema\";\nimport { useTranslation } from \"react-i18next\";\nimport ApiKeySettingsDialog from \"@/components/ApiKeySettingsDialog\";\n\ninterface ApiKeyCardProps {\n  apiKey: ApiKey;\n  onToggleStatus?: (id: string) => void;\n  onDelete?: (id: string) => void;\n}\n\nexport default function ApiKeyCard({ apiKey, onToggleStatus, onDelete }: ApiKeyCardProps) {\n  const [showPrivateKey, setShowPrivateKey] = useState(false);\n  const { toast } = useToast();\n  const { t } = useTranslation();\n\n  const copyToClipboard = (text: string, label: string) => {\n    navigator.clipboard.writeText(text);\n    toast({\n      title: t('apiKeys.card.copied'),\n      description: `${label} ${t('toast.copiedToClipboard')}`,\n    });\n  };\n\n  const maskKey = (key: string) => {\n    return key.slice(0, 8) + \"‚Ä¢\".repeat(20) + key.slice(-4);\n  };\n\n  return (\n    <Card data-testid={`card-apikey-${apiKey.id}`}>\n      <CardHeader className=\"flex flex-row items-start justify-between gap-2 space-y-0 pb-4\">\n        <div className=\"space-y-1 flex-1\">\n          <CardTitle className=\"text-lg\" data-testid=\"text-name\">\n            {apiKey.name}\n          </CardTitle>\n          {apiKey.domain && (\n            <p className=\"text-sm text-muted-foreground\" data-testid=\"text-domain\">\n              {t('apiKeys.card.domainLabel')}{apiKey.domain}\n            </p>\n          )}\n        </div>\n        <Badge\n          variant={apiKey.isActive ? \"default\" : \"secondary\"}\n          data-testid={`badge-status-${apiKey.isActive ? \"active\" : \"inactive\"}`}\n        >\n          {apiKey.isActive ? t('apiKeys.card.active') : t('apiKeys.card.inactive')}\n        </Badge>\n      </CardHeader>\n\n      <CardContent className=\"space-y-4\">\n        <div className=\"space-y-2\">\n          <div className=\"flex items-center justify-between\">\n            <span className=\"text-sm font-medium\">{t('apiKeys.card.siteKey')}</span>\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              onClick={() => copyToClipboard(apiKey.sitekey, t('apiKeys.card.siteKey'))}\n              data-testid=\"button-copy-public\"\n            >\n              <Copy className=\"h-4 w-4\" />\n            </Button>\n          </div>\n          <code\n            className=\"block text-xs bg-muted p-2 rounded font-mono\"\n            data-testid=\"text-public-key\"\n          >\n            {apiKey.sitekey}\n          </code>\n          <p className=\"text-xs text-muted-foreground\">\n            {t('apiKeys.card.siteKeyHelpText')}\n          </p>\n        </div>\n\n        <div className=\"space-y-2\">\n          <div className=\"flex items-center justify-between\">\n            <span className=\"text-sm font-medium\">{t('apiKeys.card.secretKey')}</span>\n            <div className=\"flex gap-1\">\n              <Button\n                variant=\"ghost\"\n                size=\"sm\"\n                onClick={() => setShowPrivateKey(!showPrivateKey)}\n                data-testid=\"button-toggle-visibility\"\n              >\n                {showPrivateKey ? <EyeOff className=\"h-4 w-4\" /> : <Eye className=\"h-4 w-4\" />}\n              </Button>\n              <Button\n                variant=\"ghost\"\n                size=\"sm\"\n                onClick={() => copyToClipboard(apiKey.secretkey, t('apiKeys.card.secretKey'))}\n                data-testid=\"button-copy-private\"\n              >\n                <Copy className=\"h-4 w-4\" />\n              </Button>\n            </div>\n          </div>\n          <code\n            className=\"block text-xs bg-muted p-2 rounded font-mono\"\n            data-testid=\"text-private-key\"\n          >\n            {showPrivateKey ? apiKey.secretkey : maskKey(apiKey.secretkey)}\n          </code>\n          <p className=\"text-xs text-muted-foreground\">\n            {t('apiKeys.card.secretKeyHelpText')}\n          </p>\n        </div>\n\n        <div className=\"flex flex-col gap-2 pt-2\">\n          <div className=\"flex gap-2\">\n            <Button\n              variant=\"outline\"\n              size=\"sm\"\n              onClick={() => onToggleStatus?.(apiKey.id)}\n              data-testid=\"button-toggle-status\"\n              className=\"flex-1\"\n            >\n              {apiKey.isActive ? (\n                <>\n                  <ToggleLeft className=\"h-4 w-4 mr-2\" />\n                  {t('apiKeys.card.deactivate')}\n                </>\n              ) : (\n                <>\n                  <ToggleRight className=\"h-4 w-4 mr-2\" />\n                  {t('apiKeys.card.activate')}\n                </>\n              )}\n            </Button>\n            <Button\n              variant=\"destructive\"\n              size=\"sm\"\n              onClick={() => onDelete?.(apiKey.id)}\n              data-testid=\"button-delete\"\n            >\n              <Trash2 className=\"h-4 w-4\" />\n            </Button>\n          </div>\n          \n          <ApiKeySettingsDialog apiKeyId={apiKey.id} apiKeyName={apiKey.name} />\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n","size_bytes":5271},"client/src/components/ThemeToggle.tsx":{"content":"import { Moon, Sun } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { useEffect, useState } from \"react\";\n\nexport default function ThemeToggle() {\n  const [theme, setTheme] = useState<\"light\" | \"dark\">(\"light\");\n\n  useEffect(() => {\n    const savedTheme = localStorage.getItem(\"theme\") as \"light\" | \"dark\" | null;\n    const prefersDark = window.matchMedia(\"(prefers-color-scheme: dark)\").matches;\n    const initialTheme = savedTheme || (prefersDark ? \"dark\" : \"light\");\n\n    setTheme(initialTheme);\n    document.documentElement.classList.toggle(\"dark\", initialTheme === \"dark\");\n  }, []);\n\n  const toggleTheme = () => {\n    const newTheme = theme === \"light\" ? \"dark\" : \"light\";\n    setTheme(newTheme);\n    localStorage.setItem(\"theme\", newTheme);\n    document.documentElement.classList.toggle(\"dark\", newTheme === \"dark\");\n  };\n\n  return (\n    <Button\n      variant=\"ghost\"\n      size=\"icon\"\n      onClick={toggleTheme}\n      data-testid=\"button-theme-toggle\"\n      aria-label=\"Toggle theme\"\n    >\n      {theme === \"light\" ? (\n        <Moon className=\"h-5 w-5\" data-testid=\"icon-moon\" />\n      ) : (\n        <Sun className=\"h-5 w-5\" data-testid=\"icon-sun\" />\n      )}\n    </Button>\n  );\n}\n","size_bytes":1220},"client/src/components/ui/dropdown-menu.tsx":{"content":"import * as React from \"react\"\nimport * as DropdownMenuPrimitive from \"@radix-ui/react-dropdown-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst DropdownMenu = DropdownMenuPrimitive.Root\n\nconst DropdownMenuTrigger = DropdownMenuPrimitive.Trigger\n\nconst DropdownMenuGroup = DropdownMenuPrimitive.Group\n\nconst DropdownMenuPortal = DropdownMenuPrimitive.Portal\n\nconst DropdownMenuSub = DropdownMenuPrimitive.Sub\n\nconst DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup\n\nconst DropdownMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto\" />\n  </DropdownMenuPrimitive.SubTrigger>\n))\nDropdownMenuSubTrigger.displayName =\n  DropdownMenuPrimitive.SubTrigger.displayName\n\nconst DropdownMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuSubContent.displayName =\n  DropdownMenuPrimitive.SubContent.displayName\n\nconst DropdownMenuContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <DropdownMenuPrimitive.Portal>\n    <DropdownMenuPrimitive.Content\n      ref={ref}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </DropdownMenuPrimitive.Portal>\n))\nDropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName\n\nconst DropdownMenuItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName\n\nconst DropdownMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <DropdownMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.CheckboxItem>\n))\nDropdownMenuCheckboxItem.displayName =\n  DropdownMenuPrimitive.CheckboxItem.displayName\n\nconst DropdownMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.RadioItem>\n))\nDropdownMenuRadioItem.displayName = DropdownMenuPrimitive.RadioItem.displayName\n\nconst DropdownMenuLabel = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuLabel.displayName = DropdownMenuPrimitive.Label.displayName\n\nconst DropdownMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nDropdownMenuSeparator.displayName = DropdownMenuPrimitive.Separator.displayName\n\nconst DropdownMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\"ml-auto text-xs tracking-widest opacity-60\", className)}\n      {...props}\n    />\n  )\n}\nDropdownMenuShortcut.displayName = \"DropdownMenuShortcut\"\n\nexport {\n  DropdownMenu,\n  DropdownMenuTrigger,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuCheckboxItem,\n  DropdownMenuRadioItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuShortcut,\n  DropdownMenuGroup,\n  DropdownMenuPortal,\n  DropdownMenuSub,\n  DropdownMenuSubContent,\n  DropdownMenuSubTrigger,\n  DropdownMenuRadioGroup,\n}\n","size_bytes":7609},"server/db.ts":{"content":"import { Pool, neonConfig } from '@neondatabase/serverless';\nimport { drizzle } from 'drizzle-orm/neon-serverless';\nimport ws from \"ws\";\nimport * as schema from \"@shared/schema\";\n\nneonConfig.webSocketConstructor = ws;\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\n    \"DATABASE_URL must be set. Did you forget to provision a database?\",\n  );\n}\n\nexport const pool = new Pool({ connectionString: process.env.DATABASE_URL });\nexport const db = drizzle({ client: pool, schema });\n","size_bytes":483},"client/src/pages/not-found.tsx":{"content":"import { Button } from \"@/components/ui/button\";\nimport { Shield, Home, ArrowLeft } from \"lucide-react\";\nimport { Link } from \"wouter\";\nimport { useTranslation } from \"react-i18next\";\n\nexport default function NotFound() {\n  const { t } = useTranslation();\n\n  return (\n    <div className=\"min-h-screen w-full flex items-center justify-center bg-gradient-to-br from-background via-background to-muted/20\">\n      <div className=\"w-full max-w-2xl mx-4 text-center\">\n        <div className=\"mb-8 flex justify-center\">\n          <div className=\"relative\">\n            <div className=\"absolute inset-0 bg-primary/20 blur-3xl rounded-full animate-pulse\"></div>\n            <div className=\"relative bg-gradient-to-br from-primary to-primary/70 p-8 rounded-3xl shadow-2xl\">\n              <Shield className=\"w-24 h-24 text-primary-foreground\" strokeWidth={1.5} />\n            </div>\n          </div>\n        </div>\n\n        <div className=\"mb-6\">\n          <h1 className=\"text-9xl font-bold bg-gradient-to-r from-primary via-primary/80 to-primary/60 bg-clip-text text-transparent mb-4\">\n            404\n          </h1>\n          <h2 className=\"text-3xl font-bold mb-4\">\n            {t('notFound.title')}\n          </h2>\n          <div className=\"max-w-md mx-auto space-y-3\">\n            <p className=\"text-lg text-muted-foreground\">\n              {t('notFound.description')}\n            </p>\n          </div>\n        </div>\n\n        <div className=\"flex flex-wrap gap-4 justify-center mt-8\">\n          <Link href=\"/\">\n            <Button size=\"lg\" className=\"gap-2\" data-testid=\"button-home\">\n              <Home className=\"w-5 h-5\" />\n              {t('notFound.goHome')}\n            </Button>\n          </Link>\n          <Button \n            size=\"lg\" \n            variant=\"outline\" \n            className=\"gap-2\"\n            onClick={() => window.history.back()}\n            data-testid=\"button-back\"\n          >\n            <ArrowLeft className=\"w-5 h-5\" />\n            {t('common.cancel')}\n          </Button>\n        </div>\n\n        <div className=\"mt-16 grid grid-cols-3 gap-4 max-w-md mx-auto opacity-50\">\n          <div className=\"h-1 bg-gradient-to-r from-transparent via-primary/30 to-transparent rounded-full\"></div>\n          <div className=\"h-1 bg-gradient-to-r from-transparent via-primary/50 to-transparent rounded-full\"></div>\n          <div className=\"h-1 bg-gradient-to-r from-transparent via-primary/30 to-transparent rounded-full\"></div>\n        </div>\n\n        <div className=\"mt-12\">\n          <p className=\"text-sm text-muted-foreground/60\">\n            Powered by <span className=\"font-semibold text-primary\">ProofCaptcha</span>\n          </p>\n        </div>\n      </div>\n    </div>\n  );\n}\n","size_bytes":2704},"client/src/pages/Privacy.tsx":{"content":"import { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Shield } from \"lucide-react\";\nimport { Link } from \"wouter\";\nimport { useTranslation } from \"react-i18next\";\nimport LanguageToggle from \"@/components/LanguageToggle\";\nimport ThemeToggle from \"@/components/ThemeToggle\";\n\nexport default function Privacy() {\n  const { t } = useTranslation();\n\n  return (\n    <div className=\"min-h-screen\" data-testid=\"page-privacy\">\n      <header className=\"border-b\">\n        <div className=\"container mx-auto px-4 py-4 flex items-center justify-between\">\n          <div className=\"flex items-center gap-2\">\n            <Shield className=\"h-6 w-6 text-primary\" />\n            <span className=\"font-bold text-lg\">ProofCaptcha</span>\n          </div>\n          <div className=\"flex items-center gap-2\">\n            <LanguageToggle />\n            <ThemeToggle />\n          </div>\n        </div>\n      </header>\n\n      <div className=\"p-4 md:p-8\">\n        <div className=\"max-w-4xl mx-auto\">\n          <div className=\"flex items-center gap-3 mb-6\">\n            <Shield className=\"h-8 w-8 text-primary\" />\n            <h1 className=\"text-3xl font-bold\">{t('privacy.title')}</h1>\n          </div>\n\n          <Card className=\"mb-6\">\n            <CardHeader>\n              <CardTitle>{t('privacy.pageTitle')}</CardTitle>\n              <p className=\"text-sm text-muted-foreground\">{t('privacy.lastUpdated')}: {t('privacy.lastUpdatedDate')}</p>\n            </CardHeader>\n            <CardContent className=\"space-y-6\">\n              <section>\n                <h2 className=\"text-xl font-semibold mb-3\">{t('privacy.introduction.title')}</h2>\n                <p className=\"text-muted-foreground\">\n                  {t('privacy.introduction.content')}\n                </p>\n              </section>\n\n              <section>\n                <h2 className=\"text-xl font-semibold mb-3\">{t('privacy.infoCollect.title')}</h2>\n                <div className=\"space-y-3 text-muted-foreground\">\n                  <div>\n                    <h3 className=\"font-medium text-foreground mb-2\">{t('privacy.infoCollect.technical.title')}</h3>\n                    <ul className=\"list-disc list-inside space-y-1 ml-4\">\n                      {(t('privacy.infoCollect.technical.items', { returnObjects: true }) as string[]).map((item: string, index: number) => (\n                        <li key={index}>{item}</li>\n                      ))}\n                    </ul>\n                  </div>\n                  <div>\n                    <h3 className=\"font-medium text-foreground mb-2\">{t('privacy.infoCollect.interaction.title')}</h3>\n                    <ul className=\"list-disc list-inside space-y-1 ml-4\">\n                      {(t('privacy.infoCollect.interaction.items', { returnObjects: true }) as string[]).map((item: string, index: number) => (\n                        <li key={index}>{item}</li>\n                      ))}\n                    </ul>\n                  </div>\n                  <div>\n                    <h3 className=\"font-medium text-foreground mb-2\">{t('privacy.infoCollect.developer.title')}</h3>\n                    <ul className=\"list-disc list-inside space-y-1 ml-4\">\n                      {(t('privacy.infoCollect.developer.items', { returnObjects: true }) as string[]).map((item: string, index: number) => (\n                        <li key={index}>{item}</li>\n                      ))}\n                    </ul>\n                  </div>\n                </div>\n              </section>\n\n              <section>\n                <h2 className=\"text-xl font-semibold mb-3\">{t('privacy.howWeUse.title')}</h2>\n                <div className=\"space-y-2 text-muted-foreground\">\n                  <p>{t('privacy.howWeUse.intro')}</p>\n                  <ul className=\"list-disc list-inside space-y-1 ml-4\">\n                    {(t('privacy.howWeUse.items', { returnObjects: true }) as string[]).map((item: string, index: number) => (\n                      <li key={index}>{item}</li>\n                    ))}\n                  </ul>\n                </div>\n              </section>\n\n              <section>\n                <h2 className=\"text-xl font-semibold mb-3\">{t('privacy.dataSecurity.title')}</h2>\n                <div className=\"space-y-2 text-muted-foreground\">\n                  <p>{t('privacy.dataSecurity.intro')}</p>\n                  <ul className=\"list-disc list-inside space-y-1 ml-4\">\n                    {(t('privacy.dataSecurity.items', { returnObjects: true }) as string[]).map((item: string, index: number) => (\n                      <li key={index}>{item}</li>\n                    ))}\n                  </ul>\n                </div>\n              </section>\n\n              <section>\n                <h2 className=\"text-xl font-semibold mb-3\">{t('privacy.dataRetention.title')}</h2>\n                <div className=\"space-y-2 text-muted-foreground\">\n                  <p>{t('privacy.dataRetention.intro')}</p>\n                  <ul className=\"list-disc list-inside space-y-1 ml-4\">\n                    {(t('privacy.dataRetention.items', { returnObjects: true }) as string[]).map((item: string, index: number) => (\n                      <li key={index}>{item}</li>\n                    ))}\n                  </ul>\n                </div>\n              </section>\n\n              <section>\n                <h2 className=\"text-xl font-semibold mb-3\">{t('privacy.thirdParty.title')}</h2>\n                <p className=\"text-muted-foreground\">\n                  {t('privacy.thirdParty.content')}\n                </p>\n              </section>\n\n              <section>\n                <h2 className=\"text-xl font-semibold mb-3\">{t('privacy.cookies.title')}</h2>\n                <p className=\"text-muted-foreground\">\n                  {t('privacy.cookies.content')}\n                </p>\n              </section>\n\n              <section>\n                <h2 className=\"text-xl font-semibold mb-3\">{t('privacy.yourRights.title')}</h2>\n                <div className=\"space-y-2 text-muted-foreground\">\n                  <p>{t('privacy.yourRights.intro')}</p>\n                  <ul className=\"list-disc list-inside space-y-1 ml-4\">\n                    {(t('privacy.yourRights.items', { returnObjects: true }) as string[]).map((item: string, index: number) => (\n                      <li key={index}>{item}</li>\n                    ))}\n                  </ul>\n                </div>\n              </section>\n\n              <section>\n                <h2 className=\"text-xl font-semibold mb-3\">{t('privacy.children.title')}</h2>\n                <p className=\"text-muted-foreground\">\n                  {t('privacy.children.content')}\n                </p>\n              </section>\n\n              <section>\n                <h2 className=\"text-xl font-semibold mb-3\">{t('privacy.changes.title')}</h2>\n                <p className=\"text-muted-foreground\">\n                  {t('privacy.changes.content')}\n                </p>\n              </section>\n\n              <section>\n                <h2 className=\"text-xl font-semibold mb-3\">{t('privacy.contact.title')}</h2>\n                <p className=\"text-muted-foreground\">\n                  {t('privacy.contact.content')}\n                </p>\n              </section>\n            </CardContent>\n          </Card>\n\n          <div className=\"text-center\">\n            <Link href=\"/\" className=\"text-primary hover:underline\" data-testid=\"link-home\">\n              {t('privacy.backToHome')}\n            </Link>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n","size_bytes":7523},"server/db-storage.ts":{"content":"import { drizzle } from \"drizzle-orm/neon-serverless\";\nimport { Pool, neonConfig } from \"@neondatabase/serverless\";\nimport { eq, and, gte, lte, desc, isNull, sql } from \"drizzle-orm\";\nimport ws from \"ws\";\nimport {\n  developers,\n  apiKeys,\n  challenges,\n  verifications,\n  analytics,\n  countryAnalytics,\n  type Developer,\n  type InsertDeveloper,\n  type ApiKey,\n  type InsertApiKey,\n  type Challenge,\n  type InsertChallenge,\n  type Verification,\n  type InsertVerification,\n  type Analytics,\n  type InsertAnalytics,\n  type CountryAnalytics,\n  type InsertCountryAnalytics,\n} from \"@shared/schema\";\nimport { nanoid } from \"nanoid\";\nimport type { IStorage } from \"./storage\";\nimport { generateKeyPair } from \"./crypto-utils\";\n\nexport class DatabaseStorage implements IStorage {\n  private db;\n\n  constructor(databaseUrl: string) {\n    neonConfig.webSocketConstructor = ws;\n    const pool = new Pool({ connectionString: databaseUrl });\n    this.db = drizzle({ client: pool });\n  }\n\n  async createDeveloper(insertDeveloper: InsertDeveloper): Promise<Developer> {\n    const [developer] = await this.db\n      .insert(developers)\n      .values(insertDeveloper)\n      .returning();\n    return developer;\n  }\n\n  async getDeveloper(id: string): Promise<Developer | undefined> {\n    const [developer] = await this.db\n      .select()\n      .from(developers)\n      .where(eq(developers.id, id))\n      .limit(1);\n    return developer;\n  }\n\n  async getDeveloperByEmail(email: string): Promise<Developer | undefined> {\n    const [developer] = await this.db\n      .select()\n      .from(developers)\n      .where(eq(developers.email, email))\n      .limit(1);\n    return developer;\n  }\n\n  async getDeveloperById(id: string): Promise<Developer | undefined> {\n    const [developer] = await this.db\n      .select()\n      .from(developers)\n      .where(eq(developers.id, id))\n      .limit(1);\n    return developer;\n  }\n\n  async verifyDeveloperEmail(id: string): Promise<void> {\n    await this.db\n      .update(developers)\n      .set({\n        isEmailVerified: true,\n        verificationCode: null,\n        verificationCodeExpiry: null,\n      })\n      .where(eq(developers.id, id));\n  }\n\n  async updateVerificationCode(id: string, code: string, expiry: Date): Promise<void> {\n    await this.db\n      .update(developers)\n      .set({\n        verificationCode: code,\n        verificationCodeExpiry: expiry,\n      })\n      .where(eq(developers.id, id));\n  }\n\n  async updateResetPasswordCode(email: string, code: string, expiry: Date): Promise<void> {\n    await this.db\n      .update(developers)\n      .set({\n        resetPasswordCode: code,\n        resetPasswordCodeExpiry: expiry,\n      })\n      .where(eq(developers.email, email));\n  }\n\n  async resetPassword(email: string, code: string, newPassword: string): Promise<boolean> {\n    const developer = await this.getDeveloperByEmail(email);\n    if (!developer) {\n      return false;\n    }\n\n    if (!developer.resetPasswordCode || !developer.resetPasswordCodeExpiry) {\n      return false;\n    }\n\n    if (new Date() > developer.resetPasswordCodeExpiry) {\n      return false;\n    }\n\n    if (developer.resetPasswordCode !== code) {\n      return false;\n    }\n\n    await this.db\n      .update(developers)\n      .set({\n        password: newPassword,\n        resetPasswordCode: null,\n        resetPasswordCodeExpiry: null,\n      })\n      .where(eq(developers.email, email));\n\n    return true;\n  }\n\n  // API Keys\n  async createApiKey(insertApiKey: InsertApiKey, customKeys?: { sitekey: string; secretkey: string }): Promise<ApiKey> {\n    const { siteKey, secretKey } = customKeys \n      ? { siteKey: customKeys.sitekey, secretKey: customKeys.secretkey }\n      : generateKeyPair();\n\n    const [apiKey] = await this.db\n      .insert(apiKeys)\n      .values({\n        developerId: insertApiKey.developerId,\n        name: insertApiKey.name,\n        sitekey: siteKey,\n        secretkey: secretKey,\n        domain: insertApiKey.domain || null,\n        theme: insertApiKey.theme || 'light',\n        isActive: insertApiKey.isActive ?? true,\n      })\n      .returning();\n\n    return apiKey;\n  }\n\n  async getApiKeysByDeveloper(developerId: string): Promise<ApiKey[]> {\n    return await this.db\n      .select()\n      .from(apiKeys)\n      .where(eq(apiKeys.developerId, developerId));\n  }\n\n  async getApiKey(id: string): Promise<ApiKey | undefined> {\n    const [apiKey] = await this.db\n      .select()\n      .from(apiKeys)\n      .where(eq(apiKeys.id, id))\n      .limit(1);\n\n    return apiKey;\n  }\n\n  async getApiKeyBySitekey(sitekey: string): Promise<ApiKey | undefined> {\n    const [apiKey] = await this.db\n      .select()\n      .from(apiKeys)\n      .where(eq(apiKeys.sitekey, sitekey))\n      .limit(1);\n\n    return apiKey;\n  }\n\n  async getApiKeyBySecretkey(secretkey: string): Promise<ApiKey | undefined> {\n    const [apiKey] = await this.db\n      .select()\n      .from(apiKeys)\n      .where(eq(apiKeys.secretkey, secretkey))\n      .limit(1);\n\n    return apiKey;\n  }\n\n  async getAllApiKeys(): Promise<ApiKey[]> {\n    return await this.db.select().from(apiKeys);\n  }\n\n  async updateApiKeyStatus(id: string, isActive: boolean): Promise<void> {\n    await this.db\n      .update(apiKeys)\n      .set({ isActive })\n      .where(eq(apiKeys.id, id));\n  }\n\n  async updateApiKeySettings(id: string, settings: any): Promise<void> {\n    await this.db\n      .update(apiKeys)\n      .set({ settings })\n      .where(eq(apiKeys.id, id));\n  }\n\n  async deleteApiKey(id: string): Promise<void> {\n    await this.db.delete(apiKeys).where(eq(apiKeys.id, id));\n  }\n\n  // Challenges\n  async createChallenge(insertChallenge: InsertChallenge): Promise<Challenge> {\n    const [challenge] = await this.db\n      .insert(challenges)\n      .values({\n        token: insertChallenge.token,\n        difficulty: insertChallenge.difficulty ?? 4,\n        challengeData: insertChallenge.challengeData,\n        type: insertChallenge.type,\n        apiKeyId: insertChallenge.apiKeyId || null,\n        validatedDomain: insertChallenge.validatedDomain,\n        signature: insertChallenge.signature,\n        isUsed: insertChallenge.isUsed ?? false,\n        expiresAt: insertChallenge.expiresAt,\n      })\n      .returning();\n\n    return challenge;\n  }\n\n  async getChallenge(id: string): Promise<Challenge | undefined> {\n    const [challenge] = await this.db\n      .select()\n      .from(challenges)\n      .where(eq(challenges.id, id))\n      .limit(1);\n\n    return challenge;\n  }\n\n  async getChallengeByToken(token: string): Promise<Challenge | undefined> {\n    const [challenge] = await this.db\n      .select()\n      .from(challenges)\n      .where(eq(challenges.token, token))\n      .limit(1);\n\n    return challenge;\n  }\n\n  async markChallengeAsUsed(id: string): Promise<boolean> {\n    const result = await this.db\n      .update(challenges)\n      .set({ isUsed: true })\n      .where(and(eq(challenges.id, id), eq(challenges.isUsed, false)))\n      .returning({ id: challenges.id });\n    \n    return result.length > 0;\n  }\n\n  async getAllChallenges(): Promise<Challenge[]> {\n    return await this.db.select().from(challenges);\n  }\n\n  async deleteChallenge(id: string): Promise<void> {\n    const hasVerifications = await this.db\n      .select({ id: verifications.id })\n      .from(verifications)\n      .where(eq(verifications.challengeId, id))\n      .limit(1);\n    \n    if (hasVerifications.length === 0) {\n      await this.db.delete(challenges).where(eq(challenges.id, id));\n    }\n  }\n\n  // Verifications\n  async createVerification(insertVerification: InsertVerification): Promise<Verification> {\n    const [verification] = await this.db\n      .insert(verifications)\n      .values({\n        challengeId: insertVerification.challengeId || null,\n        apiKeyId: insertVerification.apiKeyId || null,\n        success: insertVerification.success,\n        ipAddress: insertVerification.ipAddress || null,\n        userAgent: insertVerification.userAgent || null,\n        country: insertVerification.country || null,\n        countryName: insertVerification.countryName || null,\n        region: insertVerification.region || null,\n        city: insertVerification.city || null,\n        latitude: insertVerification.latitude || null,\n        longitude: insertVerification.longitude || null,\n        timezone: insertVerification.timezone || null,\n        timeToSolve: insertVerification.timeToSolve || null,\n        attemptData: insertVerification.attemptData || null,\n      })\n      .returning();\n\n    return verification;\n  }\n\n  async getVerificationsByApiKey(apiKeyId: string, limit: number = 100): Promise<Verification[]> {\n    return await this.db\n      .select()\n      .from(verifications)\n      .where(eq(verifications.apiKeyId, apiKeyId))\n      .orderBy(desc(verifications.createdAt))\n      .limit(limit);\n  }\n\n  async getRecentVerifications(limit: number = 100): Promise<Verification[]> {\n    return await this.db\n      .select()\n      .from(verifications)\n      .orderBy(desc(verifications.createdAt))\n      .limit(limit);\n  }\n\n  // Analytics\n  async createOrUpdateAnalytics(insertAnalytics: InsertAnalytics): Promise<Analytics> {\n    // Build the where condition to properly handle null apiKeyId\n    const apiKeyCondition = insertAnalytics.apiKeyId \n      ? eq(analytics.apiKeyId, insertAnalytics.apiKeyId)\n      : isNull(analytics.apiKeyId);\n    \n    const [existing] = await this.db\n      .select()\n      .from(analytics)\n      .where(\n        and(\n          apiKeyCondition,\n          eq(analytics.date, insertAnalytics.date)\n        )\n      )\n      .limit(1);\n\n    if (existing) {\n      const [updated] = await this.db\n        .update(analytics)\n        .set({\n          totalChallenges: insertAnalytics.totalChallenges,\n          successfulVerifications: insertAnalytics.successfulVerifications,\n          failedVerifications: insertAnalytics.failedVerifications,\n          averageTimeToSolve: insertAnalytics.averageTimeToSolve,\n          uniqueIps: insertAnalytics.uniqueIps,\n        })\n        .where(eq(analytics.id, existing.id))\n        .returning();\n\n      return updated;\n    }\n\n    const [newAnalytics] = await this.db\n      .insert(analytics)\n      .values({\n        apiKeyId: insertAnalytics.apiKeyId || null,\n        date: insertAnalytics.date,\n        totalChallenges: insertAnalytics.totalChallenges ?? 0,\n        successfulVerifications: insertAnalytics.successfulVerifications ?? 0,\n        failedVerifications: insertAnalytics.failedVerifications ?? 0,\n        averageTimeToSolve: insertAnalytics.averageTimeToSolve || null,\n        uniqueIps: insertAnalytics.uniqueIps ?? 0,\n      })\n      .returning();\n\n    return newAnalytics;\n  }\n\n  async getAnalyticsByApiKey(\n    apiKeyId: string,\n    startDate?: Date,\n    endDate?: Date\n  ): Promise<Analytics[]> {\n    const conditions = [eq(analytics.apiKeyId, apiKeyId)];\n\n    if (startDate) {\n      conditions.push(gte(analytics.date, startDate));\n    }\n    if (endDate) {\n      conditions.push(lte(analytics.date, endDate));\n    }\n\n    return await this.db\n      .select()\n      .from(analytics)\n      .where(and(...conditions));\n  }\n\n  async getAnalyticsByDateRange(startDate: Date, endDate: Date): Promise<Analytics[]> {\n    return await this.db\n      .select()\n      .from(analytics)\n      .where(and(gte(analytics.date, startDate), lte(analytics.date, endDate)));\n  }\n\n  /**\n   * Update analytics aggregates for today based on actual verification data\n   * This should be called after each verification\n   */\n  async updateDailyAnalytics(apiKeyId: string): Promise<void> {\n    const today = new Date();\n    today.setHours(0, 0, 0, 0);\n    \n    const tomorrow = new Date(today);\n    tomorrow.setDate(tomorrow.getDate() + 1);\n\n    // Get all verifications for today for this API key\n    const todayVerifications = await this.db\n      .select()\n      .from(verifications)\n      .where(\n        and(\n          eq(verifications.apiKeyId, apiKeyId),\n          gte(verifications.createdAt, today),\n          sql`${verifications.createdAt} < ${tomorrow}`\n        )\n      );\n\n    // Get all challenges created today for this API key\n    const todayChallenges = await this.db\n      .select({ id: challenges.id })\n      .from(challenges)\n      .where(\n        and(\n          eq(challenges.apiKeyId, apiKeyId),\n          gte(challenges.createdAt, today),\n          sql`${challenges.createdAt} < ${tomorrow}`\n        )\n      );\n\n    // Calculate aggregates\n    const totalChallenges = todayChallenges.length;\n    const successfulVerifications = todayVerifications.filter(v => v.success).length;\n    const failedVerifications = todayVerifications.filter(v => !v.success).length;\n    \n    // Calculate average time to solve (only from successful verifications)\n    const successfulWithTime = todayVerifications.filter(v => v.success && v.timeToSolve !== null);\n    const averageTimeToSolve = successfulWithTime.length > 0\n      ? Math.round(successfulWithTime.reduce((sum, v) => sum + (v.timeToSolve || 0), 0) / successfulWithTime.length)\n      : null;\n    \n    // Count unique IPs\n    const uniqueIpsSet = new Set(todayVerifications.map(v => v.ipAddress).filter(ip => ip !== null));\n    const uniqueIps = uniqueIpsSet.size;\n\n    // Update or create analytics record\n    await this.createOrUpdateAnalytics({\n      apiKeyId,\n      date: today,\n      totalChallenges,\n      successfulVerifications,\n      failedVerifications,\n      averageTimeToSolve,\n      uniqueIps,\n    });\n\n    console.log(`[ANALYTICS] Updated daily analytics for ${apiKeyId}: ${successfulVerifications}/${totalChallenges} successful, ${uniqueIps} unique IPs, avg ${averageTimeToSolve}ms`);\n  }\n\n  /**\n   * Update country analytics aggregates for today based on actual verification data\n   * This should be called after each verification\n   */\n  async updateDailyCountryAnalytics(apiKeyId: string): Promise<void> {\n    const today = new Date();\n    today.setHours(0, 0, 0, 0);\n    \n    const tomorrow = new Date(today);\n    tomorrow.setDate(tomorrow.getDate() + 1);\n\n    // Get all verifications for today for this API key\n    const todayVerifications = await this.db\n      .select()\n      .from(verifications)\n      .where(\n        and(\n          eq(verifications.apiKeyId, apiKeyId),\n          gte(verifications.createdAt, today),\n          sql`${verifications.createdAt} < ${tomorrow}`\n        )\n      );\n\n    // Group verifications by country\n    const countriesMap = new Map<string, {\n      country: string;\n      countryName: string;\n      verifications: typeof todayVerifications;\n    }>();\n\n    for (const verification of todayVerifications) {\n      const country = verification.country || 'Unknown';\n      const countryName = verification.countryName || 'Unknown';\n      \n      if (!countriesMap.has(country)) {\n        countriesMap.set(country, {\n          country,\n          countryName,\n          verifications: [],\n        });\n      }\n      countriesMap.get(country)!.verifications.push(verification);\n    }\n\n    // Update analytics for each country\n    for (const [country, data] of Array.from(countriesMap)) {\n      const totalVerifications = data.verifications.length;\n      const successfulVerifications = data.verifications.filter((v: any) => v.success).length;\n      const failedVerifications = data.verifications.filter((v: any) => !v.success).length;\n      \n      // Calculate average time to solve (only from successful verifications)\n      const successfulWithTime = data.verifications.filter((v: any) => v.success && v.timeToSolve !== null);\n      const averageTimeToSolve = successfulWithTime.length > 0\n        ? Math.round(successfulWithTime.reduce((sum: number, v: any) => sum + (v.timeToSolve || 0), 0) / successfulWithTime.length)\n        : null;\n      \n      // Count unique IPs\n      const uniqueIpsSet = new Set(data.verifications.map((v: any) => v.ipAddress).filter((ip: any) => ip !== null));\n      const uniqueIps = uniqueIpsSet.size;\n\n      // Update or create country analytics record\n      await this.createOrUpdateCountryAnalytics({\n        apiKeyId,\n        country: data.country,\n        countryName: data.countryName,\n        date: today,\n        totalVerifications,\n        successfulVerifications,\n        failedVerifications,\n        averageTimeToSolve,\n        uniqueIps,\n      });\n\n      console.log(`[ANALYTICS] Updated country analytics for ${apiKeyId} - ${data.countryName} (${data.country}): ${successfulVerifications}/${totalVerifications} successful, ${uniqueIps} unique IPs`);\n    }\n  }\n\n  // Country Analytics\n  async createOrUpdateCountryAnalytics(insertCountryAnalytics: InsertCountryAnalytics): Promise<CountryAnalytics> {\n    const existing = await this.db\n      .select()\n      .from(countryAnalytics)\n      .where(\n        and(\n          eq(countryAnalytics.apiKeyId, insertCountryAnalytics.apiKeyId || ''),\n          eq(countryAnalytics.country, insertCountryAnalytics.country),\n          sql`DATE(${countryAnalytics.date}) = DATE(${insertCountryAnalytics.date})`\n        )\n      )\n      .limit(1);\n\n    if (existing.length > 0) {\n      const [updated] = await this.db\n        .update(countryAnalytics)\n        .set({\n          totalVerifications: insertCountryAnalytics.totalVerifications,\n          successfulVerifications: insertCountryAnalytics.successfulVerifications,\n          failedVerifications: insertCountryAnalytics.failedVerifications,\n          averageTimeToSolve: insertCountryAnalytics.averageTimeToSolve,\n          uniqueIps: insertCountryAnalytics.uniqueIps,\n        })\n        .where(eq(countryAnalytics.id, existing[0].id))\n        .returning();\n\n      return updated;\n    }\n\n    const [newCountryAnalytics] = await this.db\n      .insert(countryAnalytics)\n      .values({\n        apiKeyId: insertCountryAnalytics.apiKeyId,\n        country: insertCountryAnalytics.country,\n        countryName: insertCountryAnalytics.countryName,\n        date: insertCountryAnalytics.date,\n        totalVerifications: insertCountryAnalytics.totalVerifications ?? 0,\n        successfulVerifications: insertCountryAnalytics.successfulVerifications ?? 0,\n        failedVerifications: insertCountryAnalytics.failedVerifications ?? 0,\n        averageTimeToSolve: insertCountryAnalytics.averageTimeToSolve || null,\n        uniqueIps: insertCountryAnalytics.uniqueIps ?? 0,\n      })\n      .returning();\n\n    return newCountryAnalytics;\n  }\n\n  async getCountryAnalyticsByApiKey(\n    apiKeyId: string,\n    startDate?: Date,\n    endDate?: Date\n  ): Promise<CountryAnalytics[]> {\n    const conditions = [eq(countryAnalytics.apiKeyId, apiKeyId)];\n\n    if (startDate) {\n      conditions.push(gte(countryAnalytics.date, startDate));\n    }\n    if (endDate) {\n      conditions.push(lte(countryAnalytics.date, endDate));\n    }\n\n    return await this.db\n      .select()\n      .from(countryAnalytics)\n      .where(and(...conditions))\n      .orderBy(desc(countryAnalytics.totalVerifications));\n  }\n\n  async getCountryAnalyticsSummary(apiKeyId?: string, limit: number = 20): Promise<CountryAnalytics[]> {\n    let query = this.db\n      .select({\n        id: sql`MAX(${countryAnalytics.id})`.as('id'),\n        apiKeyId: countryAnalytics.apiKeyId,\n        country: countryAnalytics.country,\n        countryName: sql`MAX(${countryAnalytics.countryName})`.as('countryName'),\n        date: sql`MAX(${countryAnalytics.date})`.as('date'),\n        totalVerifications: sql<number>`SUM(${countryAnalytics.totalVerifications})`.as('totalVerifications'),\n        successfulVerifications: sql<number>`SUM(${countryAnalytics.successfulVerifications})`.as('successfulVerifications'),\n        failedVerifications: sql<number>`SUM(${countryAnalytics.failedVerifications})`.as('failedVerifications'),\n        averageTimeToSolve: sql<number>`AVG(${countryAnalytics.averageTimeToSolve})`.as('averageTimeToSolve'),\n        uniqueIps: sql<number>`SUM(${countryAnalytics.uniqueIps})`.as('uniqueIps'),\n      })\n      .from(countryAnalytics)\n      .groupBy(countryAnalytics.country, countryAnalytics.apiKeyId);\n\n    if (apiKeyId) {\n      query = query.where(eq(countryAnalytics.apiKeyId, apiKeyId)) as any;\n    }\n\n    const results = await query\n      .orderBy(desc(sql`SUM(${countryAnalytics.totalVerifications})`))\n      .limit(limit);\n\n    return results as CountryAnalytics[];\n  }\n}\n","size_bytes":20180},"server/migrate.ts":{"content":"import { drizzle } from \"drizzle-orm/neon-serverless\";\nimport { migrate } from \"drizzle-orm/neon-serverless/migrator\";\nimport { Pool, neonConfig } from \"@neondatabase/serverless\";\nimport ws from \"ws\";\n\nexport async function runMigrations(): Promise<void> {\n  if (!process.env.DATABASE_URL) {\n    console.log('[MIGRATE] No DATABASE_URL found, skipping migrations');\n    return;\n  }\n\n  console.log('[MIGRATE] Running database migrations...');\n  console.log('[MIGRATE] DATABASE_URL configured, connecting to database...');\n  \n  neonConfig.webSocketConstructor = ws;\n  const pool = new Pool({ connectionString: process.env.DATABASE_URL });\n  const db = drizzle({ client: pool });\n\n  try {\n    await migrate(db, { migrationsFolder: './migrations' });\n    console.log('[MIGRATE] Database migrations completed successfully');\n  } catch (error: any) {\n    console.error('[MIGRATE] Migration failed:', error?.message || error);\n    throw error;\n  } finally {\n    await pool.end();\n  }\n}\n","size_bytes":978},"shared/schema.ts":{"content":"import { sql } from \"drizzle-orm\";\nimport { pgTable, text, varchar, timestamp, integer, boolean, jsonb } from \"drizzle-orm/pg-core\";\nimport { createInsertSchema } from \"drizzle-zod\";\nimport { z } from \"zod\";\n\n// Developers table - untuk autentikasi developer\nexport const developers = pgTable(\"developers\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  email: text(\"email\").notNull().unique(),\n  password: text(\"password\").notNull(), // hashed password\n  name: text(\"name\").notNull(),\n  isEmailVerified: boolean(\"is_email_verified\").notNull().default(false),\n  verificationCode: text(\"verification_code\"),\n  verificationCodeExpiry: timestamp(\"verification_code_expiry\"),\n  resetPasswordCode: text(\"reset_password_code\"),\n  resetPasswordCodeExpiry: timestamp(\"reset_password_code_expiry\"),\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n});\n\n// API Keys table - untuk autentikasi aplikasi yang menggunakan CAPTCHA\nexport const apiKeys = pgTable(\"api_keys\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  developerId: varchar(\"developer_id\").references(() => developers.id).notNull(),\n  name: text(\"name\").notNull(), // nama aplikasi/website\n  sitekey: text(\"sitekey\").notNull().unique(),\n  secretkey: text(\"secretkey\").notNull().unique(),\n  domain: text(\"domain\"), // domain yang diizinkan (optional)\n  theme: text(\"theme\").notNull().default('light'), // tema captcha: light, dark, auto\n  settings: jsonb(\"settings\"), // konfigurasi keamanan dan desain per API key\n  isActive: boolean(\"is_active\").notNull().default(true),\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n});\n\n// Challenges table - menyimpan challenge yang di-generate\nexport const challenges = pgTable(\"challenges\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  token: text(\"token\").notNull().unique(), // JWT token untuk challenge\n  difficulty: integer(\"difficulty\").notNull().default(4), // level kesulitan proof-of-work\n  challengeData: jsonb(\"challenge_data\").notNull(), // data challenge (nonce, target, dll)\n  type: text(\"type\").notNull(), // 'grid', 'jigsaw', 'gesture', atau 'upside_down'\n  apiKeyId: varchar(\"api_key_id\").references(() => apiKeys.id),\n  validatedDomain: text(\"validated_domain\").notNull(), // domain yang tervalidasi saat challenge dibuat\n  signature: text(\"signature\").notNull(), // HMAC signature untuk mencegah replay attack\n  sessionFingerprint: varchar(\"session_fingerprint\", { length: 64 }), // session fingerprint untuk binding\n  isUsed: boolean(\"is_used\").notNull().default(false),\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n  expiresAt: timestamp(\"expires_at\").notNull(),\n});\n\n// Verifications table - log semua verifikasi attempt\nexport const verifications = pgTable(\"verifications\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  challengeId: varchar(\"challenge_id\").references(() => challenges.id),\n  apiKeyId: varchar(\"api_key_id\").references(() => apiKeys.id),\n  success: boolean(\"success\").notNull(),\n  ipAddress: text(\"ip_address\"),\n  userAgent: text(\"user_agent\"),\n  country: text(\"country\"), // kode negara ISO (e.g., \"US\", \"ID\")\n  countryName: text(\"country_name\"), // nama lengkap negara\n  region: text(\"region\"), // region/state\n  city: text(\"city\"), // nama kota\n  latitude: text(\"latitude\"), // koordinat latitude\n  longitude: text(\"longitude\"), // koordinat longitude\n  timezone: text(\"timezone\"), // timezone\n  timeToSolve: integer(\"time_to_solve\"), // dalam milidetik\n  attemptData: jsonb(\"attempt_data\"), // data tambahan untuk analytics\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n});\n\n// Analytics agregat - untuk dashboard performa\nexport const analytics = pgTable(\"analytics\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  apiKeyId: varchar(\"api_key_id\").references(() => apiKeys.id),\n  date: timestamp(\"date\").notNull(),\n  totalChallenges: integer(\"total_challenges\").notNull().default(0),\n  successfulVerifications: integer(\"successful_verifications\").notNull().default(0),\n  failedVerifications: integer(\"failed_verifications\").notNull().default(0),\n  averageTimeToSolve: integer(\"average_time_to_solve\"), // dalam milidetik\n  uniqueIps: integer(\"unique_ips\").notNull().default(0),\n});\n\n// Country Analytics - analytics per negara\nexport const countryAnalytics = pgTable(\"country_analytics\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  apiKeyId: varchar(\"api_key_id\").references(() => apiKeys.id),\n  country: text(\"country\").notNull(), // kode negara ISO\n  countryName: text(\"country_name\").notNull(), // nama lengkap negara\n  date: timestamp(\"date\").notNull(),\n  totalVerifications: integer(\"total_verifications\").notNull().default(0),\n  successfulVerifications: integer(\"successful_verifications\").notNull().default(0),\n  failedVerifications: integer(\"failed_verifications\").notNull().default(0),\n  averageTimeToSolve: integer(\"average_time_to_solve\"), // dalam milidetik\n  uniqueIps: integer(\"unique_ips\").notNull().default(0),\n});\n\n// Insert schemas\nexport const insertDeveloperSchema = createInsertSchema(developers).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertApiKeySchema = createInsertSchema(apiKeys).omit({\n  id: true,\n  sitekey: true,\n  secretkey: true,\n  createdAt: true,\n});\n\nexport const insertChallengeSchema = createInsertSchema(challenges).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertVerificationSchema = createInsertSchema(verifications).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertAnalyticsSchema = createInsertSchema(analytics).omit({\n  id: true,\n});\n\nexport const insertCountryAnalyticsSchema = createInsertSchema(countryAnalytics).omit({\n  id: true,\n});\n\n// Types\nexport type InsertDeveloper = z.infer<typeof insertDeveloperSchema>;\nexport type Developer = typeof developers.$inferSelect;\n\nexport type InsertApiKey = z.infer<typeof insertApiKeySchema>;\nexport type ApiKey = typeof apiKeys.$inferSelect;\n\nexport type InsertChallenge = z.infer<typeof insertChallengeSchema>;\nexport type Challenge = typeof challenges.$inferSelect;\n\nexport type InsertVerification = z.infer<typeof insertVerificationSchema>;\nexport type Verification = typeof verifications.$inferSelect;\n\nexport type InsertAnalytics = z.infer<typeof insertAnalyticsSchema>;\nexport type Analytics = typeof analytics.$inferSelect;\n\nexport type InsertCountryAnalytics = z.infer<typeof insertCountryAnalyticsSchema>;\nexport type CountryAnalytics = typeof countryAnalytics.$inferSelect;\n\n// Security Settings Schema and Types\n// IMPORTANT: This schema contains CONFIGURABLE security features only\n// \n// The following security features are ALWAYS ENFORCED server-side and CANNOT be disabled:\n// - Domain Validation: Always validates requests against allowed domains\n// - End-to-End Encryption: Always active via EncryptionManager (progressive enhancement)\n// \n// These core security features are not included in this schema because they are\n// fundamental protections that must never be turned off.\nexport const securitySettingsSchema = z.object({\n  // Security Features (Configurable)\n  antiDebugger: z.boolean().default(true),\n  advancedFingerprinting: z.boolean().default(true),\n  sessionBinding: z.boolean().default(true),\n  csrfProtection: z.boolean().default(true),\n  ipRateLimiting: z.boolean().default(true),\n  automationDetection: z.boolean().default(true),\n  behavioralAnalysis: z.boolean().default(true),\n  riskAdaptiveDifficulty: z.boolean().default(true),\n  \n  // IP and Country Blocking\n  blockedIps: z.array(z.string()).default([]), // Array of blocked IP addresses (CIDR notation supported)\n  blockedCountries: z.array(z.string()).default([]), // Array of blocked country codes (ISO 3166-1 alpha-2)\n  \n  // Proof of Work\n  proofOfWorkDifficulty: z.number().min(1).max(10).default(4),\n  \n  // Rate Limiting Configuration\n  rateLimitWindowMs: z.number().min(1000).max(3600000).default(60000), // 1s to 1h\n  rateLimitMaxRequests: z.number().min(1).max(1000).default(30),\n  \n  // Timeouts\n  challengeTimeoutMs: z.number().min(10000).max(300000).default(60000), // 10s to 5min\n  tokenExpiryMs: z.number().min(30000).max(600000).default(60000), // 30s to 10min\n  \n  // Challenge Types\n  enabledChallengeTypes: z.array(z.enum(['grid', 'jigsaw', 'gesture', 'upside_down'])).default(['grid', 'jigsaw', 'gesture', 'upside_down']),\n});\n\nexport type SecuritySettings = z.infer<typeof securitySettingsSchema>;\n\n// Default security settings - semua fitur enabled\nexport const DEFAULT_SECURITY_SETTINGS: SecuritySettings = {\n  antiDebugger: true,\n  advancedFingerprinting: true,\n  sessionBinding: true,\n  csrfProtection: true,\n  ipRateLimiting: true,\n  automationDetection: true,\n  behavioralAnalysis: true,\n  riskAdaptiveDifficulty: true,\n  blockedIps: [],\n  blockedCountries: [],\n  proofOfWorkDifficulty: 4,\n  rateLimitWindowMs: 60000,\n  rateLimitMaxRequests: 30,\n  challengeTimeoutMs: 60000,\n  tokenExpiryMs: 60000,\n  enabledChallengeTypes: ['grid', 'jigsaw', 'gesture', 'upside_down'],\n};\n","size_bytes":9059},"client/src/components/ui/checkbox.tsx":{"content":"import * as React from \"react\"\nimport * as CheckboxPrimitive from \"@radix-ui/react-checkbox\"\nimport { Check } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Checkbox = React.forwardRef<\n  React.ElementRef<typeof CheckboxPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <CheckboxPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground\",\n      className\n    )}\n    {...props}\n  >\n    <CheckboxPrimitive.Indicator\n      className={cn(\"flex items-center justify-center text-current\")}\n    >\n      <Check className=\"h-4 w-4\" />\n    </CheckboxPrimitive.Indicator>\n  </CheckboxPrimitive.Root>\n))\nCheckbox.displayName = CheckboxPrimitive.Root.displayName\n\nexport { Checkbox }\n","size_bytes":1056},"server/routes.ts":{"content":"import type { Express, Request, Response, NextFunction } from \"express\";\nimport { createServer, type Server } from \"http\";\nimport { storage } from \"./storage\";\nimport { z } from \"zod\";\nimport jwt from \"jsonwebtoken\";\nimport { nanoid } from \"nanoid\";\nimport rateLimit from \"express-rate-limit\";\nimport crypto from \"crypto\";\nimport bcrypt from \"bcryptjs\";\nimport path from \"path\";\nimport { readFile } from \"fs/promises\";\nimport { detectAutomation } from \"./automation-detector\";\nimport { ipBlocker } from \"./ip-blocker\";\nimport { generateChallengeSignature, verifyChallengeSignature, extractDomainFromRequest, createVerificationToken, verifyVerificationToken, normalizeDomain, getServerOrigin } from \"./crypto-utils\";\nimport { generateDeviceFingerprint, trackDeviceFingerprint } from \"./device-fingerprint\";\nimport { calculateRiskScore, calculateAdaptiveDifficulty } from \"./risk-scoring\";\nimport { analyzeBehavior } from \"./behavioral-analysis\";\nimport { markChallengeAsUsed, isChallengeUsed } from \"./challenge-tracker\";\nimport { securityMonitor } from \"./security-monitor\";\nimport { checkChallengeExpiration, DEFAULT_EXPIRATION_CONFIG } from \"./enhancements/token-expiration\";\nimport { generateSessionFingerprint, verifySessionBinding, DEFAULT_SESSION_BINDING_CONFIG } from \"./enhancements/session-binding\";\nimport { csrfMiddleware, createCSRFCookie, verifyCSRFToken, getCSRFToken } from \"./enhancements/csrf-protection\";\nimport { generateAdvancedFingerprint, compareFingerprints, type AdvancedFingerprint } from \"./enhancements/advanced-fingerprint\";\nimport { checkEnhancedHoneypot, ENHANCED_HONEYPOT_CONFIG } from \"./enhancements/enhanced-honeypot\";\nimport { sessionCache } from \"./session-cache\";\nimport { \n  generateServerKeyPair,\n  deriveSharedSecret,\n  deriveMasterKey,\n  signHandshakeTranscript,\n  encryptChallengeData,\n  encryptSecurityConfig,\n  decryptSolutionData,\n  decryptVerificationMetadata,\n  type HandshakeResponse,\n  type EncryptedPayload\n} from \"./encryption\";\nimport { generateUpsideDownChallenge, validateUpsideDownSolution, type UpsideDownChallengeData } from \"./upside-down-generator\";\nimport { getGeolocationFromIP } from \"./geolocation\";\nimport { securitySettingsSchema, DEFAULT_SECURITY_SETTINGS, type SecuritySettings } from \"@shared/schema\";\nimport { emailService } from \"./email-service\";\n\nconst JWT_SECRET = process.env.SESSION_SECRET;\n\nif (!JWT_SECRET) {\n  throw new Error(\n    \"CRITICAL SECURITY ERROR: SESSION_SECRET environment variable is required. \" +\n    \"Set a strong random secret in your .env file to enable JWT token signing.\"\n  );\n}\n\n/**\n * SECURITY FIX Bug #6: Per-API-key rate limiting for /api/captcha/handshake\n * Tracks handshake requests per API key to prevent abuse\n * Format: Map<apiKeyId, { count: number, windowStart: number }>\n */\nconst perApiKeyHandshakeRateLimits = new Map<string, { count: number; windowStart: number }>();\n\n// Cleanup expired rate limit entries every 60 seconds\nsetInterval(() => {\n  const now = Date.now();\n  const windowMs = 60000; // 1 minute window\n  \n  for (const [key, data] of perApiKeyHandshakeRateLimits.entries()) {\n    if (now - data.windowStart > windowMs) {\n      perApiKeyHandshakeRateLimits.delete(key);\n    }\n  }\n}, 60000);\n\nfunction requireAuth(req: Request, res: Response, next: NextFunction) {\n  if (!req.session.developerId) {\n    return res.status(401).json({ error: \"Unauthorized\", message: \"Please login first\" });\n  }\n  next();\n}\n\n/**\n * SECURITY: Constant-time array comparison to prevent timing attacks\n * Compares two arrays element-by-element in constant time\n */\nfunction constantTimeArrayEqual(arr1: number[], arr2: number[]): boolean {\n  if (arr1.length !== arr2.length) {\n    return false;\n  }\n  \n  let result = 0;\n  for (let i = 0; i < arr1.length; i++) {\n    result |= arr1[i] ^ arr2[i];\n  }\n  \n  return result === 0;\n}\n\n/**\n * SECURITY: Constant-time position comparison for gesture challenges\n * Prevents timing attacks that could leak target position\n */\nfunction constantTimePositionMatch(\n  submitted: { x: number; y: number },\n  target: { x: number; y: number },\n  tolerance: number\n): boolean {\n  const dx = submitted.x - target.x;\n  const dy = submitted.y - target.y;\n  const distanceSquared = dx * dx + dy * dy;\n  const toleranceSquared = tolerance * tolerance;\n  \n  // Constant time comparison: always compute full distance\n  return distanceSquared <= toleranceSquared;\n}\n\nasync function requireVerifiedEmail(req: Request, res: Response, next: NextFunction) {\n  if (!req.session.developerId) {\n    return res.status(401).json({ error: \"Unauthorized\", message: \"Please login first\" });\n  }\n  \n  const developer = await storage.getDeveloperById(req.session.developerId);\n  if (!developer) {\n    return res.status(401).json({ error: \"Unauthorized\", message: \"Account not found\" });\n  }\n  \n  if (!developer.isEmailVerified) {\n    return res.status(403).json({ \n      error: \"Email not verified\", \n      message: \"Please verify your email before accessing this resource\",\n      requiresVerification: true\n    });\n  }\n  \n  next();\n}\n\n// Rate limiter untuk challenge generation\nconst challengeLimiter = rateLimit({\n  windowMs: 60 * 1000, // 1 menit\n  max: 30, // maksimal 30 request per menit\n  message: \"Too many challenge requests, please try again later\",\n});\n\n// Rate limiter untuk verification\nconst verifyLimiter = rateLimit({\n  windowMs: 60 * 1000, // 1 menit\n  max: 60, // maksimal 60 request per menit\n  message: \"Too many verification requests, please try again later\",\n});\n\n// Rate limiter untuk handshake\nconst handshakeLimiter = rateLimit({\n  windowMs: 60 * 1000, // 1 menit\n  max: 20, // maksimal 20 handshake per menit\n  message: \"Too many handshake requests, please try again later\",\n});\n\n// ALTCHA-style Proof-of-work utilities\n// More efficient than traditional POW - uses exact hash matching instead of prefix search\n\n/**\n * Calculate maxNumber based on difficulty level\n * Uses exponential growth formula for scalable difficulty\n * \n * Formula: maxNumber = baseNumber * (growthFactor ^ (difficulty - 1))\n * \n * @param difficulty - Difficulty level (1-10)\n * @returns maxNumber - Maximum search space for POW\n */\nfunction calculateMaxNumber(difficulty: number): number {\n  // Clamp difficulty to valid range\n  const clampedDifficulty = Math.max(1, Math.min(difficulty, 10));\n  \n  // Base configuration\n  const baseNumber = 50;        // Starting point for difficulty 1\n  const growthFactor = 2;       // Exponential growth factor\n  \n  // Exponential formula: 50 * (2 ^ (difficulty - 1))\n  // Difficulty 1: 50\n  // Difficulty 2: 100\n  // Difficulty 3: 200\n  // Difficulty 4: 400\n  // Difficulty 5: 800\n  // Difficulty 6: 1,600\n  // Difficulty 7: 3,200\n  // Difficulty 8: 6,400\n  // Difficulty 9: 12,800\n  // Difficulty 10: 25,600\n  const maxNumber = baseNumber * Math.pow(growthFactor, clampedDifficulty - 1);\n  \n  return Math.floor(maxNumber);\n}\n\n/**\n * SECURITY FIX Bug #3: Enhanced HMAC binding with contextual data\n * Binds signature to challenge context (timestamp, nonce, apiKey, fingerprint)\n * to prevent replay/tampering attacks\n */\nfunction generateChallenge(\n  difficulty: number, \n  context?: { timestamp?: number; nonce?: string; apiKey?: string; fingerprint?: string }\n) {\n  // Generate random salt (ALTCHA approach)\n  const salt = nanoid(32);\n  const timestamp = context?.timestamp || Date.now();\n  const nonce = context?.nonce || nanoid(16);\n  \n  // Calculate max number dynamically based on difficulty\n  const maxNumber = calculateMaxNumber(difficulty);\n  \n  // SECURITY FIX: Generate secret number using cryptographically secure random\n  // crypto.randomInt() prevents prediction attacks unlike Math.random()\n  const secretNumber = crypto.randomInt(0, maxNumber);\n  \n  // Create challenge hash: SHA256(salt + secretNumber)\n  const challengeHash = crypto\n    .createHash(\"sha256\")\n    .update(salt + secretNumber.toString())\n    .digest(\"hex\");\n  \n  // SECURITY FIX Bug #3: Enhanced HMAC signature with context binding\n  // Include: challengeHash, salt, maxNumber, timestamp, nonce, apiKey (if available), fingerprint (if available)\n  const hmacKey = JWT_SECRET;\n  const signatureData = [\n    challengeHash,\n    salt,\n    maxNumber.toString(),\n    timestamp.toString(),\n    nonce,\n    context?.apiKey || '',\n    context?.fingerprint || ''\n  ].join('|');\n  \n  const signature = crypto\n    .createHmac(\"sha256\", hmacKey)\n    .update(signatureData)\n    .digest(\"hex\");\n\n  return {\n    salt,\n    timestamp,\n    nonce,\n    difficulty,\n    maxNumber,\n    challengeHash,\n    secretNumber, // Store this server-side only, don't send to client\n    signature,\n    apiKey: context?.apiKey, // Include in return for verification\n    fingerprint: context?.fingerprint, // Include in return for verification\n  };\n}\n\n/**\n * SECURITY FIX Bug #3: Enhanced HMAC verification with context binding\n */\nfunction verifyProofOfWork(challenge: any, solution: number | string): boolean {\n  const { salt, challengeHash, signature, maxNumber, timestamp, nonce, apiKey, fingerprint } = challenge;\n  \n  // Convert solution to number if it's a string\n  const solutionNumber = typeof solution === 'string' ? parseInt(solution, 10) : solution;\n  \n  // Validate solution is a valid number\n  if (isNaN(solutionNumber)) {\n    console.error(\"[ALTCHA] Invalid solution: not a number\");\n    return false;\n  }\n  \n  // SECURITY FIX Bug #3: Verify enhanced HMAC signature with context binding\n  // Must match the same signature data format used during generation\n  const hmacKey = JWT_SECRET;\n  const signatureData = [\n    challengeHash,\n    salt,\n    maxNumber.toString(),\n    (timestamp || 0).toString(),\n    nonce || '',\n    apiKey || '',\n    fingerprint || ''\n  ].join('|');\n  \n  const expectedSignature = crypto\n    .createHmac(\"sha256\", hmacKey)\n    .update(signatureData)\n    .digest(\"hex\");\n  \n  if (signature !== expectedSignature) {\n    console.error(\"[ALTCHA] Invalid signature - possible tampering detected\");\n    return false;\n  }\n  \n  // Verify the solution: SHA256(salt + solution) should equal challengeHash\n  const solutionHash = crypto\n    .createHash(\"sha256\")\n    .update(salt + solutionNumber.toString())\n    .digest(\"hex\");\n\n  return solutionHash === challengeHash;\n}\n\nexport async function registerRoutes(app: Express): Promise<Server> {\n  // ==================== AUTHENTICATION ENDPOINTS ====================\n\n  app.post(\"/api/auth/register\", async (req: Request, res: Response) => {\n    try {\n      const honeypotCheck = checkEnhancedHoneypot(req, ENHANCED_HONEYPOT_CONFIG);\n      if (honeypotCheck.shouldBlock) {\n        console.log(`[HONEYPOT] Bot detected in registration: ${honeypotCheck.details.join(', ')}`);\n        const clientIP = ipBlocker.getClientIP(req);\n        ipBlocker.recordFailedAttempt(clientIP);\n        return res.status(403).json({ \n          error: \"Security check failed\",\n          message: \"Suspicious activity detected\"\n        });\n      }\n\n      const schema = z.object({\n        email: z.string().email(\"Invalid email address\"),\n        password: z.string().min(8, \"Password must be at least 8 characters\"),\n        name: z.string().min(1, \"Name is required\"),\n        captchaToken: z.string().min(1, \"CAPTCHA token is required\"),\n      });\n\n      const data = schema.parse(req.body);\n      \n      // Get demo API key to decode verification token\n      const demoDeveloper = await storage.getDeveloperByEmail(\"demo@proofcaptcha.local\");\n      if (!demoDeveloper) {\n        return res.status(500).json({\n          error: \"System error\",\n          message: \"Demo key not configured\",\n        });\n      }\n\n      const apiKeys = await storage.getApiKeysByDeveloper(demoDeveloper.id);\n      const demoKey = apiKeys.find(k => k.name === \"Demo Application\");\n      if (!demoKey) {\n        return res.status(500).json({\n          error: \"System error\",\n          message: \"Demo key not found\",\n        });\n      }\n\n      // Decode verification token (not challenge token)\n      const decoded = verifyVerificationToken(data.captchaToken, demoKey.secretkey);\n      if (!decoded) {\n        return res.status(400).json({\n          error: \"Invalid CAPTCHA\",\n          message: \"CAPTCHA verification failed. Please try again.\",\n        });\n      }\n\n      // Get the challenge that was verified\n      const challenge = await storage.getChallenge(decoded.challengeId);\n      if (!challenge) {\n        return res.status(400).json({\n          error: \"Invalid CAPTCHA\",\n          message: \"CAPTCHA verification failed. Please try again.\",\n        });\n      }\n\n      const expirationCheck = checkChallengeExpiration(challenge.createdAt, DEFAULT_EXPIRATION_CONFIG);\n      if (!expirationCheck.isValid) {\n        return res.status(400).json({\n          error: \"Invalid CAPTCHA\",\n          message: expirationCheck.message || \"CAPTCHA expired. Please try again.\",\n        });\n      }\n      \n      if (!challenge.isUsed) {\n        return res.status(400).json({\n          error: \"CAPTCHA not verified\",\n          message: \"Please complete the CAPTCHA challenge first.\",\n        });\n      }\n\n      // Check verification token replay using the same tracker\n      const verificationTokenId = `vt_${decoded.challengeId}_${decoded.nonce}`;\n      if (isChallengeUsed(verificationTokenId)) {\n        console.log(`[SECURITY] Verification token replay attack detected in register: ${verificationTokenId}`);\n        return res.status(400).json({\n          error: \"Invalid CAPTCHA\",\n          message: \"CAPTCHA token already used. Please try again.\",\n        });\n      }\n      \n      // Mark verification token as used to prevent replay\n      markChallengeAsUsed(verificationTokenId);\n      \n      // Note: Challenge is already marked as used, preventing reuse\n      // It will be cleaned up by automated cleanup task\n      console.log(`[SECURITY] CAPTCHA token validated for registration: ${data.email}`);\n      \n      const existingDeveloper = await storage.getDeveloperByEmail(data.email);\n      if (existingDeveloper) {\n        return res.status(400).json({\n          error: \"Email already registered\",\n          message: \"An account with this email already exists\",\n        });\n      }\n\n      const hashedPassword = await bcrypt.hash(data.password, 10);\n      \n      // SECURITY FIX: Generate 6-digit verification code using crypto.randomInt\n      const verificationCode = crypto.randomInt(100000, 1000000).toString();\n      const verificationCodeExpiry = new Date(Date.now() + 15 * 60 * 1000); // 15 minutes\n      \n      const developer = await storage.createDeveloper({\n        email: data.email,\n        password: hashedPassword,\n        name: data.name,\n        isEmailVerified: false,\n        verificationCode,\n        verificationCodeExpiry,\n      });\n\n      // Send verification email\n      const emailSent = await emailService.sendVerificationEmail(\n        developer.email,\n        verificationCode,\n        developer.name\n      );\n\n      if (!emailSent) {\n        console.error('[REGISTER] Failed to send verification email');\n      }\n\n      // Store developer ID in session but don't mark as fully authenticated\n      req.session.developerId = developer.id;\n      req.session.isEmailVerified = false;\n\n      res.json({\n        success: true,\n        requiresVerification: true,\n        developer: {\n          id: developer.id,\n          email: developer.email,\n          name: developer.name,\n          isEmailVerified: false,\n        },\n      });\n    } catch (error: any) {\n      console.error(\"Registration error:\", error);\n      res.status(400).json({ \n        error: \"Registration failed\",\n        message: error.message || \"Failed to create account\"\n      });\n    }\n  });\n\n  // Verify email with code\n  app.post(\"/api/auth/verify-email\", async (req: Request, res: Response) => {\n    try {\n      if (!req.session.developerId) {\n        return res.status(401).json({\n          error: \"Unauthorized\",\n          message: \"Please login first\",\n        });\n      }\n\n      const schema = z.object({\n        code: z.string().length(6, \"Verification code must be 6 digits\"),\n      });\n\n      const data = schema.parse(req.body);\n\n      const developer = await storage.getDeveloperById(req.session.developerId);\n      if (!developer) {\n        return res.status(404).json({\n          error: \"Developer not found\",\n          message: \"Account not found\",\n        });\n      }\n\n      if (developer.isEmailVerified) {\n        return res.status(400).json({\n          error: \"Already verified\",\n          message: \"Email is already verified\",\n        });\n      }\n\n      if (!developer.verificationCode || !developer.verificationCodeExpiry) {\n        return res.status(400).json({\n          error: \"No verification code\",\n          message: \"No verification code found. Please request a new one.\",\n        });\n      }\n\n      // Check if code expired\n      if (new Date() > developer.verificationCodeExpiry) {\n        return res.status(400).json({\n          error: \"Code expired\",\n          message: \"Verification code has expired. Please request a new one.\",\n        });\n      }\n\n      // Verify code\n      if (data.code !== developer.verificationCode) {\n        return res.status(400).json({\n          error: \"Invalid code\",\n          message: \"Verification code is incorrect\",\n        });\n      }\n\n      // Mark as verified\n      await storage.verifyDeveloperEmail(developer.id);\n      req.session.isEmailVerified = true;\n\n      res.json({\n        success: true,\n        message: \"Email verified successfully\",\n      });\n    } catch (error: any) {\n      console.error(\"Email verification error:\", error);\n      res.status(400).json({\n        error: \"Verification failed\",\n        message: error.message || \"Failed to verify email\",\n      });\n    }\n  });\n\n  // Resend verification code\n  app.post(\"/api/auth/resend-verification\", async (req: Request, res: Response) => {\n    try {\n      if (!req.session.developerId) {\n        return res.status(401).json({\n          error: \"Unauthorized\",\n          message: \"Please login first\",\n        });\n      }\n\n      const developer = await storage.getDeveloperById(req.session.developerId);\n      if (!developer) {\n        return res.status(404).json({\n          error: \"Developer not found\",\n          message: \"Account not found\",\n        });\n      }\n\n      if (developer.isEmailVerified) {\n        return res.status(400).json({\n          error: \"Already verified\",\n          message: \"Email is already verified\",\n        });\n      }\n\n      // SECURITY FIX: Generate new verification code using crypto.randomInt\n      const verificationCode = crypto.randomInt(100000, 1000000).toString();\n      const verificationCodeExpiry = new Date(Date.now() + 15 * 60 * 1000); // 15 minutes\n\n      await storage.updateVerificationCode(developer.id, verificationCode, verificationCodeExpiry);\n\n      // Send verification email\n      const emailSent = await emailService.sendVerificationEmail(\n        developer.email,\n        verificationCode,\n        developer.name\n      );\n\n      if (!emailSent) {\n        return res.status(500).json({\n          error: \"Email failed\",\n          message: \"Failed to send verification email. Please try again.\",\n        });\n      }\n\n      res.json({\n        success: true,\n        message: \"Verification code sent to your email\",\n      });\n    } catch (error: any) {\n      console.error(\"Resend verification error:\", error);\n      res.status(400).json({\n        error: \"Resend failed\",\n        message: error.message || \"Failed to resend verification code\",\n      });\n    }\n  });\n\n  // In-memory reset token storage\n  const resetTokens = new Map<string, { email: string; expiry: Date }>();\n\n  // Cleanup expired tokens periodically\n  setInterval(() => {\n    const now = new Date();\n    const tokensToDelete: string[] = [];\n    resetTokens.forEach((data, token) => {\n      if (now > data.expiry) {\n        tokensToDelete.push(token);\n      }\n    });\n    tokensToDelete.forEach(token => resetTokens.delete(token));\n  }, 60 * 1000); // Cleanup every minute\n\n  // Request password reset\n  app.post(\"/api/auth/forgot-password\", async (req: Request, res: Response) => {\n    try {\n      const honeypotCheck = checkEnhancedHoneypot(req, ENHANCED_HONEYPOT_CONFIG);\n      if (honeypotCheck.shouldBlock) {\n        console.log(`[HONEYPOT] Bot detected in forgot password: ${honeypotCheck.details.join(', ')}`);\n        const clientIP = ipBlocker.getClientIP(req);\n        ipBlocker.recordFailedAttempt(clientIP);\n        return res.status(403).json({ \n          error: \"Security check failed\",\n          message: \"Suspicious activity detected\"\n        });\n      }\n\n      const schema = z.object({\n        email: z.string().email(\"Invalid email address\"),\n        captchaToken: z.string().min(1, \"CAPTCHA token is required\"),\n      });\n\n      const data = schema.parse(req.body);\n      \n      // Get demo API key to decode verification token\n      const demoDeveloper = await storage.getDeveloperByEmail(\"demo@proofcaptcha.local\");\n      if (!demoDeveloper) {\n        return res.status(500).json({\n          error: \"System error\",\n          message: \"Demo key not configured\",\n        });\n      }\n\n      const apiKeys = await storage.getApiKeysByDeveloper(demoDeveloper.id);\n      const demoKey = apiKeys.find(k => k.name === \"Demo Application\");\n      if (!demoKey) {\n        return res.status(500).json({\n          error: \"System error\",\n          message: \"Demo key not found\",\n        });\n      }\n\n      // Decode verification token\n      const decoded = verifyVerificationToken(data.captchaToken, demoKey.secretkey);\n      if (!decoded) {\n        return res.status(400).json({\n          error: \"Invalid CAPTCHA\",\n          message: \"CAPTCHA verification failed. Please try again.\",\n        });\n      }\n\n      // Get the challenge that was verified\n      const challenge = await storage.getChallenge(decoded.challengeId);\n      if (!challenge) {\n        return res.status(400).json({\n          error: \"Invalid CAPTCHA\",\n          message: \"CAPTCHA verification failed. Please try again.\",\n        });\n      }\n\n      const expirationCheck = checkChallengeExpiration(challenge.createdAt, DEFAULT_EXPIRATION_CONFIG);\n      if (!expirationCheck.isValid) {\n        return res.status(400).json({\n          error: \"Invalid CAPTCHA\",\n          message: expirationCheck.message || \"CAPTCHA expired. Please try again.\",\n        });\n      }\n      \n      if (!challenge.isUsed) {\n        return res.status(400).json({\n          error: \"CAPTCHA not verified\",\n          message: \"CAPTCHA must be verified before proceeding\",\n        });\n      }\n\n      // Check if developer exists\n      const developer = await storage.getDeveloperByEmail(data.email);\n      if (!developer) {\n        // Don't reveal if email exists or not for security\n        return res.json({\n          success: true,\n          message: \"If the email exists, a reset code will be sent\",\n        });\n      }\n\n      // SECURITY FIX: Generate reset code using crypto.randomInt\n      const resetCode = crypto.randomInt(100000, 1000000).toString();\n      const resetCodeExpiry = new Date(Date.now() + 15 * 60 * 1000); // 15 minutes\n\n      await storage.updateResetPasswordCode(data.email, resetCode, resetCodeExpiry);\n\n      // Send reset email\n      const emailSent = await emailService.sendPasswordResetEmail(\n        developer.email,\n        resetCode,\n        developer.name\n      );\n\n      if (!emailSent) {\n        return res.status(500).json({\n          error: \"Email failed\",\n          message: \"Failed to send reset email. Please try again.\",\n        });\n      }\n\n      res.json({\n        success: true,\n        message: \"Reset code sent to your email\",\n      });\n    } catch (error: any) {\n      console.error(\"Forgot password error:\", error);\n      res.status(400).json({\n        error: \"Request failed\",\n        message: error.message || \"Failed to process request\",\n      });\n    }\n  });\n\n  // Verify reset code and generate token\n  app.post(\"/api/auth/verify-reset-code\", async (req: Request, res: Response) => {\n    try {\n      const schema = z.object({\n        email: z.string().email(\"Invalid email address\"),\n        code: z.string().length(6, \"Reset code must be 6 digits\"),\n      });\n\n      const data = schema.parse(req.body);\n\n      // Get developer\n      const developer = await storage.getDeveloperByEmail(data.email);\n      if (!developer) {\n        return res.status(400).json({\n          error: \"Verification failed\",\n          message: \"Invalid email or code\",\n        });\n      }\n\n      // Check reset code\n      if (!developer.resetPasswordCode || !developer.resetPasswordCodeExpiry) {\n        return res.status(400).json({\n          error: \"Verification failed\",\n          message: \"No reset code found. Please request a new one.\",\n        });\n      }\n\n      if (new Date() > developer.resetPasswordCodeExpiry) {\n        return res.status(400).json({\n          error: \"Verification failed\",\n          message: \"Reset code has expired. Please request a new one.\",\n        });\n      }\n\n      if (developer.resetPasswordCode !== data.code) {\n        return res.status(400).json({\n          error: \"Verification failed\",\n          message: \"Invalid reset code\",\n        });\n      }\n\n      // Generate reset token (valid for 15 minutes)\n      const resetToken = nanoid(32);\n      const tokenExpiry = new Date(Date.now() + 15 * 60 * 1000);\n      resetTokens.set(resetToken, { email: data.email, expiry: tokenExpiry });\n\n      res.json({\n        success: true,\n        resetToken: resetToken,\n        message: \"Code verified successfully\",\n      });\n    } catch (error: any) {\n      console.error(\"Verify reset code error:\", error);\n      res.status(400).json({\n        error: \"Verification failed\",\n        message: error.message || \"Failed to verify code\",\n      });\n    }\n  });\n\n  // Reset password with token\n  app.post(\"/api/auth/reset-password\", async (req: Request, res: Response) => {\n    try {\n      const schema = z.object({\n        resetToken: z.string().min(1, \"Reset token is required\"),\n        newPassword: z.string().min(8, \"Password must be at least 8 characters\"),\n      });\n\n      const data = schema.parse(req.body);\n\n      // Verify reset token\n      const tokenData = resetTokens.get(data.resetToken);\n      if (!tokenData) {\n        return res.status(400).json({\n          error: \"Reset failed\",\n          message: \"Invalid or expired reset token\",\n        });\n      }\n\n      // Check token expiry\n      if (new Date() > tokenData.expiry) {\n        resetTokens.delete(data.resetToken);\n        return res.status(400).json({\n          error: \"Reset failed\",\n          message: \"Reset token has expired. Please start over.\",\n        });\n      }\n\n      // Get developer\n      const developer = await storage.getDeveloperByEmail(tokenData.email);\n      if (!developer) {\n        return res.status(400).json({\n          error: \"Reset failed\",\n          message: \"User not found\",\n        });\n      }\n\n      // Hash new password\n      const hashedPassword = await bcrypt.hash(data.newPassword, 10);\n\n      // Update password using resetPassword method with a dummy code check\n      // Since we already verified the code in verify-reset-code, we set the code to match\n      await storage.updateResetPasswordCode(tokenData.email, \"VERIFIED\", new Date(Date.now() + 1000));\n      const success = await storage.resetPassword(tokenData.email, \"VERIFIED\", hashedPassword);\n\n      if (!success) {\n        return res.status(500).json({\n          error: \"Reset failed\",\n          message: \"Failed to update password\",\n        });\n      }\n\n      // Remove used token\n      resetTokens.delete(data.resetToken);\n\n      res.json({\n        success: true,\n        message: \"Password reset successfully\",\n      });\n    } catch (error: any) {\n      console.error(\"Reset password error:\", error);\n      res.status(400).json({\n        error: \"Reset failed\",\n        message: error.message || \"Failed to reset password\",\n      });\n    }\n  });\n\n  app.post(\"/api/auth/login\", async (req: Request, res: Response) => {\n    try {\n      const honeypotCheck = checkEnhancedHoneypot(req, ENHANCED_HONEYPOT_CONFIG);\n      if (honeypotCheck.shouldBlock) {\n        console.log(`[HONEYPOT] Bot detected in login: ${honeypotCheck.details.join(', ')}`);\n        const clientIP = ipBlocker.getClientIP(req);\n        ipBlocker.recordFailedAttempt(clientIP);\n        return res.status(403).json({ \n          error: \"Security check failed\",\n          message: \"Suspicious activity detected\"\n        });\n      }\n\n      const schema = z.object({\n        email: z.string().email(\"Invalid email address\"),\n        password: z.string().min(1, \"Password is required\"),\n        captchaToken: z.string().min(1, \"CAPTCHA token is required\"),\n      });\n\n      const data = schema.parse(req.body);\n      \n      // Get demo API key to decode verification token\n      const demoDeveloper = await storage.getDeveloperByEmail(\"demo@proofcaptcha.local\");\n      if (!demoDeveloper) {\n        return res.status(500).json({\n          error: \"System error\",\n          message: \"Demo key not configured\",\n        });\n      }\n\n      const apiKeys = await storage.getApiKeysByDeveloper(demoDeveloper.id);\n      const demoKey = apiKeys.find(k => k.name === \"Demo Application\");\n      if (!demoKey) {\n        return res.status(500).json({\n          error: \"System error\",\n          message: \"Demo key not found\",\n        });\n      }\n\n      // Decode verification token (not challenge token)\n      const decoded = verifyVerificationToken(data.captchaToken, demoKey.secretkey);\n      if (!decoded) {\n        return res.status(400).json({\n          error: \"Invalid CAPTCHA\",\n          message: \"CAPTCHA verification failed. Please try again.\",\n        });\n      }\n\n      // Get the challenge that was verified\n      const challenge = await storage.getChallenge(decoded.challengeId);\n      if (!challenge) {\n        return res.status(400).json({\n          error: \"Invalid CAPTCHA\",\n          message: \"CAPTCHA verification failed. Please try again.\",\n        });\n      }\n\n      const expirationCheck = checkChallengeExpiration(challenge.createdAt, DEFAULT_EXPIRATION_CONFIG);\n      if (!expirationCheck.isValid) {\n        return res.status(400).json({\n          error: \"Invalid CAPTCHA\",\n          message: expirationCheck.message || \"CAPTCHA expired. Please try again.\",\n        });\n      }\n      \n      if (!challenge.isUsed) {\n        return res.status(400).json({\n          error: \"CAPTCHA not verified\",\n          message: \"Please complete the CAPTCHA challenge first.\",\n        });\n      }\n\n      // Check verification token replay using the same tracker\n      const verificationTokenId = `vt_${decoded.challengeId}_${decoded.nonce}`;\n      if (isChallengeUsed(verificationTokenId)) {\n        console.log(`[SECURITY] Verification token replay attack detected in login: ${verificationTokenId}`);\n        return res.status(400).json({\n          error: \"Invalid CAPTCHA\",\n          message: \"CAPTCHA token already used. Please try again.\",\n        });\n      }\n      \n      // Mark verification token as used to prevent replay\n      markChallengeAsUsed(verificationTokenId);\n      \n      // Note: Challenge is already marked as used, preventing reuse\n      // It will be cleaned up by automated cleanup task\n      console.log(`[SECURITY] CAPTCHA token validated for login: ${data.email}`);\n      \n      const developer = await storage.getDeveloperByEmail(data.email);\n      if (!developer) {\n        return res.status(401).json({\n          error: \"Invalid credentials\",\n          message: \"Email or password is incorrect\",\n        });\n      }\n\n      const isValidPassword = await bcrypt.compare(data.password, developer.password);\n      if (!isValidPassword) {\n        return res.status(401).json({\n          error: \"Invalid credentials\",\n          message: \"Email or password is incorrect\",\n        });\n      }\n\n      req.session.developerId = developer.id;\n\n      res.json({\n        success: true,\n        developer: {\n          id: developer.id,\n          email: developer.email,\n          name: developer.name,\n        },\n      });\n    } catch (error: any) {\n      console.error(\"Login error:\", error);\n      res.status(400).json({ \n        error: \"Login failed\",\n        message: error.message || \"Failed to login\"\n      });\n    }\n  });\n\n  app.post(\"/api/auth/logout\", (req: Request, res: Response) => {\n    req.session.destroy((err) => {\n      if (err) {\n        return res.status(500).json({ error: \"Failed to logout\" });\n      }\n      res.json({ success: true });\n    });\n  });\n\n  app.get(\"/api/auth/user\", async (req: Request, res: Response) => {\n    if (!req.session.developerId) {\n      return res.status(401).json({ error: \"Not authenticated\" });\n    }\n\n    const developer = await storage.getDeveloper(req.session.developerId);\n    if (!developer) {\n      return res.status(401).json({ error: \"Developer not found\" });\n    }\n\n    res.json({\n      id: developer.id,\n      email: developer.email,\n      name: developer.name,\n      isEmailVerified: developer.isEmailVerified,\n      csrfToken: getCSRFToken(req),\n    });\n  });\n\n  app.get(\"/api/security/csrf\", (req: Request, res: Response) => {\n    const token = getCSRFToken(req);\n    res.json({ csrfToken: token });\n  });\n\n  // ==================== PUBLIC DEMO ENDPOINT ====================\n\n  app.get(\"/api/demo/key\", async (req: Request, res: Response) => {\n    try {\n      const demoDeveloper = await storage.getDeveloperByEmail(\"demo@proofcaptcha.local\");\n      if (!demoDeveloper) {\n        return res.status(404).json({ error: \"Demo key not found\" });\n      }\n\n      const apiKeys = await storage.getApiKeysByDeveloper(demoDeveloper.id);\n      const demoKey = apiKeys.find(k => k.name === \"Demo Application\");\n\n      if (!demoKey) {\n        return res.status(404).json({ error: \"Demo key not found\" });\n      }\n\n      res.json({\n        sitekey: demoKey.sitekey,\n        publicKey: demoKey.sitekey, // Legacy alias for backward compatibility\n        name: demoKey.name,\n      });\n    } catch (error: any) {\n      console.error(\"Error fetching demo key:\", error);\n      res.status(500).json({ error: \"Failed to fetch demo key\" });\n    }\n  });\n\n  // ==================== DEVELOPER DASHBOARD API ENDPOINTS (Protected) ====================\n\n  app.post(\"/api/keys\", requireVerifiedEmail, async (req: Request, res: Response) => {\n    try {\n      const honeypotCheck = checkEnhancedHoneypot(req, ENHANCED_HONEYPOT_CONFIG);\n      if (honeypotCheck.shouldBlock) {\n        console.log(`[HONEYPOT] Bot detected in API key creation: ${honeypotCheck.details.join(', ')}`);\n        const clientIP = ipBlocker.getClientIP(req);\n        ipBlocker.recordFailedAttempt(clientIP);\n        return res.status(403).json({ \n          error: \"Security check failed\",\n          message: \"Suspicious activity detected\"\n        });\n      }\n\n      const schema = z.object({\n        name: z.string().min(1, \"Application name is required\"),\n        domain: z.string().min(1, \"Domain is required\"),\n        theme: z.enum([\"light\", \"dark\", \"auto\"]).optional().default(\"light\"),\n      });\n\n      const data = schema.parse(req.body);\n      \n      const apiKey = await storage.createApiKey({\n        developerId: req.session.developerId!,\n        name: data.name,\n        domain: data.domain,\n        theme: data.theme,\n        isActive: true,\n      });\n\n      res.json({\n        success: true,\n        sitekey: apiKey.sitekey,\n        secretkey: apiKey.secretkey,\n        publicKey: apiKey.sitekey,  // Legacy alias for backward compatibility\n        privateKey: apiKey.secretkey, // Legacy alias for backward compatibility\n        name: apiKey.name,\n        domain: apiKey.domain,\n        message: \"API keys created successfully. Please save your secretkey securely.\",\n      });\n    } catch (error: any) {\n      console.error(\"API Key creation error:\", error);\n      res.status(400).json({ \n        error: \"Failed to create API keys\",\n        message: error.message || \"Failed to create API keys\"\n      });\n    }\n  });\n\n  app.get(\"/api/keys\", requireVerifiedEmail, async (req: Request, res: Response) => {\n    try {\n      const apiKeys = await storage.getApiKeysByDeveloper(req.session.developerId!);\n      res.json(apiKeys);\n    } catch (error: any) {\n      console.error(\"Error fetching API keys:\", error);\n      res.status(500).json({ error: \"Failed to fetch API keys\" });\n    }\n  });\n\n  app.delete(\"/api/keys/:id\", requireVerifiedEmail, async (req: Request, res: Response) => {\n    try {\n      const apiKey = await storage.getApiKey(req.params.id);\n      if (!apiKey || apiKey.developerId !== req.session.developerId) {\n        return res.status(404).json({ error: \"API key not found\" });\n      }\n\n      await storage.deleteApiKey(req.params.id);\n      res.json({ success: true });\n    } catch (error: any) {\n      console.error(\"Error deleting API key:\", error);\n      res.status(500).json({ error: \"Failed to delete API key\" });\n    }\n  });\n\n  app.patch(\"/api/keys/:id/toggle\", requireVerifiedEmail, async (req: Request, res: Response) => {\n    try {\n      const apiKey = await storage.getApiKey(req.params.id);\n      if (!apiKey || apiKey.developerId !== req.session.developerId) {\n        return res.status(404).json({ error: \"API key not found\" });\n      }\n\n      await storage.updateApiKeyStatus(req.params.id, !apiKey.isActive);\n      const updated = await storage.getApiKey(req.params.id);\n      res.json(updated);\n    } catch (error: any) {\n      console.error(\"Error toggling API key:\", error);\n      res.status(500).json({ error: \"Failed to toggle API key\" });\n    }\n  });\n\n  // Get security settings for an API key\n  app.get(\"/api/keys/:id/settings\", requireVerifiedEmail, async (req: Request, res: Response) => {\n    try {\n      const apiKey = await storage.getApiKey(req.params.id);\n      if (!apiKey || apiKey.developerId !== req.session.developerId) {\n        return res.status(404).json({ error: \"API key not found\" });\n      }\n\n      // Return settings or default if not set\n      const settings = apiKey.settings as SecuritySettings | null;\n      res.json(settings || DEFAULT_SECURITY_SETTINGS);\n    } catch (error: any) {\n      console.error(\"Error fetching API key settings:\", error);\n      res.status(500).json({ error: \"Failed to fetch settings\" });\n    }\n  });\n\n  // Update security settings for an API key\n  app.put(\"/api/keys/:id/settings\", requireVerifiedEmail, async (req: Request, res: Response) => {\n    try {\n      const apiKey = await storage.getApiKey(req.params.id);\n      if (!apiKey || apiKey.developerId !== req.session.developerId) {\n        return res.status(404).json({ error: \"API key not found\" });\n      }\n\n      // CRITICAL SECURITY: Validate settings with strict zod schema\n      // This prevents manipulation of settings via API\n      // .strict() ensures NO extra fields can be passed (rejects unknown fields)\n      // Schema enforces min/max values and allowed types\n      const validatedSettings = securitySettingsSchema.strict().parse(req.body);\n      \n      // Extra validation: Explicitly reject any attempt to add domainValidation or encryption fields\n      // These are core security features that must NEVER be configurable\n      if ('domainValidation' in req.body || 'encryption' in req.body || 'encryptData' in req.body) {\n        return res.status(400).json({ \n          error: \"Invalid settings\",\n          message: \"Domain validation and encryption cannot be configured. These security features are always enforced.\"\n        });\n      }\n      \n      // IMPORTANT: Domain validation and encryption are ALWAYS ENFORCED\n      // These cannot be disabled via settings and are enforced server-side:\n      // - Domain validation: Always checked in challenge/verify endpoints\n      // - Encryption: Always active in EncryptionManager (progressive enhancement)\n      // These critical security features are NOT part of configurable settings\n      \n      // Additional server-side validation to prevent manipulation\n      // Ensure settings are within safe ranges even if zod schema passes\n      if (validatedSettings.proofOfWorkDifficulty < 1 || validatedSettings.proofOfWorkDifficulty > 10) {\n        return res.status(400).json({ \n          error: \"Invalid settings\",\n          message: \"Proof of work difficulty must be between 1 and 10\"\n        });\n      }\n      \n      if (validatedSettings.rateLimitMaxRequests < 1 || validatedSettings.rateLimitMaxRequests > 1000) {\n        return res.status(400).json({ \n          error: \"Invalid settings\",\n          message: \"Rate limit max requests must be between 1 and 1000\"\n        });\n      }\n      \n      if (validatedSettings.challengeTimeoutMs < 10000 || validatedSettings.challengeTimeoutMs > 300000) {\n        return res.status(400).json({ \n          error: \"Invalid settings\",\n          message: \"Challenge timeout must be between 10 and 300 seconds\"\n        });\n      }\n      \n      if (validatedSettings.tokenExpiryMs < 30000 || validatedSettings.tokenExpiryMs > 600000) {\n        return res.status(400).json({ \n          error: \"Invalid settings\",\n          message: \"Token expiry must be between 30 and 600 seconds\"\n        });\n      }\n      \n      // SECURITY: Validate blocked IPs and countries format\n      const blockValidation = ipBlocker.validateBlockedLists(\n        validatedSettings.blockedIps,\n        validatedSettings.blockedCountries\n      );\n      \n      if (!blockValidation.valid) {\n        return res.status(400).json({\n          error: \"Invalid blocking configuration\",\n          message: \"Some IP addresses or country codes are invalid\",\n          details: blockValidation.errors\n        });\n      }\n      \n      // Normalize blocked data before persisting\n      if (validatedSettings.blockedIps) {\n        validatedSettings.blockedIps = validatedSettings.blockedIps.map(ip => ip.trim());\n      }\n      if (validatedSettings.blockedCountries) {\n        validatedSettings.blockedCountries = validatedSettings.blockedCountries.map(\n          country => country.trim().toUpperCase()\n        );\n      }\n      \n      // Update settings in database\n      await storage.updateApiKeySettings(req.params.id, validatedSettings);\n      \n      res.json({\n        success: true,\n        settings: validatedSettings,\n        message: \"Settings updated successfully\"\n      });\n    } catch (error: any) {\n      console.error(\"Error updating API key settings:\", error);\n      if (error.name === 'ZodError') {\n        return res.status(400).json({ \n          error: \"Invalid settings\",\n          message: \"Some settings values are invalid\",\n          details: error.errors\n        });\n      }\n      res.status(500).json({ error: \"Failed to update settings\" });\n    }\n  });\n\n  app.get(\"/api/analytics\", requireVerifiedEmail, async (req: Request, res: Response) => {\n    try {\n      const apiKeys = await storage.getApiKeysByDeveloper(req.session.developerId!);\n      const apiKeyIds = apiKeys.map(k => k.id);\n      \n      const allAnalytics = [];\n      for (const apiKeyId of apiKeyIds) {\n        const analytics = await storage.getAnalyticsByApiKey(apiKeyId);\n        allAnalytics.push(...analytics);\n      }\n      \n      res.json(allAnalytics);\n    } catch (error: any) {\n      console.error(\"Error fetching analytics:\", error);\n      res.status(500).json({ error: \"Failed to fetch analytics\" });\n    }\n  });\n\n  // Dashboard statistics endpoint - uses aggregated analytics data for efficiency\n  app.get(\"/api/admin/stats\", requireVerifiedEmail, async (req: Request, res: Response) => {\n    try {\n      const filterApiKeyId = req.query.apiKeyId as string | undefined;\n      \n      const apiKeys = await storage.getApiKeysByDeveloper(req.session.developerId!);\n      \n      // If filtering by specific API key, verify ownership\n      if (filterApiKeyId) {\n        const hasAccess = apiKeys.some(k => k.id === filterApiKeyId);\n        if (!hasAccess) {\n          return res.status(403).json({ error: \"Access denied to this API key\" });\n        }\n      }\n      \n      // Determine which API keys to aggregate\n      const apiKeyIds = filterApiKeyId ? [filterApiKeyId] : apiKeys.map(k => k.id);\n      \n      // Use analytics data (already aggregated) for all-time totals\n      let totalChallenges = 0;\n      let successfulVerifications = 0;\n      let failedVerifications = 0;\n      let totalSolveTime = 0;\n      let solveTimeCount = 0;\n      const uniqueIpsSet = new Set<string>();\n      \n      // Fetch all analytics data for selected API keys in parallel\n      const analyticsPromises = apiKeyIds.map(apiKeyId => \n        storage.getAnalyticsByApiKey(apiKeyId)\n      );\n      const allAnalyticsArrays = await Promise.all(analyticsPromises);\n      \n      // Aggregate all analytics records\n      for (const analyticsArray of allAnalyticsArrays) {\n        for (const record of analyticsArray) {\n          totalChallenges += record.totalChallenges || 0;\n          successfulVerifications += record.successfulVerifications || 0;\n          failedVerifications += record.failedVerifications || 0;\n          \n          // Calculate weighted average for solve time\n          if (record.averageTimeToSolve !== null && record.successfulVerifications > 0) {\n            totalSolveTime += record.averageTimeToSolve * record.successfulVerifications;\n            solveTimeCount += record.successfulVerifications;\n          }\n        }\n      }\n      \n      // Get unique IPs from recent verifications (last 1000)\n      const recentVerificationsPromises = apiKeyIds.map(apiKeyId =>\n        storage.getVerificationsByApiKey(apiKeyId, 1000)\n      );\n      const recentVerificationsArrays = await Promise.all(recentVerificationsPromises);\n      \n      for (const verifications of recentVerificationsArrays) {\n        verifications.forEach(v => {\n          if (v.ipAddress) uniqueIpsSet.add(v.ipAddress);\n        });\n      }\n      \n      const totalVerifications = successfulVerifications + failedVerifications;\n      const successRate = totalVerifications > 0 \n        ? ((successfulVerifications / totalVerifications) * 100).toFixed(1)\n        : \"0.0\";\n      \n      const avgTimeToSolve = solveTimeCount > 0\n        ? Math.round(totalSolveTime / solveTimeCount)\n        : 0;\n      \n      res.json({\n        totalApiKeys: apiKeys.length,\n        activeApiKeys: apiKeys.filter(k => k.isActive).length,\n        totalVerifications,\n        successfulVerifications,\n        failedVerifications,\n        successRate,\n        uniqueIps: uniqueIpsSet.size,\n        avgTimeToSolve,\n      });\n    } catch (error: any) {\n      console.error(\"Error fetching admin stats:\", error);\n      res.status(500).json({ error: \"Failed to fetch stats\" });\n    }\n  });\n\n  // Time-series data for charts (hourly data for last 24 hours)\n  app.get(\"/api/admin/timeseries\", requireVerifiedEmail, async (req: Request, res: Response) => {\n    try {\n      const filterApiKeyId = req.query.apiKeyId as string | undefined;\n      const apiKeys = await storage.getApiKeysByDeveloper(req.session.developerId!);\n      \n      if (filterApiKeyId) {\n        const hasAccess = apiKeys.some(k => k.id === filterApiKeyId);\n        if (!hasAccess) {\n          return res.status(403).json({ error: \"Access denied to this API key\" });\n        }\n      }\n      \n      const apiKeyIds = filterApiKeyId ? [filterApiKeyId] : apiKeys.map(k => k.id);\n      \n      // Get verifications for last 24 hours\n      const now = Date.now();\n      const twentyFourHoursAgo = now - (24 * 60 * 60 * 1000);\n      \n      const verificationsPromises = apiKeyIds.map(apiKeyId =>\n        storage.getVerificationsByApiKey(apiKeyId, 5000)\n      );\n      const allVerificationsArrays = await Promise.all(verificationsPromises);\n      const allVerifications = allVerificationsArrays.flat();\n      \n      // Filter to last 24 hours\n      const recentVerifications = allVerifications.filter(v => \n        new Date(v.createdAt).getTime() > twentyFourHoursAgo\n      );\n      \n      // Group by hour\n      const hourlyData: { [key: string]: { success: number; failed: number; total: number } } = {};\n      \n      for (let i = 23; i >= 0; i--) {\n        const hourTime = now - (i * 60 * 60 * 1000);\n        const hourLabel = new Date(hourTime).getHours().toString().padStart(2, '0') + ':00';\n        hourlyData[hourLabel] = { success: 0, failed: 0, total: 0 };\n      }\n      \n      recentVerifications.forEach(v => {\n        const hour = new Date(v.createdAt).getHours().toString().padStart(2, '0') + ':00';\n        if (hourlyData[hour]) {\n          hourlyData[hour].total++;\n          if (v.success) {\n            hourlyData[hour].success++;\n          } else {\n            hourlyData[hour].failed++;\n          }\n        }\n      });\n      \n      const timeseriesData = Object.entries(hourlyData).map(([time, data]) => ({\n        time,\n        success: data.success,\n        failed: data.failed,\n        total: data.total,\n      }));\n      \n      res.json(timeseriesData);\n    } catch (error: any) {\n      console.error(\"Error fetching timeseries data:\", error);\n      res.status(500).json({ error: \"Failed to fetch timeseries data\" });\n    }\n  });\n\n  // Challenge types distribution\n  app.get(\"/api/admin/challenge-types\", requireVerifiedEmail, async (req: Request, res: Response) => {\n    try {\n      const filterApiKeyId = req.query.apiKeyId as string | undefined;\n      const apiKeys = await storage.getApiKeysByDeveloper(req.session.developerId!);\n      \n      if (filterApiKeyId) {\n        const hasAccess = apiKeys.some(k => k.id === filterApiKeyId);\n        if (!hasAccess) {\n          return res.status(403).json({ error: \"Access denied to this API key\" });\n        }\n      }\n      \n      const apiKeyIds = filterApiKeyId ? [filterApiKeyId] : apiKeys.map(k => k.id);\n      \n      // Get all challenges and filter by API key\n      const allChallenges = await storage.getAllChallenges();\n      const filteredChallenges = allChallenges.filter(\n        (challenge) => challenge.apiKeyId && apiKeyIds.includes(challenge.apiKeyId)\n      );\n      \n      const typeCounts: { [key: string]: number } = {};\n      filteredChallenges.forEach((challenge) => {\n        typeCounts[challenge.type] = (typeCounts[challenge.type] || 0) + 1;\n      });\n      \n      const distribution = Object.entries(typeCounts).map(([label, value]) => ({\n        label: label.charAt(0).toUpperCase() + label.slice(1),\n        value,\n      }));\n      \n      res.json(distribution);\n    } catch (error: any) {\n      console.error(\"Error fetching challenge types:\", error);\n      res.status(500).json({ error: \"Failed to fetch challenge types\" });\n    }\n  });\n\n  // Country analytics - verifications by country\n  app.get(\"/api/admin/country-analytics\", requireVerifiedEmail, async (req: Request, res: Response) => {\n    try {\n      const filterApiKeyId = req.query.apiKeyId as string | undefined;\n      const limit = parseInt(req.query.limit as string) || 20;\n      const apiKeys = await storage.getApiKeysByDeveloper(req.session.developerId!);\n      \n      if (filterApiKeyId) {\n        const hasAccess = apiKeys.some(k => k.id === filterApiKeyId);\n        if (!hasAccess) {\n          return res.status(403).json({ error: \"Access denied to this API key\" });\n        }\n      }\n      \n      const apiKeyIds = filterApiKeyId ? [filterApiKeyId] : apiKeys.map(k => k.id);\n      \n      // Get all verifications\n      const allVerifications = filterApiKeyId \n        ? await storage.getVerificationsByApiKey(filterApiKeyId, 10000)\n        : await storage.getRecentVerifications(10000);\n      \n      // Filter by developer's API keys if \"all\"\n      const verifications = filterApiKeyId\n        ? allVerifications\n        : allVerifications.filter(v => v.apiKeyId && apiKeyIds.includes(v.apiKeyId));\n      \n      // Group by country\n      const countryStats: {\n        [country: string]: {\n          country: string;\n          countryName: string;\n          totalVerifications: number;\n          successfulVerifications: number;\n          failedVerifications: number;\n          uniqueIps: Set<string>;\n          totalSolveTime: number;\n          solveTimeCount: number;\n        }\n      } = {};\n      \n      verifications.forEach(v => {\n        const countryCode = v.country || 'Unknown';\n        const countryName = v.countryName || 'Unknown';\n        \n        if (!countryStats[countryCode]) {\n          countryStats[countryCode] = {\n            country: countryCode,\n            countryName: countryName,\n            totalVerifications: 0,\n            successfulVerifications: 0,\n            failedVerifications: 0,\n            uniqueIps: new Set(),\n            totalSolveTime: 0,\n            solveTimeCount: 0,\n          };\n        }\n        \n        const stats = countryStats[countryCode];\n        stats.totalVerifications++;\n        \n        if (v.success) {\n          stats.successfulVerifications++;\n        } else {\n          stats.failedVerifications++;\n        }\n        \n        if (v.ipAddress) {\n          stats.uniqueIps.add(v.ipAddress);\n        }\n        \n        if (v.timeToSolve) {\n          stats.totalSolveTime += v.timeToSolve;\n          stats.solveTimeCount++;\n        }\n      });\n      \n      // Convert to array and calculate averages\n      const countryAnalytics = Object.values(countryStats)\n        .map(stats => ({\n          country: stats.country,\n          countryName: stats.countryName,\n          totalVerifications: stats.totalVerifications,\n          successfulVerifications: stats.successfulVerifications,\n          failedVerifications: stats.failedVerifications,\n          successRate: stats.totalVerifications > 0 \n            ? ((stats.successfulVerifications / stats.totalVerifications) * 100).toFixed(1) + '%'\n            : '0%',\n          uniqueIps: stats.uniqueIps.size,\n          averageTimeToSolve: stats.solveTimeCount > 0 \n            ? Math.round(stats.totalSolveTime / stats.solveTimeCount)\n            : null,\n        }))\n        .sort((a, b) => b.totalVerifications - a.totalVerifications)\n        .slice(0, limit);\n      \n      res.json(countryAnalytics);\n    } catch (error: any) {\n      console.error(\"Error fetching country analytics:\", error);\n      res.status(500).json({ error: \"Failed to fetch country analytics\" });\n    }\n  });\n\n  // Geographic distribution for map visualization\n  app.get(\"/api/admin/geo-distribution\", requireVerifiedEmail, async (req: Request, res: Response) => {\n    try {\n      const filterApiKeyId = req.query.apiKeyId as string | undefined;\n      const apiKeys = await storage.getApiKeysByDeveloper(req.session.developerId!);\n      \n      if (filterApiKeyId) {\n        const hasAccess = apiKeys.some(k => k.id === filterApiKeyId);\n        if (!hasAccess) {\n          return res.status(403).json({ error: \"Access denied to this API key\" });\n        }\n      }\n      \n      const apiKeyIds = filterApiKeyId ? [filterApiKeyId] : apiKeys.map(k => k.id);\n      \n      // Get all verifications\n      const allVerifications = filterApiKeyId \n        ? await storage.getVerificationsByApiKey(filterApiKeyId, 10000)\n        : await storage.getRecentVerifications(10000);\n      \n      // Filter by developer's API keys if \"all\"\n      const verifications = filterApiKeyId\n        ? allVerifications\n        : allVerifications.filter(v => v.apiKeyId && apiKeyIds.includes(v.apiKeyId));\n      \n      // Group by location (lat/long)\n      const locationMap: {\n        [key: string]: {\n          latitude: string;\n          longitude: string;\n          city: string | null;\n          country: string | null;\n          countryName: string | null;\n          count: number;\n          success: number;\n          failed: number;\n        }\n      } = {};\n      \n      verifications.forEach(v => {\n        if (v.latitude && v.longitude) {\n          const key = `${v.latitude},${v.longitude}`;\n          \n          if (!locationMap[key]) {\n            locationMap[key] = {\n              latitude: v.latitude,\n              longitude: v.longitude,\n              city: v.city,\n              country: v.country,\n              countryName: v.countryName,\n              count: 0,\n              success: 0,\n              failed: 0,\n            };\n          }\n          \n          locationMap[key].count++;\n          if (v.success) {\n            locationMap[key].success++;\n          } else {\n            locationMap[key].failed++;\n          }\n        }\n      });\n      \n      const geoDistribution = Object.values(locationMap);\n      \n      res.json(geoDistribution);\n    } catch (error: any) {\n      console.error(\"Error fetching geo distribution:\", error);\n      res.status(500).json({ error: \"Failed to fetch geo distribution\" });\n    }\n  });\n\n  // ==================== PUBLIC API ENDPOINTS ====================\n\n  // PUBLIC: Site Verify Endpoint - untuk developer verify captcha response di backend mereka\n  // NOTE: Session fingerprint binding NOT applied here because this is a backend-to-backend call\n  // Session binding only works for client-to-server calls (browser to API)\n  app.all(\"/proofCaptcha/api/siteverify\", async (req: Request, res: Response) => {\n    try {\n      const secret = req.method === 'GET' ? req.query.secret as string : req.body.secret;\n      const response = req.method === 'GET' ? req.query.response as string : req.body.response;\n\n      if (!secret || !response) {\n        return res.json({\n          success: false,\n          \"error-codes\": [\"missing-input-secret\", \"missing-input-response\"]\n        });\n      }\n\n      const apiKey = await storage.getApiKeyBySecretkey(secret);\n      \n      if (!apiKey || !apiKey.isActive) {\n        return res.json({\n          success: false,\n          \"error-codes\": [\"invalid-input-secret\"]\n        });\n      }\n\n      const decoded = verifyVerificationToken(response, secret);\n      \n      if (!decoded) {\n        return res.json({\n          success: false,\n          \"error-codes\": [\"invalid-input-response\"]\n        });\n      }\n\n      const challenge = await storage.getChallenge(decoded.challengeId);\n      \n      if (!challenge) {\n        return res.json({\n          success: false,\n          \"error-codes\": [\"timeout-or-duplicate\"]\n        });\n      }\n\n      // IMPORTANT: Verification tokens can be validated even if challenge.isUsed = true\n      // because they are separate tokens generated after successful verification.\n      // The challenge being \"used\" means it was verified via /api/captcha/verify,\n      // but the verification token itself needs separate replay protection.\n      \n      // Check if this specific verification token has been used before\n      // We'll use a separate tracking mechanism for verification tokens\n      const verificationTokenId = `vt_${decoded.challengeId}_${decoded.nonce}`;\n      if (isChallengeUsed(verificationTokenId)) {\n        console.log(`[SECURITY] Verification token replay attack detected: ${verificationTokenId}`);\n        return res.json({\n          success: false,\n          \"error-codes\": [\"timeout-or-duplicate\"]\n        });\n      }\n\n      // Enhanced token expiration check dengan grace period\n      const expirationCheck = checkChallengeExpiration(\n        challenge.createdAt,\n        DEFAULT_EXPIRATION_CONFIG\n      );\n\n      if (!expirationCheck.isValid) {\n        console.log(`[SECURITY] Challenge expired in siteverify: ${expirationCheck.message}`);\n        return res.json({\n          success: false,\n          \"error-codes\": [expirationCheck.errorCode!]\n        });\n      }\n\n      // Log jika mendekati expiration\n      if (expirationCheck.expiresIn! < 60000) {\n        console.log(`[WARNING] Challenge near expiration in siteverify: ${Math.floor(expirationCheck.expiresIn! / 1000)}s remaining`);\n      }\n      \n      // NOTE: Session fingerprint binding is intentionally skipped for siteverify\n      // because this endpoint is called from developer's backend server, not from the end-user's browser\n\n      // Normalize domains untuk perbandingan yang konsisten (case-insensitive, etc)\n      const normalizedApiDomain = apiKey.domain ? normalizeDomain(apiKey.domain) : null;\n      const normalizedTokenDomain = normalizeDomain(decoded.domain);\n      const normalizedChallengeDomain = normalizeDomain(challenge.validatedDomain);\n\n      // Domain validation: Skip if API key has wildcard domain\n      if (normalizedApiDomain && normalizedApiDomain !== \"*\" && normalizedTokenDomain !== normalizedApiDomain) {\n        console.log(`[SECURITY] Domain mismatch in siteverify: Expected ${apiKey.domain}, got ${decoded.domain}`);\n        return res.json({\n          success: false,\n          \"error-codes\": [\"invalid-input-response\"]\n        });\n      }\n\n      // Validate challenge domain matches token domain\n      // This is always enforced regardless of API key domain setting\n      // This prevents tokens from being used on different domains than where they were issued\n      if (normalizedChallengeDomain !== normalizedTokenDomain) {\n        console.log(`[SECURITY] Challenge domain mismatch in siteverify: Expected ${challenge.validatedDomain}, got ${decoded.domain}`);\n        return res.json({\n          success: false,\n          \"error-codes\": [\"invalid-input-response\"]\n        });\n      }\n\n      // Mark this verification token as used to prevent replay\n      markChallengeAsUsed(verificationTokenId);\n      \n      // Also mark the challenge as used in database if not already\n      // This ensures challenges can't be re-verified after siteverify validation\n      if (!challenge.isUsed) {\n        await storage.markChallengeAsUsed(challenge.id);\n      }\n\n      console.log(`[SECURITY] Verification token validated successfully: ${verificationTokenId}`);\n\n      res.json({\n        success: true,\n        challenge_ts: new Date(challenge.createdAt).toISOString(),\n        hostname: decoded.domain\n      });\n    } catch (error: any) {\n      console.error(\"Siteverify error:\", error);\n      res.json({\n        success: false,\n        \"error-codes\": [\"invalid-input-response\"]\n      });\n    }\n  });\n\n  // PUBLIC: Widget Script Endpoint - Serve canonical widget bundle\n  app.get(\"/proofCaptcha/api.js\", async (req: Request, res: Response) => {\n    try {\n      const scriptPath = path.resolve(import.meta.dirname, \"public\", \"api.js\");\n      const script = await readFile(scriptPath, \"utf-8\");\n      \n      res.setHeader(\"Content-Type\", \"application/javascript; charset=utf-8\");\n      res.setHeader(\"Cache-Control\", \"no-cache, no-store, must-revalidate\"); // No cache for development\n      res.setHeader(\"Access-Control-Allow-Origin\", \"*\"); // Allow CORS for widget script\n      res.send(script);\n    } catch (error) {\n      console.error(\"Error serving captcha widget script:\", error);\n      res.status(500).send(\"// Error loading ProofCaptcha widget\");\n    }\n  });\n\n  // OLD INLINE WIDGET SCRIPT (DEPRECATED - Keeping for reference, remove later)\n  // The canonical widget is now served from server/public/api.js\n  /*\n  app.get(\"/proofCaptcha/api.js.OLD\", (req: Request, res: Response) => {\n    const domain = process.env.REPLIT_DOMAINS \n      ? `https://${process.env.REPLIT_DOMAINS.split(',')[0]}`\n      : req.protocol + '://' + req.get('host');\n    \n    const widgetScript = `\n(function() {\n  'use strict';\n  \n  var ProofCaptcha = {\n    sitekey: null,\n    challengeToken: null,\n    baseUrl: '${domain}',\n    \n    init: function() {\n      var widgets = document.querySelectorAll('.proof-captcha');\n      widgets.forEach(function(widget) {\n        ProofCaptcha.sitekey = widget.getAttribute('data-sitekey');\n        if (!ProofCaptcha.sitekey) {\n          console.error('ProofCaptcha: data-sitekey attribute is required');\n          return;\n        }\n        ProofCaptcha.render(widget);\n      });\n    },\n    \n    render: function(container) {\n      container.innerHTML = '<div style=\"border: 1px solid #d3d3d3; border-radius: 3px; padding: 10px; width: 300px; background: #f9f9f9;\"><label style=\"display: flex; align-items: center; cursor: pointer;\"><input type=\"checkbox\" id=\"proof-captcha-checkbox\" style=\"margin-right: 8px;\"><span>I\\\\'m not a robot</span></label><div id=\"proof-captcha-status\" style=\"margin-top: 5px; font-size: 12px; color: #666;\"></div></div>';\n      \n      var checkbox = container.querySelector('#proof-captcha-checkbox');\n      var status = container.querySelector('#proof-captcha-status');\n      \n      checkbox.addEventListener('change', function() {\n        if (this.checked) {\n          status.textContent = 'Verifying...';\n          ProofCaptcha.getChallenge();\n        } else {\n          status.textContent = '';\n          ProofCaptcha.challengeToken = null;\n          var responseInput = document.querySelector('input[name=\"proof-captcha-response\"]');\n          if (responseInput) responseInput.remove();\n        }\n      });\n    },\n    \n    getChallenge: function() {\n      fetch(ProofCaptcha.baseUrl + '/api/captcha/challenge', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ \n          publicKey: ProofCaptcha.sitekey,\n          type: 'checkbox'\n        })\n      })\n      .then(function(response) { return response.json(); })\n      .then(function(data) {\n        if (data.error) {\n          document.querySelector('#proof-captcha-status').textContent = 'Error: ' + data.error;\n          document.querySelector('#proof-captcha-checkbox').checked = false;\n          return;\n        }\n        \n        ProofCaptcha.challengeToken = data.token;\n        ProofCaptcha.solveChallenge(data.challenge);\n      })\n      .catch(function(error) {\n        console.error('ProofCaptcha error:', error);\n        document.querySelector('#proof-captcha-status').textContent = 'Connection error';\n        document.querySelector('#proof-captcha-checkbox').checked = false;\n      });\n    },\n    \n    solveChallenge: async function(challenge) {\n      var solution = await ProofCaptcha.computeProofOfWork(challenge);\n      \n      fetch(ProofCaptcha.baseUrl + '/api/captcha/verify', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ \n          token: ProofCaptcha.challengeToken,\n          solution: solution\n        })\n      })\n      .then(function(response) { return response.json(); })\n      .then(function(data) {\n        var status = document.querySelector('#proof-captcha-status');\n        if (data.success) {\n          status.textContent = 'Verified ‚úì';\n          status.style.color = 'green';\n          \n          var form = document.querySelector('#proof-captcha-checkbox').closest('form');\n          if (form) {\n            var existingInput = form.querySelector('input[name=\"proof-captcha-response\"]');\n            if (existingInput) existingInput.remove();\n            \n            var input = document.createElement('input');\n            input.type = 'hidden';\n            input.name = 'proof-captcha-response';\n            input.value = ProofCaptcha.challengeToken;\n            form.appendChild(input);\n          }\n        } else {\n          status.textContent = 'Verification failed';\n          status.style.color = 'red';\n          document.querySelector('#proof-captcha-checkbox').checked = false;\n        }\n      })\n      .catch(function(error) {\n        console.error('Verification error:', error);\n        document.querySelector('#proof-captcha-status').textContent = 'Verification error';\n        document.querySelector('#proof-captcha-checkbox').checked = false;\n      });\n    },\n    \n    computeProofOfWork: async function(challenge) {\n      var nonce = challenge.nonce;\n      var timestamp = challenge.timestamp;\n      var difficulty = challenge.difficulty;\n      var target = '0'.repeat(difficulty);\n      \n      for (var i = 0; i < 1000000; i++) {\n        var hash = await ProofCaptcha.sha256(nonce + timestamp + i);\n        if (hash.startsWith(target)) {\n          return i.toString();\n        }\n      }\n      return '0';\n    },\n    \n    sha256: async function(str) {\n      var buffer = new TextEncoder().encode(str);\n      var hashBuffer = await crypto.subtle.digest('SHA-256', buffer);\n      return Array.from(new Uint8Array(hashBuffer))\n        .map(function(b) { return b.toString(16).padStart(2, '0'); })\n        .join('');\n    }\n  };\n  \n  if (document.readyState === 'loading') {\n    document.addEventListener('DOMContentLoaded', function() {\n      ProofCaptcha.init();\n    });\n  } else {\n    ProofCaptcha.init();\n  }\n  \n  window.ProofCaptcha = ProofCaptcha;\n})();\n`;\n\n    res.setHeader('Content-Type', 'application/javascript');\n    res.setHeader('Cache-Control', 'public, max-age=3600');\n    res.send(widgetScript);\n  });\n  */\n\n  // REMOVED: Legacy GET-only siteverify endpoint that conflicted with the canonical POST/GET endpoint at line 434\n  // The canonical endpoint correctly handles verification tokens from /api/captcha/verify\n  // and marks challenges as used to prevent replay attacks\n  \n  // ==================== ENCRYPTION HANDSHAKE ENDPOINT ====================\n  /**\n   * ECDH Handshake for establishing encrypted session\n   * Returns server's ephemeral public key and establishes shared session key\n   */\n  app.post(\"/api/captcha/handshake\", handshakeLimiter, async (req: Request, res: Response) => {\n    try {\n      const clientIP = ipBlocker.getClientIP(req);\n      if (ipBlocker.isBlocked(clientIP)) {\n        const blockInfo = ipBlocker.getBlockInfo(clientIP);\n        const remainingTime = blockInfo ? Math.ceil((blockInfo.expiresAt - Date.now()) / 1000 / 60) : 0;\n        \n        return res.status(429).json({ \n          error: \"IP blocked\",\n          message: `Your IP has been blocked due to too many failed attempts. Please try again in ${remainingTime} minutes.`,\n          remainingTime,\n        });\n      }\n\n      const { publicKey, clientPublicKey } = req.body;\n\n      if (!publicKey || !clientPublicKey) {\n        return res.status(400).json({ \n          error: \"Invalid request\",\n          message: \"publicKey and clientPublicKey are required\" \n        });\n      }\n\n      // Validate API key\n      const apiKey = await storage.getApiKeyBySitekey(publicKey);\n      if (!apiKey || !apiKey.isActive) {\n        return res.status(401).json({ \n          error: \"Invalid API key\",\n          message: \"API key is invalid or inactive\" \n        });\n      }\n\n      // SECURITY FIX Bug #6: Per-API-key rate limiting\n      // Limit handshake requests per API key (e.g., 100 per minute)\n      const apiKeyRateLimitKey = apiKey.id;\n      const now = Date.now();\n      const windowMs = 60000; // 1 minute window\n      const maxRequestsPerWindow = 100; // Max 100 handshakes per minute per API key\n      \n      const rateLimitData = perApiKeyHandshakeRateLimits.get(apiKeyRateLimitKey);\n      \n      if (rateLimitData) {\n        // Check if we're still in the same window\n        if (now - rateLimitData.windowStart < windowMs) {\n          if (rateLimitData.count >= maxRequestsPerWindow) {\n            console.log(`[SECURITY] API key ${apiKey.name} exceeded handshake rate limit: ${rateLimitData.count}/${maxRequestsPerWindow}`);\n            return res.status(429).json({\n              error: \"Rate limit exceeded\",\n              message: `Too many handshake requests for this API key. Maximum ${maxRequestsPerWindow} requests per minute.`,\n              retryAfter: Math.ceil((windowMs - (now - rateLimitData.windowStart)) / 1000)\n            });\n          }\n          // Increment count in current window\n          rateLimitData.count++;\n        } else {\n          // New window - reset\n          rateLimitData.count = 1;\n          rateLimitData.windowStart = now;\n        }\n      } else {\n        // First request for this API key\n        perApiKeyHandshakeRateLimits.set(apiKeyRateLimitKey, { count: 1, windowStart: now });\n      }\n\n      // Validate domain (same as challenge endpoint)\n      if (!apiKey.domain) {\n        return res.status(403).json({ \n          error: \"Domain validation failed\",\n          message: \"API key must have a domain restriction configured\"\n        });\n      }\n\n      const origin = req.headers.origin || req.headers.referer;\n      if (!origin) {\n        return res.status(403).json({ \n          error: \"Domain validation failed\",\n          message: \"Origin or Referer header is required\"\n        });\n      }\n\n      const requestDomain = extractDomainFromRequest(req);\n      if (!requestDomain) {\n        return res.status(403).json({ \n          error: \"Domain validation failed\",\n          message: \"Cannot determine request origin\"\n        });\n      }\n\n      if (apiKey.domain !== \"*\") {\n        const allowedDomain = apiKey.domain.replace(/^(https?:\\/\\/)/, '').replace(/\\/$/, '');\n        const isMatch = requestDomain === allowedDomain || \n                       requestDomain.endsWith('.' + allowedDomain);\n        \n        if (!isMatch) {\n          return res.status(403).json({ \n            error: \"Domain validation failed\",\n            message: `This API key is restricted to domain: ${allowedDomain}`\n          });\n        }\n      }\n\n      // Get server ephemeral key pair\n      const serverKeyPair = sessionCache.getCurrentServerKeyPair();\n\n      // Decode client's public key\n      let clientPublicKeyBuffer: Buffer;\n      try {\n        clientPublicKeyBuffer = Buffer.from(clientPublicKey, 'base64');\n      } catch (error) {\n        return res.status(400).json({ \n          error: \"Invalid request\",\n          message: \"Invalid public key encoding\" \n        });\n      }\n\n      // SECURITY: Validate client public key format\n      // P-256 uncompressed public key must be exactly 65 bytes (0x04 || x || y)\n      if (clientPublicKeyBuffer.length !== 65) {\n        console.log(`[HANDSHAKE] Invalid client public key length: ${clientPublicKeyBuffer.length} (expected 65)`);\n        return res.status(400).json({ \n          error: \"Invalid request\",\n          message: \"Invalid public key format\" \n        });\n      }\n\n      // First byte must be 0x04 (uncompressed point indicator for P-256)\n      if (clientPublicKeyBuffer[0] !== 0x04) {\n        console.log(`[HANDSHAKE] Invalid client public key format: first byte is ${clientPublicKeyBuffer[0]} (expected 0x04)`);\n        return res.status(400).json({ \n          error: \"Invalid request\",\n          message: \"Invalid public key format\" \n        });\n      }\n\n      // SECURITY FIX Bug #7: ECDH Curve Membership Validation\n      // Extract x and y coordinates from public key (bytes 1-32 are x, 33-64 are y)\n      const x = BigInt('0x' + clientPublicKeyBuffer.slice(1, 33).toString('hex'));\n      const y = BigInt('0x' + clientPublicKeyBuffer.slice(33, 65).toString('hex'));\n      \n      // P-256 (secp256r1) curve parameters\n      const p = BigInt('0xFFFFFFFF00000001000000000000000000000000FFFFFFFFFFFFFFFFFFFFFFFF'); // Prime field modulus\n      const a = BigInt('0xFFFFFFFF00000001000000000000000000000000FFFFFFFFFFFFFFFFFFFFFFFC'); // Curve coefficient a\n      const b = BigInt('0x5AC635D8AA3A93E7B3EBBD55769886BC651D06B0CC53B0F63BCE3C3E27D2604B'); // Curve coefficient b\n      \n      // 1. Validate coordinates are less than p (prevent invalid field elements)\n      if (x >= p || y >= p) {\n        console.log(`[HANDSHAKE] SECURITY: Client public key coordinates exceed prime modulus`);\n        return res.status(400).json({ \n          error: \"Invalid request\",\n          message: \"Invalid public key - coordinates out of range\" \n        });\n      }\n      \n      // 2. Validate point is not at infinity (coordinates must not be zero)\n      if (x === 0n && y === 0n) {\n        console.log(`[HANDSHAKE] SECURITY: Client public key is point at infinity`);\n        return res.status(400).json({ \n          error: \"Invalid request\",\n          message: \"Invalid public key - point at infinity\" \n        });\n      }\n      \n      // 3. Validate point lies on the curve: y¬≤ ‚â° x¬≥ + ax + b (mod p)\n      // This prevents small-subgroup attacks and invalid curve attacks\n      const modPow = (base: bigint, exp: bigint, mod: bigint): bigint => {\n        let result = 1n;\n        base = base % mod;\n        while (exp > 0n) {\n          if (exp % 2n === 1n) result = (result * base) % mod;\n          exp = exp / 2n;\n          base = (base * base) % mod;\n        }\n        return result;\n      };\n      \n      const lhs = modPow(y, 2n, p); // y¬≤\n      const rhs = (modPow(x, 3n, p) + (a * x) % p + b) % p; // x¬≥ + ax + b\n      const lhsNormalized = (lhs % p + p) % p;\n      const rhsNormalized = (rhs % p + p) % p;\n      \n      if (lhsNormalized !== rhsNormalized) {\n        console.log(`[HANDSHAKE] SECURITY: Client public key point not on P-256 curve`);\n        return res.status(400).json({ \n          error: \"Invalid request\",\n          message: \"Invalid public key - point not on curve\" \n        });\n      }\n      \n      console.log(`[HANDSHAKE] SECURITY: Client public key passed curve membership validation`);\n\n      // Perform ECDH to derive shared secret (wrapped in try-catch for security)\n      let sharedSecret: Buffer;\n      try {\n        sharedSecret = deriveSharedSecret(\n          serverKeyPair.privateKey,\n          clientPublicKeyBuffer\n        );\n      } catch (error) {\n        console.error(\"[HANDSHAKE] ECDH derivation failed:\", error);\n        return res.status(400).json({ \n          error: \"Invalid request\",\n          message: \"Key exchange failed\" \n        });\n      }\n\n      // Generate server nonce for freshness\n      const serverNonce = nanoid(32);\n\n      // Derive master session key with binding\n      const masterKey = deriveMasterKey(\n        sharedSecret,\n        serverKeyPair.publicKey,\n        serverNonce\n      );\n\n      // Generate device fingerprint for session binding\n      const deviceFingerprint = generateDeviceFingerprint(req);\n\n      // Store session key\n      const sessionKey = {\n        masterKey,\n        serverPublicKey: serverKeyPair.publicKey,\n        clientPublicKey: clientPublicKeyBuffer,\n        timestamp: Date.now(),\n        expiresAt: Date.now() + (5 * 60 * 1000), // 5 minutes\n        nonce: serverNonce,\n      };\n\n      sessionCache.storeSession(\n        sessionKey,\n        publicKey,\n        clientIP,\n        deviceFingerprint.id\n      );\n\n      // Generate handshake signature for replay protection\n      const signature = signHandshakeTranscript(\n        serverKeyPair.publicKey,\n        clientPublicKeyBuffer,\n        apiKey.secretkey,\n        sessionKey.timestamp\n      );\n\n      // Return handshake response\n      const response: HandshakeResponse & { signature: string } = {\n        serverPublicKey: serverKeyPair.publicKey.toString('base64'),\n        timestamp: sessionKey.timestamp,\n        expiresIn: 300, // 5 minutes in seconds\n        nonce: serverNonce,\n        signature,\n      };\n\n      console.log(`[HANDSHAKE] Established session for ${publicKey.substring(0, 12)}... from ${clientIP}`);\n\n      res.json(response);\n    } catch (error: any) {\n      console.error(\"[HANDSHAKE] Error:\", error);\n      res.status(500).json({ \n        error: \"Handshake failed\",\n        message: \"Internal server error during key exchange\" \n      });\n    }\n  });\n\n  // Get theme configuration by sitekey (public endpoint for widgets)\n  app.get(\"/api/captcha/config/:sitekey\", async (req: Request, res: Response) => {\n    try {\n      const { sitekey } = req.params;\n      \n      if (!sitekey) {\n        return res.status(400).json({\n          error: \"Missing sitekey\",\n          message: \"Sitekey parameter is required\"\n        });\n      }\n\n      const apiKey = await storage.getApiKeyBySitekey(sitekey);\n      \n      if (!apiKey) {\n        return res.status(404).json({\n          error: \"Invalid sitekey\",\n          message: \"No configuration found for this sitekey\"\n        });\n      }\n\n      if (!apiKey.isActive) {\n        return res.status(403).json({\n          error: \"Inactive API key\",\n          message: \"This API key has been deactivated\"\n        });\n      }\n\n      res.json({\n        theme: apiKey.theme || 'light',\n        domain: apiKey.domain,\n      });\n    } catch (error: any) {\n      console.error(\"Error fetching captcha config:\", error);\n      res.status(500).json({\n        error: \"Internal server error\",\n        message: \"Failed to fetch configuration\"\n      });\n    }\n  });\n  \n  // Generate challenge\n  app.post(\"/api/captcha/challenge\", challengeLimiter, async (req: Request, res: Response) => {\n    try {\n      // Decode request body\n      let requestBody = req.body;\n      if (req.body.data && typeof req.body.data === 'string') {\n        try {\n          const decodedString = Buffer.from(req.body.data, 'base64').toString('utf-8');\n          requestBody = JSON.parse(decodedString);\n          console.log('[REQUEST] Decoded request body');\n        } catch (decodeError) {\n          console.error('[REQUEST] Failed to decode request body:', decodeError);\n          return res.status(400).json({ error: \"Invalid request format\" });\n        }\n      }\n      \n      const clientIP = ipBlocker.getClientIP(req);\n      \n      const isRefresh = requestBody.isRefresh === true;\n      \n      // Load API key early to access security settings\n      const { publicKey } = requestBody;\n      if (!publicKey) {\n        return res.status(400).json({ error: \"Public key is required\" });\n      }\n\n      const apiKey = await storage.getApiKeyBySitekey(publicKey);\n      if (!apiKey || !apiKey.isActive) {\n        return res.status(401).json({ error: \"Invalid or inactive API key\" });\n      }\n\n      // Load security settings for this API key\n      // CRITICAL SECURITY: Settings are loaded SERVER-SIDE ONLY from database\n      // Client CANNOT manipulate or override these settings - they are strictly enforced server-side\n      // Domain validation and encryption are ALWAYS enforced regardless of settings\n      const settings = (apiKey.settings as SecuritySettings | null) || DEFAULT_SECURITY_SETTINGS;\n      console.log(`[SETTINGS] Security settings for ${apiKey.name}: difficulty=${settings.proofOfWorkDifficulty}, fingerprinting=${settings.advancedFingerprinting}`);\n      \n      // FIXED: Check IP and country blocking\n      const geoData = await getGeolocationFromIP(clientIP);\n      const blockCheck = ipBlocker.checkSecurityBlocking(clientIP, geoData.country, settings);\n      \n      if (blockCheck.blocked) {\n        console.log(`[SECURITY] Blocked request from IP ${clientIP} / Country ${geoData.country}: ${blockCheck.reason}`);\n        return res.status(403).json({\n          error: \"Access denied\",\n          message: blockCheck.reason\n        });\n      }\n      \n      // Custom rate limiting based on API key settings (if enabled)\n      if (settings.ipRateLimiting) {\n        const rateLimitKey = `ratelimit:challenge:${clientIP}`;\n        const requestCount = (req as any).rateLimit?.current || 0;\n        const windowMs = settings.rateLimitWindowMs || 60000;\n        const maxRequests = settings.rateLimitMaxRequests || 30;\n        \n        if (requestCount > maxRequests) {\n          return res.status(429).json({\n            error: \"Rate limit exceeded\",\n            message: `Too many challenge requests. Maximum ${maxRequests} requests per ${windowMs / 1000} seconds.`\n          });\n        }\n      }\n      \n      if (ipBlocker.isBlocked(clientIP)) {\n        const blockInfo = ipBlocker.getBlockInfo(clientIP);\n        const remainingTime = blockInfo ? Math.ceil((blockInfo.expiresAt - Date.now()) / 1000 / 60) : 0;\n        \n        return res.status(429).json({ \n          error: \"IP blocked\",\n          message: blockInfo?.reason || `Your IP has been blocked. Please try again in ${remainingTime} minutes.`,\n          remainingTime,\n          blockExpiresAt: blockInfo?.expiresAt,\n        });\n      }\n      \n      if (isRefresh && settings.ipRateLimiting) {\n        ipBlocker.recordRefreshClick(clientIP);\n        \n        if (ipBlocker.isBlocked(clientIP)) {\n          const blockInfo = ipBlocker.getBlockInfo(clientIP);\n          const remainingTime = blockInfo ? Math.ceil((blockInfo.expiresAt - Date.now()) / 1000 / 60) : 0;\n          \n          return res.status(429).json({ \n            error: \"IP blocked\",\n            message: blockInfo?.reason || `Your IP has been blocked. Please try again in ${remainingTime} minutes.`,\n            remainingTime,\n            blockExpiresAt: blockInfo?.expiresAt,\n          });\n        }\n      }\n\n      const automationCheck = settings.automationDetection ? detectAutomation(req) : { isAutomation: false, score: 0, detectedBy: [] };\n      const deviceFingerprint = generateDeviceFingerprint(req);\n      const behavioralPattern = settings.behavioralAnalysis ? analyzeBehavior(req) : { confidence: 0, isBot: false, patterns: [] };\n      \n      const advancedFingerprintData = requestBody.advancedFingerprint;\n      let advancedFingerprint: AdvancedFingerprint | undefined;\n      if (settings.advancedFingerprinting && advancedFingerprintData && typeof advancedFingerprintData === 'object') {\n        const maxPayloadSize = 10000;\n        const payloadStr = JSON.stringify(advancedFingerprintData);\n        \n        if (payloadStr.length > maxPayloadSize) {\n          console.log(`[SECURITY] Rejected oversized advanced fingerprint payload: ${payloadStr.length} bytes`);\n          ipBlocker.recordFailedAttempt(clientIP);\n          return res.status(400).json({ \n            error: \"Invalid request\",\n            message: \"Request payload too large\"\n          });\n        }\n        \n        const allowedKeys = ['canvasHash', 'webglHash', 'audioHash', 'fonts', 'screenFingerprint', \n                            'plugins', 'timezone', 'platform', 'hardwareConcurrency', \n                            'deviceMemory', 'colorDepth', 'pixelRatio'];\n        \n        const hasInvalidKeys = Object.keys(advancedFingerprintData).some(\n          key => !allowedKeys.includes(key)\n        );\n        \n        if (hasInvalidKeys) {\n          console.log(`[SECURITY] Rejected advanced fingerprint with invalid keys`);\n          ipBlocker.recordFailedAttempt(clientIP);\n          return res.status(400).json({ \n            error: \"Invalid request\",\n            message: \"Invalid fingerprint data\"\n          });\n        }\n        \n        advancedFingerprint = generateAdvancedFingerprint(advancedFingerprintData);\n        console.log(`[SECURITY] Advanced fingerprint collected (confidence: ${advancedFingerprint.confidence}%)`);\n      }\n      \n      const honeypotCheck = checkEnhancedHoneypot(req, ENHANCED_HONEYPOT_CONFIG);\n      if (honeypotCheck.shouldBlock) {\n        console.log(`[HONEYPOT] Bot detected: ${honeypotCheck.details.join(', ')}`);\n        ipBlocker.recordFailedAttempt(clientIP);\n        return res.status(403).json({ \n          error: \"Security check failed\",\n          message: \"Suspicious activity detected\"\n        });\n      }\n      \n      trackDeviceFingerprint(deviceFingerprint);\n\n      const ipFailures = ipBlocker.getFailureCount(clientIP);\n      const baseRiskScore = calculateRiskScore(\n        req,\n        automationCheck,\n        deviceFingerprint,\n        0,\n        ipFailures\n      );\n      \n      const totalRiskScore = Math.min(\n        baseRiskScore.riskScore + \n        honeypotCheck.riskScore + \n        (advancedFingerprint && !advancedFingerprint.isReliable ? 10 : 0),\n        100\n      );\n      \n      const riskAssessment = {\n        ...baseRiskScore,\n        riskScore: totalRiskScore,\n        riskLevel: totalRiskScore > 70 ? 'critical' as const :\n                   totalRiskScore > 50 ? 'high' as const :\n                   totalRiskScore > 30 ? 'medium' as const :\n                   'low' as const\n      };\n\n      securityMonitor.logEvent({\n        type: \"challenge_request\",\n        ip: clientIP,\n        riskLevel: riskAssessment.riskLevel,\n        riskScore: riskAssessment.riskScore,\n        details: {\n          automationScore: automationCheck.score,\n          deviceScore: deviceFingerprint.score,\n          behavioralScore: behavioralPattern.confidence,\n        },\n      });\n\n      console.log(`[SECURITY] Challenge request from ${clientIP}: Risk=${riskAssessment.riskLevel} (${riskAssessment.riskScore}), Automation=${automationCheck.score}, Device=${deviceFingerprint.score}, Behavioral=${behavioralPattern.confidence}`);\n      \n      if (riskAssessment.riskLevel === \"critical\" || automationCheck.isAutomation || behavioralPattern.isBot) {\n        console.log(\"High-confidence threat detected, blocking request\");\n        ipBlocker.recordFailedAttempt(clientIP);\n        securityMonitor.logEvent({\n          type: \"threat_blocked\",\n          ip: clientIP,\n          riskLevel: riskAssessment.riskLevel,\n          riskScore: riskAssessment.riskScore,\n          details: {\n            reasons: [...automationCheck.detectedBy, ...deviceFingerprint.signals, ...behavioralPattern.patterns],\n          },\n        });\n        return res.status(403).json({ \n          error: \"Security check failed\",\n          message: \"Please use a real browser to access this service\"\n        });\n      }\n\n      const { type, encryptedClientData, requestNonce, protocol: encryptionProtocol } = requestBody;\n\n      // SECURITY: Decrypt client data if encrypted\n      let clientDetections: any;\n      let fingerprintData: any = {};\n      let behavioralData: any = {};\n      let isEncrypted = false;\n\n      if (encryptionProtocol === 'encrypted-v1' && encryptedClientData && requestNonce) {\n        console.log('[ENCRYPTION] Received encrypted client data, attempting to decrypt...');\n        \n        // Get session key from cache using API publicKey + client IP + device fingerprint ID\n        const sessionKey = sessionCache.getSession(publicKey, clientIP, deviceFingerprint.id);\n        \n        if (!sessionKey || !sessionKey.masterKey) {\n          console.warn('[ENCRYPTION] No valid session found for decryption');\n          return res.status(409).json({\n            error: \"Session expired\",\n            message: \"Encryption session has expired, please refresh and try again\"\n          });\n        }\n\n        // SECURITY FIX: Validate session has not expired\n        const now = Date.now();\n        if (sessionKey.expiresAt <= now) {\n          const expiredBy = now - sessionKey.expiresAt;\n          console.warn(`[ENCRYPTION] Session expired ${Math.ceil(expiredBy / 1000)}s ago`);\n          // Invalidate expired session immediately\n          sessionCache.invalidateSession(publicKey, clientIP, deviceFingerprint.id);\n          return res.status(409).json({\n            error: \"Session expired\",\n            message: \"Encryption session has expired, please refresh and try again\"\n          });\n        }\n        \n        try {\n          // Decrypt client data using session key and requestNonce as challengeId\n          const decrypted = await decryptSolutionData(\n            encryptedClientData,\n            sessionKey,\n            requestNonce\n          );\n          \n          if (decrypted) {\n            console.log('[ENCRYPTION] Client data decrypted successfully');\n            clientDetections = decrypted.clientDetections;\n            fingerprintData = decrypted.fingerprint || {};\n            behavioralData = decrypted.behavioral || {};\n            isEncrypted = true;\n          } else {\n            console.error('[ENCRYPTION] Decryption failed - invalid payload or key');\n            ipBlocker.recordFailedAttempt(clientIP);\n            return res.status(400).json({\n              error: \"Decryption failed\",\n              message: \"Unable to decrypt client data\"\n            });\n          }\n        } catch (decryptError) {\n          console.error('[ENCRYPTION] Decryption error:', decryptError);\n          ipBlocker.recordFailedAttempt(clientIP);\n          return res.status(400).json({\n            error: \"Decryption error\",\n            message: \"Failed to decrypt client data\"\n          });\n        }\n      } else {\n        // Fallback to plaintext (for browsers without encryption support)\n        console.log('[ENCRYPTION] Using plaintext client data (fallback mode)');\n        clientDetections = requestBody.clientDetections;\n        \n        // Collect fingerprint data from individual fields\n        fingerprintData = {\n          canvasHash: requestBody.canvasHash,\n          webglHash: requestBody.webglHash,\n          audioHash: requestBody.audioHash,\n          fonts: requestBody.fonts,\n          screenFingerprint: requestBody.screenFingerprint,\n          plugins: requestBody.plugins,\n          timezone: requestBody.timezone,\n          platform: requestBody.platform,\n          hardwareConcurrency: requestBody.hardwareConcurrency,\n          deviceMemory: requestBody.deviceMemory,\n          colorDepth: requestBody.colorDepth,\n          pixelRatio: requestBody.pixelRatio,\n        };\n        \n        behavioralData = {\n          mouseMovements: requestBody.mouseMovements,\n          keyboardEvents: requestBody.keyboardEvents,\n          submissionTime: requestBody.submissionTime,\n        };\n        \n        isEncrypted = false;\n      }\n\n      // Log encryption status for security audit (using existing event type)\n      if (!isEncrypted) {\n        securityMonitor.logEvent({\n          type: \"challenge_request\",\n          ip: clientIP,\n          riskLevel: \"medium\",\n          riskScore: 10,\n          details: {\n            encrypted: false,\n            protocol: 'plaintext',\n            warning: 'Unencrypted client data transmission'\n          }\n        });\n      }\n\n      // Log client-side detections but don't block unless high confidence\n      if (clientDetections && Array.isArray(clientDetections) && clientDetections.length > 0) {\n        console.log(\"Client-side automation signals detected:\", clientDetections);\n        \n        // Only block for high-confidence automation signals\n        const highConfidenceSignals = ['webdriver', 'webdriver-attribute', 'missing-storage'];\n        const hasHighConfidence = clientDetections.some((signal: string) => \n          highConfidenceSignals.includes(signal)\n        );\n        \n        if (hasHighConfidence) {\n          ipBlocker.recordFailedAttempt(clientIP);\n          return res.status(403).json({ \n            error: \"Automation detected\",\n            message: \"Automation tools are not allowed\"\n          });\n        }\n      }\n\n      // CRITICAL: ALWAYS enforce domain validation for security\n      // Every API key MUST have a domain restriction\n      if (!apiKey.domain) {\n        return res.status(403).json({ \n          error: \"Domain validation failed\",\n          message: \"API key must have a domain restriction configured\"\n        });\n      }\n\n      const origin = req.headers.origin || req.headers.referer;\n      if (!origin) {\n        return res.status(403).json({ \n          error: \"Domain validation failed\",\n          message: \"Origin or Referer header is required\"\n        });\n      }\n\n      // SECURITY: Extract and validate domain from request\n      // This will be saved server-side to prevent header spoofing\n      const requestDomain = extractDomainFromRequest(req);\n      if (!requestDomain) {\n        return res.status(403).json({ \n          error: \"Domain validation failed\",\n          message: \"Cannot determine request origin\"\n        });\n      }\n\n      // Check if wildcard domain (for demo purposes)\n      if (apiKey.domain !== \"*\") {\n        const allowedDomain = apiKey.domain.replace(/^(https?:\\/\\/)/, '').replace(/\\/$/, '');\n        \n        // Check if domains match (exact match or subdomain)\n        const isMatch = requestDomain === allowedDomain || \n                       requestDomain.endsWith('.' + allowedDomain);\n        \n        if (!isMatch) {\n          return res.status(403).json({ \n            error: \"Domain validation failed\",\n            message: `This API key is restricted to domain: ${allowedDomain}. Request from: ${requestDomain}`\n          });\n        }\n      }\n\n      // Determine challenge type - use only types enabled in settings\n      const enabledTypes = settings.enabledChallengeTypes;\n      let challengeType: string;\n      \n      if (!type || type === \"random\") {\n        // SECURITY FIX: Random selection using cryptographically secure random\n        challengeType = enabledTypes[crypto.randomInt(0, enabledTypes.length)];\n      } else if (enabledTypes.includes(type as any)) {\n        challengeType = type;\n      } else {\n        return res.status(400).json({ \n          error: \"Invalid challenge type\",\n          message: `This API key only supports: ${enabledTypes.join(', ')}`\n        });\n      }\n\n      // Generate challenge based on type with difficulty from settings\n      let challengeData: any;\n      let baseDifficulty: number;\n      let difficulty: number;\n\n      // Use configured proof-of-work difficulty as base\n      baseDifficulty = settings.proofOfWorkDifficulty;\n      \n      // Apply risk-based adaptive difficulty only if enabled in settings\n      if (settings.riskAdaptiveDifficulty) {\n        difficulty = calculateAdaptiveDifficulty(baseDifficulty, riskAssessment);\n      } else {\n        difficulty = baseDifficulty;\n      }\n\n      // SECURITY FIX Bug #3: Create context for HMAC binding\n      const challengeContext = {\n        timestamp: Date.now(),\n        nonce: nanoid(16),\n        apiKey: publicKey,\n        fingerprint: deviceFingerprint + (advancedFingerprint ? `|${advancedFingerprint.hash}` : '')\n      };\n\n      if (challengeType === \"grid\") {\n        // SECURITY FIX: All random generation uses crypto.randomInt for unpredictability\n        const gridSize = crypto.randomInt(0, 2) === 0 ? 3 : 4;\n        const totalCells = gridSize * gridSize;\n        \n        const emojiOptions = [\"üçé\", \"üçä\", \"üçã\", \"üçå\", \"üçá\", \"üçì\", \"üçí\", \"üçë\", \"ü•ù\", \"ü••\", \"üçç\", \"ü•≠\", \"üçà\", \"üçâ\", \"ü´ê\", \"üçè\"];\n        \n        const targetEmoji = emojiOptions[crypto.randomInt(0, emojiOptions.length)];\n        const otherEmojis = emojiOptions.filter(e => e !== targetEmoji);\n        \n        const numTargetCells = gridSize === 3 ? (crypto.randomInt(0, 2) === 0 ? 2 : 3) : (crypto.randomInt(0, 2) === 0 ? 3 : 4);\n        \n        const gridEmojis: string[] = [];\n        const correctCells: number[] = [];\n        \n        const targetPositions = new Set<number>();\n        while (targetPositions.size < numTargetCells) {\n          targetPositions.add(crypto.randomInt(0, totalCells));\n        }\n        \n        for (let i = 0; i < totalCells; i++) {\n          if (targetPositions.has(i)) {\n            gridEmojis.push(targetEmoji);\n            correctCells.push(i);\n          } else {\n            gridEmojis.push(otherEmojis[crypto.randomInt(0, otherEmojis.length)]);\n          }\n        }\n        \n        challengeData = {\n          ...generateChallenge(difficulty, challengeContext),\n          gridSize,\n          gridEmojis,\n          targetEmojis: [targetEmoji],\n          correctCells: correctCells.sort((a, b) => a - b),\n        };\n      } else if (challengeType === \"jigsaw\") {\n        // SECURITY FIX: Fisher-Yates shuffle using crypto.randomInt (secure shuffle)\n        const pieces = [0, 1, 2, 3];\n        const shuffled = [...pieces];\n        for (let i = shuffled.length - 1; i > 0; i--) {\n          const j = crypto.randomInt(0, i + 1);\n          [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];\n        }\n        challengeData = {\n          ...generateChallenge(difficulty, challengeContext),\n          pieces: shuffled,\n          correctOrder: pieces,\n        };\n      } else if (challengeType === \"gesture\") {\n        // SECURITY FIX: All random generation uses crypto.randomInt\n        // Generate random target position (x, y coordinates)\n        // Grid size defines the bounds for the draggable area\n        const gridWidth = 300;\n        const gridHeight = 300;\n        \n        // Target position with some padding from edges\n        const padding = 40;\n        const targetX = crypto.randomInt(padding, gridWidth - padding);\n        const targetY = crypto.randomInt(padding, gridHeight - padding);\n        \n        // Tolerance for matching (in pixels) - adjust based on difficulty\n        const tolerance = 15;\n        \n        // Generate puzzle piece seed for deterministic shape\n        const puzzleSeed = crypto.randomInt(0, 10000);\n        \n        // Random image from Lorem Picsum (free, no API key, high quality)\n        const imageSeed = crypto.randomInt(0, 1000);\n        const puzzleImageUrl = `https://picsum.photos/seed/${imageSeed}/400/400`;\n        \n        challengeData = {\n          ...generateChallenge(difficulty, challengeContext),\n          gridSize: { width: gridWidth, height: gridHeight },\n          target: { x: targetX, y: targetY },\n          tolerance,\n          puzzleSeed,\n          puzzleImageUrl,\n        };\n      } else if (challengeType === \"upside_down\") {\n        \n        const upsideDownData = generateUpsideDownChallenge();\n        \n        // Get server origin to convert relative paths to absolute URLs\n        const serverOrigin = getServerOrigin(req);\n        \n        // Convert relative paths to absolute URLs for external website access\n        const BACKGROUND_PATHS = [\n          '/assets/stock_images/floral_pattern_green_a3b1b488.jpg',\n          '/assets/stock_images/floral_pattern_green_7eb03bb9.jpg',\n        ];\n        \n        challengeData = {\n          ...generateChallenge(difficulty, challengeContext),\n          ...upsideDownData,\n          backgroundUrl: new URL(BACKGROUND_PATHS[upsideDownData.backgroundIndex], serverOrigin).toString(),\n          animals: upsideDownData.animals.map(a => ({\n            ...a,\n            path: new URL(a.path, serverOrigin).toString(),\n          })),\n        };\n      } else {\n        difficulty = calculateAdaptiveDifficulty(baseDifficulty, riskAssessment);\n        challengeData = generateChallenge(difficulty, challengeContext);\n      }\n\n      console.log(`[SECURITY] Generated ${challengeType} challenge with adaptive difficulty: ${difficulty} (base: ${baseDifficulty}, risk: ${riskAssessment.riskLevel})`);\n\n      // Create JWT token WITHOUT sensitive data (correctCells, correctOrder)\n      // Only include non-sensitive challenge data needed for client-side display\n      const clientChallengeData = { ...challengeData };\n      delete clientChallengeData.correctCells;\n      delete clientChallengeData.correctOrder;\n      // For gesture challenges, keep target for UI visualization (user needs to see where to drag)\n      // For grid/jigsaw, delete target/correctCells as those are the answers\n      if (challengeType !== \"gesture\") {\n        delete clientChallengeData.target;\n      }\n      // For upside_down challenges, do NOT send rotation data in plaintext mode\n      // Rotation will be added later ONLY in encrypted payload\n      // This prevents bots from reading which animals are upside-down\n      if (challengeType === \"upside_down\") {\n        // Send animal positions, types, and paths, but NOT rotation\n        // Rotation will be added in encrypted payload only\n        clientChallengeData.animals = (challengeData.animals as any[]).map(a => ({\n          id: a.id,\n          x: a.x,\n          y: a.y,\n          animalType: a.animalType,\n          path: a.path,\n          // No rotation field here - will be added in encrypted mode only\n        }));\n      }\n      // gridEmojis and targetEmoji are safe to send - they're needed for display\n      // but correctCells and correctOrder (the answers) must stay in database only\n\n      const token = jwt.sign(\n        {\n          challengeData: clientChallengeData,\n          type: challengeType,\n          apiKeyId: apiKey.id,\n        },\n        JWT_SECRET,\n        { expiresIn: `${Math.ceil(settings.challengeTimeoutMs / 1000)}s` }\n      );\n\n      // SECURITY: Generate HMAC signature to bind challenge to validated domain\n      // This prevents replay attacks and ensures challenge is only valid for the original domain\n      const signature = generateChallengeSignature(token, requestDomain, apiKey.secretkey);\n\n      // SECURITY: Generate session fingerprint untuk bind challenge ke session\n      const sessionFp = generateSessionFingerprint(req);\n      console.log(`[SECURITY] Challenge created with session fingerprint (confidence: ${sessionFp.confidence}%)`);\n      \n      // SECURITY: Store advanced fingerprint if available\n      let advancedFpHash: string | undefined;\n      if (advancedFingerprint) {\n        advancedFpHash = advancedFingerprint.hash;\n        console.log(`[SECURITY] Challenge bound to advanced fingerprint`);\n      }\n\n      // Save full challenge data (including correct answers) in database\n      // Use timeout from settings instead of hardcoded value\n      const expiresAt = new Date(Date.now() + settings.challengeTimeoutMs);\n      await storage.createChallenge({\n        token,\n        difficulty,\n        challengeData, // Store complete data with correct answers in DB\n        type: challengeType,\n        apiKeyId: apiKey.id,\n        validatedDomain: requestDomain, // SECURITY: Store validated domain server-side\n        signature, // SECURITY: HMAC signature to prevent tampering\n        sessionFingerprint: sessionFp.hash, // SECURITY: Session binding to prevent token stealing\n        isUsed: false,\n        expiresAt,\n      });\n\n      // ENCRYPTION: Server-side encryption support determination\n      // SECURITY: Server determines encryption based on session existence ONLY\n      // Client cannot manipulate this - if session exists, encryption is MANDATORY\n      const sessionKey = sessionCache.getSession(\n        publicKey,\n        clientIP,\n        deviceFingerprint.id\n      );\n\n      let encryptedChallenge: EncryptedPayload | undefined;\n      let protocol: string;\n\n      // CRITICAL: upside_down challenges REQUIRE encryption to prevent answer leakage\n      if (challengeType === \"upside_down\" && !sessionKey) {\n        console.error(\"[UPSIDE_DOWN] Encryption required but no session found\");\n        return res.status(400).json({\n          error: \"Encryption required\",\n          message: \"Upside-down challenges require encryption. Please refresh and try again.\"\n        });\n      }\n\n      if (sessionKey) {\n        // Session exists - encryption is MANDATORY\n        // This prevents downgrade attacks - client cannot request plaintext\n        console.log(`[ENCRYPTION] Session found for ${publicKey.substring(0, 12)}... - encryption enforced`);\n        \n        // For upside_down, include rotation in encrypted data\n        let dataToEncrypt = clientChallengeData;\n        if (challengeType === \"upside_down\") {\n          dataToEncrypt = {\n            ...clientChallengeData,\n            animals: (challengeData.animals as any[]).map(a => ({\n              id: a.id,\n              x: a.x,\n              y: a.y,\n              animalType: a.animalType,\n              path: a.path,\n              rotation: a.orientation === 'upside_down' ? 180 : 0,\n            }))\n          };\n        }\n        \n        // Encrypt challenge data\n        try {\n          encryptedChallenge = encryptChallengeData(\n            dataToEncrypt,\n            sessionKey,\n            token // Use token as challenge ID for key derivation\n          );\n          \n          protocol = \"encrypted-v1\";\n          console.log(`[ENCRYPTION] Challenge data encrypted successfully`);\n        } catch (error) {\n          console.error(\"[ENCRYPTION] Failed to encrypt challenge:\", error);\n          return res.status(500).json({ \n            error: \"Encryption failed\",\n            message: \"Cannot encrypt challenge data\"\n          });\n        }\n      } else {\n        // No session - use plaintext (legacy/transition mode or encryption not available)\n        protocol = \"plaintext\";\n        console.log(`[ENCRYPTION] No session found, using plaintext mode`);\n      }\n\n      // SECURITY: Prepare security configuration\n      const securityConfig = {\n        antiDebugger: settings.antiDebugger,\n        challengeTimeoutMs: settings.challengeTimeoutMs,\n        tokenExpiryMs: settings.tokenExpiryMs,\n        advancedFingerprinting: settings.advancedFingerprinting,\n        // Note: Domain validation and encryption are ALWAYS enforced server-side\n        // and cannot be disabled regardless of these client settings\n      };\n\n      // Send to client WITHOUT correct answers\n      const response: any = {\n        token,\n        type: challengeType,\n        expiresAt,\n        protocol,\n      };\n\n      // CRITICAL SECURITY: Encrypt securityConfig to prevent client-side manipulation\n      // This prevents attackers from:\n      // - Disabling anti-debugger protection\n      // - Extending timeouts to bypass time-based defenses\n      // - Turning off fingerprinting to avoid detection\n      if (sessionKey) {\n        // Session exists - encrypt security config (MANDATORY)\n        try {\n          const encryptedConfig = encryptSecurityConfig(\n            securityConfig,\n            sessionKey,\n            token // Use token as challenge ID for key derivation\n          );\n          response.encryptedSecurityConfig = encryptedConfig;\n          console.log(`[ENCRYPTION] Security config encrypted successfully`);\n        } catch (error) {\n          console.error(\"[ENCRYPTION] Failed to encrypt security config:\", error);\n          return res.status(500).json({ \n            error: \"Encryption failed\",\n            message: \"Cannot encrypt security configuration\"\n          });\n        }\n      } else {\n        // No session - CRITICAL: Do not send sensitive security config in plaintext\n        // Send minimal safe defaults only - actual enforcement is always server-side\n        response.securityConfig = {\n          challengeTimeoutMs: 60000, // Safe default timeout\n          tokenExpiryMs: 60000, // Safe default expiry\n          // Do NOT send antiDebugger or advancedFingerprinting flags in plaintext\n          // These could be manipulated by attackers\n        };\n        console.warn(`[SECURITY] No session - sending minimal security config (server enforcement still active)`);\n      }\n\n      if (encryptedChallenge) {\n        response.encrypted = encryptedChallenge;\n      } else {\n        response.challenge = clientChallengeData;\n      }\n\n      // OBFUSCATION: Add base64 encoding layer to hide response structure\n      // This prevents casual inspection of response format in network tab\n      // and adds an additional layer of obfuscation for security\n      const jsonString = JSON.stringify(response);\n      const base64Encoded = Buffer.from(jsonString, 'utf-8').toString('base64');\n      \n      console.log(`[OBFUSCATION] Response encoded (${jsonString.length} -> ${base64Encoded.length} bytes)`);\n      \n      // Send base64-encoded response\n      res.json({\n        data: base64Encoded\n      });\n    } catch (error) {\n      console.error(\"Challenge generation error:\", error);\n      res.status(500).json({ error: \"Failed to generate challenge\" });\n    }\n  });\n\n  // Verify solution\n  app.post(\"/api/captcha/verify\", verifyLimiter, async (req: Request, res: Response) => {\n    const startTime = Date.now();\n    try {\n      const clientIP = ipBlocker.getClientIP(req);\n      if (ipBlocker.isBlocked(clientIP)) {\n        const blockInfo = ipBlocker.getBlockInfo(clientIP);\n        const remainingTime = blockInfo ? Math.ceil((blockInfo.expiresAt - Date.now()) / 1000 / 60) : 0;\n        \n        return res.status(429).json({ \n          success: false,\n          error: \"IP blocked\",\n          message: `Your IP has been blocked due to too many failed attempts. Please try again in ${remainingTime} minutes.`,\n          remainingTime,\n        });\n      }\n\n      // Note: We'll load settings after getting the API key from token\n      // For now, run basic checks - will be conditionally applied later\n      const deviceFingerprint = generateDeviceFingerprint(req);\n      \n      trackDeviceFingerprint(deviceFingerprint);\n\n      const { token, solution, encrypted, encryptedMetadata, clientDetections, publicKey } = req.body;\n\n      if (!token) {\n        return res.status(400).json({\n          success: false,\n          error: \"Token is required\",\n        });\n      }\n\n      // ENCRYPTION: Decrypt solution if encrypted\n      let decryptedSolution: any;\n      \n      if (encrypted) {\n        // Solution is encrypted - must decrypt it\n        if (!publicKey) {\n          return res.status(400).json({\n            success: false,\n            error: \"publicKey required for encrypted solution\",\n          });\n        }\n\n        // Get session key\n        const sessionKey = sessionCache.getSession(\n          publicKey,\n          clientIP,\n          deviceFingerprint.id\n        );\n\n        if (!sessionKey) {\n          console.error(\"[ENCRYPTION] No valid session for encrypted solution\");\n          return res.status(403).json({\n            success: false,\n            error: \"Invalid session\",\n            message: \"Cannot decrypt solution - session expired or invalid\",\n          });\n        }\n\n        // Decrypt solution\n        const decrypted = decryptSolutionData(\n          encrypted,\n          sessionKey,\n          token // Use token as challenge ID\n        );\n\n        if (!decrypted) {\n          console.error(\"[ENCRYPTION] Failed to decrypt solution\");\n          ipBlocker.recordFailedAttempt(clientIP);\n          return res.status(400).json({\n            success: false,\n            error: \"Decryption failed\",\n            message: \"Cannot decrypt solution - invalid ciphertext or tampered data\",\n          });\n        }\n\n        decryptedSolution = decrypted;\n        console.log(`[ENCRYPTION] Solution decrypted successfully`);\n      } else {\n        // Plaintext solution (legacy/transition mode)\n        if (!solution) {\n          return res.status(400).json({\n            success: false,\n            error: \"Solution is required\",\n          });\n        }\n        decryptedSolution = solution;\n      }\n\n      // Use decryptedSolution for the rest of the verification logic\n      const solutionToVerify = decryptedSolution;\n\n      // ENCRYPTION: Decrypt verification metadata if encrypted\n      let verificationMetadata: any = {};\n      \n      if (encryptedMetadata) {\n        if (!publicKey) {\n          return res.status(400).json({\n            success: false,\n            error: \"publicKey required for encrypted metadata\",\n          });\n        }\n\n        const sessionKey = sessionCache.getSession(\n          publicKey,\n          clientIP,\n          deviceFingerprint.id\n        );\n\n        if (!sessionKey) {\n          console.error(\"[ENCRYPTION] No valid session for encrypted metadata\");\n          return res.status(403).json({\n            success: false,\n            error: \"Invalid session\",\n            message: \"Cannot decrypt metadata - session expired or invalid\",\n          });\n        }\n\n        // Decrypt metadata\n        const decryptedMetadata = decryptVerificationMetadata(\n          encryptedMetadata,\n          sessionKey,\n          token\n        );\n\n        if (!decryptedMetadata) {\n          console.error(\"[ENCRYPTION] Failed to decrypt verification metadata\");\n          ipBlocker.recordFailedAttempt(clientIP);\n          return res.status(400).json({\n            success: false,\n            error: \"Metadata decryption failed\",\n            message: \"Cannot decrypt metadata - invalid ciphertext or tampered data\",\n          });\n        }\n\n        verificationMetadata = decryptedMetadata;\n        console.log(`[ENCRYPTION] Verification metadata decrypted successfully`);\n      } else {\n        // Plaintext metadata (legacy/transition mode)\n        verificationMetadata = {\n          clientDetections: req.body.clientDetections,\n          canvasHash: req.body.canvasHash,\n          webglHash: req.body.webglHash,\n          audioHash: req.body.audioHash,\n          fonts: req.body.fonts,\n          screenFingerprint: req.body.screenFingerprint,\n          plugins: req.body.plugins,\n          timezone: req.body.timezone,\n          platform: req.body.platform,\n          hardwareConcurrency: req.body.hardwareConcurrency,\n          deviceMemory: req.body.deviceMemory,\n          colorDepth: req.body.colorDepth,\n          pixelRatio: req.body.pixelRatio,\n          mouseMovements: req.body.mouseMovements,\n          keyboardEvents: req.body.keyboardEvents,\n          submissionTime: req.body.submissionTime\n        };\n      }\n\n      // Assign behavioral data back to req.body so analyzeBehavior can read it\n      req.body.mouseMovements = verificationMetadata.mouseMovements;\n      req.body.keyboardEvents = verificationMetadata.keyboardEvents;\n      req.body.submissionTime = verificationMetadata.submissionTime;\n\n      // This section moved after API key loading - will be updated later\n\n      // Log client-side detections but don't block unless high confidence\n      const clientDetectionsToCheck = verificationMetadata.clientDetections;\n      if (clientDetectionsToCheck && Array.isArray(clientDetectionsToCheck) && clientDetectionsToCheck.length > 0) {\n        console.log(\"Client-side automation signals during verification:\", clientDetectionsToCheck);\n        \n        // Only block for high-confidence automation signals\n        const highConfidenceSignals = ['webdriver', 'webdriver-attribute', 'missing-storage'];\n        const hasHighConfidence = clientDetectionsToCheck.some((signal: string) => \n          highConfidenceSignals.includes(signal)\n        );\n        \n        if (hasHighConfidence) {\n          ipBlocker.recordFailedAttempt(clientIP);\n          return res.json({\n            success: false,\n            error: \"Automation detected\",\n          });\n        }\n      }\n\n      // SECURITY FIX: Validate domain FIRST before any DB queries to prevent enumeration attacks\n      // Extract domain from current request\n      const requestDomain = extractDomainFromRequest(req);\n      if (!requestDomain) {\n        return res.json({\n          success: false,\n          error: \"Verification failed\",\n        });\n      }\n\n      // Verify JWT token and extract API key info\n      let decoded: any;\n      try {\n        decoded = jwt.verify(token, JWT_SECRET);\n      } catch (err) {\n        return res.json({\n          success: false,\n          error: \"Verification failed\",\n        });\n      }\n\n      // Check if challenge exists and not used\n      const challenge = await storage.getChallengeByToken(token);\n      if (!challenge) {\n        return res.json({\n          success: false,\n          error: \"Verification failed\",\n        });\n      }\n\n      // SECURITY: Validate domain IMMEDIATELY after getting challenge\n      // This prevents enumeration of valid tokens from different domains\n      if (requestDomain !== challenge.validatedDomain) {\n        ipBlocker.recordFailedAttempt(clientIP);\n        return res.json({\n          success: false,\n          error: \"Verification failed\",\n        });\n      }\n\n      // Get API key from the decoded token\n      const apiKey = await storage.getApiKey(decoded.apiKeyId);\n      if (!apiKey || !apiKey.isActive) {\n        return res.status(401).json({\n          success: false,\n          error: \"Verification failed\",\n        });\n      }\n\n      // Load security settings for this API key\n      // CRITICAL SECURITY: Settings are loaded SERVER-SIDE ONLY from database\n      // Client CANNOT manipulate or override these settings\n      const settings = (apiKey.settings as SecuritySettings | null) || DEFAULT_SECURITY_SETTINGS;\n\n      // FIXED: Check IP and country blocking\n      const geoData = await getGeolocationFromIP(clientIP);\n      const blockCheck = ipBlocker.checkSecurityBlocking(clientIP, geoData.country, settings);\n      \n      if (blockCheck.blocked) {\n        console.log(`[SECURITY] Blocked verification from IP ${clientIP} / Country ${geoData.country}: ${blockCheck.reason}`);\n        return res.json({\n          success: false,\n          error: \"Access denied\",\n          message: blockCheck.reason\n        });\n      }\n\n      // Perform conditional security checks based on settings\n      const automationCheck = settings.automationDetection ? detectAutomation(req) : { isAutomation: false, score: 0, detectedBy: [] };\n      const behavioralPattern = settings.behavioralAnalysis ? analyzeBehavior(req) : { confidence: 0, isBot: false, patterns: [] };\n\n      const ipFailures = ipBlocker.getFailureCount(clientIP);\n      const riskAssessment = calculateRiskScore(\n        req,\n        automationCheck,\n        deviceFingerprint,\n        0,\n        ipFailures\n      );\n\n      console.log(`[SECURITY] Verification from ${clientIP}: Risk=${riskAssessment.riskLevel} (${riskAssessment.riskScore})`);\n      \n      if (riskAssessment.riskLevel === \"critical\" || automationCheck.isAutomation || behavioralPattern.isBot) {\n        console.log(\"High-confidence threat detected during verification\");\n        ipBlocker.recordFailedAttempt(clientIP);\n        \n        return res.json({\n          success: false,\n          error: \"Security check failed\",\n          message: \"Please use a real browser to access this service\"\n        });\n      }\n\n      // SECURITY: Verify HMAC signature to prevent tampering\n      // This ensures the challenge token hasn't been modified and is bound to the original domain\n      const isSignatureValid = verifyChallengeSignature(\n        token,\n        challenge.validatedDomain,\n        apiKey.secretkey,\n        challenge.signature\n      );\n      \n      if (!isSignatureValid) {\n        ipBlocker.recordFailedAttempt(clientIP);\n        return res.json({\n          success: false,\n          error: \"Verification failed\",\n        });\n      }\n\n      // SECURITY: Verify session fingerprint binding (only if enabled in settings)\n      // This prevents token stealing across different devices/browsers\n      if (settings.sessionBinding && challenge.sessionFingerprint) {\n        const bindingCheck = verifySessionBinding(\n          challenge.sessionFingerprint,\n          req,\n          DEFAULT_SESSION_BINDING_CONFIG\n        );\n        \n        if (!bindingCheck.isValid) {\n          console.log(`[SECURITY] Session fingerprint mismatch in verification: ${bindingCheck.reason}`);\n          ipBlocker.recordFailedAttempt(clientIP);\n          \n          securityMonitor.logEvent({\n            type: \"verification_failure\",\n            ip: clientIP,\n            riskLevel: \"high\",\n            riskScore: 80,\n            details: {\n              reason: \"session_fingerprint_mismatch\",\n              similarity: bindingCheck.similarity,\n            },\n          });\n          \n          return res.json({\n            success: false,\n            error: \"Verification failed\",\n          });\n        }\n        \n        console.log(`[SECURITY] Session fingerprint verified (similarity: ${bindingCheck.similarity?.toFixed(2)})`);\n      }\n\n      if (challenge.isUsed || isChallengeUsed(token)) {\n        console.log(`[SECURITY] Replay attack attempt detected: Challenge ${token.substring(0, 20)}... already used`);\n        ipBlocker.recordFailedAttempt(clientIP);\n        securityMonitor.logEvent({\n          type: \"replay_attack\",\n          ip: clientIP,\n          details: { token: token.substring(0, 30) },\n        });\n        return res.json({\n          success: false,\n          error: \"Challenge already used\",\n        });\n      }\n\n      const expirationCheck = checkChallengeExpiration(challenge.createdAt, DEFAULT_EXPIRATION_CONFIG);\n      if (!expirationCheck.isValid) {\n        return res.json({\n          success: false,\n          error: \"Challenge expired\",\n          message: expirationCheck.message,\n        });\n      }\n\n      // Verify based on challenge type\n      // IMPORTANT: Get correct answers from database, NOT from JWT token\n      // This prevents attackers from decoding the JWT to see the answers\n      let isValid = false;\n      \n      if (challenge.type === \"grid\") {\n        // Grid challenge: verify selected cells match correct cells from DATABASE\n        // SECURITY: Also verify proof-of-work to prevent ML-based automated solvers\n        try {\n          const submission = JSON.parse(solutionToVerify);\n          \n          // Visual challenges send {answer: [...], powSolution: \"...\"}\n          const selectedCells = submission.answer || submission;\n          const powSolution = submission.powSolution;\n          const correctCells = (challenge.challengeData as any).correctCells;\n          \n          if (!correctCells || !Array.isArray(correctCells)) {\n            throw new Error(\"Invalid challenge data\");\n          }\n          \n          // SECURITY FIX: Use constant-time comparison to prevent timing attacks\n          // Sort both arrays first for consistent comparison\n          const sortedSelected = [...selectedCells].sort((a, b) => a - b);\n          const sortedCorrect = [...correctCells].sort((a, b) => a - b);\n          \n          // First verify the visual puzzle answer using constant-time comparison\n          isValid = constantTimeArrayEqual(sortedSelected, sortedCorrect);\n          \n          console.log(`[GRID] Verification: cellsMatch=${isValid}`);\n          \n          // Then verify proof-of-work to add computational cost for bots\n          if (isValid && powSolution) {\n            const powValid = verifyProofOfWork(challenge.challengeData, powSolution);\n            if (!powValid) {\n              console.log(`[GRID] Proof-of-work verification failed`);\n              isValid = false;\n            }\n          } else if (isValid && !powSolution) {\n            // PoW is required for defense-in-depth\n            console.log(`[GRID] Missing proof-of-work solution`);\n            isValid = false;\n          }\n        } catch (e) {\n          console.error(\"Grid verification error:\", e);\n          isValid = false;\n        }\n      } else if (challenge.type === \"jigsaw\") {\n        // Jigsaw challenge: verify piece order from DATABASE\n        // SECURITY: Also verify proof-of-work to prevent ML-based automated solvers\n        try {\n          const submission = JSON.parse(solutionToVerify);\n          \n          // Visual challenges send {answer: [...], powSolution: \"...\"}\n          const pieceOrder = submission.answer || submission;\n          const powSolution = submission.powSolution;\n          const correctOrder = (challenge.challengeData as any).correctOrder;\n          \n          if (!correctOrder) {\n            throw new Error(\"Invalid challenge data\");\n          }\n          \n          // SECURITY FIX: Use constant-time comparison to prevent timing attacks\n          // First verify the visual puzzle answer\n          isValid = constantTimeArrayEqual(pieceOrder, correctOrder);\n          \n          console.log(`[JIGSAW] Verification: puzzleValid=${isValid}`);\n          \n          // Then verify proof-of-work to add computational cost for bots\n          if (isValid && powSolution) {\n            const powValid = verifyProofOfWork(challenge.challengeData, powSolution);\n            if (!powValid) {\n              console.log(`[JIGSAW] Proof-of-work verification failed`);\n              isValid = false;\n            }\n          } else if (isValid && !powSolution) {\n            // PoW is required for defense-in-depth\n            console.log(`[JIGSAW] Missing proof-of-work solution`);\n            isValid = false;\n          }\n        } catch (e) {\n          console.error(\"Jigsaw verification error:\", e);\n          isValid = false;\n        }\n      } else if (challenge.type === \"gesture\") {\n        // Gesture challenge: verify x,y coordinates match target within tolerance\n        // SECURITY: Also verify proof-of-work to prevent ML-based automated solvers\n        try {\n          const submission = JSON.parse(solutionToVerify);\n          \n          // Visual challenges send {answer: {x, y}, powSolution: \"...\"}\n          const submittedPosition = submission.answer || submission;\n          const powSolution = submission.powSolution;\n          const target = (challenge.challengeData as any).target;\n          const tolerance = (challenge.challengeData as any).tolerance || 15;\n          \n          if (!target || typeof target.x !== 'number' || typeof target.y !== 'number') {\n            throw new Error(\"Invalid challenge data\");\n          }\n          \n          if (typeof submittedPosition.x !== 'number' || typeof submittedPosition.y !== 'number') {\n            throw new Error(\"Invalid solution format\");\n          }\n          \n          // SECURITY FIX: Use constant-time position matching to prevent timing attacks\n          // First verify the visual puzzle answer\n          isValid = constantTimePositionMatch(submittedPosition, target, tolerance);\n          \n          console.log(`[GESTURE] Verification: positionMatch=${isValid}`);\n          \n          // Then verify proof-of-work to add computational cost for bots\n          if (isValid && powSolution) {\n            const powValid = verifyProofOfWork(challenge.challengeData, powSolution);\n            if (!powValid) {\n              console.log(`[GESTURE] Proof-of-work verification failed`);\n              isValid = false;\n            }\n          } else if (isValid && !powSolution) {\n            // PoW is required for defense-in-depth\n            console.log(`[GESTURE] Missing proof-of-work solution`);\n            isValid = false;\n          }\n        } catch (e) {\n          console.error(\"Gesture verification error:\", e);\n          isValid = false;\n        }\n      } else if (challenge.type === \"upside_down\") {\n        // Upside-down challenge: verify clicked coordinates match all upside-down animals\n        // SECURITY: Also verify proof-of-work to prevent ML-based automated solvers\n        try {\n          const submission = JSON.parse(solutionToVerify);\n          \n          // Visual challenges send {answer: {clicks: [...]}, powSolution: \"...\"}\n          const submittedClicks = submission.answer || submission;\n          const powSolution = submission.powSolution;\n          \n          if (!submittedClicks || !submittedClicks.clicks || !Array.isArray(submittedClicks.clicks)) {\n            throw new Error(\"Invalid solution format - expected { clicks: [{x, y}, ...] }\");\n          }\n          \n          const challengeData = challenge.challengeData as UpsideDownChallengeData;\n          const validationResult = validateUpsideDownSolution(challengeData, submittedClicks.clicks);\n          \n          // First verify the visual puzzle answer\n          isValid = validationResult.valid;\n          \n          console.log(`[UPSIDE_DOWN] Verification: clicks=${submittedClicks.clicks.length}, puzzleValid=${isValid}, reason=${validationResult.reason || 'success'}`);\n          \n          if (!isValid && validationResult.details) {\n            console.log(`[UPSIDE_DOWN] Details:`, validationResult.details);\n          }\n          \n          // Then verify proof-of-work to add computational cost for bots\n          if (isValid && powSolution) {\n            const powValid = verifyProofOfWork(challenge.challengeData, powSolution);\n            if (!powValid) {\n              console.log(`[UPSIDE_DOWN] Proof-of-work verification failed`);\n              isValid = false;\n            }\n          } else if (isValid && !powSolution) {\n            // PoW is required for defense-in-depth\n            console.log(`[UPSIDE_DOWN] Missing proof-of-work solution`);\n            isValid = false;\n          }\n        } catch (e) {\n          console.error(\"Upside-down verification error:\", e);\n          isValid = false;\n        }\n      } else {\n        // Checkbox or slider: regular proof-of-work\n        isValid = verifyProofOfWork(challenge.challengeData, solutionToVerify);\n      }\n\n      const solveTime = Date.now() - startTime;\n      \n      // Mark challenge as used for auth endpoints (login/register) that check isUsed\n      // For external validation via siteverify, use the verificationToken instead\n      if (isValid) {\n        markChallengeAsUsed(token);\n        await storage.markChallengeAsUsed(challenge.id);\n      }\n\n      const userAgent = req.headers[\"user-agent\"];\n      // Note: geoData already fetched earlier for country blocking check\n\n      await storage.createVerification({\n        challengeId: challenge.id,\n        apiKeyId: apiKey.id,\n        success: isValid,\n        ipAddress: clientIP,\n        userAgent,\n        country: geoData.country,\n        countryName: geoData.countryName,\n        region: geoData.region,\n        city: geoData.city,\n        latitude: geoData.latitude,\n        longitude: geoData.longitude,\n        timezone: geoData.timezone,\n        timeToSolve: decoded.challengeData.timestamp\n          ? Date.now() - decoded.challengeData.timestamp\n          : null,\n        attemptData: { solution },\n      });\n\n      // Update daily analytics aggregates\n      await storage.updateDailyAnalytics(apiKey.id);\n      await storage.updateDailyCountryAnalytics(apiKey.id);\n      \n      if (!isValid) {\n        ipBlocker.recordFailedAttempt(clientIP);\n        securityMonitor.logEvent({\n          type: \"verification_failure\",\n          ip: clientIP,\n          riskLevel: riskAssessment.riskLevel,\n          riskScore: riskAssessment.riskScore,\n          details: { solveTime, challengeType: challenge.type },\n        });\n        console.log(`[SECURITY] Verification failed from ${clientIP} (solve time: ${solveTime}ms)`);\n        \n        if (ipBlocker.isBlocked(clientIP)) {\n          const blockInfo = ipBlocker.getBlockInfo(clientIP);\n          const remainingTime = blockInfo ? Math.ceil((blockInfo.expiresAt - Date.now()) / 1000 / 60) : 0;\n          \n          return res.json({\n            success: false,\n            message: `Too many failed attempts. Your IP has been blocked for ${remainingTime} minutes.`,\n            blocked: true,\n            remainingTime,\n          });\n        }\n      } else {\n        ipBlocker.resetAttempts(clientIP);\n        securityMonitor.logEvent({\n          type: \"verification_success\",\n          ip: clientIP,\n          riskLevel: riskAssessment.riskLevel,\n          riskScore: riskAssessment.riskScore,\n          details: { solveTime, challengeType: challenge.type },\n        });\n        console.log(`[SECURITY] Verification successful from ${clientIP} (solve time: ${solveTime}ms)`);\n      }\n\n      const response: any = {\n        success: isValid,\n        message: isValid ? \"Verification successful\" : \"Invalid proof-of-work solution\",\n      };\n\n      if (isValid) {\n        const verificationToken = createVerificationToken(\n          challenge.id,\n          apiKey.secretkey,\n          {\n            domain: challenge.validatedDomain,\n            timestamp: Date.now(),\n            nonce: nanoid(16),\n            fingerprint: JSON.stringify(deviceFingerprint),\n          }\n        );\n        \n        response.verificationToken = verificationToken;\n      }\n\n      res.json(response);\n    } catch (error) {\n      console.error(\"Verification error:\", error);\n      res.status(500).json({\n        success: false,\n        error: \"Verification failed\",\n      });\n    }\n  });\n\n  // ==================== SIMPLIFIED RECAPTCHA-LIKE ENDPOINTS ====================\n  \n  // Simplified Challenge Creation - for reCAPTCHA-like integration\n  app.post(\"/api/challenge/create\", challengeLimiter, async (req: Request, res: Response) => {\n    try {\n      const { sitekey, type } = req.body;\n\n      if (!sitekey) {\n        return res.status(400).json({ error: \"Sitekey is required\" });\n      }\n\n      const apiKey = await storage.getApiKeyBySitekey(sitekey);\n      if (!apiKey || !apiKey.isActive) {\n        return res.status(401).json({ error: \"Invalid or inactive API key\" });\n      }\n\n      const requestDomain = extractDomainFromRequest(req);\n      if (!requestDomain) {\n        return res.status(403).json({ \n          error: \"Domain validation failed\",\n          message: \"Cannot determine request origin\"\n        });\n      }\n\n      // CRITICAL SECURITY: Domain validation is ALWAYS ENFORCED\n      // This CANNOT be disabled via settings - it's a core security feature\n      // Validates domain against API key's allowed domain to prevent unauthorized sites from using the sitekey\n      if (apiKey.domain && apiKey.domain !== \"*\") {\n        const allowedDomain = apiKey.domain.replace(/^(https?:\\/\\/)/, '').replace(/\\/$/, '');\n        \n        // Check if domains match (exact match or subdomain)\n        const isMatch = requestDomain === allowedDomain || \n                       requestDomain.endsWith('.' + allowedDomain);\n        \n        if (!isMatch) {\n          console.log(`[SECURITY] Domain validation failed in challenge/create: Expected ${allowedDomain}, got ${requestDomain}`);\n          return res.status(403).json({ \n            error: \"Domain validation failed\",\n            message: `This sitekey is restricted to domain: ${allowedDomain}`\n          });\n        }\n      }\n\n      // Load security settings for this API key\n      // Settings are loaded SERVER-SIDE and cannot be manipulated by client\n      const settings = (apiKey.settings as SecuritySettings | null) || DEFAULT_SECURITY_SETTINGS;\n      console.log(`[SETTINGS] Using security settings for ${apiKey.name}: difficulty=${settings.proofOfWorkDifficulty}`);\n\n      // FIXED: Check IP and country blocking\n      const clientIP = ipBlocker.getClientIP(req);\n      const geoData = await getGeolocationFromIP(clientIP);\n      const blockCheck = ipBlocker.checkSecurityBlocking(clientIP, geoData.country, settings);\n      \n      if (blockCheck.blocked) {\n        console.log(`[SECURITY] Blocked request from IP ${clientIP} / Country ${geoData.country}: ${blockCheck.reason}`);\n        return res.status(403).json({\n          error: \"Access denied\",\n          message: blockCheck.reason\n        });\n      }\n\n      // Generate session fingerprint early for context\n      const sessionFp = generateSessionFingerprint(req);\n      \n      // Generate proof-of-work challenge using configured difficulty\n      const difficulty = settings.proofOfWorkDifficulty || 4;\n      \n      // SECURITY FIX Bug #3: Create context for HMAC binding\n      const challengeContext = {\n        timestamp: Date.now(),\n        nonce: nanoid(16),\n        apiKey: sitekey,\n        fingerprint: sessionFp.hash\n      };\n      \n      const challenge = generateChallenge(difficulty, challengeContext);\n      \n      // Create JWT token with expiration from settings\n      const tokenExpirySeconds = Math.floor((settings.tokenExpiryMs || 60000) / 1000);\n      const challengeToken = jwt.sign(\n        { challenge, type: type || 'checkbox', timestamp: Date.now() },\n        JWT_SECRET,\n        { expiresIn: `${tokenExpirySeconds}s` }\n      );\n\n      // Create HMAC signature\n      const signature = generateChallengeSignature(\n        challengeToken,\n        requestDomain,\n        apiKey.secretkey\n      );\n\n      // Store challenge in database\n      await storage.createChallenge({\n        token: challengeToken,\n        difficulty,\n        challengeData: challenge,\n        type: type || 'checkbox',\n        apiKeyId: apiKey.id,\n        validatedDomain: requestDomain,\n        signature,\n        sessionFingerprint: sessionFp.hash,\n        isUsed: false,\n        expiresAt: new Date(Date.now() + (settings.challengeTimeoutMs || 300000)),\n      });\n\n      // SECURITY FIX Bug #5: Return minimal security config stub only\n      // Only expose absolutely necessary client-side settings\n      // Prevents attackers from analyzing full security configuration\n      const minimalSecurityConfig = {\n        // Only reveal timeouts (client needs for UI/UX)\n        challengeTimeoutMs: settings.challengeTimeoutMs,\n        tokenExpiryMs: settings.tokenExpiryMs,\n        // Only reveal if advanced fingerprinting is required (client needs to collect data)\n        advancedFingerprinting: settings.advancedFingerprinting,\n        // Hide all other security measures (antiDebugger, rate limits, blocking, etc.)\n        // These are enforced server-side only - client doesn't need to know\n      };\n\n      res.json({\n        success: true,\n        challenge: {\n          token: challengeToken,\n          salt: challenge.salt,\n          challengeHash: challenge.challengeHash,\n          maxNumber: challenge.maxNumber,\n          timestamp: challenge.timestamp,\n          difficulty: challenge.difficulty,\n          signature: challenge.signature,\n          nonce: challenge.nonce, // Include nonce for HMAC verification\n        },\n        // Minimal security config - only essential client-side settings\n        securityConfig: minimalSecurityConfig\n      });\n    } catch (error: any) {\n      console.error(\"Challenge creation error:\", error);\n      res.status(500).json({ error: \"Failed to create challenge\" });\n    }\n  });\n\n  // Simplified Challenge Verification - returns verification token\n  app.post(\"/api/challenge/verify\", verifyLimiter, async (req: Request, res: Response) => {\n    try {\n      const { token, solution } = req.body;\n\n      if (!token || !solution) {\n        return res.status(400).json({ \n          success: false,\n          error: \"Token and solution are required\" \n        });\n      }\n\n      // Decode JWT token\n      let decoded: any;\n      try {\n        decoded = jwt.verify(token, JWT_SECRET);\n      } catch (e) {\n        return res.json({ \n          success: false,\n          error: \"Invalid or expired token\" \n        });\n      }\n\n      // Get challenge from database\n      const challenge = await storage.getChallengeByToken(token);\n      if (!challenge) {\n        return res.json({ \n          success: false,\n          error: \"Challenge not found\" \n        });\n      }\n\n      // Check if already used\n      if (challenge.isUsed) {\n        return res.json({ \n          success: false,\n          error: \"Challenge already used\" \n        });\n      }\n\n      // Check expiration\n      const expirationCheck = checkChallengeExpiration(challenge.createdAt, DEFAULT_EXPIRATION_CONFIG);\n      if (!expirationCheck.isValid) {\n        return res.json({ \n          success: false,\n          error: \"Challenge expired\",\n          message: expirationCheck.message\n        });\n      }\n\n      // SECURITY: Validate domain from request matches the domain stored in challenge\n      // This prevents challenge tokens from being used on different domains\n      const requestDomain = extractDomainFromRequest(req);\n      if (!requestDomain || requestDomain !== challenge.validatedDomain) {\n        console.log(`[SECURITY] Domain validation failed in challenge/verify: Expected ${challenge.validatedDomain}, got ${requestDomain}`);\n        return res.json({ \n          success: false,\n          error: \"Domain validation failed\",\n          message: \"Challenge cannot be verified from this domain\"\n        });\n      }\n\n      // Get API key for additional domain validation\n      const apiKey = await storage.getApiKey(challenge.apiKeyId!);\n      if (!apiKey) {\n        return res.json({ \n          success: false,\n          error: \"API key not found\" \n        });\n      }\n\n      // SECURITY: Double-check domain against API key's allowed domain\n      if (apiKey.domain && apiKey.domain !== \"*\") {\n        const allowedDomain = apiKey.domain.replace(/^(https?:\\/\\/)/, '').replace(/\\/$/, '');\n        const isMatch = requestDomain === allowedDomain || \n                       requestDomain.endsWith('.' + allowedDomain);\n        \n        if (!isMatch) {\n          console.log(`[SECURITY] Domain validation failed against API key: Expected ${allowedDomain}, got ${requestDomain}`);\n          return res.json({ \n            success: false,\n            error: \"Domain validation failed\"\n          });\n        }\n      }\n\n      // FIXED: Check IP and country blocking\n      const settings = (apiKey.settings as SecuritySettings | null) || DEFAULT_SECURITY_SETTINGS;\n      const clientIP = ipBlocker.getClientIP(req);\n      const geoData = await getGeolocationFromIP(clientIP);\n      const blockCheck = ipBlocker.checkSecurityBlocking(clientIP, geoData.country, settings);\n      \n      if (blockCheck.blocked) {\n        console.log(`[SECURITY] Blocked verification from IP ${clientIP} / Country ${geoData.country}: ${blockCheck.reason}`);\n        return res.json({\n          success: false,\n          error: \"Access denied\",\n          message: blockCheck.reason\n        });\n      }\n\n      // Verify proof-of-work\n      const isValid = verifyProofOfWork(decoded.challenge, solution);\n\n      if (!isValid) {\n        return res.json({ \n          success: false,\n          error: \"Invalid solution\" \n        });\n      }\n\n      // Mark as used\n      await storage.markChallengeAsUsed(challenge.id);\n\n      // Create verification token\n      const verificationToken = createVerificationToken(\n        challenge.id,\n        apiKey.secretkey,\n        {\n          domain: challenge.validatedDomain,\n          timestamp: Date.now(),\n          nonce: nanoid(16),\n        }\n      );\n\n      // Log verification (reuse clientIP and geoData from above)\n      await storage.createVerification({\n        challengeId: challenge.id,\n        apiKeyId: apiKey.id,\n        success: true,\n        ipAddress: clientIP,\n        userAgent: req.headers[\"user-agent\"] || null,\n        country: geoData.country,\n        countryName: geoData.countryName,\n        region: geoData.region,\n        city: geoData.city,\n        latitude: geoData.latitude,\n        longitude: geoData.longitude,\n        timezone: geoData.timezone,\n        timeToSolve: req.body.timeToSolve || null,\n        attemptData: { solution },\n      });\n\n      // Update daily analytics aggregates\n      await storage.updateDailyAnalytics(apiKey.id);\n      await storage.updateDailyCountryAnalytics(apiKey.id);\n\n      res.json({\n        success: true,\n        verificationToken,\n        message: \"Verification successful\"\n      });\n    } catch (error: any) {\n      console.error(\"Verification error:\", error);\n      res.status(500).json({ \n        success: false,\n        error: \"Verification failed\" \n      });\n    }\n  });\n\n  // ==================== SERVER-TO-SERVER TOKEN VERIFICATION ====================\n  \n  // Rate limiter untuk server-to-server verification\n  const serverVerifyLimiter = rateLimit({\n    windowMs: 60 * 1000,\n    max: 100,\n    message: \"Too many verification requests from this server\",\n    skipSuccessfulRequests: false,\n  });\n  \n  // Endpoint untuk validasi token dari backend server eksternal\n  // Ini digunakan oleh backend server customer untuk memvalidasi token captcha\n  app.post(\"/api/captcha/verify-token\", serverVerifyLimiter, async (req: Request, res: Response) => {\n    try {\n      // 1. Validasi Authorization header (API Secret Key)\n      const authHeader = req.headers.authorization;\n      if (!authHeader || !authHeader.startsWith(\"Bearer \")) {\n        return res.status(401).json({\n          success: false,\n          error: \"Unauthorized\",\n          message: \"API secret key required in Authorization header\"\n        });\n      }\n      \n      const apiSecretKey = authHeader.substring(7); // Remove \"Bearer \"\n      \n      // 2. Validasi API key dari secret\n      const apiKey = await storage.getApiKeyBySecretkey(apiSecretKey);\n      if (!apiKey || !apiKey.isActive) {\n        console.log(\"[SECURITY] Invalid API secret key attempt\");\n        return res.status(401).json({\n          success: false,\n          error: \"Unauthorized\",\n          message: \"Invalid or inactive API secret key\"\n        });\n      }\n      \n      // 3. Ambil verification token dari request body\n      const { token } = req.body;\n      \n      if (!token) {\n        return res.status(400).json({\n          success: false,\n          error: \"Bad Request\",\n          message: \"Verification token is required\"\n        });\n      }\n      \n      // 4. Verify verification token\n      const verificationResult = verifyVerificationToken(token, apiKey.secretkey);\n      \n      if (!verificationResult) {\n        return res.json({\n          success: false,\n          error: \"Invalid Token\",\n          message: \"Token verification failed or expired\"\n        });\n      }\n      \n      const { challengeId, domain, timestamp } = verificationResult;\n      \n      // 5. Check token age (max 5 minutes)\n      const tokenAge = Date.now() - timestamp;\n      const MAX_TOKEN_AGE = 5 * 60 * 1000; // 5 minutes\n      \n      if (tokenAge > MAX_TOKEN_AGE) {\n        return res.json({\n          success: false,\n          error: \"Token Expired\",\n          message: \"Verification token has expired\"\n        });\n      }\n      \n      // 6. Get challenge dari database untuk validasi tambahan\n      const challenge = await storage.getChallenge(challengeId);\n      \n      if (!challenge) {\n        return res.json({\n          success: false,\n          error: \"Invalid Challenge\",\n          message: \"Challenge not found\"\n        });\n      }\n      \n      // 7. Validasi challenge sudah digunakan dan berhasil\n      if (!challenge.isUsed) {\n        console.log(\"[SECURITY] Token presented but challenge not marked as used\");\n        return res.json({\n          success: false,\n          error: \"Invalid State\",\n          message: \"Challenge verification incomplete\"\n        });\n      }\n      \n      // 8. Check challenge expiration\n      if (new Date() > challenge.expiresAt) {\n        return res.json({\n          success: false,\n          error: \"Challenge Expired\",\n          message: \"Challenge has expired\"\n        });\n      }\n      \n      // 9. Validate domain matches\n      const normalizedChallengeDomain = normalizeDomain(challenge.validatedDomain);\n      const normalizedTokenDomain = normalizeDomain(domain);\n      \n      if (normalizedChallengeDomain !== normalizedTokenDomain) {\n        console.log(`[SECURITY] Domain mismatch: challenge=${normalizedChallengeDomain}, token=${normalizedTokenDomain}`);\n        return res.json({\n          success: false,\n          error: \"Domain Mismatch\",\n          message: \"Token domain does not match challenge domain\"\n        });\n      }\n      \n      // 10. Validate API key matches\n      if (challenge.apiKeyId !== apiKey.id) {\n        console.log(\"[SECURITY] API key mismatch in token verification\");\n        return res.json({\n          success: false,\n          error: \"API Key Mismatch\",\n          message: \"Token was not issued for this API key\"\n        });\n      }\n      \n      // 11. Log successful verification\n      const clientIP = ipBlocker.getClientIP(req);\n      console.log(`[SERVER-VERIFY] Successful token verification from ${clientIP} for domain ${domain}`);\n      \n      // 12. Return success dengan minimal data\n      res.json({\n        success: true,\n        data: {\n          challengeId: challenge.id,\n          domain: challenge.validatedDomain,\n          type: challenge.type,\n          timestamp: timestamp,\n          verified: true\n        }\n      });\n      \n    } catch (error: any) {\n      console.error(\"Server-to-server verification error:\", error);\n      res.status(500).json({\n        success: false,\n        error: \"Internal Server Error\",\n        message: \"Token verification failed\"\n      });\n    }\n  });\n\n  // ==================== CAPTCHA WIDGET SCRIPT ====================\n  \n  // Serve the ProofCaptcha widget JavaScript library (similar to reCAPTCHA api.js)\n  app.get(\"/api/captcha.js\", async (req: Request, res: Response) => {\n    try {\n      const scriptPath = path.resolve(import.meta.dirname, \"public\", \"api.js\");\n      const script = await readFile(scriptPath, \"utf-8\");\n      \n      res.setHeader(\"Content-Type\", \"application/javascript; charset=utf-8\");\n      res.setHeader(\"Cache-Control\", \"public, max-age=3600\"); // Cache for 1 hour\n      res.setHeader(\"Access-Control-Allow-Origin\", \"*\"); // Allow CORS for widget script\n      res.send(script);\n    } catch (error) {\n      console.error(\"Error serving captcha widget script:\", error);\n      res.status(500).send(\"// Error loading ProofCaptcha widget\");\n    }\n  });\n\n  const httpServer = createServer(app);\n  return httpServer;\n}\n","size_bytes":151281},"server/security-headers.ts":{"content":"import type { Request, Response, NextFunction } from \"express\";\n\nexport function setSecurityHeaders(req: Request, res: Response, next: NextFunction) {\n  // CORS headers untuk public API endpoints (agar bisa diakses dari domain lain)\n  // ProofCaptcha HARUS bisa diakses dari website eksternal manapun\n  const publicEndpoints = [\n    '/proofCaptcha/api.js',\n    '/proofCaptcha/api/siteverify',\n    '/api/captcha/handshake',\n    '/api/captcha/challenge',\n    '/api/captcha/verify',\n    '/api/challenge/verify'\n  ];\n  \n  const isPublicEndpoint = publicEndpoints.some(endpoint => req.path.startsWith(endpoint));\n  \n  if (isPublicEndpoint) {\n    // Allow cross-origin requests untuk public API\n    const origin = req.headers.origin || '*';\n    res.setHeader(\"Access-Control-Allow-Origin\", origin);\n    res.setHeader(\"Access-Control-Allow-Credentials\", \"true\");\n    res.setHeader(\"Access-Control-Allow-Methods\", \"GET, POST, PUT, DELETE, PATCH, OPTIONS\");\n    res.setHeader(\"Access-Control-Allow-Headers\", \"Content-Type, Authorization, Cookie, X-CSRF-Token, X-Requested-With\");\n    res.setHeader(\"Access-Control-Expose-Headers\", \"X-CSRF-Token\");\n    res.setHeader(\"Access-Control-Max-Age\", \"86400\");\n    \n    // Handle preflight requests\n    if (req.method === 'OPTIONS') {\n      return res.status(204).end();\n    }\n  }\n\n  res.setHeader(\n    \"Strict-Transport-Security\",\n    \"max-age=31536000; includeSubDomains; preload\"\n  );\n\n  res.setHeader(\"X-Content-Type-Options\", \"nosniff\");\n\n  // X-Frame-Options: Allow framing untuk widget embedding\n  if (isPublicEndpoint) {\n    res.setHeader(\"X-Frame-Options\", \"SAMEORIGIN\");\n  } else {\n    res.setHeader(\"X-Frame-Options\", \"DENY\");\n  }\n\n  res.setHeader(\"X-XSS-Protection\", \"1; mode=block\");\n\n  // CSP lebih permissive untuk public endpoints\n  if (isPublicEndpoint) {\n    res.setHeader(\n      \"Content-Security-Policy\",\n      \"default-src 'self' *; \" +\n      \"script-src 'self' 'unsafe-inline' 'unsafe-eval' *; \" +\n      \"style-src 'self' 'unsafe-inline' *; \" +\n      \"img-src 'self' data: https: *; \" +\n      \"font-src 'self' data: *; \" +\n      \"connect-src 'self' *; \" +\n      \"frame-ancestors *; \" +\n      \"base-uri 'self'; \" +\n      \"form-action 'self' *\"\n    );\n  } else {\n    res.setHeader(\n      \"Content-Security-Policy\",\n      \"default-src 'self'; \" +\n      \"script-src 'self' 'unsafe-inline' 'unsafe-eval'; \" +\n      \"style-src 'self' 'unsafe-inline'; \" +\n      \"img-src 'self' data: https:; \" +\n      \"font-src 'self' data:; \" +\n      \"connect-src 'self'; \" +\n      \"frame-ancestors 'none'; \" +\n      \"base-uri 'self'; \" +\n      \"form-action 'self'\"\n    );\n  }\n\n  res.setHeader(\n    \"Permissions-Policy\",\n    \"geolocation=(), microphone=(), camera=(), payment=(), usb=(), magnetometer=(), gyroscope=(), accelerometer=()\"\n  );\n\n  res.setHeader(\"Referrer-Policy\", \"strict-origin-when-cross-origin\");\n\n  if (req.path.startsWith(\"/api/\")) {\n    res.setHeader(\"Cache-Control\", \"no-store, no-cache, must-revalidate, private\");\n    res.setHeader(\"Pragma\", \"no-cache\");\n    res.setHeader(\"Expires\", \"0\");\n  }\n\n  next();\n}\n","size_bytes":3062},"client/src/components/ui/toggle-group.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ToggleGroupPrimitive from \"@radix-ui/react-toggle-group\"\nimport { type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { toggleVariants } from \"@/components/ui/toggle\"\n\nconst ToggleGroupContext = React.createContext<\n  VariantProps<typeof toggleVariants>\n>({\n  size: \"default\",\n  variant: \"default\",\n})\n\nconst ToggleGroup = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, children, ...props }, ref) => (\n  <ToggleGroupPrimitive.Root\n    ref={ref}\n    className={cn(\"flex items-center justify-center gap-1\", className)}\n    {...props}\n  >\n    <ToggleGroupContext.Provider value={{ variant, size }}>\n      {children}\n    </ToggleGroupContext.Provider>\n  </ToggleGroupPrimitive.Root>\n))\n\nToggleGroup.displayName = ToggleGroupPrimitive.Root.displayName\n\nconst ToggleGroupItem = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Item> &\n    VariantProps<typeof toggleVariants>\n>(({ className, children, variant, size, ...props }, ref) => {\n  const context = React.useContext(ToggleGroupContext)\n\n  return (\n    <ToggleGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        toggleVariants({\n          variant: context.variant || variant,\n          size: context.size || size,\n        }),\n        className\n      )}\n      {...props}\n    >\n      {children}\n    </ToggleGroupPrimitive.Item>\n  )\n})\n\nToggleGroupItem.displayName = ToggleGroupPrimitive.Item.displayName\n\nexport { ToggleGroup, ToggleGroupItem }\n","size_bytes":1753},"server/vite.ts":{"content":"import express, { type Express } from \"express\";\nimport fs from \"fs\";\nimport path from \"path\";\nimport { createServer as createViteServer, createLogger } from \"vite\";\nimport { type Server } from \"http\";\nimport viteConfig from \"../vite.config\";\nimport { nanoid } from \"nanoid\";\n\nconst viteLogger = createLogger();\n\nexport function log(message: string, source = \"express\") {\n  const formattedTime = new Date().toLocaleTimeString(\"en-US\", {\n    hour: \"numeric\",\n    minute: \"2-digit\",\n    second: \"2-digit\",\n    hour12: true,\n  });\n\n  console.log(`${formattedTime} [${source}] ${message}`);\n}\n\nexport async function setupVite(app: Express, server: Server) {\n  const serverOptions = {\n    middlewareMode: true,\n    hmr: { server },\n    allowedHosts: true as const,\n  };\n\n  const vite = await createViteServer({\n    ...viteConfig,\n    configFile: false,\n    customLogger: {\n      ...viteLogger,\n      error: (msg, options) => {\n        viteLogger.error(msg, options);\n        process.exit(1);\n      },\n    },\n    server: serverOptions,\n    appType: \"custom\",\n  });\n\n  app.use(vite.middlewares);\n  app.use(\"*\", async (req, res, next) => {\n    const url = req.originalUrl;\n\n    try {\n      const clientTemplate = path.resolve(\n        import.meta.dirname,\n        \"..\",\n        \"client\",\n        \"index.html\",\n      );\n\n      // always reload the index.html file from disk incase it changes\n      let template = await fs.promises.readFile(clientTemplate, \"utf-8\");\n      template = template.replace(\n        `src=\"/src/main.tsx\"`,\n        `src=\"/src/main.tsx?v=${nanoid()}\"`,\n      );\n      const page = await vite.transformIndexHtml(url, template);\n      res.status(200).set({ \"Content-Type\": \"text/html\" }).end(page);\n    } catch (e) {\n      vite.ssrFixStacktrace(e as Error);\n      next(e);\n    }\n  });\n}\n\nexport function serveStatic(app: Express) {\n  const distPath = path.resolve(import.meta.dirname, \"public\");\n\n  if (!fs.existsSync(distPath)) {\n    throw new Error(\n      `Could not find the build directory: ${distPath}, make sure to build the client first`,\n    );\n  }\n\n  app.use(express.static(distPath));\n\n  // fall through to index.html if the file doesn't exist\n  app.use(\"*\", (_req, res) => {\n    res.sendFile(path.resolve(distPath, \"index.html\"));\n  });\n}\n","size_bytes":2263},"client/src/lib/captcha-solver.ts":{"content":"// ALTCHA-style Proof-of-Work solver for CAPTCHA\n// Finds the secret number that when hashed with salt equals challengeHash\nexport async function solveProofOfWork(\n  challenge: {\n    pow?: {\n      salt: string;\n      challengeHash: string;\n      maxNumber: number;\n      signature: string;\n    };\n    salt?: string;\n    challengeHash?: string;\n    maxNumber?: number;\n    signature?: string;\n    difficulty?: number;\n    timestamp?: number;\n  },\n  onProgress?: (hash: string, attempts: number) => void\n): Promise<number> {\n  // Extract PoW fields from nested pow object or top-level (for backwards compatibility)\n  const pow = challenge.pow || challenge;\n  const { salt, challengeHash, maxNumber } = pow;\n  \n  // Validate required fields\n  if (!salt || !challengeHash || !maxNumber) {\n    throw new Error(`Missing PoW fields: salt=${!!salt}, challengeHash=${!!challengeHash}, maxNumber=${!!maxNumber}`);\n  }\n  \n  return new Promise((resolve, reject) => {\n    const worker = async () => {\n      // Randomize search order to prevent timing attacks\n      const searchOrder: number[] = [];\n      for (let i = 0; i <= maxNumber; i++) {\n        searchOrder.push(i);\n      }\n      \n      // Fisher-Yates shuffle\n      for (let i = searchOrder.length - 1; i > 0; i--) {\n        const j = Math.floor(Math.random() * (i + 1));\n        [searchOrder[i], searchOrder[j]] = [searchOrder[j], searchOrder[i]];\n      }\n\n      for (let attempts = 0; attempts <= maxNumber; attempts++) {\n        const candidate = searchOrder[attempts];\n        \n        // Calculate SHA256(salt + candidate)\n        const encoder = new TextEncoder();\n        const data = salt + candidate.toString();\n        const dataBuffer = encoder.encode(data);\n        const hashBuffer = await crypto.subtle.digest(\"SHA-256\", dataBuffer);\n        const hashArray = Array.from(new Uint8Array(hashBuffer));\n        const hashHex = hashArray.map((b) => b.toString(16).padStart(2, \"0\")).join(\"\");\n\n        if (onProgress && attempts % 100 === 0) {\n          onProgress(hashHex, attempts);\n        }\n\n        // Check if this candidate's hash matches the challenge hash\n        if (hashHex === challengeHash) {\n          resolve(candidate);\n          return;\n        }\n      }\n\n      reject(new Error(\"Solution not found in search space\"));\n    };\n\n    // Execute worker and handle any errors\n    worker().catch(reject);\n  });\n}\n","size_bytes":2378},"client/src/components/CaptchaWidget.tsx":{"content":"import { useState, useEffect, useRef } from \"react\";\nimport { createPortal } from \"react-dom\";\nimport { Loader2, CheckCircle2, XCircle, Bot, X, UserCheck, Shield, Clock } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card } from \"@/components/ui/card\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { solveProofOfWork } from \"@/lib/captcha-solver\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { detectClientAutomation } from \"@/lib/automation-detector\";\nimport { generateJigsawPath } from \"@shared/puzzle-utils\";\nimport { \n  isEncryptionAvailable, \n  performHandshake, \n  decryptChallengeData,\n  encryptSolutionData,\n  clearSession,\n  type EncryptedPayload\n} from \"@/lib/encryption\";\nimport UpsideDownCaptcha from \"./UpsideDownCaptcha\";\n\ninterface CaptchaWidgetProps {\n  publicKey: string;\n  onSuccess?: (token: string) => void;\n  onError?: (error: string) => void;\n  type?: \"grid\" | \"jigsaw\" | \"gesture\" | \"upside_down\" | \"random\";\n}\n\nexport default function CaptchaWidget({\n  publicKey,\n  onSuccess,\n  onError,\n  type = \"random\",\n}: CaptchaWidgetProps) {\n  const [status, setStatus] = useState<\"idle\" | \"loading\" | \"solving\" | \"success\" | \"error\" | \"blocked\">(\"idle\");\n  const [showOverlay, setShowOverlay] = useState(false);\n  const [challenge, setChallenge] = useState<any>(null);\n  const [token, setToken] = useState<string>(\"\");\n  const [progress, setProgress] = useState(0);\n  const [attempts, setAttempts] = useState(0);\n  const [actualType, setActualType] = useState<\"grid\" | \"jigsaw\" | \"gesture\" | \"upside_down\" | null>(null);\n  const [selectedCells, setSelectedCells] = useState<number[]>([]);\n  const [jigsawPieces, setJigsawPieces] = useState<number[]>([]);\n  const [blockExpiresAt, setBlockExpiresAt] = useState<number | null>(null);\n  const [remainingTime, setRemainingTime] = useState<string>(\"\");\n  const [dragPosition, setDragPosition] = useState<{ x: number; y: number }>({ x: 0, y: 0 });\n  const [isDragging, setIsDragging] = useState(false);\n  const [encryptionEnabled, setEncryptionEnabled] = useState(false);\n  const [sessionEstablished, setSessionEstablished] = useState(false);\n\n  // Ref to track challenge timeout ID for manual cleanup\n  const challengeTimeoutRef = useRef<NodeJS.Timeout | null>(null);\n  \n  // Ref to store onError callback without causing effect re-run\n  const onErrorRef = useRef(onError);\n  useEffect(() => {\n    onErrorRef.current = onError;\n  }, [onError]);\n\n  // Perform handshake on mount to establish encrypted session\n  useEffect(() => {\n    async function initEncryption() {\n      if (!isEncryptionAvailable()) {\n        console.warn('[ENCRYPTION] Web Crypto API not available, using plaintext mode');\n        setEncryptionEnabled(false);\n        return;\n      }\n\n      try {\n        const session = await performHandshake(publicKey);\n        if (session) {\n          setSessionEstablished(true);\n          setEncryptionEnabled(true);\n          console.log('[ENCRYPTION] Session established successfully');\n        } else {\n          console.warn('[ENCRYPTION] Handshake failed, falling back to plaintext');\n          setEncryptionEnabled(false);\n        }\n      } catch (error) {\n        console.error('[ENCRYPTION] Handshake error:', error);\n        setEncryptionEnabled(false);\n      }\n    }\n\n    initEncryption();\n\n    // Cleanup on unmount\n    return () => {\n      clearSession();\n    };\n  }, [publicKey]);\n\n  useEffect(() => {\n    if (status !== \"blocked\" || !blockExpiresAt) {\n      return;\n    }\n\n    const updateCountdown = () => {\n      const now = Date.now();\n      const remaining = blockExpiresAt - now;\n\n      if (remaining <= 0) {\n        setStatus(\"idle\");\n        setBlockExpiresAt(null);\n        setRemainingTime(\"\");\n        return;\n      }\n\n      const hours = Math.floor(remaining / (1000 * 60 * 60));\n      const minutes = Math.floor((remaining % (1000 * 60 * 60)) / (1000 * 60));\n      const seconds = Math.floor((remaining % (1000 * 60)) / 1000);\n\n      if (hours > 0) {\n        setRemainingTime(`${hours}h ${minutes}m ${seconds}s`);\n      } else if (minutes > 0) {\n        setRemainingTime(`${minutes}m ${seconds}s`);\n      } else {\n        setRemainingTime(`${seconds}s`);\n      }\n    };\n\n    updateCountdown();\n    const interval = setInterval(updateCountdown, 1000);\n\n    return () => clearInterval(interval);\n  }, [status, blockExpiresAt]);\n\n  // Challenge timeout: Auto-close overlay after 1 minute if not verified\n  // Key: Only depend on showOverlay to prevent timer reset on status/callback changes\n  useEffect(() => {\n    // Clear any existing timeout when overlay closes\n    if (!showOverlay) {\n      if (challengeTimeoutRef.current) {\n        clearTimeout(challengeTimeoutRef.current);\n        challengeTimeoutRef.current = null;\n      }\n      return;\n    }\n\n    // Start new timeout when overlay opens (keyed only to overlay state)\n    challengeTimeoutRef.current = setTimeout(() => {\n      // Check status at timeout execution time, not at effect setup time\n      setStatus((currentStatus) => {\n        if (currentStatus !== \"success\") {\n          setShowOverlay(false);\n          onErrorRef.current?.(\"Challenge expired - time limit exceeded\");\n          return \"error\";\n        }\n        return currentStatus;\n      });\n    }, 60000); // 1 minute\n\n    return () => {\n      if (challengeTimeoutRef.current) {\n        clearTimeout(challengeTimeoutRef.current);\n        challengeTimeoutRef.current = null;\n      }\n    };\n  }, [showOverlay]);\n\n  // Verification timeout: Auto-reset after 1 minute if verified but token not used\n  useEffect(() => {\n    if (status !== \"success\") {\n      return;\n    }\n\n    const timeoutId = setTimeout(() => {\n      setStatus((currentStatus) => {\n        if (currentStatus === \"success\") {\n          setChallenge(null);\n          setToken(\"\");\n          setProgress(0);\n          setAttempts(0);\n          setSelectedCells([]);\n          setJigsawPieces([]);\n          setDragPosition({ x: 0, y: 0 });\n          onErrorRef.current?.(\"Verification expired - token not used within time limit\");\n          return \"idle\";\n        }\n        return currentStatus;\n      });\n    }, 60000); // 1 minute\n\n    return () => clearTimeout(timeoutId);\n  }, [status]);\n\n  const handleCheckboxClick = async () => {\n    if (status !== \"idle\" && status !== \"error\") return;\n\n    setStatus(\"loading\");\n    setShowOverlay(true);\n\n    try {\n      const clientDetections = detectClientAutomation();\n      \n      // Encode request body\n      const requestBody = { \n        publicKey, \n        type, \n        clientDetections\n      };\n      const jsonString = JSON.stringify(requestBody);\n      const encodedBody = btoa(jsonString);\n      \n      const response = await fetch(\"/api/captcha/challenge\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ data: encodedBody }),\n        credentials: \"include\",\n      });\n      \n      // Decode response\n      const rawData = await response.json();\n      let data: any;\n      \n      if (rawData.data) {\n        try {\n          const decodedString = atob(rawData.data);\n          data = JSON.parse(decodedString);\n        } catch (decodeError) {\n          console.error('[REQUEST] Failed to decode response:', decodeError);\n          throw new Error('Failed to decode server response');\n        }\n      } else {\n        data = rawData;\n      }\n      \n      if (!response.ok) {\n        if (response.status === 429 && data.error === \"IP blocked\") {\n          const remainingMinutes = data.remainingTime || 0;\n          const expiresAt = Date.now() + (remainingMinutes * 60 * 1000);\n          setBlockExpiresAt(expiresAt);\n          setStatus(\"blocked\");\n          setShowOverlay(false);\n          onError?.(data.message || \"IP blocked due to too many failed attempts\");\n          return;\n        }\n        \n        throw new Error(data.message || data.error || \"Failed to generate challenge\");\n      }\n\n      // Decrypt challenge if encrypted\n      let challengeData: any;\n      \n      if (data.protocol === \"encrypted-v1\" && data.encrypted) {\n        console.log('[ENCRYPTION] Received encrypted challenge, decrypting...');\n        const decrypted = await decryptChallengeData(\n          data.encrypted as EncryptedPayload,\n          data.token,\n          publicKey\n        );\n\n        if (!decrypted) {\n          throw new Error('Failed to decrypt challenge data');\n        }\n\n        challengeData = decrypted;\n        console.log('[ENCRYPTION] Challenge decrypted successfully');\n      } else if (data.challenge) {\n        // Plaintext mode\n        challengeData = data.challenge;\n        console.log('[ENCRYPTION] Using plaintext challenge');\n      } else {\n        throw new Error('Invalid challenge response format');\n      }\n      \n      setChallenge(challengeData);\n      setToken(data.token);\n      setActualType(data.type);\n      setStatus(\"idle\");\n    } catch (error) {\n      console.error(\"Challenge generation error:\", error);\n      setStatus(\"error\");\n      setShowOverlay(false);\n      onError?.(error instanceof Error ? error.message : \"Failed to generate challenge\");\n    }\n  };\n\n  const closeOverlay = () => {\n    setShowOverlay(false);\n    setActualType(null);\n    setChallenge(null);\n    setSelectedCells([]);\n    setJigsawPieces([]);\n    setProgress(0);\n    // Don't reset status to idle - preserve success/error states\n  };\n\n  const handleCheckboxVerify = async () => {\n    if (!challenge || !token) return;\n\n    setStatus(\"solving\");\n    setProgress(0);\n    setAttempts(0);\n\n    try {\n      const solution = await solveProofOfWork(challenge, (hash, attemptCount) => {\n        setAttempts(attemptCount);\n        setProgress(Math.min((attemptCount / 50000) * 100, 95));\n      });\n\n      // Detect client-side automation again during verification\n      const clientDetections = detectClientAutomation();\n\n      // Encrypt solution if encryption is enabled\n      let requestBody: any = { token, clientDetections };\n\n      if (encryptionEnabled && sessionEstablished) {\n        console.log('[ENCRYPTION] Encrypting solution...');\n        const encrypted = await encryptSolutionData(solution, token, publicKey);\n        \n        if (!encrypted) {\n          throw new Error('Failed to encrypt solution');\n        }\n\n        requestBody.encrypted = encrypted;\n        requestBody.publicKey = publicKey;\n        console.log('[ENCRYPTION] Solution encrypted successfully');\n      } else {\n        // Plaintext mode\n        requestBody.solution = solution;\n        console.log('[ENCRYPTION] Sending plaintext solution');\n      }\n\n      const response = await apiRequest(\"POST\", \"/api/captcha/verify\", requestBody);\n\n      const result = await response.json();\n      \n      if (result.blocked && result.message) {\n        closeOverlay();\n        setStatus(\"blocked\");\n        const remainingMinutes = result.remainingTime || 120;\n        const expiresAt = Date.now() + (remainingMinutes * 60 * 1000);\n        setBlockExpiresAt(expiresAt);\n        onError?.(result.message);\n        return;\n      }\n      \n      if (result.success) {\n        setProgress(100);\n        setStatus(\"success\");\n        setTimeout(() => {\n          closeOverlay();\n          onSuccess?.(token);\n        }, 1000);\n      } else {\n        setStatus(\"error\");\n        onError?.(result.error || \"Verification failed\");\n      }\n    } catch (error) {\n      console.error(\"Verification error:\", error);\n      setStatus(\"error\");\n      onError?.(error instanceof Error ? error.message : \"Verification failed\");\n    }\n  };\n\n  const handleGridCellClick = (cellIndex: number) => {\n    if (status !== \"idle\") return;\n    \n    setSelectedCells((prev) => {\n      if (prev.includes(cellIndex)) {\n        return prev.filter((i) => i !== cellIndex);\n      } else {\n        return [...prev, cellIndex].sort((a, b) => a - b);\n      }\n    });\n  };\n\n  const handleGridVerify = async () => {\n    if (!challenge || !token || selectedCells.length === 0) return;\n\n    setStatus(\"solving\");\n    setProgress(50);\n\n    try {\n      // SECURITY: Solve proof-of-work to prevent ML-based automated solvers\n      const powSolution = await solveProofOfWork(\n        challenge,\n        (hash, attempts) => {\n          const powProgress = Math.min(50 + (attempts / 1000) * 25, 75);\n          setProgress(powProgress);\n        }\n      );\n\n      setProgress(80);\n\n      // Create solution payload: {answer: [...], powSolution: \"...\"}\n      const solutionPayload = {\n        answer: selectedCells,\n        powSolution,\n      };\n      const solution = JSON.stringify(solutionPayload);\n      const clientDetections = detectClientAutomation();\n\n      // Encrypt solution if encryption is enabled\n      let requestBody: any = { token, clientDetections };\n\n      if (encryptionEnabled && sessionEstablished) {\n        const encrypted = await encryptSolutionData(solution, token, publicKey);\n        if (!encrypted) {\n          throw new Error('Failed to encrypt solution');\n        }\n        requestBody.encrypted = encrypted;\n        requestBody.publicKey = publicKey;\n      } else {\n        requestBody.solution = solution;\n      }\n      \n      const response = await apiRequest(\"POST\", \"/api/captcha/verify\", requestBody);\n\n      const result = await response.json();\n      \n      if (result.success) {\n        setProgress(100);\n        setStatus(\"success\");\n        setTimeout(() => {\n          closeOverlay();\n          onSuccess?.(token);\n        }, 1000);\n      } else {\n        setStatus(\"error\");\n        onError?.(result.error || \"Verification failed\");\n        \n        // Auto-refresh challenge after 1.5 seconds if wrong\n        setTimeout(() => {\n          setSelectedCells([]);\n          setJigsawPieces([]);\n          setStatus(\"idle\"); // Must set to idle first so handleCheckboxClick doesn't early return\n          setTimeout(() => handleCheckboxClick(), 50);\n        }, 1500);\n      }\n    } catch (error) {\n      console.error(\"Verification error:\", error);\n      setStatus(\"error\");\n      onError?.(error instanceof Error ? error.message : \"Verification failed\");\n      \n      // Auto-refresh on error\n      setTimeout(() => {\n        setSelectedCells([]);\n        setJigsawPieces([]);\n        setStatus(\"idle\");\n        setTimeout(() => handleCheckboxClick(), 50);\n      }, 1500);\n    }\n  };\n\n  const handleJigsawPieceClick = (pieceIndex: number) => {\n    if (status !== \"idle\") return;\n    \n    setJigsawPieces((prev) => {\n      if (prev.includes(pieceIndex)) {\n        return prev.filter((i) => i !== pieceIndex);\n      } else {\n        return [...prev, pieceIndex];\n      }\n    });\n  };\n\n  const handleJigsawVerify = async () => {\n    if (!challenge || !token || jigsawPieces.length !== 4) return;\n\n    setStatus(\"solving\");\n    setProgress(50);\n\n    try {\n      // SECURITY: Solve proof-of-work to prevent ML-based automated solvers\n      const powSolution = await solveProofOfWork(\n        challenge,\n        (hash, attempts) => {\n          const powProgress = Math.min(50 + (attempts / 1000) * 25, 75);\n          setProgress(powProgress);\n        }\n      );\n\n      setProgress(80);\n\n      // Create solution payload: {answer: [...], powSolution: \"...\"}\n      const solutionPayload = {\n        answer: jigsawPieces,\n        powSolution,\n      };\n      const solution = JSON.stringify(solutionPayload);\n      const clientDetections = detectClientAutomation();\n\n      // Encrypt solution if encryption is enabled\n      let requestBody: any = { token, clientDetections };\n\n      if (encryptionEnabled && sessionEstablished) {\n        const encrypted = await encryptSolutionData(solution, token, publicKey);\n        if (!encrypted) {\n          throw new Error('Failed to encrypt solution');\n        }\n        requestBody.encrypted = encrypted;\n        requestBody.publicKey = publicKey;\n      } else {\n        requestBody.solution = solution;\n      }\n      \n      const response = await apiRequest(\"POST\", \"/api/captcha/verify\", requestBody);\n\n      const result = await response.json();\n      \n      if (result.success) {\n        setProgress(100);\n        setStatus(\"success\");\n        setTimeout(() => {\n          closeOverlay();\n          onSuccess?.(token);\n        }, 1000);\n      } else {\n        setStatus(\"error\");\n        onError?.(result.error || \"Verification failed\");\n        \n        // Auto-refresh challenge after 1.5 seconds if wrong\n        setTimeout(() => {\n          setSelectedCells([]);\n          setJigsawPieces([]);\n          setStatus(\"idle\"); // Must set to idle first so handleCheckboxClick doesn't early return\n          setTimeout(() => handleCheckboxClick(), 50);\n        }, 1500);\n      }\n    } catch (error) {\n      console.error(\"Verification error:\", error);\n      setStatus(\"error\");\n      onError?.(error instanceof Error ? error.message : \"Verification failed\");\n      \n      // Auto-refresh on error\n      setTimeout(() => {\n        setSelectedCells([]);\n        setJigsawPieces([]);\n        setStatus(\"idle\");\n        setTimeout(() => handleCheckboxClick(), 50);\n      }, 1500);\n    }\n  };\n  \n  const handleGestureVerify = async () => {\n    if (!challenge || !token) return;\n\n    setStatus(\"solving\");\n    setProgress(50);\n\n    try {\n      // SECURITY: Solve proof-of-work to prevent ML-based automated solvers\n      const powSolution = await solveProofOfWork(\n        challenge,\n        (hash, attempts) => {\n          const powProgress = Math.min(50 + (attempts / 1000) * 25, 75);\n          setProgress(powProgress);\n        }\n      );\n\n      setProgress(80);\n\n      // Create solution payload: {answer: {x, y}, powSolution: \"...\"}\n      const solutionPayload = {\n        answer: dragPosition,\n        powSolution,\n      };\n      const solution = JSON.stringify(solutionPayload);\n      const clientDetections = detectClientAutomation();\n\n      // Encrypt solution if encryption is enabled\n      let requestBody: any = { token, clientDetections };\n\n      if (encryptionEnabled && sessionEstablished) {\n        const encrypted = await encryptSolutionData(solution, token, publicKey);\n        if (!encrypted) {\n          throw new Error('Failed to encrypt solution');\n        }\n        requestBody.encrypted = encrypted;\n        requestBody.publicKey = publicKey;\n      } else {\n        requestBody.solution = solution;\n      }\n      \n      const response = await apiRequest(\"POST\", \"/api/captcha/verify\", requestBody);\n\n      const result = await response.json();\n      \n      if (result.success) {\n        setProgress(100);\n        setStatus(\"success\");\n        setTimeout(() => {\n          closeOverlay();\n          onSuccess?.(token);\n        }, 1000);\n      } else {\n        setStatus(\"error\");\n        onError?.(result.error || \"Verification failed\");\n        \n        // Auto-refresh challenge after 1.5 seconds if wrong\n        setTimeout(() => {\n          setDragPosition({ x: 0, y: 0 });\n          setStatus(\"idle\");\n          setTimeout(() => handleCheckboxClick(), 50);\n        }, 1500);\n      }\n    } catch (error) {\n      console.error(\"Verification error:\", error);\n      setStatus(\"error\");\n      onError?.(error instanceof Error ? error.message : \"Verification failed\");\n      \n      // Auto-refresh on error\n      setTimeout(() => {\n        setDragPosition({ x: 0, y: 0 });\n        setStatus(\"idle\");\n        setTimeout(() => handleCheckboxClick(), 50);\n      }, 1500);\n    }\n  };\n  \n  const handleUpsideDownVerify = async (solution: { clicks: Array<{ x: number; y: number }> }) => {\n    if (!challenge || !token) return;\n\n    setStatus(\"solving\");\n    setProgress(50);\n\n    try {\n      // SECURITY: Solve proof-of-work to prevent ML-based automated solvers\n      const powSolution = await solveProofOfWork(\n        challenge,\n        (hash, attempts) => {\n          const powProgress = Math.min(50 + (attempts / 1000) * 25, 75);\n          setProgress(powProgress);\n        }\n      );\n\n      setProgress(80);\n\n      // Create solution payload: {answer: {clicks: [...]}, powSolution: \"...\"}\n      const solutionPayload = {\n        answer: solution,\n        powSolution,\n      };\n      const solutionString = JSON.stringify(solutionPayload);\n      const clientDetections = detectClientAutomation();\n\n      // Encrypt solution if encryption is enabled\n      let requestBody: any = { token, clientDetections };\n\n      if (encryptionEnabled && sessionEstablished) {\n        const encrypted = await encryptSolutionData(solutionString, token, publicKey);\n        if (!encrypted) {\n          throw new Error('Failed to encrypt solution');\n        }\n        requestBody.encrypted = encrypted;\n        requestBody.publicKey = publicKey;\n      } else {\n        requestBody.solution = solutionString;\n      }\n      \n      const response = await apiRequest(\"POST\", \"/api/captcha/verify\", requestBody);\n\n      const result = await response.json();\n      \n      if (result.success) {\n        setProgress(100);\n        setStatus(\"success\");\n        setTimeout(() => {\n          closeOverlay();\n          onSuccess?.(token);\n        }, 1000);\n      } else {\n        setStatus(\"error\");\n        onError?.(result.error || \"Verification failed\");\n        \n        // Auto-refresh challenge after 1.5 seconds if wrong\n        setTimeout(() => {\n          setStatus(\"idle\");\n          setTimeout(() => handleCheckboxClick(), 50);\n        }, 1500);\n      }\n    } catch (error) {\n      console.error(\"Verification error:\", error);\n      setStatus(\"error\");\n      onError?.(error instanceof Error ? error.message : \"Verification failed\");\n      \n      // Auto-refresh on error\n      setTimeout(() => {\n        setStatus(\"idle\");\n        setTimeout(() => handleCheckboxClick(), 50);\n      }, 1500);\n    }\n  };\n  \n  const handleSkip = () => {\n    // Skip just closes the overlay and resets\n    closeOverlay();\n    setStatus(\"idle\");\n    setSelectedCells([]);\n    setJigsawPieces([]);\n    setDragPosition({ x: 0, y: 0 });\n  };\n\n  const renderChallengeContent = () => {\n    if (status === \"loading\") {\n      return (\n        <div className=\"flex items-center gap-3 p-8\">\n          <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n          <p className=\"text-lg font-medium\">Loading challenge...</p>\n        </div>\n      );\n    }\n\n    if (actualType === \"grid\") {\n      const gridSize = challenge?.gridSize || 3;\n      const gridEmojis = challenge?.gridEmojis || [];\n      const targetEmojis = challenge?.targetEmojis || [\"üçé\"];\n      \n      return (\n        <div className=\"space-y-3 sm:space-y-6 p-3 sm:p-6\">\n          <div className=\"flex items-center justify-between gap-2\">\n            <div className=\"flex-1 min-w-0\">\n              <h3 className=\"text-base sm:text-lg font-semibold\">Grid Challenge</h3>\n              <p className=\"text-xs sm:text-sm text-muted-foreground mt-1\">\n                Select these: {targetEmojis.map((emoji: string, idx: number) => (\n                  <span key={idx} className=\"text-lg sm:text-2xl mx-0.5\">{emoji}</span>\n                ))}\n              </p>\n            </div>\n            <div className=\"flex gap-1 flex-shrink-0\">\n              <Button \n                variant=\"ghost\" \n                size=\"icon\" \n                onClick={handleCheckboxClick}\n                disabled={status === \"solving\"}\n                title=\"New Challenge\"\n              >\n                <svg className=\"h-4 w-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15\" />\n                </svg>\n              </Button>\n              <Button variant=\"ghost\" size=\"icon\" onClick={closeOverlay} disabled={status === \"solving\"}>\n                <X className=\"h-4 w-4 sm:h-5 sm:w-5\" />\n              </Button>\n            </div>\n          </div>\n\n          {status === \"success\" ? (\n            <div className=\"flex items-center gap-2 sm:gap-3 p-3 sm:p-6 bg-green-50 dark:bg-green-900/20 rounded-lg\">\n              <CheckCircle2 className=\"h-6 w-6 sm:h-8 sm:w-8 text-green-600 flex-shrink-0\" />\n              <div>\n                <p className=\"font-semibold text-sm sm:text-base text-green-900 dark:text-green-100\">Puzzle solved!</p>\n              </div>\n            </div>\n          ) : (\n            <>\n              <div \n                className=\"grid gap-2 sm:gap-3 mx-auto p-3 sm:p-8 bg-gradient-to-br from-slate-50 to-slate-100 dark:from-slate-900 dark:to-slate-800 rounded-xl\"\n                style={{ \n                  gridTemplateColumns: `repeat(${gridSize}, minmax(0, 1fr))`,\n                  maxWidth: gridSize === 3 ? '280px' : '320px'\n                }}\n              >\n                {gridEmojis.map((emoji: string, idx: number) => (\n                  <button\n                    key={idx}\n                    onClick={() => handleGridCellClick(idx)}\n                    disabled={status === \"solving\"}\n                    className={`\n                      aspect-square rounded-lg sm:rounded-xl border-2 transition-all duration-200 relative flex items-center justify-center text-2xl sm:text-4xl\n                      ${selectedCells.includes(idx) \n                        ? \"bg-gradient-to-br from-blue-500 to-indigo-600 border-blue-400 shadow-lg scale-95\" \n                        : \"bg-white dark:bg-slate-700 border-slate-200 dark:border-slate-600 hover:border-slate-400\"}\n                      ${status === \"solving\" ? \"opacity-50 cursor-not-allowed\" : \"cursor-pointer hover:scale-105\"}\n                    `}\n                  >\n                    <span className={selectedCells.includes(idx) ? \"opacity-30\" : \"\"}>{emoji}</span>\n                    {selectedCells.includes(idx) && (\n                      <div className=\"absolute inset-0 flex items-center justify-center\">\n                        <CheckCircle2 className=\"h-6 w-6 sm:h-10 sm:w-10 text-white\" />\n                      </div>\n                    )}\n                  </button>\n                ))}\n              </div>\n\n              <p className=\"text-center text-xs sm:text-sm text-muted-foreground\">\n                {selectedCells.length} cells selected\n              </p>\n\n              <div className=\"grid grid-cols-2 gap-2 sm:gap-3\">\n                <Button \n                  onClick={handleSkip}\n                  disabled={status === \"solving\"}\n                  variant=\"outline\"\n                  size=\"lg\"\n                  className=\"text-sm sm:text-base\"\n                >\n                  Skip\n                </Button>\n                <Button \n                  onClick={handleGridVerify}\n                  disabled={selectedCells.length === 0 || status === \"solving\"}\n                  className=\"w-full\"\n                  size=\"lg\"\n                >\n                  {status === \"solving\" ? (\n                    <>\n                      <Loader2 className=\"mr-2 h-3 w-3 sm:h-4 sm:w-4 animate-spin\" />\n                      <span className=\"text-sm sm:text-base\">Verifying...</span>\n                    </>\n                  ) : (\n                    <span className=\"text-sm sm:text-base\">Verify</span>\n                  )}\n                </Button>\n              </div>\n\n              {status === \"solving\" && (\n                <div className=\"h-2 w-full bg-muted rounded-full overflow-hidden\">\n                  <div\n                    className=\"h-full bg-primary transition-all duration-300\"\n                    style={{ width: `${progress}%` }}\n                  />\n                </div>\n              )}\n            </>\n          )}\n        </div>\n      );\n    }\n\n    if (actualType === \"jigsaw\") {\n      const pieces = challenge?.pieces || [0, 1, 2, 3];\n      const pieceColors = [\"bg-red-400\", \"bg-blue-400\", \"bg-green-400\", \"bg-yellow-400\"];\n      \n      return (\n        <div className=\"space-y-3 sm:space-y-6 p-3 sm:p-6\">\n          <div className=\"flex items-center justify-between gap-2\">\n            <div className=\"flex-1 min-w-0\">\n              <h3 className=\"text-base sm:text-lg font-semibold\">Jigsaw Challenge</h3>\n              <p className=\"text-xs sm:text-sm text-muted-foreground mt-1\">\n                Click pieces in order: üî¥ üîµ üü¢ üü°\n              </p>\n            </div>\n            <div className=\"flex gap-1 flex-shrink-0\">\n              <Button \n                variant=\"ghost\" \n                size=\"icon\" \n                onClick={handleCheckboxClick}\n                disabled={status === \"solving\"}\n                title=\"New Challenge\"\n              >\n                <svg className=\"h-4 w-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15\" />\n                </svg>\n              </Button>\n              <Button variant=\"ghost\" size=\"icon\" onClick={closeOverlay} disabled={status === \"solving\"}>\n                <X className=\"h-4 w-4 sm:h-5 sm:w-5\" />\n              </Button>\n            </div>\n          </div>\n\n          {status === \"success\" ? (\n            <div className=\"flex items-center gap-2 sm:gap-3 p-3 sm:p-6 bg-green-50 dark:bg-green-900/20 rounded-lg\">\n              <CheckCircle2 className=\"h-6 w-6 sm:h-8 sm:w-8 text-green-600 flex-shrink-0\" />\n              <div>\n                <p className=\"font-semibold text-sm sm:text-base text-green-900 dark:text-green-100\">Jigsaw completed!</p>\n              </div>\n            </div>\n          ) : (\n            <>\n              <div className=\"grid grid-cols-4 gap-2 sm:gap-4 p-3 sm:p-6 bg-gradient-to-br from-slate-50 to-slate-100 dark:from-slate-900 dark:to-slate-800 rounded-xl\">\n                {pieces.map((piece: number, idx: number) => {\n                  const pieceEmoji = [\"üî¥\", \"üîµ\", \"üü¢\", \"üü°\"];\n                  const order = jigsawPieces.indexOf(piece);\n                  const isSelected = jigsawPieces.includes(piece);\n                  \n                  return (\n                    <button\n                      key={idx}\n                      onClick={() => handleJigsawPieceClick(piece)}\n                      disabled={status === \"solving\"}\n                      className={`\n                        h-20 sm:h-28 rounded-lg sm:rounded-xl border-2 transition-all duration-200 flex flex-col items-center justify-center gap-1 relative\n                        ${pieceColors[piece]} \n                        ${isSelected\n                          ? \"border-white scale-95 ring-2 sm:ring-4 ring-primary/50\" \n                          : \"border-slate-300 dark:border-slate-600 hover:border-white hover:scale-105\"}\n                        ${status === \"solving\" ? \"opacity-50 cursor-not-allowed\" : \"cursor-pointer\"}\n                      `}\n                    >\n                      <span className=\"text-2xl sm:text-4xl drop-shadow-lg\">\n                        {pieceEmoji[piece]}\n                      </span>\n                      {isSelected && (\n                        <span className=\"absolute -top-1 -right-1 sm:-top-2 sm:-right-2 bg-white dark:bg-slate-800 rounded-full w-6 h-6 sm:w-8 sm:h-8 flex items-center justify-center text-xs sm:text-sm font-bold border-2 border-primary\">\n                          {order + 1}\n                        </span>\n                      )}\n                    </button>\n                  );\n                })}\n              </div>\n\n              <p className=\"text-center text-xs sm:text-sm text-muted-foreground\">\n                {jigsawPieces.length}/4 pieces arranged\n              </p>\n\n              <div className=\"grid grid-cols-2 gap-2 sm:gap-3\">\n                <Button \n                  onClick={handleSkip}\n                  disabled={status === \"solving\"}\n                  variant=\"outline\"\n                  size=\"lg\"\n                  className=\"text-sm sm:text-base\"\n                >\n                  Skip\n                </Button>\n                <Button \n                  onClick={handleJigsawVerify}\n                  disabled={jigsawPieces.length !== 4 || status === \"solving\"}\n                  className=\"w-full\"\n                  size=\"lg\"\n                >\n                  {status === \"solving\" ? (\n                    <>\n                      <Loader2 className=\"mr-2 h-3 w-3 sm:h-4 sm:w-4 animate-spin\" />\n                      <span className=\"text-sm sm:text-base\">Verifying...</span>\n                    </>\n                  ) : (\n                    <span className=\"text-sm sm:text-base\">Verify</span>\n                  )}\n                </Button>\n              </div>\n\n              {status === \"solving\" && (\n                <div className=\"h-2 w-full bg-muted rounded-full overflow-hidden\">\n                  <div\n                    className=\"h-full bg-primary transition-all duration-300\"\n                    style={{ width: `${progress}%` }}\n                  />\n                </div>\n              )}\n            </>\n          )}\n        </div>\n      );\n    }\n\n    if (actualType === \"gesture\") {\n      const gridSize = challenge?.gridSize || { width: 300, height: 300 };\n      const target = challenge?.target || { x: 150, y: 150 };\n      const tolerance = challenge?.tolerance || 15;\n      const puzzleSeed = challenge?.puzzleSeed || 1234;\n      const puzzleImageUrl = challenge?.puzzleImageUrl || 'https://picsum.photos/seed/default/400/400';\n      \n      const handlePointerDown = (e: React.PointerEvent<HTMLDivElement>) => {\n        if (status !== \"idle\") return;\n        setIsDragging(true);\n        e.currentTarget.setPointerCapture(e.pointerId);\n      };\n\n      const handlePointerMove = (e: React.PointerEvent<HTMLDivElement>) => {\n        if (!isDragging || status !== \"idle\") return;\n        \n        const rect = e.currentTarget.getBoundingClientRect();\n        const x = Math.max(0, Math.min(e.clientX - rect.left, gridSize.width));\n        const y = Math.max(0, Math.min(e.clientY - rect.top, gridSize.height));\n        \n        setDragPosition({ x, y });\n      };\n\n      const handlePointerUp = (e: React.PointerEvent<HTMLDivElement>) => {\n        if (isDragging) {\n          setIsDragging(false);\n          e.currentTarget.releasePointerCapture(e.pointerId);\n        }\n      };\n      \n      // Calculate if piece is near target\n      const dx = dragPosition.x - target.x;\n      const dy = dragPosition.y - target.y;\n      const distance = Math.sqrt(dx * dx + dy * dy);\n      const isNearTarget = distance <= tolerance * 1.5;\n      \n      // Generate jigsaw puzzle path using seed from shared utility\n      const puzzleSize = 60;\n      const puzzlePath = generateJigsawPath(puzzleSeed, puzzleSize);\n      \n      return (\n        <div className=\"space-y-3 sm:space-y-6 p-3 sm:p-6\">\n          <div className=\"flex items-center justify-between gap-2\">\n            <div className=\"flex-1 min-w-0\">\n              <h3 className=\"text-base sm:text-lg font-semibold\">Puzzle Challenge</h3>\n              <p className=\"text-xs sm:text-sm text-muted-foreground mt-1\">\n                Drag the puzzle piece to fit the hole\n              </p>\n            </div>\n            <div className=\"flex gap-1 flex-shrink-0\">\n              <Button \n                variant=\"ghost\" \n                size=\"icon\" \n                onClick={handleCheckboxClick}\n                disabled={status === \"solving\"}\n                title=\"New Challenge\"\n                data-testid=\"button-refresh-gesture\"\n              >\n                <svg className=\"h-4 w-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15\" />\n                </svg>\n              </Button>\n              <Button variant=\"ghost\" size=\"icon\" onClick={closeOverlay} disabled={status === \"solving\"} data-testid=\"button-close-gesture\">\n                <X className=\"h-4 w-4 sm:h-5 sm:w-5\" />\n              </Button>\n            </div>\n          </div>\n\n          {status === \"success\" ? (\n            <div className=\"flex items-center gap-2 sm:gap-3 p-3 sm:p-6 bg-green-50 dark:bg-green-900/20 rounded-lg\">\n              <CheckCircle2 className=\"h-6 w-6 sm:h-8 sm:w-8 text-green-600 flex-shrink-0\" />\n              <div>\n                <p className=\"font-semibold text-sm sm:text-base text-green-900 dark:text-green-100\">Perfect match!</p>\n                <p className=\"text-xs sm:text-sm text-green-700 dark:text-green-300\">Puzzle piece placed correctly</p>\n              </div>\n            </div>\n          ) : (\n            <>\n              <div \n                className=\"relative mx-auto rounded-xl overflow-hidden border-2 border-slate-300 dark:border-slate-700\"\n                style={{ \n                  width: `${gridSize.width}px`, \n                  height: `${gridSize.height}px`,\n                  touchAction: 'none',\n                }}\n                onPointerDown={handlePointerDown}\n                onPointerMove={handlePointerMove}\n                onPointerUp={handlePointerUp}\n                onPointerCancel={handlePointerUp}\n                data-testid=\"gesture-drag-area\"\n              >\n                {/* SVG layer untuk background image dan hole */}\n                <svg \n                  className=\"absolute inset-0 pointer-events-none\" \n                  width={gridSize.width} \n                  height={gridSize.height}\n                >\n                  <defs>\n                    {/* Pattern untuk gambar background */}\n                    <pattern id=\"puzzleBackgroundImage\" x=\"0\" y=\"0\" width=\"1\" height=\"1\">\n                      <image \n                        href={puzzleImageUrl} \n                        x=\"0\" \n                        y=\"0\" \n                        width={gridSize.width} \n                        height={gridSize.height}\n                        preserveAspectRatio=\"xMidYMid slice\"\n                      />\n                    </pattern>\n                    \n                    {/* Clip path untuk hole */}\n                    <clipPath id=\"puzzleHoleClip\">\n                      <path d={puzzlePath} transform={`translate(${target.x - puzzleSize/2}, ${target.y - puzzleSize/2})`} />\n                    </clipPath>\n                    \n                    {/* Mask untuk semua area kecuali hole */}\n                    <mask id=\"puzzleHoleMask\">\n                      <rect width={gridSize.width} height={gridSize.height} fill=\"white\" />\n                      <path \n                        d={puzzlePath} \n                        transform={`translate(${target.x - puzzleSize/2}, ${target.y - puzzleSize/2})`}\n                        fill=\"black\"\n                      />\n                    </mask>\n                  </defs>\n                  \n                  {/* Background image dengan mask (tidak tampil di hole) */}\n                  <rect \n                    width={gridSize.width} \n                    height={gridSize.height} \n                    fill=\"url(#puzzleBackgroundImage)\"\n                    mask=\"url(#puzzleHoleMask)\"\n                  />\n                  \n                  {/* Area hole - hitam solid */}\n                  <path \n                    d={puzzlePath} \n                    transform={`translate(${target.x - puzzleSize/2}, ${target.y - puzzleSize/2})`}\n                    fill=\"rgba(0, 0, 0, 0.85)\"\n                  />\n                  \n                  {/* Border hole - subtle */}\n                  <path \n                    d={puzzlePath} \n                    transform={`translate(${target.x - puzzleSize/2}, ${target.y - puzzleSize/2})`}\n                    fill=\"none\"\n                    stroke={isNearTarget ? '#10b981' : 'rgba(255, 255, 255, 0.3)'}\n                    strokeWidth={isNearTarget ? '2' : '1.5'}\n                    opacity={isNearTarget ? '0.8' : '0.5'}\n                  />\n                </svg>\n                \n                {/* Draggable Puzzle Piece */}\n                <div\n                  className={`absolute transition-all duration-100 ${isDragging ? \"cursor-grabbing\" : \"cursor-grab\"}`}\n                  style={{\n                    left: `${dragPosition.x}px`,\n                    top: `${dragPosition.y}px`,\n                    transform: 'translate(-50%, -50%)',\n                    filter: isDragging ? 'drop-shadow(0 12px 20px rgba(0, 0, 0, 0.6))' : 'drop-shadow(0 6px 12px rgba(0, 0, 0, 0.5))',\n                    zIndex: 2,\n                  }}\n                  data-testid=\"gesture-draggable\"\n                >\n                  <svg \n                    width={puzzleSize + 20} \n                    height={puzzleSize + 20} \n                    viewBox={`-10 -10 ${puzzleSize + 20} ${puzzleSize + 20}`}\n                    className={`transition-transform ${isDragging ? 'scale-105' : 'scale-100'}`}\n                  >\n                    <defs>\n                      <clipPath id=\"puzzlePieceClip\">\n                        <path d={puzzlePath} />\n                      </clipPath>\n                    </defs>\n                    \n                    {/* Puzzle piece dengan gambar yang offset - selalu tampilkan bagian dari target */}\n                    <g clipPath=\"url(#puzzlePieceClip)\">\n                      <image \n                        href={puzzleImageUrl} \n                        x={-target.x + puzzleSize/2} \n                        y={-target.y + puzzleSize/2}\n                        width={gridSize.width} \n                        height={gridSize.height}\n                        preserveAspectRatio=\"xMidYMid slice\"\n                      />\n                    </g>\n                    \n                    {/* Puzzle piece border */}\n                    <path \n                      d={puzzlePath} \n                      fill=\"none\"\n                      stroke={isNearTarget ? '#10b981' : '#ffffff'}\n                      strokeWidth=\"2.5\"\n                      opacity=\"0.95\"\n                    />\n                    \n                    {/* Inner highlight untuk efek 3D */}\n                    <path \n                      d={puzzlePath} \n                      fill=\"none\"\n                      stroke=\"rgba(255, 255, 255, 0.5)\"\n                      strokeWidth=\"1\"\n                    />\n                  </svg>\n                  \n                  {/* Distance indicator when near target */}\n                  {isNearTarget && (\n                    <div className=\"absolute -bottom-8 left-1/2 -translate-x-1/2 whitespace-nowrap\">\n                      <div className=\"bg-green-500 text-white text-xs px-2 py-1 rounded-full animate-pulse font-semibold\">\n                        {Math.round(distance)}px away\n                      </div>\n                    </div>\n                  )}\n                </div>\n              </div>\n\n              <p className=\"text-center text-xs sm:text-sm text-muted-foreground\">\n                {isNearTarget ? (\n                  <span className=\"text-green-600 dark:text-green-400 font-semibold\">\n                    Perfect! Almost in place - {Math.round(distance)}px away\n                  </span>\n                ) : (\n                  <span>\n                    Drag the jigsaw piece to complete the puzzle\n                  </span>\n                )}\n              </p>\n\n              <div className=\"grid grid-cols-2 gap-2 sm:gap-3\">\n                <Button \n                  onClick={handleSkip}\n                  disabled={status === \"solving\"}\n                  variant=\"outline\"\n                  size=\"lg\"\n                  data-testid=\"button-skip-gesture\"\n                  className=\"text-sm sm:text-base\"\n                >\n                  Skip\n                </Button>\n                <Button \n                  onClick={handleGestureVerify}\n                  disabled={status === \"solving\"}\n                  className=\"w-full\"\n                  size=\"lg\"\n                  data-testid=\"button-verify-gesture\"\n                >\n                  {status === \"solving\" ? (\n                    <>\n                      <Loader2 className=\"mr-2 h-3 w-3 sm:h-4 sm:w-4 animate-spin\" />\n                      <span className=\"text-sm sm:text-base\">Verifying...</span>\n                    </>\n                  ) : (\n                    <span className=\"text-sm sm:text-base\">Verify</span>\n                  )}\n                </Button>\n              </div>\n\n              {status === \"solving\" && (\n                <div className=\"h-2 w-full bg-muted rounded-full overflow-hidden\">\n                  <div\n                    className=\"h-full bg-primary transition-all duration-300\"\n                    style={{ width: `${progress}%` }}\n                  />\n                </div>\n              )}\n            </>\n          )}\n        </div>\n      );\n    }\n\n    if (actualType === \"upside_down\") {\n      return (\n        <div className=\"space-y-6 p-6\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <h3 className=\"text-lg font-semibold\">Animal Challenge</h3>\n              <p className=\"text-sm text-muted-foreground mt-1\">\n                Click on all upside-down animals\n              </p>\n            </div>\n            <div className=\"flex gap-1\">\n              <Button \n                variant=\"ghost\" \n                size=\"icon\" \n                onClick={handleCheckboxClick}\n                disabled={status === \"solving\"}\n                title=\"New Challenge\"\n                data-testid=\"button-refresh-upside-down\"\n              >\n                <svg className=\"h-4 w-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15\" />\n                </svg>\n              </Button>\n              <Button variant=\"ghost\" size=\"icon\" onClick={closeOverlay} disabled={status === \"solving\"} data-testid=\"button-close-upside-down\">\n                <X className=\"h-5 w-5\" />\n              </Button>\n            </div>\n          </div>\n\n          {status === \"success\" ? (\n            <div className=\"flex items-center gap-3 p-6 bg-green-50 dark:bg-green-900/20 rounded-lg\">\n              <CheckCircle2 className=\"h-8 w-8 text-green-600\" />\n              <div>\n                <p className=\"font-semibold text-green-900 dark:text-green-100\">All correct!</p>\n                <p className=\"text-sm text-green-700 dark:text-green-300\">You identified all upside-down animals</p>\n              </div>\n            </div>\n          ) : (\n            <UpsideDownCaptcha\n              challengeData={challenge}\n              onSolve={handleUpsideDownVerify}\n              disabled={status === \"solving\"}\n            />\n          )}\n        </div>\n      );\n    }\n\n    return null;\n  };\n\n  return (\n    <>\n      <Card className=\"w-full max-w-sm border-2 shadow-md\" data-testid=\"card-captcha-widget\">\n        <div className=\"p-3 border-b bg-gradient-to-r from-slate-50 to-slate-100 dark:from-slate-900 dark:to-slate-800\">\n          <div className=\"flex items-center gap-3\">\n            {status === \"success\" ? (\n              <>\n                <div className=\"flex items-center justify-center w-8 h-8 rounded bg-green-100 dark:bg-green-900\">\n                  <CheckCircle2 className=\"h-5 w-5 text-green-600 dark:text-green-400\" data-testid=\"icon-success\" />\n                </div>\n                <div className=\"flex-1\">\n                  <p className=\"text-sm font-semibold\" data-testid=\"text-status\">\n                    Verified!\n                  </p>\n                  {attempts > 0 && (\n                    <p className=\"text-xs text-muted-foreground\" data-testid=\"text-attempts\">\n                      {attempts.toLocaleString()} computations\n                    </p>\n                  )}\n                </div>\n              </>\n            ) : status === \"blocked\" ? (\n              <>\n                <div className=\"flex items-center justify-center w-8 h-8 rounded bg-orange-100 dark:bg-orange-900\">\n                  <Shield className=\"h-5 w-5 text-orange-600 dark:text-orange-400\" data-testid=\"icon-blocked\" />\n                </div>\n                <div className=\"flex-1\">\n                  <p className=\"text-sm font-semibold text-orange-900 dark:text-orange-100\" data-testid=\"text-status\">\n                    IP Locked\n                  </p>\n                  <div className=\"flex items-center gap-1 text-xs text-orange-700 dark:text-orange-300\" data-testid=\"text-countdown\">\n                    <Clock className=\"h-3 w-3\" />\n                    <span>{remainingTime}</span>\n                  </div>\n                </div>\n              </>\n            ) : status === \"error\" ? (\n              <>\n                <div className=\"flex items-center justify-center w-8 h-8 rounded bg-red-100 dark:bg-red-900\">\n                  <XCircle className=\"h-5 w-5 text-red-600 dark:text-red-400\" data-testid=\"icon-error\" />\n                </div>\n                <div className=\"flex-1\">\n                  <p className=\"text-sm font-semibold\" data-testid=\"text-status\">\n                    Verification failed\n                  </p>\n                  <Button\n                    variant=\"ghost\"\n                    size=\"sm\"\n                    onClick={() => setStatus(\"idle\")}\n                    data-testid=\"button-retry\"\n                    className=\"h-auto p-0 text-xs hover:underline\"\n                  >\n                    Try again\n                  </Button>\n                </div>\n              </>\n            ) : (\n              <>\n                <Checkbox\n                  checked={false}\n                  onCheckedChange={handleCheckboxClick}\n                  data-testid=\"checkbox-verify\"\n                  className=\"h-7 w-7 border-2 data-[state=checked]:bg-blue-600\"\n                  disabled={status === \"loading\"}\n                />\n                <p className=\"text-sm font-semibold\" data-testid=\"text-instruction\">\n                  I'm not a robot\n                </p>\n              </>\n            )}\n\n            <div className={`ml-auto flex items-center justify-center w-10 h-10 rounded-md shadow-md ${\n              status === \"success\" \n                ? \"bg-gradient-to-br from-green-500 to-emerald-600\" \n                : status === \"blocked\"\n                ? \"bg-gradient-to-br from-orange-500 to-amber-600\"\n                : \"bg-gradient-to-br from-blue-500 to-indigo-600\"\n            }`}>\n              {status === \"success\" ? (\n                <UserCheck className=\"h-6 w-6 text-white\" data-testid=\"icon-human\" />\n              ) : status === \"blocked\" ? (\n                <Shield className=\"h-6 w-6 text-white\" data-testid=\"icon-shield\" />\n              ) : (\n                <Bot className=\"h-6 w-6 text-white\" data-testid=\"icon-bot\" />\n              )}\n            </div>\n          </div>\n        </div>\n\n        <div className=\"px-3 py-2 text-[10px] text-muted-foreground flex items-center justify-between bg-white dark:bg-slate-950\" data-testid=\"text-branding\">\n          <a href=\"/privacy\" target=\"_blank\" rel=\"noopener noreferrer\" className=\"hover:underline\" data-testid=\"link-privacy\">Privacy</a>\n          <span className=\"font-semibold\">ProofCaptcha</span>\n          <a href=\"/terms\" target=\"_blank\" rel=\"noopener noreferrer\" className=\"hover:underline\" data-testid=\"link-terms\">Terms</a>\n        </div>\n      </Card>\n\n      {showOverlay && createPortal(\n        <div \n          className=\"fixed inset-0 flex items-center justify-center p-4 captcha-overlay-fade\"\n          style={{\n            backgroundColor: 'rgba(0, 0, 0, 0.5)',\n            backdropFilter: 'blur(8px)',\n            zIndex: 999999,\n            pointerEvents: 'auto',\n            touchAction: 'none',\n          }}\n          onClick={(e) => {\n            if (e.target === e.currentTarget && status !== \"solving\") {\n              closeOverlay();\n            }\n          }}\n        >\n          <Card \n            className=\"w-full max-w-md max-h-[90vh] overflow-y-auto captcha-modal-slide\" \n            style={{\n              boxShadow: '0 20px 25px -5px rgba(0, 0, 0, 0.3), 0 10px 10px -5px rgba(0, 0, 0, 0.04)',\n              pointerEvents: 'auto',\n              position: 'relative',\n              zIndex: 1000000,\n            }}\n          >\n            {renderChallengeContent()}\n          </Card>\n        </div>,\n        document.body\n      )}\n    </>\n  );\n}\n","size_bytes":52447},"client/src/pages/Home.tsx":{"content":"import { Link } from \"wouter\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Shield, Zap, BarChart3, Code2, Lock, Cpu, CheckCircle2, ArrowRight, Sparkles, Globe, Users } from \"lucide-react\";\nimport { useTranslation } from \"react-i18next\";\nimport LanguageToggle from \"@/components/LanguageToggle\";\nimport ThemeToggle from \"@/components/ThemeToggle\";\n\nexport default function Home() {\n  const { t } = useTranslation();\n\n  return (\n    <div className=\"min-h-screen relative overflow-hidden\" data-testid=\"page-home\">\n      {/* Animated gradient background */}\n      <div className=\"absolute inset-0 -z-10\">\n        <div className=\"absolute top-0 -left-4 w-96 h-96 bg-primary/30 rounded-full mix-blend-multiply filter blur-3xl opacity-70 animate-blob\" />\n        <div className=\"absolute top-0 -right-4 w-96 h-96 bg-purple-300/30 rounded-full mix-blend-multiply filter blur-3xl opacity-70 animate-blob animation-delay-2000\" />\n        <div className=\"absolute -bottom-8 left-20 w-96 h-96 bg-blue-300/30 rounded-full mix-blend-multiply filter blur-3xl opacity-70 animate-blob animation-delay-4000\" />\n      </div>\n\n      {/* Header with glassmorphism */}\n      <header className=\"sticky top-0 z-50 backdrop-blur-md bg-background/80 border-b border-border/50\">\n        <div className=\"container mx-auto px-4 py-4 flex items-center justify-between\">\n          <div className=\"flex items-center gap-3 group\">\n            <div className=\"relative\">\n              <Shield className=\"h-7 w-7 text-primary transition-all duration-300 group-hover:scale-110 group-hover:rotate-12\" />\n              <div className=\"absolute inset-0 bg-primary/20 rounded-full blur-md group-hover:blur-lg transition-all\" />\n            </div>\n            <span className=\"font-bold text-xl bg-gradient-to-r from-primary to-purple-600 bg-clip-text text-transparent\">\n              ProofCaptcha\n            </span>\n          </div>\n          <div className=\"flex items-center gap-2\">\n            <LanguageToggle />\n            <ThemeToggle />\n          </div>\n        </div>\n      </header>\n\n      <div className=\"container mx-auto px-4 py-8 sm:py-12 lg:py-16 space-y-16 sm:space-y-20 lg:space-y-32\">\n        {/* Hero Section with 3D elements */}\n        <section className=\"text-center space-y-6 sm:space-y-8 py-8 sm:py-12 lg:py-20 relative\">\n          {/* Floating 3D icon */}\n          <div className=\"flex justify-center mb-6 sm:mb-8 perspective-1000\">\n            <div className=\"relative transform-gpu hover:scale-110 transition-all duration-500 floating\">\n              <div className=\"absolute inset-0 bg-gradient-to-br from-primary/50 to-purple-500/50 rounded-3xl blur-2xl opacity-60 animate-pulse-slow\" />\n              <div className=\"relative bg-gradient-to-br from-primary to-purple-600 p-6 sm:p-8 rounded-3xl shadow-2xl transform rotate-3 hover:rotate-0 transition-all duration-500\">\n                <Shield className=\"h-16 w-16 sm:h-20 sm:w-20 lg:h-24 lg:w-24 text-white drop-shadow-lg\" data-testid=\"icon-hero\" />\n              </div>\n            </div>\n          </div>\n\n          <div className=\"space-y-4 sm:space-y-6\">\n            <h1 className=\"text-4xl sm:text-5xl md:text-6xl lg:text-7xl font-extrabold leading-tight\" data-testid=\"text-hero-title\">\n              <span aria-label={t('home.title')}>\n                {t('home.title').split('').map((char, index) => (\n                  <span\n                    key={index}\n                    className=\"bounce-letter bg-gradient-to-r from-primary via-purple-600 to-blue-600 bg-clip-text text-transparent\"\n                    style={{\n                      animationDelay: `${index * 0.1}s`\n                    }}\n                  >\n                    {char === ' ' ? '\\u00A0' : char}\n                  </span>\n                ))}\n              </span>\n            </h1>\n            <p className=\"text-lg sm:text-xl lg:text-2xl text-muted-foreground max-w-3xl mx-auto px-4 leading-relaxed\" data-testid=\"text-hero-subtitle\">\n              {t('home.subtitle')}\n            </p>\n          </div>\n\n          <div className=\"flex gap-4 sm:gap-6 justify-center flex-wrap px-4 pt-4\">\n            <Link href=\"/register\">\n              <Button size=\"lg\" className=\"text-base sm:text-lg px-8 py-6 rounded-xl shadow-lg hover:shadow-2xl transition-all duration-300 group relative overflow-hidden\" data-testid=\"button-get-started\">\n                <span className=\"relative z-10 flex items-center gap-2\">\n                  {t('home.getStarted')}\n                  <ArrowRight className=\"w-5 h-5 group-hover:translate-x-1 transition-transform\" />\n                </span>\n              </Button>\n            </Link>\n            <Link href=\"/login\">\n              <Button size=\"lg\" variant=\"outline\" className=\"text-base sm:text-lg px-8 py-6 rounded-xl backdrop-blur-sm bg-background/50 hover:bg-background/80 border-2 shadow-lg hover:shadow-xl transition-all duration-300\" data-testid=\"button-login\">\n                {t('home.login')}\n              </Button>\n            </Link>\n          </div>\n\n          {/* Stats badges */}\n          <div className=\"flex flex-wrap gap-4 sm:gap-6 justify-center pt-8 sm:pt-12\">\n            <div className=\"flex items-center gap-2 px-4 py-2 rounded-full bg-card/80 backdrop-blur-sm border shadow-sm\" data-testid=\"badge-uptime\">\n              <CheckCircle2 className=\"w-5 h-5 text-green-500\" />\n              <span className=\"text-sm font-medium\">{t('home.stats.uptime')}</span>\n            </div>\n            <div className=\"flex items-center gap-2 px-4 py-2 rounded-full bg-card/80 backdrop-blur-sm border shadow-sm\" data-testid=\"badge-developers\">\n              <Users className=\"w-5 h-5 text-primary\" />\n              <span className=\"text-sm font-medium\">{t('home.stats.developers')}</span>\n            </div>\n            <div className=\"flex items-center gap-2 px-4 py-2 rounded-full bg-card/80 backdrop-blur-sm border shadow-sm\" data-testid=\"badge-integration\">\n              <Code2 className=\"w-5 h-5 text-blue-500\" />\n              <span className=\"text-sm font-medium\">{t('home.stats.integration')}</span>\n            </div>\n          </div>\n        </section>\n\n        {/* Features Grid with 3D cards */}\n        <section className=\"space-y-8 sm:space-y-12\">\n          <div className=\"text-center space-y-3\">\n            <div className=\"flex items-center justify-center gap-2 mb-4\">\n              <Sparkles className=\"w-6 h-6 text-primary animate-pulse\" />\n              <h2 className=\"text-3xl sm:text-4xl font-bold bg-gradient-to-r from-foreground to-muted-foreground bg-clip-text text-transparent\" data-testid=\"text-features-title\">\n                {t('home.features.title')}\n              </h2>\n              <Sparkles className=\"w-6 h-6 text-primary animate-pulse\" />\n            </div>\n            <p className=\"text-muted-foreground text-lg max-w-2xl mx-auto\" data-testid=\"text-features-subtitle\">\n              {t('home.features.subtitle')}\n            </p>\n          </div>\n\n          <div className=\"grid gap-6 md:grid-cols-2 lg:grid-cols-3\">\n            <Card className=\"group hover-elevate relative overflow-hidden border-2 transition-all duration-500 hover:scale-105 hover:shadow-2xl\" data-testid=\"card-feature-pow\">\n              <div className=\"absolute inset-0 bg-gradient-to-br from-primary/5 to-purple-500/5 opacity-0 group-hover:opacity-100 transition-opacity duration-500\" />\n              <CardHeader className=\"relative\">\n                <div className=\"p-3 bg-gradient-to-br from-primary/10 to-purple-500/10 rounded-xl w-fit mb-4 group-hover:scale-110 transition-transform duration-500\">\n                  <Cpu className=\"h-8 w-8 text-primary\" />\n                </div>\n                <CardTitle className=\"text-xl font-bold\">{t('home.features.pow.title')}</CardTitle>\n                <CardDescription className=\"text-base leading-relaxed\">\n                  {t('home.features.pow.description')}\n                </CardDescription>\n              </CardHeader>\n            </Card>\n\n            <Card className=\"group hover-elevate relative overflow-hidden border-2 transition-all duration-500 hover:scale-105 hover:shadow-2xl\" data-testid=\"card-feature-analytics\">\n              <div className=\"absolute inset-0 bg-gradient-to-br from-blue-500/5 to-cyan-500/5 opacity-0 group-hover:opacity-100 transition-opacity duration-500\" />\n              <CardHeader className=\"relative\">\n                <div className=\"p-3 bg-gradient-to-br from-blue-500/10 to-cyan-500/10 rounded-xl w-fit mb-4 group-hover:scale-110 transition-transform duration-500\">\n                  <BarChart3 className=\"h-8 w-8 text-blue-500\" />\n                </div>\n                <CardTitle className=\"text-xl font-bold\">{t('home.features.analytics.title')}</CardTitle>\n                <CardDescription className=\"text-base leading-relaxed\">\n                  {t('home.features.analytics.description')}\n                </CardDescription>\n              </CardHeader>\n            </Card>\n\n            <Card className=\"group hover-elevate relative overflow-hidden border-2 transition-all duration-500 hover:scale-105 hover:shadow-2xl\" data-testid=\"card-feature-integration\">\n              <div className=\"absolute inset-0 bg-gradient-to-br from-green-500/5 to-emerald-500/5 opacity-0 group-hover:opacity-100 transition-opacity duration-500\" />\n              <CardHeader className=\"relative\">\n                <div className=\"p-3 bg-gradient-to-br from-green-500/10 to-emerald-500/10 rounded-xl w-fit mb-4 group-hover:scale-110 transition-transform duration-500\">\n                  <Code2 className=\"h-8 w-8 text-green-500\" />\n                </div>\n                <CardTitle className=\"text-xl font-bold\">{t('home.features.integration.title')}</CardTitle>\n                <CardDescription className=\"text-base leading-relaxed\">\n                  {t('home.features.integration.description')}\n                </CardDescription>\n              </CardHeader>\n            </Card>\n\n            <Card className=\"group hover-elevate relative overflow-hidden border-2 transition-all duration-500 hover:scale-105 hover:shadow-2xl\" data-testid=\"card-feature-encryption\">\n              <div className=\"absolute inset-0 bg-gradient-to-br from-amber-500/5 to-orange-500/5 opacity-0 group-hover:opacity-100 transition-opacity duration-500\" />\n              <CardHeader className=\"relative\">\n                <div className=\"p-3 bg-gradient-to-br from-amber-500/10 to-orange-500/10 rounded-xl w-fit mb-4 group-hover:scale-110 transition-transform duration-500\">\n                  <Lock className=\"h-8 w-8 text-amber-500\" />\n                </div>\n                <CardTitle className=\"text-xl font-bold\">{t('home.features.encryption.title')}</CardTitle>\n                <CardDescription className=\"text-base leading-relaxed\">\n                  {t('home.features.encryption.description')}\n                </CardDescription>\n              </CardHeader>\n            </Card>\n\n            <Card className=\"group hover-elevate relative overflow-hidden border-2 transition-all duration-500 hover:scale-105 hover:shadow-2xl\" data-testid=\"card-feature-fingerprint\">\n              <div className=\"absolute inset-0 bg-gradient-to-br from-violet-500/5 to-purple-500/5 opacity-0 group-hover:opacity-100 transition-opacity duration-500\" />\n              <CardHeader className=\"relative\">\n                <div className=\"p-3 bg-gradient-to-br from-violet-500/10 to-purple-500/10 rounded-xl w-fit mb-4 group-hover:scale-110 transition-transform duration-500\">\n                  <Zap className=\"h-8 w-8 text-violet-500\" />\n                </div>\n                <CardTitle className=\"text-xl font-bold\">{t('home.features.fingerprint.title')}</CardTitle>\n                <CardDescription className=\"text-base leading-relaxed\">\n                  {t('home.features.fingerprint.description')}\n                </CardDescription>\n              </CardHeader>\n            </Card>\n\n            <Card className=\"group hover-elevate relative overflow-hidden border-2 transition-all duration-500 hover:scale-105 hover:shadow-2xl\" data-testid=\"card-feature-detection\">\n              <div className=\"absolute inset-0 bg-gradient-to-br from-rose-500/5 to-pink-500/5 opacity-0 group-hover:opacity-100 transition-opacity duration-500\" />\n              <CardHeader className=\"relative\">\n                <div className=\"p-3 bg-gradient-to-br from-rose-500/10 to-pink-500/10 rounded-xl w-fit mb-4 group-hover:scale-110 transition-transform duration-500\">\n                  <Shield className=\"h-8 w-8 text-rose-500\" />\n                </div>\n                <CardTitle className=\"text-xl font-bold\">{t('home.features.detection.title')}</CardTitle>\n                <CardDescription className=\"text-base leading-relaxed\">\n                  {t('home.features.detection.description')}\n                </CardDescription>\n              </CardHeader>\n            </Card>\n          </div>\n        </section>\n\n        {/* CTA Section with gradient and 3D effect */}\n        <section className=\"relative rounded-3xl overflow-hidden\">\n          <div className=\"absolute inset-0 bg-gradient-to-br from-primary via-purple-600 to-blue-600 opacity-90\" />\n          <div className=\"absolute inset-0\">\n            <div className=\"absolute top-0 left-1/4 w-72 h-72 bg-white/10 rounded-full blur-3xl\" />\n            <div className=\"absolute bottom-0 right-1/4 w-72 h-72 bg-white/10 rounded-full blur-3xl\" />\n          </div>\n          \n          <div className=\"relative p-8 sm:p-12 lg:p-16 text-center space-y-6 sm:space-y-8\">\n            <div className=\"space-y-4\">\n              <h2 className=\"text-3xl sm:text-4xl lg:text-5xl font-extrabold text-white drop-shadow-lg\" data-testid=\"text-cta-title\">\n                {t('home.cta.title')}\n              </h2>\n              <p className=\"text-base sm:text-lg lg:text-xl text-white/90 max-w-2xl mx-auto px-4 leading-relaxed drop-shadow\" data-testid=\"text-cta-subtitle\">\n                {t('home.cta.description')}\n              </p>\n            </div>\n            \n            <Link href=\"/register\">\n              <Button \n                size=\"lg\" \n                variant=\"secondary\"\n                className=\"text-base sm:text-lg px-10 py-7 rounded-xl shadow-2xl hover:shadow-3xl transition-all duration-300 hover:scale-105 group bg-white text-primary hover:bg-white/90\" \n                data-testid=\"button-cta\"\n              >\n                <span className=\"flex items-center gap-2\">\n                  {t('home.cta.button')}\n                  <ArrowRight className=\"w-5 h-5 group-hover:translate-x-1 transition-transform\" />\n                </span>\n              </Button>\n            </Link>\n\n            {/* Trust indicators */}\n            <div className=\"flex flex-wrap gap-6 justify-center pt-8 text-white/80 text-sm\">\n              <div className=\"flex items-center gap-2\" data-testid=\"trust-free-start\">\n                <CheckCircle2 className=\"w-4 h-4\" />\n                <span>{t('home.trust.freeToStart')}</span>\n              </div>\n              <div className=\"flex items-center gap-2\" data-testid=\"trust-no-credit-card\">\n                <CheckCircle2 className=\"w-4 h-4\" />\n                <span>{t('home.trust.noCreditCard')}</span>\n              </div>\n              <div className=\"flex items-center gap-2\" data-testid=\"trust-quick-setup\">\n                <CheckCircle2 className=\"w-4 h-4\" />\n                <span>{t('home.trust.quickSetup')}</span>\n              </div>\n            </div>\n          </div>\n        </section>\n\n        {/* Footer spacing */}\n        <div className=\"h-8\" />\n      </div>\n    </div>\n  );\n}\n","size_bytes":15687},"ANTI-DEBUGGER.md":{"content":"# üõ°Ô∏è Anti-Debugger Protection - ProofCaptcha\n\n## Ringkasan\n\nProofCaptcha sekarang dilengkapi dengan sistem **Anti-Debugger Protection** multi-layer yang canggih untuk mencegah debugging, reverse engineering, dan manipulasi widget captcha melalui DevTools browser.\n\n## ‚ú® Fitur Anti-Debugger\n\n### 1. **Debugger Traps** üéØ\n- Infinite loops menggunakan `debugger` statement\n- Multiple trap dengan interval acak (200-2000ms)\n- Menggunakan `Function.constructor` untuk bypass basic detection\n- Akan membuat DevTools hang jika dibuka\n\n### 2. **Viewport & Window Size Monitoring** üìê\n- Mendeteksi perubahan ukuran window saat DevTools dibuka (docked mode)\n- Threshold detection: 160px perbedaan antara `outerWidth` dan `innerWidth`\n- Real-time monitoring melalui resize events\n- Interval check setiap 1 detik\n\n### 3. **Timing-Based Detection** ‚è±Ô∏è\n- Menganalisis waktu eksekusi kode\n- Deteksi perlambatan eksekusi saat debugging aktif\n- Threshold: >100ms untuk operasi debugger statement\n- Interval check setiap 2 detik\n\n### 4. **Function Integrity Checks** üîç\n- Memantau manipulasi fungsi console (log, warn, error)\n- Membandingkan dengan signature asli menggunakan `toString()`\n- Mendeteksi console override/hijacking\n- Interval check setiap 3 detik\n\n### 5. **toString() Traps** ü™§\n- Getter traps yang execute ketika DevTools inspects objects\n- Memanfaatkan console.log('%c', object) untuk trigger inspection\n- Detection melalui DOM element property getters\n- Multiple trap layers untuk reliability\n\n### 6. **Performance Monitoring** üìä\n- Monitor delta waktu execution loop\n- Deteksi anomali >2000ms (indikasi debugging/breakpoint)\n- Continuous monitoring dengan performance.now()\n- Interval check setiap 1 detik\n\n### 7. **Console Protection** üîê\n- Filtering output console untuk mencegah information leakage\n- Suppress log yang mengandung sensitive data\n- Tetap preserve encryption logs untuk debugging legitimate\n\n### 8. **Premium Visual Feedback System** üé® **ENHANCED!**\n- **\"CHEATERS!!\" Mode**: Transformasi widget yang dramatic dengan premium styling\n- **Cracker Icon 3D**: Logo üö´ü•∑ dengan animasi shake & rotate3D yang smooth\n- **Police Animation**: Animasi cinematic polisi üöîüëÆ menangkap attacker ü•∑ dengan easing curve\n- **Gradient Text**: \"CHEATERS!!\" dengan gradient merah yang beranimasi\n- **Glow Effects**: Box-shadow yang beranimasi untuk alert effect\n- **Premium Animations**: \n  - Alert glow: Pulsing red glow di widget border\n  - Shake & Rotate3D: Icon cracker berputar 3D dengan getaran\n  - Pulse Scale: Warning icon yang membesar-mengecil smooth\n  - Police sequence: Multi-stage animation dengan perfect timing\n  - Stop sign: Muncul dengan bounce effect yang dramatic\n\n## üöÄ Cara Penggunaan\n\n### Auto-Enable (Default)\n\nAnti-debugger protection **otomatis aktif** saat api.js dimuat:\n\n```html\n<!-- Cukup load script seperti biasa -->\n<script src=\"/proofCaptcha/api.js\"></script>\n```\n\n### Manual Control via API\n\nAnda dapat mengontrol anti-debugger melalui global API:\n\n```javascript\n// Enable anti-debugger protection\nProofCaptcha.antiDebug.enable();\n\n// Disable anti-debugger (untuk development saja!)\nProofCaptcha.antiDebug.disable();\n\n// Cek status proteksi\nconst status = ProofCaptcha.antiDebug.getStatus();\nconsole.log(status);\n// Output:\n// {\n//   enabled: true,\n//   devtoolsDetected: false\n// }\n```\n\n### Contoh Implementation\n\n```html\n<!DOCTYPE html>\n<html>\n<head>\n  <title>Protected Captcha</title>\n  <script src=\"/proofCaptcha/api.js\"></script>\n</head>\n<body>\n  <div \n    class=\"proof-captcha\"\n    data-sitekey=\"your_public_key\"\n    data-theme=\"light\"\n    data-callback=\"onSuccess\"\n  ></div>\n\n  <script>\n    // Anti-debugger sudah otomatis aktif!\n    \n    function onSuccess(token) {\n      console.log('Captcha verified:', token);\n      \n      // Cek apakah ada DevTools detection\n      const status = ProofCaptcha.antiDebug.getStatus();\n      if (status.devtoolsDetected) {\n        alert('‚ö†Ô∏è DevTools detected! Submission blocked.');\n        return;\n      }\n      \n      // Submit form dengan token\n      submitForm(token);\n    }\n    \n    // Untuk development, disable anti-debugger\n    if (window.location.hostname === 'localhost') {\n      ProofCaptcha.antiDebug.disable();\n      console.log('Anti-debugger disabled for development');\n    }\n  </script>\n</body>\n</html>\n```\n\n## üéÆ Testing & Demo\n\nKunjungi halaman test untuk melihat anti-debugger beraksi:\n\n```\nhttps://your-domain.com/test.html\n```\n\n### Demo Features:\n- Real-time status monitoring\n- Manual enable/disable controls\n- DevTools detection status\n- Live protection indicators\n\n### Cara Test:\n1. Buka halaman `/test.html`\n2. Lihat section \"Anti-Debugger Protection\"\n3. Buka DevTools browser (F12 atau Ctrl+Shift+I)\n4. Perhatikan perubahan DRAMATIS pada widget:\n   - ‚úÖ Status \"DevTools Detected\" berubah menjadi \"YA\"\n   - üö´ Logo berubah jadi cracker dengan tanda X (üö´ü•∑)\n   - ‚ö†Ô∏è Text berubah jadi \"CHEATERS!!\" dengan warna merah\n   - üî¥ Checkbox diganti warning icon yang beranimasi pulse\n   - ‚ùÑÔ∏è DevTools akan freeze karena debugger traps\n5. **KLIK WARNING ICON** untuk melihat animasi polisi menangkap attacker! üöîüëÆ‚ûúü•∑\n\n## üîß Configuration & Customization\n\n### Disable for Development\n\n```javascript\n// Di file development Anda\nif (import.meta.env.DEV) {\n  window.ProofCaptcha?.antiDebug?.disable();\n}\n```\n\n### Custom Response Actions\n\nSaat DevTools terdeteksi, anti-debugger melakukan actions berikut:\n- ‚ùå **Close overlay** jika challenge sedang dibuka\n- üé® **Transform widget** ke \"cheater mode\":\n  - Logo ‚Üí üö´ü•∑ (cracker dengan X, animasi shake + rotate3D)\n  - Text ‚Üí **\"CHEATERS!!\"** (merah, bold, pulse animation)\n  - Checkbox ‚Üí Warning icon (pulse animation)\n  - Click handler ‚Üí Police animation üöîüëÆ menangkap ü•∑\n- üö® **Dispatch event** `captcha_tamper_detected`\n- üìù **Log detection** untuk monitoring\n\nAnda bisa listen event ini untuk custom action:\n\n```javascript\ndocument.addEventListener('captcha_tamper_detected', (e) => {\n  console.warn('‚ö†Ô∏è Tamper attempt detected!');\n  \n  // Custom actions\n  alert('Please close DevTools to continue');\n  window.location.href = '/blocked';\n  \n  // Log to your analytics\n  analytics.track('security_violation', {\n    type: 'devtools_detected',\n    timestamp: new Date()\n  });\n});\n```\n\n## ‚ö†Ô∏è Important Notes\n\n### Development vs Production\n\n**Development:**\n```javascript\n// Disable untuk kemudahan debugging\nProofCaptcha.antiDebug.disable();\n```\n\n**Production:**\n```javascript\n// Biarkan default (enabled) untuk security\n// Atau explicitly enable:\nProofCaptcha.antiDebug.enable();\n```\n\n### Bypass Protection (For Legitimate Testing)\n\nAnti-debugger **TIDAK 100% unbreakable**. Attackers dengan skill tinggi dapat:\n- Menggunakan custom Firefox build dengan modified debugger keyword\n- Browser extensions seperti \"Anti Anti Debug\"\n- Detached DevTools window untuk viewport detection bypass\n- Disable JavaScript (tapi captcha tidak akan berfungsi)\n\n**Defense Strategy:**\n- Multi-layered approach (anti-debugger adalah layer tambahan)\n- Server-side validation tetap yang paling penting\n- Rate limiting untuk mencegah brute force\n- Monitor suspicious patterns di analytics\n\n## üìä Technical Details\n\n### Detection Methods Comparison\n\n| Method | Effectiveness | False Positive | Performance Impact |\n|--------|--------------|----------------|-------------------|\n| Debugger Traps | ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ | Low | Medium |\n| Viewport Monitoring | ‚òÖ‚òÖ‚òÖ‚òÜ‚òÜ | Medium | Low |\n| Timing Detection | ‚òÖ‚òÖ‚òÖ‚òÖ‚òÜ | Low | Low |\n| Function Integrity | ‚òÖ‚òÖ‚òÖ‚òÜ‚òÜ | Very Low | Low |\n| toString() Traps | ‚òÖ‚òÖ‚òÖ‚òÖ‚òÜ | Low | Low |\n| Performance Monitoring | ‚òÖ‚òÖ‚òÖ‚òÜ‚òÜ | Medium | Low |\n\n### Browser Compatibility\n\n‚úÖ **Fully Supported:**\n- Chrome/Chromium (90+)\n- Firefox (88+)\n- Safari (14+)\n- Edge (90+)\n\n‚ö†Ô∏è **Partial Support:**\n- Older browsers may not trigger all detection methods\n- Mobile browsers have different viewport behavior\n\n## üîê Security Best Practices\n\n1. **Always Validate Server-Side**\n   ```javascript\n   // ‚ùå BAD - Client-side only validation\n   if (captchaToken) {\n     submitForm();\n   }\n   \n   // ‚úÖ GOOD - Server validates token\n   fetch('/api/verify', {\n     method: 'POST',\n     body: JSON.stringify({ token: captchaToken })\n   });\n   ```\n\n2. **Combine with Rate Limiting**\n   ```javascript\n   // Limit verification attempts per IP\n   app.use('/api/verify', rateLimiter({\n     windowMs: 15 * 60 * 1000,\n     max: 10\n   }));\n   ```\n\n3. **Monitor & Alert**\n   ```javascript\n   // Track DevTools detection in your analytics\n   if (status.devtoolsDetected) {\n     analytics.track('security_event', {\n       type: 'devtools_detected',\n       page: window.location.href\n     });\n   }\n   ```\n\n4. **Disable in Development**\n   ```javascript\n   // .env.development\n   VITE_DISABLE_ANTI_DEBUG=true\n   \n   // App initialization\n   if (import.meta.env.VITE_DISABLE_ANTI_DEBUG) {\n     ProofCaptcha.antiDebug.disable();\n   }\n   ```\n\n## üìö API Reference\n\n### `ProofCaptcha.antiDebug.enable()`\nMengaktifkan semua layer proteksi anti-debugger.\n\n**Returns:** `void`\n\n### `ProofCaptcha.antiDebug.disable()`\nMenonaktifkan semua proteksi (untuk development).\n\n**Returns:** `void`\n\n### `ProofCaptcha.antiDebug.getStatus()`\nMendapatkan status proteksi saat ini.\n\n**Returns:** \n```typescript\n{\n  enabled: boolean;      // Apakah proteksi aktif\n  devtoolsDetected: boolean; // Apakah DevTools terdeteksi\n}\n```\n\n## üéØ Version History\n\n### v3.2.2 (Current) - Premium Animation Enhancement\n- ‚ö° **ENHANCED:** Semua animasi menggunakan CSS keyframes (no inline styles)\n- üé® **PREMIUM:** Gradient backgrounds dengan glow effects\n- üé≠ **SMOOTH:** Cubic-bezier easing untuk animasi yang lebih natural\n- üíé **POLISHED:** Drop shadows, backdrop blur, dan text effects\n- üöÄ **OPTIMIZED:** Better performance dengan CSS-only animations\n- ‚ú® **VISUAL:** \n  - Alert glow animation di widget border\n  - Gradient animated text untuk \"CHEATERS!!\"\n  - Multi-stage police animation dengan perfect timing\n  - 3D rotation dengan shake effect di cracker icon\n  - Pulse scaling dengan smooth transitions\n\n### v3.2.1 (November 2024) - Visual Feedback Update\n- üé® **NEW:** Visual \"CHEATERS!!\" mode saat DevTools terdeteksi\n- üö´ **NEW:** Cracker icon 3D dengan tanda X (üö´ü•∑)\n- üöî **NEW:** Animasi polisi menangkap attacker saat klik\n- ‚ö° **IMPROVED:** Tidak blur widget, lebih confrontational\n- üé≠ **IMPROVED:** Multiple CSS animations (shake, rotate3d, pulse, slideIn)\n\n### v3.2.0 (November 2024)\n- ‚ú® Added multi-layer anti-debugger protection\n- ‚ú® 7 detection methods implemented\n- ‚ú® Global API for enable/disable control\n- ‚ú® Real-time DevTools detection\n- ‚ú® Test page with live monitoring\n\n### Future Enhancements\n- [ ] WebAssembly-based obfuscation\n- [ ] Dynamic code generation\n- [ ] ML-based behavioral detection\n- [ ] Hardware fingerprinting\n- [ ] Custom cheater messages/animations\n\n## üÜò Troubleshooting\n\n### \"DevTools detected\" bahkan ketika tidak dibuka\n- **Penyebab:** Viewport threshold terlalu sensitif\n- **Solusi:** Adjust threshold di code atau disable viewport monitoring\n\n### DevTools masih bisa dibuka tanpa detection\n- **Penyebab:** Detached window mode atau browser extension\n- **Solusi:** Multi-layer protection akan tetap mendeteksi via timing/performance\n\n### Performance impact di mobile\n- **Penyebab:** Interval checks terlalu frequent\n- **Solusi:** Disable di mobile atau increase interval\n\n```javascript\n// Disable di mobile\nif (/Android|iPhone|iPad/i.test(navigator.userAgent)) {\n  ProofCaptcha.antiDebug.disable();\n}\n```\n\n## üìû Support\n\nUntuk pertanyaan atau issue terkait anti-debugger protection:\n- Buka GitHub Issues\n- Email: support@proofcaptcha.com\n- Dokumentasi: https://docs.proofcaptcha.com/anti-debugger\n\n---\n\n**‚ö†Ô∏è Disclaimer:** Anti-debugger adalah security layer tambahan. Tidak ada proteksi client-side yang 100% aman. Selalu kombinasikan dengan server-side validation yang robust.\n","size_bytes":11997},"client/src/components/ui/skeleton.tsx":{"content":"import { cn } from \"@/lib/utils\"\n\nfunction Skeleton({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) {\n  return (\n    <div\n      className={cn(\"animate-pulse rounded-md bg-muted\", className)}\n      {...props}\n    />\n  )\n}\n\nexport { Skeleton }\n","size_bytes":261},"client/public/proofcaptcha.js":{"content":"(function() {\n  'use strict';\n\n  const API_BASE = window.location.origin;\n  let widgetCounter = 0;\n  const widgets = new Map();\n\n  class ProofCaptcha {\n    constructor(containerId, options = {}) {\n      this.id = widgetCounter++;\n      this.containerId = containerId;\n      this.sitekey = options.sitekey || options['data-sitekey'];\n      this.callback = options.callback || options['data-callback'];\n      this.expiredCallback = options['expired-callback'] || options['data-expired-callback'];\n      this.errorCallback = options['error-callback'] || options['data-error-callback'];\n      this.theme = options.theme || options['data-theme'] || 'light';\n      this.size = options.size || options['data-size'] || 'normal';\n      \n      this.token = null;\n      this.challengeData = null;\n      this.isVerified = false;\n      this.startTime = null;\n      \n      if (!this.sitekey) {\n        console.error('ProofCaptcha: sitekey is required');\n        return;\n      }\n      \n      this.render();\n    }\n\n    async render() {\n      const container = typeof this.containerId === 'string' \n        ? document.getElementById(this.containerId) \n        : this.containerId;\n      \n      if (!container) {\n        console.error('ProofCaptcha: container not found');\n        return;\n      }\n\n      container.innerHTML = `\n        <div class=\"proofcaptcha-widget\" data-theme=\"${this.theme}\" data-size=\"${this.size}\">\n          <div class=\"proofcaptcha-checkbox\">\n            <input type=\"checkbox\" id=\"proofcaptcha-checkbox-${this.id}\" class=\"proofcaptcha-input\">\n            <label for=\"proofcaptcha-checkbox-${this.id}\" class=\"proofcaptcha-label\">\n              <span class=\"proofcaptcha-checkmark\"></span>\n              <span class=\"proofcaptcha-text\">I'm not a robot</span>\n            </label>\n            <div class=\"proofcaptcha-spinner\" style=\"display: none;\"></div>\n            <div class=\"proofcaptcha-success\" style=\"display: none;\">‚úì</div>\n          </div>\n          <div class=\"proofcaptcha-logo\">\n            <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\">\n              <path d=\"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n            </svg>\n            <span>ProofCaptcha</span>\n          </div>\n        </div>\n      `;\n\n      this.addStyles();\n      this.attachListeners();\n    }\n\n    addStyles() {\n      if (document.getElementById('proofcaptcha-styles')) return;\n      \n      const styles = document.createElement('style');\n      styles.id = 'proofcaptcha-styles';\n      styles.textContent = `\n        .proofcaptcha-widget {\n          border: 1px solid #d3d3d3;\n          border-radius: 3px;\n          background: #f9f9f9;\n          padding: 12px;\n          width: 304px;\n          font-family: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, sans-serif;\n        }\n        .proofcaptcha-widget[data-theme=\"dark\"] {\n          background: #1a1a1a;\n          border-color: #333;\n          color: #fff;\n        }\n        .proofcaptcha-checkbox {\n          display: flex;\n          align-items: center;\n          gap: 12px;\n          margin-bottom: 8px;\n        }\n        .proofcaptcha-input {\n          display: none;\n        }\n        .proofcaptcha-label {\n          display: flex;\n          align-items: center;\n          gap: 12px;\n          cursor: pointer;\n          user-select: none;\n        }\n        .proofcaptcha-checkmark {\n          width: 28px;\n          height: 28px;\n          border: 2px solid #d3d3d3;\n          border-radius: 3px;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          background: white;\n          transition: all 0.2s;\n        }\n        .proofcaptcha-widget[data-theme=\"dark\"] .proofcaptcha-checkmark {\n          background: #2a2a2a;\n          border-color: #444;\n        }\n        .proofcaptcha-text {\n          font-size: 14px;\n          color: #333;\n        }\n        .proofcaptcha-widget[data-theme=\"dark\"] .proofcaptcha-text {\n          color: #fff;\n        }\n        .proofcaptcha-spinner {\n          width: 20px;\n          height: 20px;\n          border: 3px solid #f3f3f3;\n          border-top: 3px solid #3498db;\n          border-radius: 50%;\n          animation: proofcaptcha-spin 1s linear infinite;\n        }\n        .proofcaptcha-success {\n          color: #4caf50;\n          font-size: 24px;\n          font-weight: bold;\n        }\n        @keyframes proofcaptcha-spin {\n          0% { transform: rotate(0deg); }\n          100% { transform: rotate(360deg); }\n        }\n        .proofcaptcha-logo {\n          display: flex;\n          align-items: center;\n          gap: 6px;\n          font-size: 11px;\n          color: #666;\n        }\n        .proofcaptcha-widget[data-theme=\"dark\"] .proofcaptcha-logo {\n          color: #999;\n        }\n        .proofcaptcha-logo svg {\n          width: 14px;\n          height: 14px;\n        }\n      `;\n      document.head.appendChild(styles);\n    }\n\n    attachListeners() {\n      const checkbox = document.getElementById(`proofcaptcha-checkbox-${this.id}`);\n      const label = checkbox.nextElementSibling;\n      \n      label.addEventListener('click', async (e) => {\n        e.preventDefault();\n        if (!this.isVerified && !this.startTime) {\n          await this.verify();\n        }\n      });\n    }\n\n    async verify() {\n      this.startTime = Date.now();\n      this.showLoading();\n\n      try {\n        const response = await fetch(`${API_BASE}/api/challenge/create`, {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json',\n          },\n          body: JSON.stringify({\n            sitekey: this.sitekey,\n            type: 'checkbox'\n          })\n        });\n\n        if (!response.ok) {\n          throw new Error('Failed to create challenge');\n        }\n\n        const data = await response.json();\n        this.challengeData = data.challenge;\n        \n        const solution = await this.solveChallenge(data.challenge);\n        \n        const verifyResponse = await fetch(`${API_BASE}/api/challenge/verify`, {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json',\n          },\n          body: JSON.stringify({\n            token: data.challenge.token,\n            solution: solution,\n            timeToSolve: Date.now() - this.startTime\n          })\n        });\n\n        if (!verifyResponse.ok) {\n          throw new Error('Verification failed');\n        }\n\n        const verifyData = await verifyResponse.json();\n        \n        if (verifyData.success) {\n          this.token = verifyData.verificationToken;\n          this.isVerified = true;\n          this.showSuccess();\n          \n          if (this.callback) {\n            if (typeof this.callback === 'string') {\n              window[this.callback](this.token);\n            } else {\n              this.callback(this.token);\n            }\n          }\n\n          setTimeout(() => {\n            this.expire();\n          }, 120000);\n        } else {\n          throw new Error('Verification failed');\n        }\n      } catch (error) {\n        console.error('ProofCaptcha error:', error);\n        this.showError();\n        \n        if (this.errorCallback) {\n          if (typeof this.errorCallback === 'string') {\n            window[this.errorCallback]();\n          } else {\n            this.errorCallback();\n          }\n        }\n      }\n    }\n\n    async solveChallenge(challenge) {\n      const { nonce, timestamp, difficulty } = challenge;\n      let solution = 0;\n      \n      while (true) {\n        const hash = await this.sha256(nonce + timestamp + solution);\n        if (hash.startsWith('0'.repeat(difficulty))) {\n          return solution.toString();\n        }\n        solution++;\n        \n        if (solution % 1000 === 0) {\n          await new Promise(resolve => setTimeout(resolve, 0));\n        }\n      }\n    }\n\n    async sha256(message) {\n      const msgBuffer = new TextEncoder().encode(message);\n      const hashBuffer = await crypto.subtle.digest('SHA-256', msgBuffer);\n      const hashArray = Array.from(new Uint8Array(hashBuffer));\n      return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');\n    }\n\n    showLoading() {\n      const container = document.querySelector(`[for=\"proofcaptcha-checkbox-${this.id}\"]`).parentElement;\n      container.querySelector('.proofcaptcha-checkmark').style.display = 'none';\n      container.querySelector('.proofcaptcha-text').style.display = 'none';\n      container.querySelector('.proofcaptcha-spinner').style.display = 'block';\n    }\n\n    showSuccess() {\n      const container = document.querySelector(`[for=\"proofcaptcha-checkbox-${this.id}\"]`).parentElement;\n      container.querySelector('.proofcaptcha-spinner').style.display = 'none';\n      container.querySelector('.proofcaptcha-success').style.display = 'block';\n      container.querySelector('.proofcaptcha-checkmark').style.background = '#4caf50';\n      container.querySelector('.proofcaptcha-checkmark').style.borderColor = '#4caf50';\n      container.querySelector('.proofcaptcha-text').textContent = 'Verified';\n      container.querySelector('.proofcaptcha-text').style.display = 'block';\n    }\n\n    showError() {\n      const container = document.querySelector(`[for=\"proofcaptcha-checkbox-${this.id}\"]`).parentElement;\n      container.querySelector('.proofcaptcha-spinner').style.display = 'none';\n      container.querySelector('.proofcaptcha-checkmark').style.display = 'block';\n      container.querySelector('.proofcaptcha-text').style.display = 'block';\n      container.querySelector('.proofcaptcha-checkmark').style.borderColor = '#f44336';\n      this.startTime = null;\n    }\n\n    expire() {\n      this.token = null;\n      this.isVerified = false;\n      this.startTime = null;\n      this.reset();\n      \n      if (this.expiredCallback) {\n        if (typeof this.expiredCallback === 'string') {\n          window[this.expiredCallback]();\n        } else {\n          this.expiredCallback();\n        }\n      }\n    }\n\n    reset() {\n      const container = document.querySelector(`[for=\"proofcaptcha-checkbox-${this.id}\"]`).parentElement;\n      container.querySelector('.proofcaptcha-checkmark').style.display = 'block';\n      container.querySelector('.proofcaptcha-text').style.display = 'block';\n      container.querySelector('.proofcaptcha-spinner').style.display = 'none';\n      container.querySelector('.proofcaptcha-success').style.display = 'none';\n      container.querySelector('.proofcaptcha-checkmark').style.background = 'white';\n      container.querySelector('.proofcaptcha-checkmark').style.borderColor = '#d3d3d3';\n      container.querySelector('.proofcaptcha-text').textContent = \"I'm not a robot\";\n    }\n\n    getResponse() {\n      return this.token;\n    }\n  }\n\n  window.proofcaptcha = {\n    render: function(container, options) {\n      const widget = new ProofCaptcha(container, options);\n      widgets.set(widget.id, widget);\n      return widget.id;\n    },\n    reset: function(widgetId) {\n      const widget = widgets.get(widgetId);\n      if (widget) widget.reset();\n    },\n    getResponse: function(widgetId) {\n      const widget = widgets.get(widgetId);\n      return widget ? widget.getResponse() : null;\n    }\n  };\n\n  function autoRender() {\n    const containers = document.querySelectorAll('.proofcaptcha');\n    containers.forEach(container => {\n      if (container.dataset.rendered) return;\n      \n      const options = {\n        sitekey: container.dataset.sitekey,\n        callback: container.dataset.callback,\n        'expired-callback': container.dataset.expiredCallback,\n        'error-callback': container.dataset.errorCallback,\n        theme: container.dataset.theme,\n        size: container.dataset.size\n      };\n      \n      new ProofCaptcha(container, options);\n      container.dataset.rendered = 'true';\n    });\n  }\n\n  if (document.readyState === 'loading') {\n    document.addEventListener('DOMContentLoaded', autoRender);\n  } else {\n    autoRender();\n  }\n})();\n","size_bytes":11995},"client/src/components/ui/pagination.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { ButtonProps, buttonVariants } from \"@/components/ui/button\"\n\nconst Pagination = ({ className, ...props }: React.ComponentProps<\"nav\">) => (\n  <nav\n    role=\"navigation\"\n    aria-label=\"pagination\"\n    className={cn(\"mx-auto flex w-full justify-center\", className)}\n    {...props}\n  />\n)\nPagination.displayName = \"Pagination\"\n\nconst PaginationContent = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    className={cn(\"flex flex-row items-center gap-1\", className)}\n    {...props}\n  />\n))\nPaginationContent.displayName = \"PaginationContent\"\n\nconst PaginationItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li ref={ref} className={cn(\"\", className)} {...props} />\n))\nPaginationItem.displayName = \"PaginationItem\"\n\ntype PaginationLinkProps = {\n  isActive?: boolean\n} & Pick<ButtonProps, \"size\"> &\n  React.ComponentProps<\"a\">\n\nconst PaginationLink = ({\n  className,\n  isActive,\n  size = \"icon\",\n  ...props\n}: PaginationLinkProps) => (\n  <a\n    aria-current={isActive ? \"page\" : undefined}\n    className={cn(\n      buttonVariants({\n        variant: isActive ? \"outline\" : \"ghost\",\n        size,\n      }),\n      className\n    )}\n    {...props}\n  />\n)\nPaginationLink.displayName = \"PaginationLink\"\n\nconst PaginationPrevious = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to previous page\"\n    size=\"default\"\n    className={cn(\"gap-1 pl-2.5\", className)}\n    {...props}\n  >\n    <ChevronLeft className=\"h-4 w-4\" />\n    <span>Previous</span>\n  </PaginationLink>\n)\nPaginationPrevious.displayName = \"PaginationPrevious\"\n\nconst PaginationNext = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to next page\"\n    size=\"default\"\n    className={cn(\"gap-1 pr-2.5\", className)}\n    {...props}\n  >\n    <span>Next</span>\n    <ChevronRight className=\"h-4 w-4\" />\n  </PaginationLink>\n)\nPaginationNext.displayName = \"PaginationNext\"\n\nconst PaginationEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    aria-hidden\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More pages</span>\n  </span>\n)\nPaginationEllipsis.displayName = \"PaginationEllipsis\"\n\nexport {\n  Pagination,\n  PaginationContent,\n  PaginationEllipsis,\n  PaginationItem,\n  PaginationLink,\n  PaginationNext,\n  PaginationPrevious,\n}\n","size_bytes":2751},"design_guidelines.md":{"content":"# Design Guidelines: CAPTCHA System (hCaptcha-style)\n\n## Design Approach\n**Design System Approach** - Using a hybrid of Material Design and modern SaaS patterns (inspired by Stripe, Vercel, Linear) for clarity, trust, and functionality. This is a utility-focused security product where reliability and ease of integration are paramount.\n\n## Core Design Principles\n1. **Trust & Security**: Clean, professional aesthetic that conveys reliability\n2. **Minimal Friction**: CAPTCHA widget should be unobtrusive and fast\n3. **Developer-First**: Clear documentation, easy integration, powerful dashboard\n4. **Performance**: Lightweight, fast-loading components\n\n## Typography\n- **Primary Font**: Inter (via Google Fonts CDN)\n- **Monospace**: JetBrains Mono (for API keys, code snippets)\n\n**Hierarchy:**\n- Hero Headlines: text-5xl to text-6xl, font-bold\n- Section Headers: text-3xl to text-4xl, font-semibold\n- Subsection Headers: text-xl to text-2xl, font-semibold\n- Body Text: text-base, font-normal\n- Small Text/Captions: text-sm, font-medium\n- Code/Technical: text-sm, font-mono\n\n## Layout System\n**Spacing Primitives**: Tailwind units of 2, 4, 6, 8, 12, 16, 20, 24\n- Tight spacing: gap-2, p-4\n- Standard spacing: gap-4, p-6, p-8\n- Section spacing: py-16, py-20, py-24\n- Component padding: p-6, p-8\n\n**Containers:**\n- Marketing pages: max-w-7xl\n- Dashboard: w-full with fluid layout\n- CAPTCHA widget: Fixed dimensions (300px-400px width)\n- Documentation: max-w-4xl\n\n## Component Library\n\n### CAPTCHA Widget Components\n**Challenge Box**: Compact container (340px √ó 78px collapsed, expands to ~400px √ó 300px for challenges)\n- Rounded corners: rounded-lg\n- Border: border with subtle shadow\n- Checkbox verification state with checkmark icon\n- Puzzle slider with smooth drag interaction\n- Loading states with subtle animations\n\n**Verification Badge**: Small, unobtrusive indicator showing \"Verified by [YourCaptcha]\" with shield icon\n\n### Dashboard Components\n**Sidebar Navigation**: Fixed left sidebar (240px-280px)\n- Icon + label navigation items\n- Collapsible on mobile\n- Clear active states\n\n**Stats Cards**: Grid of metric cards showing:\n- Total verifications, success rate, blocked attempts\n- Card layout: p-6, rounded-xl, with large numbers (text-3xl) and labels (text-sm)\n\n**Analytics Graphs**: Line/bar charts using Chart.js or similar\n- Time-series verification data\n- Geographic distribution\n- Challenge type breakdown\n\n**API Key Management**: \n- Copy-to-clipboard buttons for keys\n- Masked display with reveal toggle\n- Generation and revocation actions\n- Key type indicators (Public/Private with distinct badges)\n\n**Activity Log Table**: \n- Timestamp, IP, challenge type, result columns\n- Sortable headers\n- Pagination\n- Search/filter functionality\n\n### Marketing/Landing Page Components\n**Hero Section**: (60-70vh)\n- Large headline emphasizing security and ease of use\n- Live demo CAPTCHA widget embedded\n- Primary CTA: \"Get Started Free\" + Secondary: \"View Documentation\"\n- Trust indicators: \"Protecting 50M+ requests daily\"\n\n**Features Grid**: 3-column layout (lg:grid-cols-3)\n- Proof-of-Work Security\n- Easy Integration\n- Real-time Analytics\n- Rate Limiting\n- Multiple Challenge Types\n- Developer-Friendly API\n\n**Integration Code Examples**: Side-by-side 2-column\n- Left: Code snippet with syntax highlighting\n- Right: Visual preview/explanation\n\n**Pricing Table**: 3-column comparison (Free, Pro, Enterprise)\n- Clear feature differentiation\n- Prominent CTA buttons\n\n**Documentation Section**: \n- Quick start guide\n- API reference cards\n- SDK installation steps\n\n### Form Elements\n**Input Fields**: Consistent across all forms\n- Height: h-12\n- Padding: px-4\n- Rounded: rounded-lg\n- Focus ring with offset\n\n**Buttons**:\n- Primary: Solid, font-semibold, px-6, py-3, rounded-lg\n- Secondary: Border variant with hover fill\n- Destructive: For delete/revoke actions\n\n## Navigation\n**Marketing Nav**: Horizontal, sticky top\n- Logo left, links center, CTA buttons right\n- Transparent with backdrop blur on scroll\n\n**Dashboard Nav**: Two-tier\n- Top bar: User menu, notifications, search\n- Side nav: Main sections (Overview, Analytics, Settings, API Keys, Logs)\n\n## Icons\nUse Heroicons (outline for nav, solid for emphasis) via CDN\n\n## Images\n**Hero Section**: Abstract security visualization or clean dashboard preview screenshot (1200√ó600px)\n**Feature Cards**: Simple, flat illustrations or icons (no photography)\n**Dashboard**: Real chart/graph examples, no stock photos\n\n## Accessibility\n- All interactive elements keyboard navigable\n- ARIA labels for CAPTCHA states\n- High contrast text ratios (WCAG AA minimum)\n- Focus indicators on all interactive elements\n- Screen reader friendly status announcements for CAPTCHA completion\n\n## Key Differentiators\n- CAPTCHA widget must feel lightweight and modern (not intrusive like old reCAPTCHA)\n- Dashboard emphasizes real-time data and actionable insights\n- Documentation integrated seamlessly with marketing content\n- Copy-paste ready code examples throughout","size_bytes":5009},"server/index.ts":{"content":"import dotenv from \"dotenv\";\ndotenv.config({ override: true });\n\nimport express, { type Request, Response, NextFunction } from \"express\";\nimport session from \"express-session\";\nimport cookieParser from \"cookie-parser\";\nimport cors from \"cors\";\nimport path from \"path\";\nimport { fileURLToPath } from \"url\";\nimport { registerRoutes } from \"./routes\";\nimport { setupVite, serveStatic, log } from \"./vite\";\nimport { setSecurityHeaders } from \"./security-headers\";\nimport { ensureDemoApiKey } from \"./init-demo-key\";\nimport { startCleanupTasks } from \"./cleanup-tasks\";\nimport { getStorage } from \"./storage\";\nimport { runMigrations } from \"./migrate\";\nimport { csrfMiddleware } from \"./enhancements/csrf-protection\";\n\nconst __dirname = path.dirname(fileURLToPath(import.meta.url));\n\nconst app = express();\n\n// Enable trust proxy for proper IP address detection behind proxies/load balancers\napp.set('trust proxy', 1);\n\n// Configure CORS - ProofCaptcha harus bisa diakses dari website eksternal manapun\napp.use(cors({\n  origin: (origin, callback) => {\n    // Allow all origins untuk public CAPTCHA endpoints\n    // Website eksternal perlu bisa menggunakan ProofCaptcha\n    callback(null, origin || true);\n  },\n  credentials: true,\n  methods: ['GET', 'POST', 'PUT', 'DELETE', 'PATCH', 'OPTIONS'],\n  allowedHeaders: ['Content-Type', 'Authorization', 'X-CSRF-Token', 'Cookie', 'X-Requested-With'],\n  exposedHeaders: ['X-CSRF-Token'],\n  preflightContinue: false,\n  optionsSuccessStatus: 204,\n}));\n\ndeclare module \"express-session\" {\n  interface SessionData {\n    developerId?: string;\n    isEmailVerified?: boolean;\n  }\n}\n\napp.use(\n  session({\n    secret: process.env.SESSION_SECRET || \"your-secret-key-change-in-production\",\n    resave: false,\n    saveUninitialized: false,\n    cookie: {\n      secure: process.env.NODE_ENV === \"production\",\n      httpOnly: true,\n      maxAge: 7 * 24 * 60 * 60 * 1000,\n    },\n  })\n);\n\napp.use(cookieParser());\napp.use(setSecurityHeaders);\n\napp.use((req, res, next) => {\n  const publicPaths = [\n    '/api/captcha/challenge',\n    '/api/captcha/verify',\n    '/api/captcha/handshake',\n    '/api/challenge/verify',\n    '/proofCaptcha/api/siteverify',\n    '/api/demo/key'\n  ];\n  \n  const isPublicPath = publicPaths.some(path => req.path.startsWith(path));\n  \n  if (isPublicPath && (req.method === 'POST' || req.method === 'PUT' || req.method === 'DELETE' || req.method === 'PATCH')) {\n    return next();\n  }\n  \n  return csrfMiddleware()(req, res, next);\n});\n\napp.use((req, res, next) => {\n  if (process.env.NODE_ENV === 'development' || req.path === '/health') {\n    return next();\n  }\n  \n  if (!req.secure) {\n    if (req.path.startsWith('/api/captcha')) {\n      return res.status(403).json({\n        error: 'HTTPS required',\n        message: 'This service requires HTTPS for security. Please use https:// instead of http://'\n      });\n    }\n    return res.redirect(301, `https://${req.get('host')}${req.url}`);\n  }\n  \n  next();\n});\n\ndeclare module 'http' {\n  interface IncomingMessage {\n    rawBody: unknown\n  }\n}\napp.use(express.json({\n  verify: (req, _res, buf) => {\n    req.rawBody = buf;\n  }\n}));\napp.use(express.urlencoded({ extended: false }));\n\napp.use((req, res, next) => {\n  const start = Date.now();\n  const path = req.path;\n  let capturedJsonResponse: Record<string, any> | undefined = undefined;\n\n  const originalResJson = res.json;\n  res.json = function (bodyJson, ...args) {\n    capturedJsonResponse = bodyJson;\n    return originalResJson.apply(res, [bodyJson, ...args]);\n  };\n\n  res.on(\"finish\", () => {\n    const duration = Date.now() - start;\n    if (path.startsWith(\"/api\")) {\n      let logLine = `${req.method} ${path} ${res.statusCode} in ${duration}ms`;\n      if (capturedJsonResponse) {\n        logLine += ` :: ${JSON.stringify(capturedJsonResponse)}`;\n      }\n\n      if (logLine.length > 80) {\n        logLine = logLine.slice(0, 79) + \"‚Ä¶\";\n      }\n\n      log(logLine);\n    }\n  });\n\n  next();\n});\n\n(async () => {\n  let migrationsSuccessful = false;\n  \n  if (process.env.DATABASE_URL) {\n    try {\n      console.log('[STARTUP] DATABASE_URL configured, running migrations...');\n      await runMigrations();\n      migrationsSuccessful = true;\n      console.log('[STARTUP] Migrations completed successfully');\n    } catch (error) {\n      console.error('[STARTUP] Migration failed:', error);\n      if (process.env.DATABASE_URL) {\n        console.error('[STARTUP] DATABASE_URL is configured but migrations failed!');\n        console.error('[STARTUP] The application will continue with fallback storage.');\n      }\n    }\n  } else {\n    console.log('[STARTUP] No DATABASE_URL configured, skipping migrations');\n  }\n  \n  console.log('[STARTUP] Initializing storage...');\n  await getStorage(migrationsSuccessful);\n  console.log('[STARTUP] Storage initialized successfully');\n  \n  console.log('[STARTUP] Ensuring demo API key exists...');\n  await ensureDemoApiKey();\n  console.log('[STARTUP] Demo API key initialization complete');\n  \n  // Serve static files from public directory (for test pages, widget scripts, etc.)\n  app.use(express.static(path.join(__dirname, 'public')));\n  \n  // Serve assets (images, etc.) for external api.js widget integration\n  app.use('/assets', express.static(path.join(__dirname, '..', 'attached_assets')));\n  \n  const server = await registerRoutes(app);\n\n  app.use((err: any, _req: Request, res: Response, _next: NextFunction) => {\n    const status = err.status || err.statusCode || 500;\n    const message = err.message || \"Internal Server Error\";\n\n    res.status(status).json({ message });\n    throw err;\n  });\n\n  // importantly only setup vite in development and after\n  // setting up all the other routes so the catch-all route\n  // doesn't interfere with the other routes\n  if (app.get(\"env\") === \"development\") {\n    await setupVite(app, server);\n  } else {\n    serveStatic(app);\n  }\n\n  // ALWAYS serve the app on the port specified in the environment variable PORT\n  // Other ports are firewalled. Default to 5000 if not specified.\n  // this serves both the API and the client.\n  // It is the only port that is not firewalled.\n  const port = parseInt(process.env.PORT || '5000', 10);\n  server.listen({\n    port,\n    host: \"0.0.0.0\",\n    reusePort: true,\n  }, () => {\n    log(`serving on port ${port}`);\n    \n    // Start automated cleanup tasks\n    startCleanupTasks();\n  });\n})();\n","size_bytes":6352},"drizzle.config.ts":{"content":"import { defineConfig } from \"drizzle-kit\";\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\"DATABASE_URL, ensure the database is provisioned\");\n}\n\nexport default defineConfig({\n  out: \"./migrations\",\n  schema: \"./shared/schema.ts\",\n  dialect: \"postgresql\",\n  dbCredentials: {\n    url: process.env.DATABASE_URL,\n  },\n});\n","size_bytes":325},"client/src/hooks/use-toast.ts":{"content":"import * as React from \"react\"\n\nimport type {\n  ToastActionElement,\n  ToastProps,\n} from \"@/components/ui/toast\"\n\nconst TOAST_LIMIT = 1\nconst TOAST_REMOVE_DELAY = 1000000\n\ntype ToasterToast = ToastProps & {\n  id: string\n  title?: React.ReactNode\n  description?: React.ReactNode\n  action?: ToastActionElement\n}\n\nconst actionTypes = {\n  ADD_TOAST: \"ADD_TOAST\",\n  UPDATE_TOAST: \"UPDATE_TOAST\",\n  DISMISS_TOAST: \"DISMISS_TOAST\",\n  REMOVE_TOAST: \"REMOVE_TOAST\",\n} as const\n\nlet count = 0\n\nfunction genId() {\n  count = (count + 1) % Number.MAX_SAFE_INTEGER\n  return count.toString()\n}\n\ntype ActionType = typeof actionTypes\n\ntype Action =\n  | {\n      type: ActionType[\"ADD_TOAST\"]\n      toast: ToasterToast\n    }\n  | {\n      type: ActionType[\"UPDATE_TOAST\"]\n      toast: Partial<ToasterToast>\n    }\n  | {\n      type: ActionType[\"DISMISS_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n  | {\n      type: ActionType[\"REMOVE_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n\ninterface State {\n  toasts: ToasterToast[]\n}\n\nconst toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()\n\nconst addToRemoveQueue = (toastId: string) => {\n  if (toastTimeouts.has(toastId)) {\n    return\n  }\n\n  const timeout = setTimeout(() => {\n    toastTimeouts.delete(toastId)\n    dispatch({\n      type: \"REMOVE_TOAST\",\n      toastId: toastId,\n    })\n  }, TOAST_REMOVE_DELAY)\n\n  toastTimeouts.set(toastId, timeout)\n}\n\nexport const reducer = (state: State, action: Action): State => {\n  switch (action.type) {\n    case \"ADD_TOAST\":\n      return {\n        ...state,\n        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),\n      }\n\n    case \"UPDATE_TOAST\":\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === action.toast.id ? { ...t, ...action.toast } : t\n        ),\n      }\n\n    case \"DISMISS_TOAST\": {\n      const { toastId } = action\n\n      // ! Side effects ! - This could be extracted into a dismissToast() action,\n      // but I'll keep it here for simplicity\n      if (toastId) {\n        addToRemoveQueue(toastId)\n      } else {\n        state.toasts.forEach((toast) => {\n          addToRemoveQueue(toast.id)\n        })\n      }\n\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === toastId || toastId === undefined\n            ? {\n                ...t,\n                open: false,\n              }\n            : t\n        ),\n      }\n    }\n    case \"REMOVE_TOAST\":\n      if (action.toastId === undefined) {\n        return {\n          ...state,\n          toasts: [],\n        }\n      }\n      return {\n        ...state,\n        toasts: state.toasts.filter((t) => t.id !== action.toastId),\n      }\n  }\n}\n\nconst listeners: Array<(state: State) => void> = []\n\nlet memoryState: State = { toasts: [] }\n\nfunction dispatch(action: Action) {\n  memoryState = reducer(memoryState, action)\n  listeners.forEach((listener) => {\n    listener(memoryState)\n  })\n}\n\ntype Toast = Omit<ToasterToast, \"id\">\n\nfunction toast({ ...props }: Toast) {\n  const id = genId()\n\n  const update = (props: ToasterToast) =>\n    dispatch({\n      type: \"UPDATE_TOAST\",\n      toast: { ...props, id },\n    })\n  const dismiss = () => dispatch({ type: \"DISMISS_TOAST\", toastId: id })\n\n  dispatch({\n    type: \"ADD_TOAST\",\n    toast: {\n      ...props,\n      id,\n      open: true,\n      onOpenChange: (open) => {\n        if (!open) dismiss()\n      },\n    },\n  })\n\n  return {\n    id: id,\n    dismiss,\n    update,\n  }\n}\n\nfunction useToast() {\n  const [state, setState] = React.useState<State>(memoryState)\n\n  React.useEffect(() => {\n    listeners.push(setState)\n    return () => {\n      const index = listeners.indexOf(setState)\n      if (index > -1) {\n        listeners.splice(index, 1)\n      }\n    }\n  }, [state])\n\n  return {\n    ...state,\n    toast,\n    dismiss: (toastId?: string) => dispatch({ type: \"DISMISS_TOAST\", toastId }),\n  }\n}\n\nexport { useToast, toast }\n","size_bytes":3895},"client/src/components/ui/drawer.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Drawer as DrawerPrimitive } from \"vaul\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Drawer = ({\n  shouldScaleBackground = true,\n  ...props\n}: React.ComponentProps<typeof DrawerPrimitive.Root>) => (\n  <DrawerPrimitive.Root\n    shouldScaleBackground={shouldScaleBackground}\n    {...props}\n  />\n)\nDrawer.displayName = \"Drawer\"\n\nconst DrawerTrigger = DrawerPrimitive.Trigger\n\nconst DrawerPortal = DrawerPrimitive.Portal\n\nconst DrawerClose = DrawerPrimitive.Close\n\nconst DrawerOverlay = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Overlay\n    ref={ref}\n    className={cn(\"fixed inset-0 z-50 bg-black/80\", className)}\n    {...props}\n  />\n))\nDrawerOverlay.displayName = DrawerPrimitive.Overlay.displayName\n\nconst DrawerContent = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DrawerPortal>\n    <DrawerOverlay />\n    <DrawerPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background\",\n        className\n      )}\n      {...props}\n    >\n      <div className=\"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted\" />\n      {children}\n    </DrawerPrimitive.Content>\n  </DrawerPortal>\n))\nDrawerContent.displayName = \"DrawerContent\"\n\nconst DrawerHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"grid gap-1.5 p-4 text-center sm:text-left\", className)}\n    {...props}\n  />\n)\nDrawerHeader.displayName = \"DrawerHeader\"\n\nconst DrawerFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"mt-auto flex flex-col gap-2 p-4\", className)}\n    {...props}\n  />\n)\nDrawerFooter.displayName = \"DrawerFooter\"\n\nconst DrawerTitle = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDrawerTitle.displayName = DrawerPrimitive.Title.displayName\n\nconst DrawerDescription = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDrawerDescription.displayName = DrawerPrimitive.Description.displayName\n\nexport {\n  Drawer,\n  DrawerPortal,\n  DrawerOverlay,\n  DrawerTrigger,\n  DrawerClose,\n  DrawerContent,\n  DrawerHeader,\n  DrawerFooter,\n  DrawerTitle,\n  DrawerDescription,\n}\n","size_bytes":3021},"client/src/components/StatsCard.tsx":{"content":"import { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { LucideIcon } from \"lucide-react\";\n\ninterface StatsCardProps {\n  title: string;\n  value: string | number;\n  description?: string;\n  icon: LucideIcon;\n  trend?: {\n    value: number;\n    label: string;\n  };\n}\n\nexport default function StatsCard({ title, value, description, icon: Icon, trend }: StatsCardProps) {\n  return (\n    <Card data-testid={`card-stats-${title.toLowerCase().replace(/\\s+/g, \"-\")}`}>\n      <CardHeader className=\"flex flex-row items-center justify-between gap-2 space-y-0 pb-2\">\n        <CardTitle className=\"text-sm font-medium\">{title}</CardTitle>\n        <Icon className=\"h-4 w-4 text-muted-foreground\" data-testid=\"icon-stats\" />\n      </CardHeader>\n      <CardContent>\n        <div className=\"text-3xl font-bold\" data-testid=\"text-value\">\n          {value}\n        </div>\n        {description && (\n          <p className=\"text-xs text-muted-foreground mt-1\" data-testid=\"text-description\">\n            {description}\n          </p>\n        )}\n        {trend && (\n          <p\n            className={`text-xs mt-1 ${trend.value >= 0 ? \"text-green-600\" : \"text-destructive\"}`}\n            data-testid=\"text-trend\"\n          >\n            {trend.value >= 0 ? \"+\" : \"\"}\n            {trend.value}% {trend.label}\n          </p>\n        )}\n      </CardContent>\n    </Card>\n  );\n}\n","size_bytes":1385},"client/src/components/ui/avatar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as AvatarPrimitive from \"@radix-ui/react-avatar\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Avatar = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Root\n    ref={ref}\n    className={cn(`\n      after:content-[''] after:block after:absolute after:inset-0 after:rounded-full after:pointer-events-none after:border after:border-black/10 dark:after:border-white/10\n      relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full`,\n      className\n    )}\n    {...props}\n  />\n))\nAvatar.displayName = AvatarPrimitive.Root.displayName\n\nconst AvatarImage = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Image>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Image>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Image\n    ref={ref}\n    className={cn(\"aspect-square h-full w-full\", className)}\n    {...props}\n  />\n))\nAvatarImage.displayName = AvatarPrimitive.Image.displayName\n\nconst AvatarFallback = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Fallback>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Fallback>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Fallback\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full items-center justify-center rounded-full bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatarFallback.displayName = AvatarPrimitive.Fallback.displayName\n\nexport { Avatar, AvatarImage, AvatarFallback }\n","size_bytes":1592},"client/src/components/ui/scroll-area.tsx":{"content":"import * as React from \"react\"\nimport * as ScrollAreaPrimitive from \"@radix-ui/react-scroll-area\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ScrollArea = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <ScrollAreaPrimitive.Root\n    ref={ref}\n    className={cn(\"relative overflow-hidden\", className)}\n    {...props}\n  >\n    <ScrollAreaPrimitive.Viewport className=\"h-full w-full rounded-[inherit]\">\n      {children}\n    </ScrollAreaPrimitive.Viewport>\n    <ScrollBar />\n    <ScrollAreaPrimitive.Corner />\n  </ScrollAreaPrimitive.Root>\n))\nScrollArea.displayName = ScrollAreaPrimitive.Root.displayName\n\nconst ScrollBar = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>\n>(({ className, orientation = \"vertical\", ...props }, ref) => (\n  <ScrollAreaPrimitive.ScrollAreaScrollbar\n    ref={ref}\n    orientation={orientation}\n    className={cn(\n      \"flex touch-none select-none transition-colors\",\n      orientation === \"vertical\" &&\n        \"h-full w-2.5 border-l border-l-transparent p-[1px]\",\n      orientation === \"horizontal\" &&\n        \"h-2.5 flex-col border-t border-t-transparent p-[1px]\",\n      className\n    )}\n    {...props}\n  >\n    <ScrollAreaPrimitive.ScrollAreaThumb className=\"relative flex-1 rounded-full bg-border\" />\n  </ScrollAreaPrimitive.ScrollAreaScrollbar>\n))\nScrollBar.displayName = ScrollAreaPrimitive.ScrollAreaScrollbar.displayName\n\nexport { ScrollArea, ScrollBar }\n","size_bytes":1642},"server/init-demo-key.ts":{"content":"import { storage } from \"./storage\";\nimport bcrypt from \"bcryptjs\";\n\nconst DEMO_PUBLIC_KEY = \"pk_ab6c4ac2c8976668e6d92fe401386cae18df4c9b4f5193cb140266f6d9546f1c\";\nconst DEMO_PRIVATE_KEY = \"sk_demo_1a2b3c4d5e6f7g8h9i0j1k2l3m4n5o6p7q8r9s0t1u2v3w4x5y6z7a8b9c0d1e2f\";\n\nexport async function ensureDemoApiKey(): Promise<void> {\n  try {\n    const demoEmail = \"demo@proofcaptcha.local\";\n    \n    let demoDeveloper = await storage.getDeveloperByEmail(demoEmail);\n    \n    if (!demoDeveloper) {\n      console.log(\"[DEMO KEY] Creating demo developer account...\");\n      const hashedPassword = await bcrypt.hash(\"demo-password-not-for-login\", 10);\n      demoDeveloper = await storage.createDeveloper({\n        email: demoEmail,\n        password: hashedPassword,\n        name: \"Demo Application\",\n      });\n      console.log(\"[DEMO KEY] Demo developer created\");\n    }\n    \n    const existingKeys = await storage.getApiKeysByDeveloper(demoDeveloper.id);\n    let demoKey = existingKeys.find(k => k.sitekey === DEMO_PUBLIC_KEY);\n    \n    if (!demoKey) {\n      const oldKeys = existingKeys.filter(k => k.name === \"Demo Application\");\n      for (const oldKey of oldKeys) {\n        console.log(\"[DEMO KEY] Removing old demo API key:\", oldKey.sitekey);\n        await storage.deleteApiKey(oldKey.id);\n      }\n      \n      const existingDemoKey = await storage.getApiKeyBySitekey(DEMO_PUBLIC_KEY);\n      if (existingDemoKey) {\n        console.log(\"[DEMO KEY] Demo key with correct sitekey already exists (from another developer)\");\n        console.log(\"[DEMO KEY] Deleting it to recreate under demo developer\");\n        await storage.deleteApiKey(existingDemoKey.id);\n      }\n      \n      console.log(\"[DEMO KEY] Creating demo API key with custom sitekey...\");\n      const apiKey = await storage.createApiKey({\n        developerId: demoDeveloper.id,\n        name: \"Demo Application\",\n        domain: \"*\",\n        isActive: true,\n      }, {\n        sitekey: DEMO_PUBLIC_KEY,\n        secretkey: DEMO_PRIVATE_KEY,\n      });\n      console.log(\"[DEMO KEY] Demo API key created:\", apiKey.sitekey);\n    } else {\n      console.log(\"[DEMO KEY] Demo API key already exists:\", demoKey.sitekey);\n    }\n  } catch (error) {\n    console.error(\"[DEMO KEY] Error ensuring demo API key:\", error);\n  }\n}\n","size_bytes":2266},"server/enhancements/enhanced-honeypot.ts":{"content":"import { Request } from 'express';\n\nexport interface EnhancedHoneypotConfig {\n  fieldNames: string[];\n  timingThreshold: number;\n  mouseMovementRequired: boolean;\n  keyboardInteractionRequired: boolean;\n  strictMode: boolean;\n  logOnly: boolean;\n}\n\nexport const ENHANCED_HONEYPOT_CONFIG: EnhancedHoneypotConfig = {\n  fieldNames: [\n    'email_confirm',\n    'phone_verify',\n    'website_url',\n    'company_name',\n    'full_address',\n    'confirm_password',\n    'business_phone',\n    'fax_number',\n    'alternate_email',\n    'linkedin_profile',\n  ],\n  timingThreshold: 2000,\n  mouseMovementRequired: true,\n  keyboardInteractionRequired: true,\n  strictMode: false,\n  logOnly: false,\n};\n\nexport interface EnhancedHoneypotResult {\n  isBot: boolean;\n  confidence: number;\n  riskScore: number;\n  triggers: {\n    honeypotFields: string[];\n    suspiciousTiming: boolean;\n    noMouseMovement: boolean;\n    noKeyboardInteraction: boolean;\n    instantFormFill: boolean;\n    patternMatching: boolean;\n  };\n  shouldBlock: boolean;\n  details: string[];\n}\n\nexport function checkEnhancedHoneypot(\n  req: Request,\n  config: EnhancedHoneypotConfig = ENHANCED_HONEYPOT_CONFIG\n): EnhancedHoneypotResult {\n  const triggers = {\n    honeypotFields: [] as string[],\n    suspiciousTiming: false,\n    noMouseMovement: false,\n    noKeyboardInteraction: false,\n    instantFormFill: false,\n    patternMatching: false,\n  };\n\n  const details: string[] = [];\n  let totalConfidence = 0;\n  let riskScore = 0;\n\n  if (req.body) {\n    for (const fieldName of config.fieldNames) {\n      const value = req.body[fieldName];\n      \n      if (value !== undefined && value !== null && value !== '') {\n        triggers.honeypotFields.push(fieldName);\n        details.push(`Honeypot field filled: ${fieldName}`);\n        totalConfidence += 30;\n        riskScore += 25;\n      }\n    }\n  }\n\n  const submissionTime = req.body?.submissionTime;\n  if (submissionTime && typeof submissionTime === 'number') {\n    if (submissionTime < config.timingThreshold) {\n      triggers.suspiciousTiming = true;\n      triggers.instantFormFill = true;\n      details.push(`Form submitted too quickly: ${submissionTime}ms`);\n      totalConfidence += 25;\n      riskScore += 20;\n    }\n  }\n\n  const mouseMovements = req.body?.mouseMovements;\n  if (config.mouseMovementRequired && (!mouseMovements || mouseMovements === 0)) {\n    triggers.noMouseMovement = true;\n    details.push('No mouse movements detected');\n    totalConfidence += 20;\n    riskScore += 15;\n  }\n\n  const keyboardEvents = req.body?.keyboardEvents;\n  if (config.keyboardInteractionRequired && (!keyboardEvents || keyboardEvents === 0)) {\n    triggers.noKeyboardInteraction = true;\n    details.push('No keyboard interaction detected');\n    totalConfidence += 20;\n    riskScore += 15;\n  }\n\n  if (req.body) {\n    const textFields = Object.entries(req.body).filter(([key, value]) =>\n      typeof value === 'string' && value.length > 10\n    );\n\n    let patternScore = 0;\n    for (const [, value] of textFields) {\n      const val = value as string;\n      \n      if (/^[a-z]{10,}$/.test(val)) {\n        patternScore += 10;\n      }\n      \n      if (/^(.)\\1{5,}/.test(val)) {\n        patternScore += 15;\n      }\n      \n      if (val === val.toUpperCase() && val.length > 5) {\n        patternScore += 5;\n      }\n    }\n\n    if (patternScore > 15) {\n      triggers.patternMatching = true;\n      details.push(`Suspicious pattern in form data (score: ${patternScore})`);\n      totalConfidence += 15;\n      riskScore += 10;\n    }\n  }\n\n  const isBot = triggers.honeypotFields.length > 0 ||\n    (triggers.instantFormFill && (triggers.noMouseMovement || triggers.noKeyboardInteraction));\n\n  const finalConfidence = Math.min(totalConfidence, 100);\n  const finalRiskScore = Math.min(riskScore, 100);\n\n  const shouldBlock = isBot && !config.logOnly && \n    (config.strictMode || finalConfidence > 50);\n\n  return {\n    isBot,\n    confidence: finalConfidence,\n    riskScore: finalRiskScore,\n    triggers,\n    shouldBlock,\n    details,\n  };\n}\n\nexport function generateEnhancedHoneypotHTML(\n  fieldNames: string[] = ENHANCED_HONEYPOT_CONFIG.fieldNames\n): string {\n  return fieldNames.map(name => `\n    <input \n      type=\"text\" \n      name=\"${name}\" \n      id=\"${name}\"\n      value=\"\"\n      tabindex=\"-1\"\n      autocomplete=\"off\"\n      aria-hidden=\"true\"\n      class=\"honeypot-field\"\n      style=\"position:absolute !important;left:-9999px !important;width:1px !important;height:1px !important;opacity:0 !important;pointer-events:none !important;\"\n    />\n  `).join('\\n');\n}\n\nexport const CLIENT_HONEYPOT_TRACKER = `\n(function() {\n  const tracker = {\n    mouseMovements: 0,\n    keyboardEvents: 0,\n    submissionTime: 0,\n    startTime: Date.now()\n  };\n\n  document.addEventListener('mousemove', function() {\n    tracker.mouseMovements++;\n  }, { passive: true });\n\n  document.addEventListener('keydown', function() {\n    tracker.keyboardEvents++;\n  }, { passive: true });\n\n  const originalSubmit = HTMLFormElement.prototype.submit;\n  HTMLFormElement.prototype.submit = function() {\n    tracker.submissionTime = Date.now() - tracker.startTime;\n    \n    const mouseInput = document.createElement('input');\n    mouseInput.type = 'hidden';\n    mouseInput.name = 'mouseMovements';\n    mouseInput.value = String(tracker.mouseMovements);\n    this.appendChild(mouseInput);\n\n    const keyInput = document.createElement('input');\n    keyInput.type = 'hidden';\n    keyInput.name = 'keyboardEvents';\n    keyInput.value = String(tracker.keyboardEvents);\n    this.appendChild(keyInput);\n\n    const timeInput = document.createElement('input');\n    timeInput.type = 'hidden';\n    timeInput.name = 'submissionTime';\n    timeInput.value = String(tracker.submissionTime);\n    this.appendChild(timeInput);\n\n    return originalSubmit.apply(this, arguments);\n  };\n\n  window.addEventListener('beforeunload', function() {\n    if (window.localStorage) {\n      localStorage.setItem('formTracking', JSON.stringify(tracker));\n    }\n  });\n\n  return tracker;\n})();\n`;\n","size_bytes":6001},"client/src/components/ui/breadcrumb.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Breadcrumb = React.forwardRef<\n  HTMLElement,\n  React.ComponentPropsWithoutRef<\"nav\"> & {\n    separator?: React.ReactNode\n  }\n>(({ ...props }, ref) => <nav ref={ref} aria-label=\"breadcrumb\" {...props} />)\nBreadcrumb.displayName = \"Breadcrumb\"\n\nconst BreadcrumbList = React.forwardRef<\n  HTMLOListElement,\n  React.ComponentPropsWithoutRef<\"ol\">\n>(({ className, ...props }, ref) => (\n  <ol\n    ref={ref}\n    className={cn(\n      \"flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5\",\n      className\n    )}\n    {...props}\n  />\n))\nBreadcrumbList.displayName = \"BreadcrumbList\"\n\nconst BreadcrumbItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentPropsWithoutRef<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    className={cn(\"inline-flex items-center gap-1.5\", className)}\n    {...props}\n  />\n))\nBreadcrumbItem.displayName = \"BreadcrumbItem\"\n\nconst BreadcrumbLink = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentPropsWithoutRef<\"a\"> & {\n    asChild?: boolean\n  }\n>(({ asChild, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      className={cn(\"transition-colors hover:text-foreground\", className)}\n      {...props}\n    />\n  )\n})\nBreadcrumbLink.displayName = \"BreadcrumbLink\"\n\nconst BreadcrumbPage = React.forwardRef<\n  HTMLSpanElement,\n  React.ComponentPropsWithoutRef<\"span\">\n>(({ className, ...props }, ref) => (\n  <span\n    ref={ref}\n    role=\"link\"\n    aria-disabled=\"true\"\n    aria-current=\"page\"\n    className={cn(\"font-normal text-foreground\", className)}\n    {...props}\n  />\n))\nBreadcrumbPage.displayName = \"BreadcrumbPage\"\n\nconst BreadcrumbSeparator = ({\n  children,\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) => (\n  <li\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"[&>svg]:w-3.5 [&>svg]:h-3.5\", className)}\n    {...props}\n  >\n    {children ?? <ChevronRight />}\n  </li>\n)\nBreadcrumbSeparator.displayName = \"BreadcrumbSeparator\"\n\nconst BreadcrumbEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More</span>\n  </span>\n)\nBreadcrumbEllipsis.displayName = \"BreadcrumbElipssis\"\n\nexport {\n  Breadcrumb,\n  BreadcrumbList,\n  BreadcrumbItem,\n  BreadcrumbLink,\n  BreadcrumbPage,\n  BreadcrumbSeparator,\n  BreadcrumbEllipsis,\n}\n","size_bytes":2712},"server/cleanup-tasks.ts":{"content":"/**\n * Automated Cleanup Tasks\n * \n * Periodic cleanup untuk expired challenges dan old security events\n */\n\nimport { storage } from './storage';\nimport { cleanupExpiredChallenges, DEFAULT_EXPIRATION_CONFIG } from './enhancements/token-expiration';\n\n/**\n * Cleanup expired challenges dari database\n */\nasync function cleanupChallenges() {\n  try {\n    console.log('[CLEANUP] Starting expired challenges cleanup...');\n    \n    const deletedCount = await cleanupExpiredChallenges(\n      async () => {\n        const challenges = await storage.getAllChallenges();\n        return challenges.map(c => ({\n          id: c.id,\n          createdAt: c.createdAt,\n        }));\n      },\n      async (id: string) => {\n        await storage.deleteChallenge(id);\n      },\n      DEFAULT_EXPIRATION_CONFIG\n    );\n    \n    if (deletedCount > 0) {\n      console.log(`[CLEANUP] Deleted ${deletedCount} expired challenges`);\n    } else {\n      console.log('[CLEANUP] No expired challenges to delete');\n    }\n  } catch (error) {\n    console.error('[CLEANUP] Error during challenge cleanup:', error);\n  }\n}\n\n/**\n * Start all periodic cleanup tasks\n */\nexport function startCleanupTasks() {\n  console.log('[CLEANUP] Starting automated cleanup tasks...');\n  \n  // Cleanup expired challenges setiap 1 jam\n  const cleanupInterval = 60 * 60 * 1000; // 1 hour\n  setInterval(cleanupChallenges, cleanupInterval);\n  \n  // Run cleanup immediately on start\n  setTimeout(cleanupChallenges, 5000); // After 5 seconds\n  \n  console.log('[CLEANUP] Automated cleanup tasks configured:');\n  console.log(`  - Challenge cleanup: every ${cleanupInterval / 1000 / 60} minutes`);\n}\n","size_bytes":1634},"tailwind.config.ts":{"content":"import type { Config } from \"tailwindcss\";\n\nexport default {\n  darkMode: [\"class\"],\n  content: [\"./client/index.html\", \"./client/src/**/*.{js,jsx,ts,tsx}\"],\n  theme: {\n    extend: {\n      borderRadius: {\n        lg: \".5625rem\", /* 9px */\n        md: \".375rem\", /* 6px */\n        sm: \".1875rem\", /* 3px */\n      },\n      colors: {\n        // Flat / base colors (regular buttons)\n        background: \"hsl(var(--background) / <alpha-value>)\",\n        foreground: \"hsl(var(--foreground) / <alpha-value>)\",\n        border: \"hsl(var(--border) / <alpha-value>)\",\n        input: \"hsl(var(--input) / <alpha-value>)\",\n        card: {\n          DEFAULT: \"hsl(var(--card) / <alpha-value>)\",\n          foreground: \"hsl(var(--card-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--card-border) / <alpha-value>)\",\n        },\n        popover: {\n          DEFAULT: \"hsl(var(--popover) / <alpha-value>)\",\n          foreground: \"hsl(var(--popover-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--popover-border) / <alpha-value>)\",\n        },\n        primary: {\n          DEFAULT: \"hsl(var(--primary) / <alpha-value>)\",\n          foreground: \"hsl(var(--primary-foreground) / <alpha-value>)\",\n          border: \"var(--primary-border)\",\n        },\n        secondary: {\n          DEFAULT: \"hsl(var(--secondary) / <alpha-value>)\",\n          foreground: \"hsl(var(--secondary-foreground) / <alpha-value>)\",\n          border: \"var(--secondary-border)\",\n        },\n        muted: {\n          DEFAULT: \"hsl(var(--muted) / <alpha-value>)\",\n          foreground: \"hsl(var(--muted-foreground) / <alpha-value>)\",\n          border: \"var(--muted-border)\",\n        },\n        accent: {\n          DEFAULT: \"hsl(var(--accent) / <alpha-value>)\",\n          foreground: \"hsl(var(--accent-foreground) / <alpha-value>)\",\n          border: \"var(--accent-border)\",\n        },\n        destructive: {\n          DEFAULT: \"hsl(var(--destructive) / <alpha-value>)\",\n          foreground: \"hsl(var(--destructive-foreground) / <alpha-value>)\",\n          border: \"var(--destructive-border)\",\n        },\n        ring: \"hsl(var(--ring) / <alpha-value>)\",\n        chart: {\n          \"1\": \"hsl(var(--chart-1) / <alpha-value>)\",\n          \"2\": \"hsl(var(--chart-2) / <alpha-value>)\",\n          \"3\": \"hsl(var(--chart-3) / <alpha-value>)\",\n          \"4\": \"hsl(var(--chart-4) / <alpha-value>)\",\n          \"5\": \"hsl(var(--chart-5) / <alpha-value>)\",\n        },\n        sidebar: {\n          ring: \"hsl(var(--sidebar-ring) / <alpha-value>)\",\n          DEFAULT: \"hsl(var(--sidebar) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--sidebar-border) / <alpha-value>)\",\n        },\n        \"sidebar-primary\": {\n          DEFAULT: \"hsl(var(--sidebar-primary) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-primary-foreground) / <alpha-value>)\",\n          border: \"var(--sidebar-primary-border)\",\n        },\n        \"sidebar-accent\": {\n          DEFAULT: \"hsl(var(--sidebar-accent) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-accent-foreground) / <alpha-value>)\",\n          border: \"var(--sidebar-accent-border)\"\n        },\n        status: {\n          online: \"rgb(34 197 94)\",\n          away: \"rgb(245 158 11)\",\n          busy: \"rgb(239 68 68)\",\n          offline: \"rgb(156 163 175)\",\n        },\n      },\n      fontFamily: {\n        sans: [\"var(--font-sans)\"],\n        serif: [\"var(--font-serif)\"],\n        mono: [\"var(--font-mono)\"],\n      },\n      keyframes: {\n        \"accordion-down\": {\n          from: { height: \"0\" },\n          to: { height: \"var(--radix-accordion-content-height)\" },\n        },\n        \"accordion-up\": {\n          from: { height: \"var(--radix-accordion-content-height)\" },\n          to: { height: \"0\" },\n        },\n      },\n      animation: {\n        \"accordion-down\": \"accordion-down 0.2s ease-out\",\n        \"accordion-up\": \"accordion-up 0.2s ease-out\",\n      },\n    },\n  },\n  plugins: [require(\"tailwindcss-animate\"), require(\"@tailwindcss/typography\")],\n} satisfies Config;\n","size_bytes":4050},"server/ip-blocker.ts":{"content":"import type { Request } from \"express\";\nimport type { SecuritySettings } from \"@shared/schema\";\n\ninterface FailedAttempt {\n  count: number;\n  firstAttempt: number;\n  lastAttempt: number;\n}\n\ninterface RefreshAttempt {\n  count: number;\n  firstRefresh: number;\n  lastRefresh: number;\n}\n\ninterface BlockedIP {\n  blockedAt: number;\n  expiresAt: number;\n  reason: string;\n  failedAttempts: number;\n}\n\nclass IPBlocker {\n  private failedAttempts: Map<string, FailedAttempt> = new Map();\n  private refreshAttempts: Map<string, RefreshAttempt> = new Map();\n  private blockedIPs: Map<string, BlockedIP> = new Map();\n  \n  private readonly MAX_ATTEMPTS = 3;\n  private readonly BLOCK_DURATION = 2 * 60 * 60 * 1000; // 2 hours in milliseconds\n  private readonly ATTEMPT_WINDOW = 10 * 60 * 1000; // 10 minutes window for attempts\n  \n  private readonly MAX_REFRESH_CLICKS = 3;\n  private readonly REFRESH_BLOCK_DURATION = 1 * 60 * 60 * 1000; // 1 hour in milliseconds\n  private readonly REFRESH_WINDOW = 5 * 60 * 1000; // 5 minutes window for refresh clicks\n  \n  constructor() {\n    // Clean up expired blocks every 5 minutes\n    setInterval(() => this.cleanupExpiredBlocks(), 5 * 60 * 1000);\n  }\n  \n  getClientIP(req: Request): string {\n    // SECURITY FIX: Walk through proxy chain to find first public IP\n    // This ensures we get the real client IP even in multi-proxy environments like Replit\n    let lastSeenPrivateIP: string | null = null;\n    \n    // Priority 1: Replit-specific header for true client IP\n    const replitClientIP = req.headers['x-replit-user-ip'] as string;\n    if (replitClientIP && replitClientIP !== 'unknown' && replitClientIP.trim() !== '') {\n      const cleanIP = replitClientIP.trim();\n      if (!this.isPrivateIP(cleanIP)) {\n        console.log(`[IP-BLOCKER] Using x-replit-user-ip (public client): ${cleanIP}`);\n        return cleanIP;\n      }\n      lastSeenPrivateIP = cleanIP;\n    }\n    \n    // Priority 2: Walk through X-Forwarded-For chain to find first public IP\n    const xForwardedFor = req.headers['x-forwarded-for'] as string;\n    if (xForwardedFor && xForwardedFor !== 'unknown' && xForwardedFor.trim() !== '') {\n      const ips = xForwardedFor.split(',').map(ip => ip.trim());\n      // Walk through chain to find first public IP (real client)\n      for (const ip of ips) {\n        if (ip && !this.isPrivateIP(ip)) {\n          console.log(`[IP-BLOCKER] Using x-forwarded-for (public client from chain): ${ip}`);\n          return ip;\n        }\n        // Track last private IP as fallback\n        if (ip) lastSeenPrivateIP = ip;\n      }\n      // If all IPs in chain are private, log warning\n      console.warn(`[IP-BLOCKER] All IPs in x-forwarded-for are private: ${xForwardedFor}`);\n    }\n    \n    // Priority 3: Express's req.ip which respects trust proxy setting\n    if (req.ip && req.ip !== 'unknown' && req.ip.trim() !== '') {\n      const ip = req.ip.startsWith('::ffff:') ? req.ip.substring(7) : req.ip;\n      if (!this.isPrivateIP(ip)) {\n        console.log(`[IP-BLOCKER] Using req.ip (public): ${ip}`);\n        return ip;\n      }\n      // If req.ip is private, save as fallback and continue to other headers\n      console.log(`[IP-BLOCKER] Skipping req.ip (private): ${ip}, checking other headers...`);\n      lastSeenPrivateIP = ip;\n    }\n    \n    // Priority 4: Cloudflare CF-Connecting-IP\n    const cfIP = req.headers['cf-connecting-ip'] as string;\n    if (cfIP && cfIP !== 'unknown' && cfIP.trim() !== '') {\n      const cleanIP = cfIP.trim();\n      if (!this.isPrivateIP(cleanIP)) {\n        console.log(`[IP-BLOCKER] Using cf-connecting-ip (public): ${cleanIP}`);\n        return cleanIP;\n      }\n      lastSeenPrivateIP = cleanIP;\n    }\n    \n    // Priority 5: Fallback to direct socket connection\n    const socketIP = req.socket.remoteAddress;\n    if (socketIP && socketIP !== 'unknown' && socketIP.trim() !== '') {\n      const cleanIP = socketIP.startsWith('::ffff:') ? socketIP.substring(7) : socketIP;\n      if (!this.isPrivateIP(cleanIP)) {\n        console.log(`[IP-BLOCKER] Using socket.remoteAddress (public): ${cleanIP}`);\n        return cleanIP;\n      }\n      lastSeenPrivateIP = cleanIP;\n    }\n    \n    // Last resort: return private IP if that's all we have\n    if (lastSeenPrivateIP) {\n      console.warn(`[IP-BLOCKER] No public IP found in any header, using last seen private IP: ${lastSeenPrivateIP}`);\n      return lastSeenPrivateIP;\n    }\n    \n    console.warn('[IP-BLOCKER] ‚úó Could not extract any IP from request');\n    return 'unknown';\n  }\n  \n  private isPrivateIP(ip: string): boolean {\n    // Check for private IP ranges\n    const parts = ip.split('.');\n    if (parts.length !== 4) return false;\n    \n    const first = parseInt(parts[0]);\n    const second = parseInt(parts[1]);\n    \n    // 10.0.0.0 - 10.255.255.255\n    if (first === 10) return true;\n    \n    // 172.16.0.0 - 172.31.255.255\n    if (first === 172 && second >= 16 && second <= 31) return true;\n    \n    // 192.168.0.0 - 192.168.255.255\n    if (first === 192 && second === 168) return true;\n    \n    // 127.0.0.0 - 127.255.255.255 (localhost)\n    if (first === 127) return true;\n    \n    return false;\n  }\n  \n  isBlocked(ip: string): boolean {\n    const blocked = this.blockedIPs.get(ip);\n    \n    if (!blocked) {\n      return false;\n    }\n    \n    // Check if block has expired\n    if (Date.now() > blocked.expiresAt) {\n      this.blockedIPs.delete(ip);\n      this.failedAttempts.delete(ip);\n      this.refreshAttempts.delete(ip);\n      return false;\n    }\n    \n    return true;\n  }\n  \n  getBlockInfo(ip: string): BlockedIP | null {\n    const blocked = this.blockedIPs.get(ip);\n    \n    if (!blocked) {\n      return null;\n    }\n    \n    // Check if block has expired\n    if (Date.now() > blocked.expiresAt) {\n      this.blockedIPs.delete(ip);\n      return null;\n    }\n    \n    return blocked;\n  }\n  \n  recordFailedAttempt(ip: string): void {\n    const now = Date.now();\n    const attempts = this.failedAttempts.get(ip);\n    \n    if (!attempts) {\n      // First failed attempt\n      this.failedAttempts.set(ip, {\n        count: 1,\n        firstAttempt: now,\n        lastAttempt: now,\n      });\n      return;\n    }\n    \n    // Check if previous attempts are within the window\n    if (now - attempts.firstAttempt > this.ATTEMPT_WINDOW) {\n      // Reset counter if outside window\n      this.failedAttempts.set(ip, {\n        count: 1,\n        firstAttempt: now,\n        lastAttempt: now,\n      });\n      return;\n    }\n    \n    // Increment counter\n    attempts.count++;\n    attempts.lastAttempt = now;\n    \n    // Block IP if reached max attempts\n    if (attempts.count >= this.MAX_ATTEMPTS) {\n      this.blockIP(ip, attempts.count);\n    }\n  }\n  \n  private blockIP(ip: string, failedAttempts: number): void {\n    const now = Date.now();\n    \n    this.blockedIPs.set(ip, {\n      blockedAt: now,\n      expiresAt: now + this.BLOCK_DURATION,\n      reason: `Too many failed verification attempts (${failedAttempts})`,\n      failedAttempts,\n    });\n    \n    console.log(`IP ${ip} blocked for 2 hours due to ${failedAttempts} failed attempts`);\n  }\n  \n  getFailureCount(ip: string): number {\n    const attempts = this.failedAttempts.get(ip);\n    if (!attempts) {\n      return 0;\n    }\n    \n    const now = Date.now();\n    if (now - attempts.firstAttempt > this.ATTEMPT_WINDOW) {\n      return 0;\n    }\n    \n    return attempts.count;\n  }\n  \n  resetAttempts(ip: string): void {\n    this.failedAttempts.delete(ip);\n    this.refreshAttempts.delete(ip);\n  }\n  \n  recordRefreshClick(ip: string): void {\n    const now = Date.now();\n    const attempts = this.refreshAttempts.get(ip);\n    \n    if (!attempts) {\n      this.refreshAttempts.set(ip, {\n        count: 1,\n        firstRefresh: now,\n        lastRefresh: now,\n      });\n      return;\n    }\n    \n    if (now - attempts.firstRefresh > this.REFRESH_WINDOW) {\n      this.refreshAttempts.set(ip, {\n        count: 1,\n        firstRefresh: now,\n        lastRefresh: now,\n      });\n      return;\n    }\n    \n    attempts.count++;\n    attempts.lastRefresh = now;\n    \n    if (attempts.count >= this.MAX_REFRESH_CLICKS) {\n      this.blockIPForRefreshAbuse(ip, attempts.count);\n    }\n  }\n  \n  private blockIPForRefreshAbuse(ip: string, refreshCount: number): void {\n    const now = Date.now();\n    \n    this.blockedIPs.set(ip, {\n      blockedAt: now,\n      expiresAt: now + this.REFRESH_BLOCK_DURATION,\n      reason: `Too many refresh attempts (${refreshCount})`,\n      failedAttempts: 0,\n    });\n    \n    console.log(`IP ${ip} blocked for 1 hour due to ${refreshCount} refresh clicks`);\n  }\n  \n  getRefreshCount(ip: string): number {\n    const attempts = this.refreshAttempts.get(ip);\n    if (!attempts) {\n      return 0;\n    }\n    \n    const now = Date.now();\n    if (now - attempts.firstRefresh > this.REFRESH_WINDOW) {\n      return 0;\n    }\n    \n    return attempts.count;\n  }\n  \n  manualBlock(ip: string, reason: string, duration?: number): void {\n    const now = Date.now();\n    const blockDuration = duration || this.BLOCK_DURATION;\n    \n    this.blockedIPs.set(ip, {\n      blockedAt: now,\n      expiresAt: now + blockDuration,\n      reason,\n      failedAttempts: 0,\n    });\n    \n    console.log(`IP ${ip} manually blocked: ${reason}`);\n  }\n  \n  unblock(ip: string): boolean {\n    const blocked = this.blockedIPs.delete(ip);\n    this.failedAttempts.delete(ip);\n    this.refreshAttempts.delete(ip);\n    \n    if (blocked) {\n      console.log(`IP ${ip} unblocked`);\n    }\n    \n    return blocked;\n  }\n  \n  private cleanupExpiredBlocks(): void {\n    const now = Date.now();\n    let cleaned = 0;\n    \n    const entries = Array.from(this.blockedIPs.entries());\n    for (const [ip, blocked] of entries) {\n      if (now > blocked.expiresAt) {\n        this.blockedIPs.delete(ip);\n        this.failedAttempts.delete(ip);\n        this.refreshAttempts.delete(ip);\n        cleaned++;\n      }\n    }\n    \n    if (cleaned > 0) {\n      console.log(`Cleaned up ${cleaned} expired IP blocks`);\n    }\n  }\n  \n  getStats() {\n    return {\n      totalBlocked: this.blockedIPs.size,\n      totalTracked: this.failedAttempts.size,\n      blockedIPs: Array.from(this.blockedIPs.entries()).map(([ip, info]) => ({\n        ip,\n        ...info,\n        remainingTime: Math.max(0, info.expiresAt - Date.now()),\n      })),\n    };\n  }\n  \n  /**\n   * Validate IP address format (supports exact IP, wildcard, CIDR)\n   */\n  validateIPFormat(ip: string): { valid: boolean; error?: string } {\n    const trimmed = ip.trim();\n    \n    // Check for wildcard pattern (e.g., \"192.168.*\" or \"10.0.*\" or \"10.*\")\n    if (trimmed.includes('*')) {\n      const parts = trimmed.split('.');\n      if (parts.length < 2 || parts.length > 4) {\n        return { valid: false, error: `Invalid wildcard IP format (must be like 192.168.*, 10.0.*, or 10.*): ${ip}` };\n      }\n      \n      // Wildcards must appear after at least one valid octet and then replace all remaining octets\n      let foundWildcard = false;\n      for (const part of parts) {\n        if (part === '*') {\n          foundWildcard = true;\n        } else if (foundWildcard) {\n          // After wildcard, only wildcards are allowed (e.g., \"192.*.0.1\" is NOT valid)\n          return { valid: false, error: `Wildcard must replace all remaining octets (e.g., 192.168.* not 192.*.0.1): ${ip}` };\n        } else {\n          const num = parseInt(part);\n          if (isNaN(num) || num < 0 || num > 255) {\n            return { valid: false, error: `Invalid octet in wildcard IP: ${ip}` };\n          }\n        }\n      }\n      \n      if (!foundWildcard) {\n        return { valid: false, error: `Wildcard pattern must contain at least one *: ${ip}` };\n      }\n      \n      return { valid: true };\n    }\n    \n    // Check for CIDR notation (e.g., \"192.168.1.0/24\")\n    if (trimmed.includes('/')) {\n      const [network, maskStr] = trimmed.split('/');\n      const mask = parseInt(maskStr);\n      \n      // Validate mask bits\n      if (isNaN(mask) || mask < 0 || mask > 32) {\n        return { valid: false, error: `Invalid CIDR mask bits (must be 0-32): ${ip}` };\n      }\n      \n      // Validate network address\n      const parts = network.split('.');\n      if (parts.length !== 4) {\n        return { valid: false, error: `Invalid network address in CIDR: ${ip}` };\n      }\n      for (const part of parts) {\n        const num = parseInt(part);\n        if (isNaN(num) || num < 0 || num > 255) {\n          return { valid: false, error: `Invalid octet in CIDR network: ${ip}` };\n        }\n      }\n      return { valid: true };\n    }\n    \n    // Check for exact IP address (e.g., \"192.168.1.1\")\n    const parts = trimmed.split('.');\n    if (parts.length !== 4) {\n      return { valid: false, error: `Invalid IP address format (must be x.x.x.x): ${ip}` };\n    }\n    for (const part of parts) {\n      const num = parseInt(part);\n      if (isNaN(num) || num < 0 || num > 255) {\n        return { valid: false, error: `Invalid octet in IP address: ${ip}` };\n      }\n    }\n    \n    return { valid: true };\n  }\n  \n  /**\n   * Validate country code format (ISO 3166-1 alpha-2)\n   */\n  validateCountryCode(code: string): { valid: boolean; error?: string } {\n    const trimmed = code.trim().toUpperCase();\n    \n    // ISO 3166-1 alpha-2 codes are exactly 2 uppercase letters\n    if (!/^[A-Z]{2}$/.test(trimmed)) {\n      return { \n        valid: false, \n        error: `Invalid country code format (must be 2-letter ISO code): ${code}` \n      };\n    }\n    \n    return { valid: true };\n  }\n  \n  /**\n   * Validate arrays of blocked IPs and countries\n   */\n  validateBlockedLists(\n    blockedIps: string[] | undefined, \n    blockedCountries: string[] | undefined\n  ): { valid: boolean; errors: string[] } {\n    const errors: string[] = [];\n    \n    // Validate blocked IPs\n    if (blockedIps && Array.isArray(blockedIps)) {\n      for (const ip of blockedIps) {\n        const result = this.validateIPFormat(ip);\n        if (!result.valid && result.error) {\n          errors.push(result.error);\n        }\n      }\n    }\n    \n    // Validate blocked countries\n    if (blockedCountries && Array.isArray(blockedCountries)) {\n      for (const country of blockedCountries) {\n        const result = this.validateCountryCode(country);\n        if (!result.valid && result.error) {\n          errors.push(result.error);\n        }\n      }\n    }\n    \n    return {\n      valid: errors.length === 0,\n      errors\n    };\n  }\n  \n  /**\n   * Check if IP is in blocked list (supports CIDR notation)\n   */\n  isIPBlocked(clientIP: string, blockedIps: string[]): boolean {\n    if (!blockedIps || blockedIps.length === 0) return false;\n    \n    // Simple IP matching (exact match or wildcard)\n    for (const blockedIP of blockedIps) {\n      // Exact match\n      if (blockedIP === clientIP) {\n        console.log(`[IP-BLOCKER] IP ${clientIP} is blocked (exact match: ${blockedIP})`);\n        return true;\n      }\n      \n      // Wildcard match (e.g., \"192.168.*\" or \"10.0.*\" or \"10.*\")\n      // Supports wildcards at any position after valid octets\n      if (blockedIP.includes('*')) {\n        const blockedParts = blockedIP.split('.');\n        const clientParts = clientIP.split('.');\n        \n        // Match each octet until we hit a wildcard\n        let matches = true;\n        for (let i = 0; i < blockedParts.length; i++) {\n          if (blockedParts[i] === '*') {\n            // Wildcard matches everything from this point on\n            break;\n          }\n          \n          // Check if client has enough octets\n          if (i >= clientParts.length) {\n            matches = false;\n            break;\n          }\n          \n          // Check if this octet matches\n          if (blockedParts[i] !== clientParts[i]) {\n            matches = false;\n            break;\n          }\n        }\n        \n        if (matches) {\n          console.log(`[IP-BLOCKER] IP ${clientIP} is blocked (wildcard match: ${blockedIP})`);\n          return true;\n        }\n      }\n      \n      // CIDR notation support (basic implementation for /24, /16, /8)\n      if (blockedIP.includes('/')) {\n        const [network, maskBits] = blockedIP.split('/');\n        const mask = parseInt(maskBits);\n        \n        // Simple CIDR check for common masks\n        if (mask === 24) {\n          // Match first 3 octets\n          const networkPrefix = network.split('.').slice(0, 3).join('.');\n          const clientPrefix = clientIP.split('.').slice(0, 3).join('.');\n          if (networkPrefix === clientPrefix) {\n            console.log(`[IP-BLOCKER] IP ${clientIP} is blocked (CIDR /24 match: ${blockedIP})`);\n            return true;\n          }\n        } else if (mask === 16) {\n          // Match first 2 octets\n          const networkPrefix = network.split('.').slice(0, 2).join('.');\n          const clientPrefix = clientIP.split('.').slice(0, 2).join('.');\n          if (networkPrefix === clientPrefix) {\n            console.log(`[IP-BLOCKER] IP ${clientIP} is blocked (CIDR /16 match: ${blockedIP})`);\n            return true;\n          }\n        } else if (mask === 8) {\n          // Match first octet\n          const networkPrefix = network.split('.')[0];\n          const clientPrefix = clientIP.split('.')[0];\n          if (networkPrefix === clientPrefix) {\n            console.log(`[IP-BLOCKER] IP ${clientIP} is blocked (CIDR /8 match: ${blockedIP})`);\n            return true;\n          }\n        }\n      }\n    }\n    \n    return false;\n  }\n  \n  /**\n   * Check if country is in blocked list\n   */\n  isCountryBlocked(countryCode: string | null, blockedCountries: string[]): boolean {\n    if (!blockedCountries || blockedCountries.length === 0 || !countryCode) return false;\n    \n    // Case-insensitive country code matching\n    const upperCountryCode = countryCode.toUpperCase();\n    const isBlocked = blockedCountries.some(blocked => blocked.toUpperCase() === upperCountryCode);\n    \n    if (isBlocked) {\n      console.log(`[IP-BLOCKER] Country ${countryCode} is blocked`);\n    }\n    \n    return isBlocked;\n  }\n  \n  /**\n   * Check if request should be blocked based on security settings\n   */\n  checkSecurityBlocking(clientIP: string, countryCode: string | null, settings: SecuritySettings | null): { blocked: boolean; reason?: string } {\n    if (!settings) return { blocked: false };\n    \n    // Check IP blocking\n    if (settings.blockedIps && settings.blockedIps.length > 0) {\n      if (this.isIPBlocked(clientIP, settings.blockedIps)) {\n        return {\n          blocked: true,\n          reason: `Your IP address (${clientIP}) is blocked by this application's security policy.`\n        };\n      }\n    }\n    \n    // Check country blocking\n    if (settings.blockedCountries && settings.blockedCountries.length > 0) {\n      if (this.isCountryBlocked(countryCode, settings.blockedCountries)) {\n        return {\n          blocked: true,\n          reason: `Access from your country (${countryCode || 'Unknown'}) is blocked by this application's security policy.`\n        };\n      }\n    }\n    \n    return { blocked: false };\n  }\n}\n\n// Singleton instance\nexport const ipBlocker = new IPBlocker();\n","size_bytes":18996},"client/src/components/ui/button.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\" +\n  \" hover-elevate active-elevate-2\",\n  {\n    variants: {\n      variant: {\n        default:\n          \"bg-primary text-primary-foreground border border-primary-border\",\n        destructive:\n          \"bg-destructive text-destructive-foreground border border-destructive-border\",\n        outline:\n          // Shows the background color of whatever card / sidebar / accent background it is inside of.\n          // Inherits the current text color.\n          \" border [border-color:var(--button-outline)]  shadow-xs active:shadow-none \",\n        secondary: \"border bg-secondary text-secondary-foreground border border-secondary-border \",\n        // Add a transparent border so that when someone toggles a border on later, it doesn't shift layout/size.\n        ghost: \"border border-transparent\",\n      },\n      // Heights are set as \"min\" heights, because sometimes Ai will place large amount of content\n      // inside buttons. With a min-height they will look appropriate with small amounts of content,\n      // but will expand to fit large amounts of content.\n      size: {\n        default: \"min-h-9 px-4 py-2\",\n        sm: \"min-h-8 rounded-md px-3 text-xs\",\n        lg: \"min-h-10 rounded-md px-8\",\n        icon: \"h-9 w-9\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  },\n)\n\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> {\n  asChild?: boolean\n}\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\n    const Comp = asChild ? Slot : \"button\"\n    return (\n      <Comp\n        className={cn(buttonVariants({ variant, size, className }))}\n        ref={ref}\n        {...props}\n      />\n    )\n  },\n)\nButton.displayName = \"Button\"\n\nexport { Button, buttonVariants }\n","size_bytes":2359},"client/src/components/UpsideDownCaptcha.tsx":{"content":"import { useEffect, useRef, useState } from 'react';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent } from '@/components/ui/card';\nimport { RotateCcw } from 'lucide-react';\n\ninterface Animal {\n  id: string;\n  x: number;\n  y: number;\n  animalType: string;\n  path: string;\n  orientation?: 'upright' | 'upside_down';\n  rotation?: number;\n}\n\ninterface UpsideDownChallengeData {\n  backgroundIndex?: number;\n  backgroundUrl: string;\n  animals: Animal[];\n  canvasWidth: number;\n  canvasHeight: number;\n  tolerance: number;\n}\n\ninterface UpsideDownCaptchaProps {\n  challengeData: UpsideDownChallengeData;\n  onSolve: (solution: { clicks: Array<{ x: number; y: number }> }) => void;\n  disabled?: boolean;\n}\n\nexport default function UpsideDownCaptcha({ challengeData, onSolve, disabled }: UpsideDownCaptchaProps) {\n  const canvasRef = useRef<HTMLCanvasElement>(null);\n  const [clicks, setClicks] = useState<Array<{ x: number; y: number }>>([]);\n  const [isLoading, setIsLoading] = useState(true);\n  const [imagesLoaded, setImagesLoaded] = useState(false);\n  const imageCache = useRef<Map<string, HTMLImageElement>>(new Map());\n\n  useEffect(() => {\n    const loadImages = async () => {\n      setIsLoading(true);\n      const promises: Promise<void>[] = [];\n\n      const bgImage = new Image();\n      bgImage.crossOrigin = 'anonymous';\n      promises.push(\n        new Promise((resolve, reject) => {\n          bgImage.onload = () => {\n            imageCache.current.set('background', bgImage);\n            resolve();\n          };\n          bgImage.onerror = reject;\n          bgImage.src = challengeData.backgroundUrl;\n        })\n      );\n\n      challengeData.animals.forEach(animal => {\n        if (!imageCache.current.has(animal.path)) {\n          const img = new Image();\n          img.crossOrigin = 'anonymous';\n          promises.push(\n            new Promise((resolve, reject) => {\n              img.onload = () => {\n                imageCache.current.set(animal.path, img);\n                resolve();\n              };\n              img.onerror = (error) => {\n                console.error(`Failed to load image: ${animal.path}`, error);\n                reject(error);\n              };\n              img.src = animal.path;\n            })\n          );\n        }\n      });\n\n      try {\n        await Promise.all(promises);\n        setImagesLoaded(true);\n      } catch (error) {\n        console.error('Failed to load images:', error);\n      } finally {\n        setIsLoading(false);\n      }\n    };\n\n    loadImages();\n  }, [challengeData]);\n\n  useEffect(() => {\n    if (!imagesLoaded || !canvasRef.current) return;\n\n    const canvas = canvasRef.current;\n    const ctx = canvas.getContext('2d');\n    if (!ctx) return;\n\n    ctx.clearRect(0, 0, canvas.width, canvas.height);\n\n    const bgImage = imageCache.current.get('background');\n    if (bgImage) {\n      ctx.drawImage(bgImage, 0, 0, canvas.width, canvas.height);\n    }\n\n    challengeData.animals.forEach(animal => {\n      const img = imageCache.current.get(animal.path);\n      if (!img) return;\n\n      const size = 80;\n      \n      const rotation = animal.rotation !== undefined \n        ? animal.rotation \n        : animal.orientation === 'upside_down' \n          ? 180 \n          : 0;\n\n      ctx.save();\n      ctx.translate(animal.x, animal.y);\n      ctx.rotate((rotation * Math.PI) / 180);\n      ctx.drawImage(img, -size / 2, -size / 2, size, size);\n      ctx.restore();\n    });\n\n    clicks.forEach((click, index) => {\n      ctx.fillStyle = 'rgba(255, 50, 50, 0.3)';\n      ctx.strokeStyle = 'rgba(255, 0, 0, 0.8)';\n      ctx.lineWidth = 2;\n      ctx.beginPath();\n      ctx.arc(click.x, click.y, 20, 0, 2 * Math.PI);\n      ctx.fill();\n      ctx.stroke();\n\n      ctx.fillStyle = '#fff';\n      ctx.font = 'bold 16px sans-serif';\n      ctx.textAlign = 'center';\n      ctx.textBaseline = 'middle';\n      ctx.fillText((index + 1).toString(), click.x, click.y);\n    });\n  }, [challengeData, clicks, imagesLoaded]);\n\n  const handleCanvasClick = (e: React.MouseEvent<HTMLCanvasElement>) => {\n    if (disabled) return;\n\n    const canvas = canvasRef.current;\n    if (!canvas) return;\n\n    const rect = canvas.getBoundingClientRect();\n    const scaleX = canvas.width / rect.width;\n    const scaleY = canvas.height / rect.height;\n\n    const x = Math.round((e.clientX - rect.left) * scaleX);\n    const y = Math.round((e.clientY - rect.top) * scaleY);\n\n    setClicks(prev => [...prev, { x, y }]);\n  };\n\n  const handleReset = () => {\n    setClicks([]);\n  };\n\n  const handleSubmit = () => {\n    onSolve({ clicks });\n  };\n\n  return (\n    <Card className=\"max-w-2xl\">\n      <CardContent className=\"p-3 sm:p-6 space-y-3 sm:space-y-4\">\n        <div className=\"space-y-1 sm:space-y-2\">\n          <h3 className=\"text-base sm:text-lg font-semibold\" data-testid=\"text-title\">\n            Click on the upside-down image\n          </h3>\n          <p className=\"text-xs sm:text-sm text-muted-foreground\" data-testid=\"text-description\">\n            Click on all animals that are upside-down. You can click multiple times if needed.\n          </p>\n        </div>\n\n        <div className=\"relative\">\n          {isLoading && (\n            <div className=\"absolute inset-0 flex items-center justify-center bg-muted/50 rounded-md z-10\">\n              <div className=\"flex items-center gap-2\">\n                <div className=\"h-5 w-5 sm:h-6 sm:w-6 animate-spin rounded-full border-2 sm:border-3 border-primary border-t-transparent\" />\n                <span className=\"text-xs sm:text-sm font-medium\">Loading challenge...</span>\n              </div>\n            </div>\n          )}\n          <canvas\n            ref={canvasRef}\n            width={challengeData.canvasWidth}\n            height={challengeData.canvasHeight}\n            onClick={handleCanvasClick}\n            className=\"w-full border rounded-md cursor-crosshair bg-muted\"\n            style={{ maxWidth: `${challengeData.canvasWidth}px`, aspectRatio: `${challengeData.canvasWidth}/${challengeData.canvasHeight}` }}\n            data-testid=\"canvas-upside-down\"\n          />\n        </div>\n\n        <div className=\"flex items-center justify-between gap-2\">\n          <div className=\"text-xs sm:text-sm text-muted-foreground\" data-testid=\"text-clicks-count\">\n            Clicks: {clicks.length}\n          </div>\n          <div className=\"flex gap-2\">\n            <Button\n              type=\"button\"\n              variant=\"outline\"\n              size=\"sm\"\n              onClick={handleReset}\n              disabled={disabled || clicks.length === 0}\n              data-testid=\"button-reset\"\n              className=\"text-xs sm:text-sm\"\n            >\n              <RotateCcw className=\"h-3 w-3 sm:h-4 sm:w-4 mr-1\" />\n              <span className=\"hidden sm:inline\">Reset</span>\n              <span className=\"sm:hidden\">‚Üª</span>\n            </Button>\n            <Button\n              type=\"button\"\n              size=\"sm\"\n              onClick={handleSubmit}\n              disabled={disabled || clicks.length === 0}\n              data-testid=\"button-submit\"\n              className=\"text-xs sm:text-sm\"\n            >\n              Verify\n            </Button>\n          </div>\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n","size_bytes":7228},"server/encryption.ts":{"content":"import crypto from \"crypto\";\n\n/**\n * Encryption module for end-to-end challenge/solution protection\n * \n * Architecture:\n * 1. ECDH handshake establishes per-session master key\n * 2. HKDF derives per-challenge child keys from master\n * 3. AES-256-GCM encrypts/decrypts payloads with unique IVs\n * \n * Security features:\n * - P-256 (secp256r1) ECDH for Web Crypto API compatibility\n * - HKDF with context binding prevents key reuse\n * - GCM provides authenticated encryption\n * - Unique 96-bit IVs per payload prevent nonce reuse\n * - Constant-time operations where applicable\n */\n\nexport interface EncryptedPayload {\n  ciphertext: string; // base64\n  iv: string; // base64\n  tag: string; // base64 (GCM auth tag)\n}\n\nexport interface HandshakeResponse {\n  serverPublicKey: string; // base64\n  timestamp: number;\n  expiresIn: number; // seconds\n  nonce: string; // server nonce for replay protection\n}\n\nexport interface SessionKey {\n  masterKey: Buffer;\n  serverPublicKey: Buffer;\n  clientPublicKey: Buffer;\n  timestamp: number;\n  expiresAt: number;\n  nonce: string;\n}\n\n/**\n * Generate server ephemeral ECDH key pair\n * Uses P-256 (secp256r1) for Web Crypto API compatibility\n * Note: P-256 is widely supported, NIST-standardized, and provides ~128-bit security\n */\nexport function generateServerKeyPair(): {\n  publicKey: Buffer;\n  privateKey: Buffer;\n} {\n  const { publicKey, privateKey } = crypto.generateKeyPairSync(\"ec\", {\n    namedCurve: \"prime256v1\", // P-256 / secp256r1\n    publicKeyEncoding: { type: \"spki\", format: \"der\" },\n    privateKeyEncoding: { type: \"pkcs8\", format: \"der\" },\n  });\n\n  // Convert SPKI public key to raw format (65 bytes for uncompressed P-256)\n  // Client expects raw format from Web Crypto API\n  const publicKeyObj = crypto.createPublicKey({\n    key: publicKey,\n    format: 'der',\n    type: 'spki'\n  });\n  \n  const publicKeyRaw = publicKeyObj.export({ format: 'der', type: 'spki' });\n  // Extract raw coordinates from SPKI format\n  // For P-256: SPKI header is variable, but raw key is always last 65 bytes\n  const rawPublicKey = publicKeyRaw.slice(-65);\n\n  return {\n    publicKey: Buffer.from(rawPublicKey),\n    privateKey: Buffer.from(privateKey),\n  };\n}\n\n/**\n * Derive shared secret using ECDH\n * @param serverPrivateKey Server's ephemeral private key\n * @param clientPublicKey Client's ephemeral public key\n * @returns Shared secret (raw ECDH output)\n */\nexport function deriveSharedSecret(\n  serverPrivateKey: Buffer,\n  clientPublicKey: Buffer\n): Buffer {\n  const serverKey = crypto.createPrivateKey({\n    key: serverPrivateKey,\n    format: \"der\",\n    type: \"pkcs8\",\n  });\n\n  // Client sends public key in 'raw' format (65 bytes for P-256)\n  // Need to convert to proper format for Node.js crypto\n  const clientKey = crypto.createPublicKey({\n    key: {\n      crv: 'P-256',\n      x: clientPublicKey.slice(1, 33).toString('base64url'),\n      y: clientPublicKey.slice(33, 65).toString('base64url'),\n      kty: 'EC'\n    },\n    format: 'jwk'\n  });\n\n  const sharedSecret = crypto.diffieHellman({\n    privateKey: serverKey,\n    publicKey: clientKey,\n  });\n\n  return Buffer.from(sharedSecret);\n}\n\n/**\n * Derive master session key from ECDH shared secret using HKDF\n * Binds server public key + nonce to prevent small-subgroup attacks\n * \n * @param sharedSecret Raw ECDH output\n * @param serverPublicKey Server's public key for binding\n * @param serverNonce Server nonce for freshness\n * @param info Context string for key separation\n * @returns 32-byte master key for AES-256\n */\nexport function deriveMasterKey(\n  sharedSecret: Buffer,\n  serverPublicKey: Buffer,\n  serverNonce: string,\n  info: string = \"captcha-session-v1\"\n): Buffer {\n  // Salt includes server public key + nonce for binding\n  const salt = Buffer.concat([\n    serverPublicKey,\n    Buffer.from(serverNonce, \"utf-8\"),\n  ]);\n\n  const derivedKey = crypto.hkdfSync(\n    \"sha256\",\n    sharedSecret,\n    salt,\n    Buffer.from(info, \"utf-8\"),\n    32 // 256 bits for AES-256\n  );\n\n  return Buffer.from(derivedKey);\n}\n\n/**\n * Derive per-challenge child key from master session key using HKDF\n * Prevents key reuse across different challenges\n * \n * @param masterKey Master session key\n * @param challengeId Unique challenge identifier (will be hashed if too long)\n * @param direction \"encrypt\", \"decrypt\", or \"metadata\" for different key derivations\n * @returns 32-byte child key for this specific challenge+direction\n */\nexport function deriveChildKey(\n  masterKey: Buffer,\n  challengeId: string,\n  direction: \"encrypt\" | \"decrypt\" | \"metadata\" | \"config\"\n): Buffer {\n  // Hash the challenge ID to ensure it's always short (64 hex chars)\n  // This prevents HKDF info parameter from exceeding 1024 byte limit\n  const challengeIdHash = crypto\n    .createHash(\"sha256\")\n    .update(challengeId)\n    .digest(\"hex\");\n  \n  const info = `captcha-challenge-v1:${direction}:${challengeIdHash}`;\n\n  const derivedKey = crypto.hkdfSync(\n    \"sha256\",\n    masterKey,\n    Buffer.alloc(0), // No salt needed for child derivation\n    Buffer.from(info, \"utf-8\"),\n    32\n  );\n\n  return Buffer.from(derivedKey);\n}\n\n/**\n * Encrypt payload using AES-256-GCM\n * \n * @param plaintext Data to encrypt\n * @param key 32-byte encryption key\n * @param additionalData Optional authenticated data (not encrypted but verified)\n * @returns Encrypted payload with IV and auth tag\n */\nexport function encryptPayload(\n  plaintext: string | Buffer,\n  key: Buffer,\n  additionalData?: string\n): EncryptedPayload {\n  // Generate random 96-bit IV (12 bytes) - GCM recommended size\n  const iv = crypto.randomBytes(12);\n\n  const cipher = crypto.createCipheriv(\"aes-256-gcm\", key, iv);\n\n  // Add authenticated data if provided\n  if (additionalData) {\n    cipher.setAAD(Buffer.from(additionalData, \"utf-8\"));\n  }\n\n  const plaintextBuffer =\n    typeof plaintext === \"string\" ? Buffer.from(plaintext, \"utf-8\") : plaintext;\n\n  const ciphertext = Buffer.concat([\n    cipher.update(plaintextBuffer),\n    cipher.final(),\n  ]);\n\n  const tag = cipher.getAuthTag();\n\n  return {\n    ciphertext: ciphertext.toString(\"base64\"),\n    iv: iv.toString(\"base64\"),\n    tag: tag.toString(\"base64\"),\n  };\n}\n\n/**\n * Decrypt payload using AES-256-GCM\n * \n * @param encrypted Encrypted payload with IV and tag\n * @param key 32-byte decryption key\n * @param additionalData Optional authenticated data (must match encryption)\n * @returns Decrypted plaintext or null if authentication fails\n */\nexport function decryptPayload(\n  encrypted: EncryptedPayload,\n  key: Buffer,\n  additionalData?: string\n): Buffer | null {\n  try {\n    const iv = Buffer.from(encrypted.iv, \"base64\");\n    const ciphertext = Buffer.from(encrypted.ciphertext, \"base64\");\n    const tag = Buffer.from(encrypted.tag, \"base64\");\n\n    const decipher = crypto.createDecipheriv(\"aes-256-gcm\", key, iv);\n\n    // Set auth tag for verification\n    decipher.setAuthTag(tag);\n\n    // Add authenticated data if provided\n    if (additionalData) {\n      decipher.setAAD(Buffer.from(additionalData, \"utf-8\"));\n    }\n\n    const plaintext = Buffer.concat([\n      decipher.update(ciphertext),\n      decipher.final(),\n    ]);\n\n    return plaintext;\n  } catch (error) {\n    // Authentication failed or invalid ciphertext\n    console.error(\"[ENCRYPTION] Decryption failed:\", error);\n    return null;\n  }\n}\n\n/**\n * Generate HMAC signature for handshake transcript\n * Prevents downgrade and replay attacks\n * \n * @param serverPublicKey Server's ephemeral public key\n * @param clientPublicKey Client's ephemeral public key\n * @param apiPrivateKey API secret key for binding\n * @param timestamp Handshake timestamp\n * @returns HMAC signature\n */\nexport function signHandshakeTranscript(\n  serverPublicKey: Buffer,\n  clientPublicKey: Buffer,\n  apiPrivateKey: string,\n  timestamp: number\n): string {\n  const hmac = crypto.createHmac(\"sha256\", apiPrivateKey);\n\n  hmac.update(serverPublicKey);\n  hmac.update(clientPublicKey);\n  hmac.update(Buffer.from(timestamp.toString(), \"utf-8\"));\n\n  return hmac.digest(\"hex\");\n}\n\n/**\n * Verify handshake transcript signature\n * \n * @param serverPublicKey Server's ephemeral public key\n * @param clientPublicKey Client's ephemeral public key\n * @param apiPrivateKey API secret key\n * @param timestamp Handshake timestamp\n * @param providedSignature Signature to verify\n * @returns True if signature is valid\n */\nexport function verifyHandshakeTranscript(\n  serverPublicKey: Buffer,\n  clientPublicKey: Buffer,\n  apiPrivateKey: string,\n  timestamp: number,\n  providedSignature: string\n): boolean {\n  const expectedSignature = signHandshakeTranscript(\n    serverPublicKey,\n    clientPublicKey,\n    apiPrivateKey,\n    timestamp\n  );\n\n  try {\n    return crypto.timingSafeEqual(\n      Buffer.from(expectedSignature, \"hex\"),\n      Buffer.from(providedSignature, \"hex\")\n    );\n  } catch {\n    return false;\n  }\n}\n\n/**\n * Encrypt challenge data for transmission to client\n * Uses per-challenge child key derived from session master key\n */\nexport function encryptChallengeData(\n  challengeData: any,\n  sessionKey: SessionKey,\n  challengeId: string\n): EncryptedPayload {\n  const childKey = deriveChildKey(sessionKey.masterKey, challengeId, \"encrypt\");\n  const plaintext = JSON.stringify(challengeData);\n\n  return encryptPayload(plaintext, childKey, challengeId);\n}\n\n/**\n * Encrypt security config to prevent client-side manipulation\n * Uses per-challenge child key with 'config' direction for key separation\n */\nexport function encryptSecurityConfig(\n  securityConfig: any,\n  sessionKey: SessionKey,\n  challengeId: string\n): EncryptedPayload {\n  const childKey = deriveChildKey(sessionKey.masterKey, challengeId, \"config\");\n  const plaintext = JSON.stringify(securityConfig);\n\n  return encryptPayload(plaintext, childKey, challengeId);\n}\n\n/**\n * Decrypt solution data from client\n * Uses per-challenge child key derived from session master key\n */\nexport function decryptSolutionData(\n  encrypted: EncryptedPayload,\n  sessionKey: SessionKey,\n  challengeId: string\n): any | null {\n  const childKey = deriveChildKey(sessionKey.masterKey, challengeId, \"decrypt\");\n  const plaintext = decryptPayload(encrypted, childKey, challengeId);\n\n  if (!plaintext) {\n    return null;\n  }\n\n  try {\n    return JSON.parse(plaintext.toString(\"utf-8\"));\n  } catch {\n    return null;\n  }\n}\n\n/**\n * Decrypt verification metadata from client (clientDetections, fingerprint, behavioral data)\n * Uses per-challenge child key derived from session master key with 'metadata' direction\n */\nexport function decryptVerificationMetadata(\n  encrypted: EncryptedPayload,\n  sessionKey: SessionKey,\n  challengeId: string\n): any | null {\n  const childKey = deriveChildKey(sessionKey.masterKey, challengeId, \"metadata\");\n  const plaintext = decryptPayload(encrypted, childKey, challengeId);\n\n  if (!plaintext) {\n    return null;\n  }\n\n  try {\n    return JSON.parse(plaintext.toString(\"utf-8\"));\n  } catch {\n    return null;\n  }\n}\n","size_bytes":10882},"client/src/components/ui/context-menu.tsx":{"content":"import * as React from \"react\"\nimport * as ContextMenuPrimitive from \"@radix-ui/react-context-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ContextMenu = ContextMenuPrimitive.Root\n\nconst ContextMenuTrigger = ContextMenuPrimitive.Trigger\n\nconst ContextMenuGroup = ContextMenuPrimitive.Group\n\nconst ContextMenuPortal = ContextMenuPrimitive.Portal\n\nconst ContextMenuSub = ContextMenuPrimitive.Sub\n\nconst ContextMenuRadioGroup = ContextMenuPrimitive.RadioGroup\n\nconst ContextMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <ContextMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </ContextMenuPrimitive.SubTrigger>\n))\nContextMenuSubTrigger.displayName = ContextMenuPrimitive.SubTrigger.displayName\n\nconst ContextMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuSubContent.displayName = ContextMenuPrimitive.SubContent.displayName\n\nconst ContextMenuContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Portal>\n    <ContextMenuPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"z-50 max-h-[--radix-context-menu-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md animate-in fade-in-80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </ContextMenuPrimitive.Portal>\n))\nContextMenuContent.displayName = ContextMenuPrimitive.Content.displayName\n\nconst ContextMenuItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuItem.displayName = ContextMenuPrimitive.Item.displayName\n\nconst ContextMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <ContextMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.CheckboxItem>\n))\nContextMenuCheckboxItem.displayName =\n  ContextMenuPrimitive.CheckboxItem.displayName\n\nconst ContextMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <ContextMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.RadioItem>\n))\nContextMenuRadioItem.displayName = ContextMenuPrimitive.RadioItem.displayName\n\nconst ContextMenuLabel = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold text-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuLabel.displayName = ContextMenuPrimitive.Label.displayName\n\nconst ContextMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nContextMenuSeparator.displayName = ContextMenuPrimitive.Separator.displayName\n\nconst ContextMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nContextMenuShortcut.displayName = \"ContextMenuShortcut\"\n\nexport {\n  ContextMenu,\n  ContextMenuTrigger,\n  ContextMenuContent,\n  ContextMenuItem,\n  ContextMenuCheckboxItem,\n  ContextMenuRadioItem,\n  ContextMenuLabel,\n  ContextMenuSeparator,\n  ContextMenuShortcut,\n  ContextMenuGroup,\n  ContextMenuPortal,\n  ContextMenuSub,\n  ContextMenuSubContent,\n  ContextMenuSubTrigger,\n  ContextMenuRadioGroup,\n}\n","size_bytes":7428},"client/src/lib/utils.ts":{"content":"import { clsx, type ClassValue } from \"clsx\"\nimport { twMerge } from \"tailwind-merge\"\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n","size_bytes":166},"client/src/main.tsx":{"content":"import { createRoot } from \"react-dom/client\";\nimport App from \"./App\";\nimport \"./index.css\";\n\ncreateRoot(document.getElementById(\"root\")!).render(<App />);\n","size_bytes":157},"server/public/captcha-widget.js":{"content":"/**\n * ProofCaptcha Widget - Standalone JavaScript Library\n * Similar to reCAPTCHA v2 API\n */\n\n(function(window) {\n  'use strict';\n\n  // Detect API base URL from the script tag source\n  function getApiBase() {\n    // Try to find the script tag that loaded this file\n    const scripts = document.getElementsByTagName('script');\n    for (let i = 0; i < scripts.length; i++) {\n      const src = scripts[i].src;\n      if (src && src.includes('/api/captcha.js')) {\n        // Extract origin from script src\n        try {\n          const url = new URL(src);\n          return url.origin;\n        } catch (e) {\n          console.error('ProofCaptcha: Failed to parse script URL', e);\n        }\n      }\n    }\n    \n    // Fallback to current origin (for self-hosted scenarios)\n    return window.location.origin;\n  }\n\n  const API_BASE = getApiBase();\n  const WIDGET_CLASS = 'proof-captcha';\n  const widgets = new Map();\n  let widgetCounter = 0;\n\n  // Utility function to detect automation\n  function detectClientAutomation() {\n    const detections = {\n      webdriver: navigator.webdriver === true,\n      headless: /headless/i.test(navigator.userAgent),\n      phantom: !!window.callPhantom || !!window._phantom,\n      selenium: !!window.document.$cdc_asdjflasutopfhvcZLmcfl_,\n      chromeDriver: !!window.document.documentElement.getAttribute('webdriver'),\n      plugins: navigator.plugins.length === 0,\n      languages: navigator.languages.length === 0,\n      platform: /Linux/.test(navigator.platform) && !/Android/.test(navigator.userAgent),\n    };\n    return detections;\n  }\n\n  // Proof of Work Solver\n  async function solveProofOfWork(challenge, onProgress) {\n    const { prefix, difficulty } = challenge;\n    let nonce = 0;\n    const maxAttempts = 1000000;\n\n    return new Promise((resolve, reject) => {\n      const worker = () => {\n        const batchSize = 1000;\n        \n        for (let i = 0; i < batchSize && nonce < maxAttempts; i++, nonce++) {\n          const solution = `${prefix}:${nonce}`;\n          const hash = simpleHash(solution);\n          \n          if (onProgress && nonce % 100 === 0) {\n            onProgress(hash, nonce);\n          }\n          \n          if (hash.startsWith('0'.repeat(difficulty))) {\n            resolve(solution);\n            return;\n          }\n        }\n        \n        if (nonce >= maxAttempts) {\n          reject(new Error('Max attempts reached'));\n          return;\n        }\n        \n        setTimeout(worker, 0);\n      };\n      \n      worker();\n    });\n  }\n\n  // Simple hash function (for demo - in production use crypto API)\n  function simpleHash(str) {\n    let hash = 0;\n    for (let i = 0; i < str.length; i++) {\n      const char = str.charCodeAt(i);\n      hash = ((hash << 5) - hash) + char;\n      hash = hash & hash;\n    }\n    return Math.abs(hash).toString(16).padStart(8, '0');\n  }\n\n  // Create widget HTML structure\n  function createWidgetHTML() {\n    const html = `\n      <div class=\"proof-captcha-container\" style=\"\n        border: 2px solid #d3d3d3;\n        border-radius: 8px;\n        padding: 12px;\n        background: linear-gradient(to right, #f8f9fa, #f1f3f5);\n        box-shadow: 0 2px 4px rgba(0,0,0,0.1);\n        max-width: 320px;\n        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;\n      \">\n        <div class=\"proof-captcha-main\" style=\"display: flex; align-items: center; gap: 12px;\">\n          <div class=\"proof-captcha-checkbox\" style=\"\n            width: 32px;\n            height: 32px;\n            border: 2px solid #9ca3af;\n            border-radius: 4px;\n            background: white;\n            cursor: pointer;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            transition: all 0.2s;\n          \" role=\"button\" tabindex=\"0\">\n            <span class=\"proof-captcha-checkmark\" style=\"display: none; color: #10b981; font-size: 20px;\">‚úì</span>\n            <span class=\"proof-captcha-loader\" style=\"display: none; border: 2px solid #f3f3f3; border-top: 2px solid #3b82f6; border-radius: 50%; width: 16px; height: 16px; animation: spin 1s linear infinite;\"></span>\n            <svg class=\"proof-captcha-warning-icon\" style=\"display: none; width: 20px; height: 20px; color: #ef4444;\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n              <path fill-rule=\"evenodd\" d=\"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z\" clip-rule=\"evenodd\"/>\n            </svg>\n            <svg class=\"proof-captcha-blocked-icon\" style=\"display: none; width: 20px; height: 20px; color: #f59e0b;\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n              <path fill-rule=\"evenodd\" d=\"M13.477 14.89A6 6 0 015.11 6.524l8.367 8.368zm1.414-1.414L6.524 5.11a6 6 0 018.367 8.367zM18 10a8 8 0 11-16 0 8 8 0 0116 0z\" clip-rule=\"evenodd\"/>\n            </svg>\n          </div>\n          <div class=\"proof-captcha-text\" style=\"flex: 1;\">\n            <span class=\"proof-captcha-label\" style=\"font-size: 14px; color: #374151;\">I'm not a robot</span>\n            <span class=\"proof-captcha-success\" style=\"display: none; font-size: 14px; color: #10b981; font-weight: 500;\">Verified!</span>\n            <div class=\"proof-captcha-error\" style=\"display: none;\">\n              <div style=\"display: flex; align-items: flex-start; gap: 6px; margin-top: 4px;\">\n                <svg style=\"width: 14px; height: 14px; color: #ef4444; flex-shrink: 0; margin-top: 2px;\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n                  <path fill-rule=\"evenodd\" d=\"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z\" clip-rule=\"evenodd\"/>\n                </svg>\n                <span class=\"proof-captcha-error-text\" style=\"font-size: 12px; color: #ef4444; line-height: 1.4;\"></span>\n              </div>\n            </div>\n            <div class=\"proof-captcha-blocked\" style=\"display: none;\">\n              <div style=\"display: flex; align-items: flex-start; gap: 6px; margin-top: 4px;\">\n                <svg style=\"width: 14px; height: 14px; color: #f59e0b; flex-shrink: 0; margin-top: 2px;\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n                  <path fill-rule=\"evenodd\" d=\"M13.477 14.89A6 6 0 015.11 6.524l8.367 8.368zm1.414-1.414L6.524 5.11a6 6 0 018.367 8.367zM18 10a8 8 0 11-16 0 8 8 0 0116 0z\" clip-rule=\"evenodd\"/>\n                </svg>\n                <span class=\"proof-captcha-blocked-text\" style=\"font-size: 12px; color: #f59e0b; line-height: 1.4;\"></span>\n              </div>\n            </div>\n          </div>\n        </div>\n        <div class=\"proof-captcha-overlay\" style=\"display: none; margin-top: 12px; padding: 16px; background: white; border-radius: 6px; border: 1px solid #e5e7eb;\">\n          <div class=\"proof-captcha-overlay-content\"></div>\n        </div>\n        <div class=\"proof-captcha-footer\" style=\"margin-top: 8px; display: flex; align-items: center; gap: 4px; font-size: 10px; color: #9ca3af;\">\n          <svg style=\"width: 12px; height: 12px;\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n            <path fill-rule=\"evenodd\" d=\"M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z\" clip-rule=\"evenodd\"/>\n          </svg>\n          <span>ProofCaptcha</span>\n        </div>\n      </div>\n      <style>\n        @keyframes spin {\n          0% { transform: rotate(0deg); }\n          100% { transform: rotate(360deg); }\n        }\n      </style>\n    `;\n    return html;\n  }\n\n  // Widget class\n  class ProofCaptchaWidget {\n    constructor(element, options) {\n      this.element = element;\n      this.options = {\n        sitekey: options.sitekey || element.dataset.sitekey,\n        callback: options.callback || element.dataset.callback,\n        errorCallback: options['error-callback'] || element.dataset.errorCallback,\n        expiredCallback: options['expired-callback'] || element.dataset.expiredCallback,\n        type: options.type || element.dataset.type || 'random',\n        theme: options.theme || element.dataset.theme || 'light',\n      };\n\n      this.state = {\n        status: 'idle', // idle, loading, solving, success, error, blocked\n        token: null,\n        challenge: null,\n        expiresAt: null,\n      };\n\n      this.render();\n      this.attachEventListeners();\n    }\n\n    render() {\n      this.element.innerHTML = createWidgetHTML();\n      this.elements = {\n        checkbox: this.element.querySelector('.proof-captcha-checkbox'),\n        checkmark: this.element.querySelector('.proof-captcha-checkmark'),\n        loader: this.element.querySelector('.proof-captcha-loader'),\n        warningIcon: this.element.querySelector('.proof-captcha-warning-icon'),\n        blockedIcon: this.element.querySelector('.proof-captcha-blocked-icon'),\n        label: this.element.querySelector('.proof-captcha-label'),\n        success: this.element.querySelector('.proof-captcha-success'),\n        error: this.element.querySelector('.proof-captcha-error'),\n        errorText: this.element.querySelector('.proof-captcha-error-text'),\n        blocked: this.element.querySelector('.proof-captcha-blocked'),\n        blockedText: this.element.querySelector('.proof-captcha-blocked-text'),\n        overlay: this.element.querySelector('.proof-captcha-overlay'),\n        overlayContent: this.element.querySelector('.proof-captcha-overlay-content'),\n      };\n    }\n\n    attachEventListeners() {\n      this.elements.checkbox.addEventListener('click', () => this.handleCheckboxClick());\n      this.elements.checkbox.addEventListener('keypress', (e) => {\n        if (e.key === 'Enter' || e.key === ' ') {\n          e.preventDefault();\n          this.handleCheckboxClick();\n        }\n      });\n    }\n\n    async handleCheckboxClick() {\n      if (this.state.status !== 'idle' && this.state.status !== 'error') return;\n\n      // Validate sitekey\n      if (!this.options.sitekey) {\n        this.setState('error');\n        this.showError('Invalid sitekey: Sitekey is required');\n        this.triggerCallback('errorCallback', 'Invalid sitekey');\n        return;\n      }\n\n      this.setState('loading');\n      this.showLoader();\n\n      try {\n        const clientDetections = detectClientAutomation();\n        \n        const response = await fetch(`${API_BASE}/api/captcha/challenge`, {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify({ \n            publicKey: this.options.sitekey, \n            type: this.options.type,\n            clientDetections \n          }),\n          credentials: 'include',\n        });\n\n        const data = await response.json();\n\n        if (!response.ok) {\n          if (response.status === 429 && data.error === 'IP blocked') {\n            this.handleBlocked(data);\n            return;\n          }\n          \n          // Handle specific error cases\n          let errorMessage = data.message || data.error || 'Failed to generate challenge';\n          \n          // Check for invalid sitekey\n          if (response.status === 401 || response.status === 404 || errorMessage.toLowerCase().includes('invalid') || errorMessage.toLowerCase().includes('not found')) {\n            errorMessage = 'Invalid sitekey: ' + errorMessage;\n          }\n          \n          throw new Error(errorMessage);\n        }\n\n        this.state.challenge = data.challenge;\n        this.state.token = data.token;\n\n        // Auto-solve the challenge\n        await this.solveChallenge();\n\n      } catch (error) {\n        console.error('Challenge generation error:', error);\n        this.setState('error');\n        this.showError(error.message || 'Network error occurred');\n        this.triggerCallback('errorCallback', error.message);\n      }\n    }\n\n    async solveChallenge() {\n      this.setState('solving');\n\n      try {\n        const solution = await solveProofOfWork(\n          this.state.challenge,\n          (hash, attempts) => {\n            // Progress callback\n          }\n        );\n\n        const clientDetections = detectClientAutomation();\n\n        const response = await fetch(`${API_BASE}/api/captcha/verify`, {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify({\n            token: this.state.token,\n            solution,\n            clientDetections,\n          }),\n          credentials: 'include',\n        });\n\n        const result = await response.json();\n\n        if (result.blocked && result.message) {\n          this.handleBlocked(result);\n          return;\n        }\n\n        if (result.success) {\n          this.setState('success');\n          this.showSuccess();\n          this.triggerCallback('callback', this.state.token);\n          \n          // Set expiration timer (typically 2 minutes)\n          this.state.expiresAt = Date.now() + (2 * 60 * 1000);\n          setTimeout(() => this.handleExpired(), 2 * 60 * 1000);\n        } else {\n          // Handle specific error cases\n          let errorMessage = result.error || result.message || 'Verification failed';\n          \n          // Check for token expired\n          if (errorMessage.toLowerCase().includes('expired') || errorMessage.toLowerCase().includes('invalid token')) {\n            errorMessage = 'Token expired: ' + errorMessage;\n          }\n          \n          throw new Error(errorMessage);\n        }\n      } catch (error) {\n        console.error('Verification error:', error);\n        this.setState('error');\n        this.showError(error.message || 'Verification failed');\n        this.triggerCallback('errorCallback', error.message);\n      }\n    }\n\n    handleBlocked(data) {\n      this.setState('blocked');\n      const message = data.message || 'IP blocked due to too many failed attempts';\n      this.showBlocked(message);\n      this.triggerCallback('errorCallback', message);\n    }\n\n    handleExpired() {\n      if (this.state.status === 'success') {\n        this.setState('error');\n        this.showError('Token expired: Please verify again');\n        this.triggerCallback('expiredCallback');\n      }\n    }\n\n    setState(status) {\n      this.state.status = status;\n    }\n\n    showLoader() {\n      this.elements.label.style.display = 'none';\n      this.elements.checkmark.style.display = 'none';\n      this.elements.warningIcon.style.display = 'none';\n      this.elements.blockedIcon.style.display = 'none';\n      this.elements.loader.style.display = 'block';\n      this.elements.success.style.display = 'none';\n      this.elements.error.style.display = 'none';\n      this.elements.blocked.style.display = 'none';\n      this.elements.checkbox.style.borderColor = '#9ca3af';\n      this.elements.checkbox.style.background = 'white';\n      this.elements.checkbox.style.cursor = 'pointer';\n    }\n\n    showSuccess() {\n      this.elements.label.style.display = 'none';\n      this.elements.checkmark.style.display = 'block';\n      this.elements.warningIcon.style.display = 'none';\n      this.elements.blockedIcon.style.display = 'none';\n      this.elements.loader.style.display = 'none';\n      this.elements.success.style.display = 'block';\n      this.elements.error.style.display = 'none';\n      this.elements.blocked.style.display = 'none';\n      this.elements.checkbox.style.borderColor = '#10b981';\n      this.elements.checkbox.style.background = '#f0fdf4';\n    }\n\n    showError(message) {\n      this.elements.label.style.display = 'block';\n      this.elements.checkmark.style.display = 'none';\n      this.elements.warningIcon.style.display = 'block';\n      this.elements.blockedIcon.style.display = 'none';\n      this.elements.loader.style.display = 'none';\n      this.elements.success.style.display = 'none';\n      this.elements.error.style.display = 'block';\n      this.elements.errorText.textContent = message;\n      this.elements.blocked.style.display = 'none';\n      this.elements.checkbox.style.borderColor = '#ef4444';\n      this.elements.checkbox.style.background = '#fef2f2';\n      this.elements.checkbox.style.cursor = 'pointer';\n    }\n\n    showBlocked(message) {\n      this.elements.label.style.display = 'none';\n      this.elements.checkmark.style.display = 'none';\n      this.elements.warningIcon.style.display = 'none';\n      this.elements.blockedIcon.style.display = 'block';\n      this.elements.loader.style.display = 'none';\n      this.elements.success.style.display = 'none';\n      this.elements.error.style.display = 'none';\n      this.elements.blocked.style.display = 'block';\n      this.elements.blockedText.textContent = message;\n      this.elements.checkbox.style.borderColor = '#f59e0b';\n      this.elements.checkbox.style.background = '#fffbeb';\n      this.elements.checkbox.style.cursor = 'not-allowed';\n    }\n\n    triggerCallback(callbackName, value) {\n      const callbackFn = this.options[callbackName];\n      if (callbackFn) {\n        if (typeof callbackFn === 'string') {\n          // Call global function by name\n          if (typeof window[callbackFn] === 'function') {\n            window[callbackFn](value);\n          }\n        } else if (typeof callbackFn === 'function') {\n          callbackFn(value);\n        }\n      }\n    }\n\n    getResponse() {\n      return this.state.status === 'success' ? this.state.token : null;\n    }\n\n    reset() {\n      this.state = {\n        status: 'idle',\n        token: null,\n        challenge: null,\n        expiresAt: null,\n      };\n      \n      this.elements.label.style.display = 'block';\n      this.elements.checkmark.style.display = 'none';\n      this.elements.warningIcon.style.display = 'none';\n      this.elements.blockedIcon.style.display = 'none';\n      this.elements.loader.style.display = 'none';\n      this.elements.success.style.display = 'none';\n      this.elements.error.style.display = 'none';\n      this.elements.blocked.style.display = 'none';\n      this.elements.checkbox.style.borderColor = '#9ca3af';\n      this.elements.checkbox.style.background = 'white';\n      this.elements.checkbox.style.cursor = 'pointer';\n    }\n  }\n\n  // Global ProofCaptcha API object (similar to grecaptcha)\n  window.ProofCaptcha = {\n    /**\n     * Render a widget\n     * @param {string|HTMLElement} container - Element or element ID\n     * @param {object} parameters - Widget configuration\n     * @returns {number} Widget ID\n     */\n    render: function(container, parameters) {\n      const element = typeof container === 'string' \n        ? document.getElementById(container) \n        : container;\n\n      if (!element) {\n        console.error('ProofCaptcha: Container element not found');\n        return -1;\n      }\n\n      const widgetId = widgetCounter++;\n      const widget = new ProofCaptchaWidget(element, parameters || {});\n      widgets.set(widgetId, widget);\n\n      return widgetId;\n    },\n\n    /**\n     * Reset a widget\n     * @param {number} widgetId - Optional widget ID (resets first widget if not specified)\n     */\n    reset: function(widgetId) {\n      if (widgetId === undefined) {\n        // Reset first widget\n        const firstWidget = widgets.values().next().value;\n        if (firstWidget) firstWidget.reset();\n      } else {\n        const widget = widgets.get(widgetId);\n        if (widget) widget.reset();\n      }\n    },\n\n    /**\n     * Get response token from a widget\n     * @param {number} widgetId - Optional widget ID\n     * @returns {string|null} Response token\n     */\n    getResponse: function(widgetId) {\n      if (widgetId === undefined) {\n        const firstWidget = widgets.values().next().value;\n        return firstWidget ? firstWidget.getResponse() : null;\n      } else {\n        const widget = widgets.get(widgetId);\n        return widget ? widget.getResponse() : null;\n      }\n    },\n\n    /**\n     * Execute callback when API is ready\n     * @param {function} callback - Callback function\n     */\n    ready: function(callback) {\n      if (typeof callback === 'function') {\n        if (document.readyState === 'loading') {\n          document.addEventListener('DOMContentLoaded', callback);\n        } else {\n          callback();\n        }\n      }\n    },\n  };\n\n  // Auto-render widgets with class 'proof-captcha'\n  function autoRenderWidgets() {\n    const elements = document.querySelectorAll(`.${WIDGET_CLASS}`);\n    elements.forEach((element) => {\n      if (!element.dataset.widgetId) {\n        const widgetId = ProofCaptcha.render(element);\n        element.dataset.widgetId = widgetId;\n      }\n    });\n  }\n\n  // Auto-render on page load\n  if (document.readyState === 'loading') {\n    document.addEventListener('DOMContentLoaded', autoRenderWidgets);\n  } else {\n    autoRenderWidgets();\n  }\n\n  // Watch for dynamically added widgets\n  if (typeof MutationObserver !== 'undefined') {\n    const observer = new MutationObserver((mutations) => {\n      mutations.forEach((mutation) => {\n        mutation.addedNodes.forEach((node) => {\n          if (node.nodeType === 1) { // Element node\n            if (node.classList && node.classList.contains(WIDGET_CLASS)) {\n              if (!node.dataset.widgetId) {\n                const widgetId = ProofCaptcha.render(node);\n                node.dataset.widgetId = widgetId;\n              }\n            }\n            // Check children\n            const children = node.querySelectorAll && node.querySelectorAll(`.${WIDGET_CLASS}`);\n            if (children) {\n              children.forEach((child) => {\n                if (!child.dataset.widgetId) {\n                  const widgetId = ProofCaptcha.render(child);\n                  child.dataset.widgetId = widgetId;\n                }\n              });\n            }\n          }\n        });\n      });\n    });\n\n    observer.observe(document.body, { childList: true, subtree: true });\n  }\n\n})(window);\n","size_bytes":21835},"client/src/components/ui/chart.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as RechartsPrimitive from \"recharts\"\n\nimport { cn } from \"@/lib/utils\"\n\n// Format: { THEME_NAME: CSS_SELECTOR }\nconst THEMES = { light: \"\", dark: \".dark\" } as const\n\nexport type ChartConfig = {\n  [k in string]: {\n    label?: React.ReactNode\n    icon?: React.ComponentType\n  } & (\n    | { color?: string; theme?: never }\n    | { color?: never; theme: Record<keyof typeof THEMES, string> }\n  )\n}\n\ntype ChartContextProps = {\n  config: ChartConfig\n}\n\nconst ChartContext = React.createContext<ChartContextProps | null>(null)\n\nfunction useChart() {\n  const context = React.useContext(ChartContext)\n\n  if (!context) {\n    throw new Error(\"useChart must be used within a <ChartContainer />\")\n  }\n\n  return context\n}\n\nconst ChartContainer = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    config: ChartConfig\n    children: React.ComponentProps<\n      typeof RechartsPrimitive.ResponsiveContainer\n    >[\"children\"]\n  }\n>(({ id, className, children, config, ...props }, ref) => {\n  const uniqueId = React.useId()\n  const chartId = `chart-${id || uniqueId.replace(/:/g, \"\")}`\n\n  return (\n    <ChartContext.Provider value={{ config }}>\n      <div\n        data-chart={chartId}\n        ref={ref}\n        className={cn(\n          \"flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none\",\n          className\n        )}\n        {...props}\n      >\n        <ChartStyle id={chartId} config={config} />\n        <RechartsPrimitive.ResponsiveContainer>\n          {children}\n        </RechartsPrimitive.ResponsiveContainer>\n      </div>\n    </ChartContext.Provider>\n  )\n})\nChartContainer.displayName = \"Chart\"\n\nconst ChartStyle = ({ id, config }: { id: string; config: ChartConfig }) => {\n  const colorConfig = Object.entries(config).filter(\n    ([, config]) => config.theme || config.color\n  )\n\n  if (!colorConfig.length) {\n    return null\n  }\n\n  return (\n    <style\n      dangerouslySetInnerHTML={{\n        __html: Object.entries(THEMES)\n          .map(\n            ([theme, prefix]) => `\n${prefix} [data-chart=${id}] {\n${colorConfig\n  .map(([key, itemConfig]) => {\n    const color =\n      itemConfig.theme?.[theme as keyof typeof itemConfig.theme] ||\n      itemConfig.color\n    return color ? `  --color-${key}: ${color};` : null\n  })\n  .join(\"\\n\")}\n}\n`\n          )\n          .join(\"\\n\"),\n      }}\n    />\n  )\n}\n\nconst ChartTooltip = RechartsPrimitive.Tooltip\n\nconst ChartTooltipContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<typeof RechartsPrimitive.Tooltip> &\n    React.ComponentProps<\"div\"> & {\n      hideLabel?: boolean\n      hideIndicator?: boolean\n      indicator?: \"line\" | \"dot\" | \"dashed\"\n      nameKey?: string\n      labelKey?: string\n    }\n>(\n  (\n    {\n      active,\n      payload,\n      className,\n      indicator = \"dot\",\n      hideLabel = false,\n      hideIndicator = false,\n      label,\n      labelFormatter,\n      labelClassName,\n      formatter,\n      color,\n      nameKey,\n      labelKey,\n    },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    const tooltipLabel = React.useMemo(() => {\n      if (hideLabel || !payload?.length) {\n        return null\n      }\n\n      const [item] = payload\n      const key = `${labelKey || item?.dataKey || item?.name || \"value\"}`\n      const itemConfig = getPayloadConfigFromPayload(config, item, key)\n      const value =\n        !labelKey && typeof label === \"string\"\n          ? config[label as keyof typeof config]?.label || label\n          : itemConfig?.label\n\n      if (labelFormatter) {\n        return (\n          <div className={cn(\"font-medium\", labelClassName)}>\n            {labelFormatter(value, payload)}\n          </div>\n        )\n      }\n\n      if (!value) {\n        return null\n      }\n\n      return <div className={cn(\"font-medium\", labelClassName)}>{value}</div>\n    }, [\n      label,\n      labelFormatter,\n      payload,\n      hideLabel,\n      labelClassName,\n      config,\n      labelKey,\n    ])\n\n    if (!active || !payload?.length) {\n      return null\n    }\n\n    const nestLabel = payload.length === 1 && indicator !== \"dot\"\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl\",\n          className\n        )}\n      >\n        {!nestLabel ? tooltipLabel : null}\n        <div className=\"grid gap-1.5\">\n          {payload.map((item, index) => {\n            const key = `${nameKey || item.name || item.dataKey || \"value\"}`\n            const itemConfig = getPayloadConfigFromPayload(config, item, key)\n            const indicatorColor = color || item.payload.fill || item.color\n\n            return (\n              <div\n                key={item.dataKey}\n                className={cn(\n                  \"flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground\",\n                  indicator === \"dot\" && \"items-center\"\n                )}\n              >\n                {formatter && item?.value !== undefined && item.name ? (\n                  formatter(item.value, item.name, item, index, item.payload)\n                ) : (\n                  <>\n                    {itemConfig?.icon ? (\n                      <itemConfig.icon />\n                    ) : (\n                      !hideIndicator && (\n                        <div\n                          className={cn(\n                            \"shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]\",\n                            {\n                              \"h-2.5 w-2.5\": indicator === \"dot\",\n                              \"w-1\": indicator === \"line\",\n                              \"w-0 border-[1.5px] border-dashed bg-transparent\":\n                                indicator === \"dashed\",\n                              \"my-0.5\": nestLabel && indicator === \"dashed\",\n                            }\n                          )}\n                          style={\n                            {\n                              \"--color-bg\": indicatorColor,\n                              \"--color-border\": indicatorColor,\n                            } as React.CSSProperties\n                          }\n                        />\n                      )\n                    )}\n                    <div\n                      className={cn(\n                        \"flex flex-1 justify-between leading-none\",\n                        nestLabel ? \"items-end\" : \"items-center\"\n                      )}\n                    >\n                      <div className=\"grid gap-1.5\">\n                        {nestLabel ? tooltipLabel : null}\n                        <span className=\"text-muted-foreground\">\n                          {itemConfig?.label || item.name}\n                        </span>\n                      </div>\n                      {item.value && (\n                        <span className=\"font-mono font-medium tabular-nums text-foreground\">\n                          {item.value.toLocaleString()}\n                        </span>\n                      )}\n                    </div>\n                  </>\n                )}\n              </div>\n            )\n          })}\n        </div>\n      </div>\n    )\n  }\n)\nChartTooltipContent.displayName = \"ChartTooltip\"\n\nconst ChartLegend = RechartsPrimitive.Legend\n\nconst ChartLegendContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> &\n    Pick<RechartsPrimitive.LegendProps, \"payload\" | \"verticalAlign\"> & {\n      hideIcon?: boolean\n      nameKey?: string\n    }\n>(\n  (\n    { className, hideIcon = false, payload, verticalAlign = \"bottom\", nameKey },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    if (!payload?.length) {\n      return null\n    }\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"flex items-center justify-center gap-4\",\n          verticalAlign === \"top\" ? \"pb-3\" : \"pt-3\",\n          className\n        )}\n      >\n        {payload.map((item) => {\n          const key = `${nameKey || item.dataKey || \"value\"}`\n          const itemConfig = getPayloadConfigFromPayload(config, item, key)\n\n          return (\n            <div\n              key={item.value}\n              className={cn(\n                \"flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground\"\n              )}\n            >\n              {itemConfig?.icon && !hideIcon ? (\n                <itemConfig.icon />\n              ) : (\n                <div\n                  className=\"h-2 w-2 shrink-0 rounded-[2px]\"\n                  style={{\n                    backgroundColor: item.color,\n                  }}\n                />\n              )}\n              {itemConfig?.label}\n            </div>\n          )\n        })}\n      </div>\n    )\n  }\n)\nChartLegendContent.displayName = \"ChartLegend\"\n\n// Helper to extract item config from a payload.\nfunction getPayloadConfigFromPayload(\n  config: ChartConfig,\n  payload: unknown,\n  key: string\n) {\n  if (typeof payload !== \"object\" || payload === null) {\n    return undefined\n  }\n\n  const payloadPayload =\n    \"payload\" in payload &&\n    typeof payload.payload === \"object\" &&\n    payload.payload !== null\n      ? payload.payload\n      : undefined\n\n  let configLabelKey: string = key\n\n  if (\n    key in payload &&\n    typeof payload[key as keyof typeof payload] === \"string\"\n  ) {\n    configLabelKey = payload[key as keyof typeof payload] as string\n  } else if (\n    payloadPayload &&\n    key in payloadPayload &&\n    typeof payloadPayload[key as keyof typeof payloadPayload] === \"string\"\n  ) {\n    configLabelKey = payloadPayload[\n      key as keyof typeof payloadPayload\n    ] as string\n  }\n\n  return configLabelKey in config\n    ? config[configLabelKey]\n    : config[key as keyof typeof config]\n}\n\nexport {\n  ChartContainer,\n  ChartTooltip,\n  ChartTooltipContent,\n  ChartLegend,\n  ChartLegendContent,\n  ChartStyle,\n}\n","size_bytes":10481},"server/public/proofCaptcha/pow-worker.js":{"content":"/**\n * ALTCHA Worker - Parallel hash computation with exact matching\n * Uses ALTCHA algorithm: finds number N where SHA256(salt + N) = challengeHash\n * Much faster than traditional POW prefix searching\n */\n\n/**\n * Convert hash buffer to hex string (optimized)\n */\nfunction bufferToHex(buffer) {\n  const hashArray = new Uint8Array(buffer);\n  let hex = '';\n  for (let i = 0; i < hashArray.length; i++) {\n    const h = hashArray[i].toString(16);\n    hex += h.length === 1 ? '0' + h : h;\n  }\n  return hex;\n}\n\n/**\n * Worker message handler for ALTCHA challenge solving\n */\nself.onmessage = async function(e) {\n  const { type, data } = e.data;\n  \n  if (type === 'solve') {\n    // ALTCHA approach: find number where SHA256(salt + number) === challengeHash\n    const { salt, challengeHash, startNumber, batchSize } = data;\n    const textEncoder = new TextEncoder();\n    let lastReportedAttempt = 0;\n    \n    for (let i = 0; i < batchSize; i++) {\n      const number = startNumber + i;\n      // ALTCHA: hash(salt + number) - looking for exact match\n      const hashData = salt + number.toString();\n      const msgBuffer = textEncoder.encode(hashData);\n      const hashBuffer = await crypto.subtle.digest('SHA-256', msgBuffer);\n      const hash = bufferToHex(hashBuffer);\n      \n      // Report progress periodically (incremental count)\n      if (i > 0 && i % 500 === 0) {\n        const incrementalAttempts = i - lastReportedAttempt;\n        self.postMessage({\n          type: 'progress',\n          data: {\n            attempts: incrementalAttempts,\n            hash: hash,\n            currentNumber: number\n          }\n        });\n        lastReportedAttempt = i;\n      }\n      \n      // Check if solution found - ALTCHA uses exact hash match\n      if (hash === challengeHash) {\n        const incrementalAttempts = (i + 1) - lastReportedAttempt;\n        self.postMessage({\n          type: 'found',\n          data: {\n            solution: number,  // Return the number, not base36 string\n            attempts: incrementalAttempts,\n            hash: hash\n          }\n        });\n        return;\n      }\n    }\n    \n    // Batch completed without finding solution (report remaining attempts)\n    const incrementalAttempts = batchSize - lastReportedAttempt;\n    self.postMessage({\n      type: 'complete',\n      data: {\n        attempts: incrementalAttempts\n      }\n    });\n  }\n};\n","size_bytes":2365},"OBFUSCATION-README.md":{"content":"# üîí Panduan Obfuscation untuk Proteksi Kode Production\n\nSistem obfuscation ini melindungi kode JavaScript/TypeScript Anda dari pencurian kode atau bypass di lingkungan production, terutama untuk API backend.\n\n## üìã Fitur Perlindungan\n\n### Untuk Backend/API (Proteksi Maksimal):\n- ‚úÖ **Control Flow Flattening**: Mengacak alur kontrol kode\n- ‚úÖ **Dead Code Injection**: Menambahkan kode palsu untuk membingungkan\n- ‚úÖ **Debug Protection**: Mencegah debugging dengan DevTools\n- ‚úÖ **Console Output Disabled**: Menonaktifkan console.log di production\n- ‚úÖ **String Encryption (RC4)**: Enkripsi string dengan algoritma RC4\n- ‚úÖ **Self-Defending**: Kode akan error jika dimodifikasi\n- ‚úÖ **Identifier Obfuscation**: Mengubah semua nama variabel/fungsi\n- ‚úÖ **Number to Expression**: Mengubah angka menjadi ekspresi matematis\n- ‚úÖ **String Array Encoding**: Menyembunyikan string dalam array terenkripsi\n- ‚úÖ **Transform Object Keys**: Mengobfuscate property object\n\n### Untuk Frontend (Proteksi Seimbang):\n- ‚úÖ Control Flow Flattening (lebih ringan)\n- ‚úÖ String Encryption (Base64)\n- ‚úÖ Dead Code Injection (lebih sedikit)\n- ‚úÖ Identifier Obfuscation\n- ‚ö° Performa tetap optimal untuk user experience\n\n## üöÄ Cara Penggunaan\n\n### 1. Build Production dengan Obfuscation\n\n```bash\nnpm run build:obfuscate\n```\n\nPerintah ini akan:\n1. Build project (frontend + backend)\n2. Otomatis mengobfuscate semua file JavaScript di folder `dist/`\n\n### 2. Obfuscate Saja (tanpa build ulang)\n\n```bash\nnpm run obfuscate\n```\n\nBerguna jika Anda sudah punya build dan hanya ingin mengobfuscate ulang.\n\n### 3. Build Normal (tanpa obfuscation)\n\n```bash\nnpm run build\n```\n\nUntuk development atau testing tanpa obfuscation.\n\n### 4. Obfuscate Source Code (ADVANCED - HATI-HATI!)\n\n```bash\nnpm run obfuscate:source\n```\n\n‚ö†Ô∏è **PERINGATAN:** Ini akan mengobfuscate SEMUA file source code (.ts, .js, .mjs) di project!\n- File original akan di-backup ke folder `backup/`\n- File source akan diganti dengan versi obfuscated\n- **Tidak bisa di-compile lagi** setelah obfuscate\n- Hanya untuk deployment akhir\n\n**Restore source code:**\n```bash\nnpm run restore:source\n```\n\nMengembalikan file original dari backup dan menghapus folder backup.\n\nüìñ **Dokumentasi lengkap:** Lihat `SOURCE-OBFUSCATION-README.md`\n\nüí° **REKOMENDASI:** Gunakan `npm run build:obfuscate` saja (lebih aman)\n\n## üìÅ File yang Diobfuscate\n\nSemua file `.js` dan `.mjs` di folder `dist/` akan diobfuscate dengan konfigurasi yang sesuai:\n\n### Backend (Proteksi Maksimal üîê):\n- ‚úÖ `dist/index.js` - Server/API backend utama\n- ‚úÖ File lain di root `dist/` (bukan di `public/`)\n\n### Frontend (Proteksi Seimbang üåê):\n- ‚úÖ `dist/public/assets/*.js` - Frontend bundle React/Vite\n- ‚úÖ `dist/public/*.js` - File JavaScript public lainnya\n- ‚úÖ `dist/client/**/*.js` - File client-side\n\n**Otomatis Deteksi**: Script akan otomatis mendeteksi lokasi file dan menggunakan konfigurasi yang tepat.\n\n## ‚öôÔ∏è Konfigurasi Obfuscation\n\nFile: `scripts/obfuscate.js`\n\n### Untuk Backend (API):\n```javascript\nconst serverObfuscationConfig = {\n  compact: true,\n  controlFlowFlattening: true,\n  deadCodeInjection: true,\n  debugProtection: true,          // Anti-debugging\n  disableConsoleOutput: true,      // Hapus console.log\n  selfDefending: true,             // Kode self-protecting\n  stringArrayEncoding: ['rc4'],    // Enkripsi RC4\n  // ... dan banyak lagi\n};\n```\n\n### Untuk Frontend:\n```javascript\nconst clientObfuscationConfig = {\n  // Konfigurasi lebih ringan untuk performa optimal\n  controlFlowFlatteningThreshold: 0.5,\n  stringArrayEncoding: ['base64'],\n  // ...\n};\n```\n\n## üìä Contoh Hasil Obfuscation\n\n### Kode Asli:\n```javascript\nfunction validateUser(username, password) {\n  if (username === 'admin' && password === 'secret') {\n    return { success: true, token: 'abc123' };\n  }\n  return { success: false };\n}\n```\n\n### Setelah Obfuscation Backend (RC4):\n```javascript\nvar _0x4a2b=['dmFsaWRhdGVVc2Vy','YWRtaW4=','c2VjcmV0',...];\n(function(_0x3f5d,_0x2c8a){var _0x4b7e=function(_0x1d3c){...}}(_0x4a2b,0x123));\nfunction _0x2d4f(_0x5a3e,_0x1b2c){if(_0x5a3e===_0x3c[0x0]&&_0x1b2c===_0x3c[0x1]){...}}\n// + Anti-debugging code\n// + Self-defending code\n```\n\n### Setelah Obfuscation Frontend (Base64):\n```javascript\nvar _0x2b4a=['validateUser','admin','secret',...];\nfunction _0x1f3e(_0x4c2a,_0x3b1d){if(_0x4c2a===_0x2b[0x1]&&_0x3b1d===_0x2b[0x2]){...}}\n// Lebih ringan, tanpa anti-debugging untuk stabilitas browser\n```\n\n## üîê Tingkat Proteksi\n\n### Backend/API: ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê (MAKSIMAL)\n- Sangat sulit di-reverse engineer\n- Anti-debugging aktif\n- Self-defending code\n- String encryption dengan RC4\n\n### Frontend: ‚≠ê‚≠ê‚≠ê‚≠ê (TINGGI)\n- Proteksi kuat namun tetap performant\n- String encryption dengan Base64\n- Tidak mengganggu user experience\n\n## ‚ö†Ô∏è PERINGATAN PENTING\n\n1. **Backup Kode Asli**: File di `dist/` akan ditimpa. Jangan hapus source code!\n2. **Hanya untuk Production**: Jangan gunakan kode terobfuscate untuk development\n3. **Testing**: Test kode production sebelum deploy\n4. **Performance**: Obfuscation menambah sedikit overhead (5-15%)\n\n## üõ°Ô∏è Proteksi Tambahan\n\n### 1. Jangan Expose Source Maps\nPastikan tidak ada file `.map` di production:\n```bash\n# Hapus source maps sebelum deploy\nrm -rf dist/**/*.map\n```\n\n### 2. Environment Variables\nJangan hardcode API keys. Gunakan environment variables:\n```javascript\n// ‚ùå JANGAN\nconst API_KEY = 'sk_live_123456789';\n\n// ‚úÖ LAKUKAN\nconst API_KEY = process.env.API_KEY;\n```\n\n### 3. Rate Limiting\nKombinasikan dengan rate limiting di `server/routes.ts`\n\n### 4. HTTPS Only\nSelalu gunakan HTTPS di production\n\n## üö¢ Deployment\n\n### Deploy ke Replit Production:\n\n1. Build dengan obfuscation:\n```bash\nnpm run build:obfuscate\n```\n\n2. Test locally:\n```bash\nnpm start\n```\n\n3. Jika semua OK, deploy ke production menggunakan tombol \"Deploy\" di Replit\n\n### Deploy ke Server Lain:\n\n```bash\n# Build dengan obfuscation\nnpm run build:obfuscate\n\n# Copy folder dist/ ke server production\nscp -r dist/ user@server:/path/to/app/\n\n# Di server, jalankan:\nNODE_ENV=production node dist/index.js\n```\n\n## üîß Troubleshooting\n\n### Error: \"Cannot find module\"\n- Pastikan `npm install` sudah dijalankan\n- Check dependencies di package.json\n\n### Kode tidak berfungsi setelah obfuscation\n- Test dengan `npm run build` dulu (tanpa obfuscation)\n- Jika build normal OK tapi obfuscated error, adjust konfigurasi di `scripts/obfuscate.js`\n\n### Performance lambat\n- Kurangi `controlFlowFlatteningThreshold`\n- Ubah `deadCodeInjectionThreshold` ke nilai lebih rendah\n- Disable `debugProtection` untuk frontend\n\n## üìà Best Practices\n\n1. ‚úÖ Selalu test build obfuscated sebelum deploy\n2. ‚úÖ Simpan backup kode original\n3. ‚úÖ Gunakan version control (Git)\n4. ‚úÖ Monitor performa di production\n5. ‚úÖ Update dependency secara berkala\n6. ‚úÖ Kombinasikan dengan security best practices lainnya\n\n## üìû Support\n\nJika ada pertanyaan atau issue:\n1. Check dokumentasi `javascript-obfuscator`\n2. Sesuaikan konfigurasi di `scripts/obfuscate.js`\n3. Test dengan konfigurasi lebih ringan jika ada masalah\n\n---\n\n**üîí Kode Anda sekarang terlindungi dari pencurian dan bypass!**\n","size_bytes":7156},"SOURCE-OBFUSCATION-README.md":{"content":"# üîê Panduan Source Code Obfuscation\n\nScript ini akan **mengobfuscate SEMUA source code** TypeScript dan JavaScript di project Anda, dengan backup otomatis ke folder `backup/`.\n\n## ‚ö†Ô∏è PERINGATAN PENTING\n\n**BACA INI SEBELUM MENJALANKAN:**\n\n1. **File original akan DIGANTI** dengan versi obfuscated\n2. **Tidak bisa di-compile** - TypeScript terobfuscate tidak bisa di-compile lagi\n3. **Hanya untuk deployment akhir** - Jangan gunakan untuk development\n4. **Simpan di Git dulu** - Commit semua perubahan sebelum obfuscate\n5. **Backup otomatis** - File original akan disimpan di folder `backup/`\n\n## üöÄ Cara Menggunakan\n\n### 1. Obfuscate Source Code\n\n```bash\nnpm run obfuscate:source\n```\n\n**Apa yang terjadi:**\n- ‚úÖ Semua file `.ts`, `.js`, `.mjs` akan di-backup ke folder `backup/backup-[timestamp]/`\n- ‚úÖ File original akan diganti dengan versi obfuscated\n- ‚úÖ Total ~46 file akan diproses\n- ‚ö†Ô∏è File di `node_modules/`, `dist/`, `.git/` akan di-skip\n\n**Folder yang di-skip:**\n- `node_modules/`\n- `dist/`\n- `backup/`\n- `.git/`\n- `.next/`\n- `.cache/`\n- `coverage/`\n- `build/`\n- `.local/`\n\n**File yang di-skip:**\n- `scripts/obfuscate.js`\n- `scripts/obfuscate-source.js`\n- `scripts/restore-source.js`\n- `scripts/setup-database.ts`\n\n### 2. Restore Source Code\n\n```bash\nnpm run restore:source\n```\n\n**Apa yang terjadi:**\n- ‚úÖ Menampilkan semua backup yang tersedia\n- ‚úÖ Otomatis menggunakan backup terbaru\n- ‚úÖ Semua file obfuscated diganti dengan file original dari backup\n- ‚úÖ Folder `backup/` akan dihapus setelah restore selesai\n- ‚úÖ Konfirmasi sebelum restore (ketik `yes` untuk lanjut)\n\n## üìã Workflow Lengkap\n\n### Skenario 1: Deploy Production dengan Source Obfuscated\n\n```bash\n# 1. Commit semua perubahan ke Git\ngit add .\ngit commit -m \"Pre-obfuscation commit\"\n\n# 2. Obfuscate source code\nnpm run obfuscate:source\n\n# 3. Build production (dari source yang sudah obfuscated)\nnpm run build\n\n# 4. Deploy ke server production\n# (copy folder dist/ dan source code terobfuscate)\n\n# 5. Restore source code untuk development\nnpm run restore:source\n\n# 6. Lanjut development normal\nnpm run dev\n```\n\n### Skenario 2: Hanya Build Obfuscated (REKOMENDASI)\n\n```bash\n# Lebih aman - hanya obfuscate hasil build, bukan source\nnpm run build:obfuscate\n\n# Deploy folder dist/ saja\n# Source code tetap aman\n```\n\n## üîê Tingkat Proteksi\n\n### Source Code Obfuscation: ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê (MAKSIMAL)\n\n- ‚úÖ **RC4 Encryption** untuk semua string\n- ‚úÖ **Anti-debugging** aktif\n- ‚úÖ **Self-defending code** - error jika dimodifikasi\n- ‚úÖ **Control flow flattening** - alur kode diacak\n- ‚úÖ **Dead code injection** - kode palsu ditambahkan\n- ‚úÖ **Console disabled** - console.log dihapus\n- ‚úÖ **Identifier transformation** - semua nama variabel diacak\n- ‚úÖ **Number to expression** - angka jadi rumus matematis\n- ‚úÖ **String array encoding** - string disembunyikan\n\n## üìä Contoh Hasil\n\n### Kode Original:\n```typescript\nexport async function validateApiKey(sitekey: string, domain: string) {\n  const apiKey = await db\n    .select()\n    .from(apiKeys)\n    .where(eq(apiKeys.sitekey, sitekey))\n    .limit(1);\n  \n  if (!apiKey || !apiKey[0]?.active) {\n    return { valid: false, error: 'Invalid API key' };\n  }\n  \n  return { valid: true, data: apiKey[0] };\n}\n```\n\n### Setelah Obfuscation:\n```javascript\nvar _0x4a=['ZGF0YWJhc2U=','c2VsZWN0','ZnJvbQ==','d2hlcmU=',...];\n(function(_0x2d,_0x4b){var _0x5c=function(_0x1d){while(--_0x1d){...}}}(_0x4a,0x123));\nvar _0x3d=function(_0x2a,_0x1f){_0x2a=_0x2a-0x0;var _0x4d=_0x4a[_0x2a];...};\nexport async function _0x2f(_0x1a,_0x3b){var _0x4c=await...}\n```\n\n## üéØ Kapan Menggunakan Source Obfuscation?\n\n### ‚úÖ GUNAKAN Jika:\n- Deploy ke server yang Anda tidak fully control\n- Ingin proteksi maksimal terhadap pencurian kode\n- Ready untuk workflow deploy yang lebih kompleks\n- Sudah backup di Git\n\n### ‚ùå JANGAN GUNAKAN Jika:\n- Masih dalam tahap development\n- Perlu debug di production\n- Belum backup kode ke Git\n- Tim perlu akses source code\n\n### üí° REKOMENDASI:\nGunakan `npm run build:obfuscate` saja (obfuscate hasil build):\n- ‚úÖ Source code tetap aman dan bisa di-edit\n- ‚úÖ Hasil build (dist/) yang terobfuscate\n- ‚úÖ Lebih mudah di-maintain\n- ‚úÖ Debugging masih bisa dilakukan di development\n\n## üîÑ Struktur Backup\n\n```\nbackup/\n‚îú‚îÄ‚îÄ backup-2025-11-13-1699999999999/\n‚îÇ   ‚îú‚îÄ‚îÄ server/\n‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ index.ts (original)\n‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ routes.ts (original)\n‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ...\n‚îÇ   ‚îú‚îÄ‚îÄ client/\n‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ src/\n‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ App.tsx (original)\n‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ ...\n‚îÇ   ‚îî‚îÄ‚îÄ shared/\n‚îÇ       ‚îî‚îÄ‚îÄ schema.ts (original)\n```\n\n## ‚öôÔ∏è Konfigurasi\n\nFile: `scripts/obfuscate-source.js`\n\n```javascript\nconst maxObfuscationConfig = {\n  compact: true,\n  controlFlowFlattening: true,\n  debugProtection: true,\n  selfDefending: true,\n  stringArrayEncoding: ['rc4'],\n  // ... proteksi maksimal\n};\n```\n\nUntuk mengubah tingkat proteksi, edit file tersebut.\n\n## üõ†Ô∏è Troubleshooting\n\n### Error: \"Cannot compile TypeScript\"\n**Penyebab:** File TypeScript sudah di-obfuscate\n**Solusi:** Restore dulu dengan `npm run restore:source`\n\n### Error: \"Backup folder tidak ditemukan\"\n**Penyebab:** Belum pernah obfuscate atau backup sudah dihapus\n**Solusi:** Tidak bisa restore, gunakan Git untuk rollback\n\n### Code tidak berfungsi setelah obfuscate\n**Penyebab:** Obfuscation terlalu agresif\n**Solusi:** \n1. Restore: `npm run restore:source`\n2. Gunakan `npm run build:obfuscate` saja (lebih aman)\n\n## üìû FAQ\n\n**Q: Apakah aman untuk production?**\nA: Ya, tapi lebih disarankan gunakan `npm run build:obfuscate` (hanya obfuscate hasil build).\n\n**Q: Bisa di-debug setelah obfuscate?**\nA: Tidak, debugging sangat sulit. Restore dulu jika perlu debug.\n\n**Q: Apakah performance terpengaruh?**\nA: Ya, sedikit overhead sekitar 5-15% karena obfuscation.\n\n**Q: Bisa di-reverse engineer?**\nA: Sangat sulit, tapi bukan impossible. Kombinasikan dengan proteksi lain.\n\n**Q: Folder backup aman?**\nA: Sudah ditambahkan ke `.gitignore`, tapi pastikan tidak ter-commit.\n\n---\n\n## üéØ Ringkasan Perintah\n\n```bash\n# Obfuscate semua source code (HATI-HATI!)\nnpm run obfuscate:source\n\n# Restore source code dari backup\nnpm run restore:source\n\n# Build obfuscated (REKOMENDASI - lebih aman)\nnpm run build:obfuscate\n```\n\n**üîí Proteksi Kode Anda Sekarang Maksimal!**\n","size_bytes":6348},"scripts/restore-source.js":{"content":"#!/usr/bin/env node\n\nimport { readdirSync, statSync, copyFileSync, rmSync, existsSync } from 'fs';\nimport { join, dirname, relative } from 'path';\nimport { fileURLToPath } from 'url';\nimport readline from 'readline';\n\nconst __filename = fileURLToPath(import.meta.url);\nconst __dirname = dirname(__filename);\n\nfunction getAllFiles(dirPath, arrayOfFiles = []) {\n  const files = readdirSync(dirPath);\n\n  files.forEach(file => {\n    const filePath = join(dirPath, file);\n    \n    if (statSync(filePath).isDirectory()) {\n      arrayOfFiles = getAllFiles(filePath, arrayOfFiles);\n    } else {\n      arrayOfFiles.push(filePath);\n    }\n  });\n\n  return arrayOfFiles;\n}\n\nfunction getBackupFolders(backupDir) {\n  if (!existsSync(backupDir)) {\n    return [];\n  }\n  \n  const folders = readdirSync(backupDir)\n    .filter(name => {\n      const path = join(backupDir, name);\n      return statSync(path).isDirectory() && name.startsWith('backup-');\n    })\n    .map(name => ({\n      name,\n      path: join(backupDir, name),\n      mtime: statSync(join(backupDir, name)).mtime\n    }))\n    .sort((a, b) => b.mtime - a.mtime); // Sort descending (newest first)\n  \n  return folders;\n}\n\nfunction askQuestion(query) {\n  const rl = readline.createInterface({\n    input: process.stdin,\n    output: process.stdout,\n  });\n\n  return new Promise(resolve => rl.question(query, ans => {\n    rl.close();\n    resolve(ans);\n  }));\n}\n\nasync function main() {\n  const projectRoot = join(__dirname, '..');\n  const backupDir = join(projectRoot, 'backup');\n  \n  console.log('üîÑ Proses Restore Source Code dari Backup\\n');\n  \n  // Check if backup folder exists\n  if (!existsSync(backupDir)) {\n    console.error('‚ùå Folder backup tidak ditemukan!');\n    console.log('üí° Belum ada backup yang tersimpan.');\n    process.exit(1);\n  }\n  \n  // Get all backup folders\n  const backupFolders = getBackupFolders(backupDir);\n  \n  if (backupFolders.length === 0) {\n    console.error('‚ùå Tidak ada folder backup yang tersedia!');\n    process.exit(1);\n  }\n  \n  console.log(`üì¶ Ditemukan ${backupFolders.length} backup:\\n`);\n  \n  // Show all backups\n  backupFolders.forEach((backup, index) => {\n    const date = backup.mtime.toLocaleString('id-ID');\n    console.log(`  ${index + 1}. ${backup.name}`);\n    console.log(`     Tanggal: ${date}`);\n    console.log('');\n  });\n  \n  // Auto-select the newest backup\n  const selectedBackup = backupFolders[0];\n  \n  console.log(`‚úÖ Menggunakan backup terbaru: ${selectedBackup.name}\\n`);\n  \n  // Confirm before restore\n  console.log('‚ö†Ô∏è  PERINGATAN:');\n  console.log('   - Semua file obfuscated akan diganti dengan file original');\n  console.log('   - Folder backup akan dihapus setelah restore selesai');\n  console.log('   - Proses ini TIDAK BISA dibatalkan!\\n');\n  \n  const answer = await askQuestion('Lanjutkan restore? (yes/no): ');\n  \n  if (answer.toLowerCase() !== 'yes' && answer.toLowerCase() !== 'y') {\n    console.log('‚ùå Restore dibatalkan.');\n    process.exit(0);\n  }\n  \n  console.log('\\nüöÄ Memulai restore...\\n');\n  \n  // Get all files from backup\n  const backupFiles = getAllFiles(selectedBackup.path);\n  \n  console.log(`üìÅ Ditemukan ${backupFiles.length} file di backup\\n`);\n  \n  // Restore each file\n  let restoredCount = 0;\n  \n  backupFiles.forEach(backupFilePath => {\n    const relativePath = relative(selectedBackup.path, backupFilePath);\n    const originalPath = join(projectRoot, relativePath);\n    const originalDir = dirname(originalPath);\n    \n    try {\n      // Copy file from backup to original location\n      copyFileSync(backupFilePath, originalPath);\n      console.log(`‚úÖ Restore: ${relativePath}`);\n      restoredCount++;\n    } catch (error) {\n      console.error(`‚ùå Error restore ${relativePath}:`, error.message);\n    }\n  });\n  \n  console.log(`\\n‚úÖ ${restoredCount} file telah di-restore!\\n`);\n  \n  // Delete backup folder\n  console.log('üóëÔ∏è  Menghapus folder backup...\\n');\n  \n  try {\n    rmSync(backupDir, { recursive: true, force: true });\n    console.log('‚úÖ Folder backup berhasil dihapus!\\n');\n  } catch (error) {\n    console.error('‚ö†Ô∏è  Warning: Gagal menghapus folder backup:', error.message);\n    console.log('üí° Anda bisa menghapusnya secara manual.\\n');\n  }\n  \n  console.log('‚ú® Restore selesai!');\n  console.log('üéâ Semua file telah dikembalikan ke versi original!');\n  console.log('');\n  console.log('üí° TIP:');\n  console.log('   - File terobfuscate telah diganti dengan file original');\n  console.log('   - Anda bisa langsung melanjutkan development');\n  console.log('   - Jika ingin obfuscate lagi, jalankan: npm run obfuscate:source');\n}\n\nmain().catch(error => {\n  console.error('‚ùå Error:', error);\n  process.exit(1);\n});\n","size_bytes":4693},"scripts/obfuscate-source.js":{"content":"#!/usr/bin/env node\n\nimport JavaScriptObfuscator from 'javascript-obfuscator';\nimport { readFileSync, writeFileSync, readdirSync, statSync, mkdirSync, existsSync, copyFileSync } from 'fs';\nimport { join, dirname, relative, extname } from 'path';\nimport { fileURLToPath } from 'url';\n\nconst __filename = fileURLToPath(import.meta.url);\nconst __dirname = dirname(__filename);\n\n// Konfigurasi obfuscation maksimal untuk semua file source\nconst maxObfuscationConfig = {\n  compact: true,\n  controlFlowFlattening: true,\n  controlFlowFlatteningThreshold: 1,\n  deadCodeInjection: true,\n  deadCodeInjectionThreshold: 0.5,\n  debugProtection: true,\n  debugProtectionInterval: 4000,\n  disableConsoleOutput: true,\n  identifierNamesGenerator: 'hexadecimal',\n  log: false,\n  numbersToExpressions: true,\n  renameGlobals: false,\n  selfDefending: true,\n  simplify: true,\n  splitStrings: true,\n  splitStringsChunkLength: 5,\n  stringArray: true,\n  stringArrayCallsTransform: true,\n  stringArrayEncoding: ['rc4'],\n  stringArrayIndexShift: true,\n  stringArrayRotate: true,\n  stringArrayShuffle: true,\n  stringArrayWrappersCount: 5,\n  stringArrayWrappersChainedCalls: true,\n  stringArrayWrappersParametersMaxCount: 5,\n  stringArrayWrappersType: 'function',\n  stringArrayThreshold: 1,\n  transformObjectKeys: true,\n  unicodeEscapeSequence: false\n};\n\n// Folder yang akan di-skip\nconst skipFolders = [\n  'node_modules',\n  'dist',\n  'backup',\n  '.git',\n  '.next',\n  '.cache',\n  'coverage',\n  'build',\n  '.local'\n];\n\n// File yang akan di-skip\nconst skipFiles = [\n  'obfuscate.js',\n  'obfuscate-source.js',\n  'restore-source.js',\n  'setup-database.ts'\n];\n\nfunction shouldSkip(path) {\n  const pathParts = path.split('/');\n  \n  // Skip jika mengandung folder yang di-skip\n  for (const folder of skipFolders) {\n    if (pathParts.includes(folder)) {\n      return true;\n    }\n  }\n  \n  // Skip jika nama file ada di daftar skip\n  const fileName = pathParts[pathParts.length - 1];\n  if (skipFiles.includes(fileName)) {\n    return true;\n  }\n  \n  return false;\n}\n\nfunction getAllSourceFiles(dirPath, arrayOfFiles = [], baseDir = dirPath) {\n  const files = readdirSync(dirPath);\n\n  files.forEach(file => {\n    const filePath = join(dirPath, file);\n    const relativePath = relative(baseDir, filePath);\n    \n    if (shouldSkip(relativePath)) {\n      return;\n    }\n    \n    if (statSync(filePath).isDirectory()) {\n      arrayOfFiles = getAllSourceFiles(filePath, arrayOfFiles, baseDir);\n    } else {\n      const ext = extname(file);\n      if (ext === '.js' || ext === '.mjs' || ext === '.ts') {\n        arrayOfFiles.push(filePath);\n      }\n    }\n  });\n\n  return arrayOfFiles;\n}\n\nfunction backupFile(filePath, backupDir, projectRoot) {\n  const relativePath = relative(projectRoot, filePath);\n  const backupPath = join(backupDir, relativePath);\n  const backupDirPath = dirname(backupPath);\n  \n  if (!existsSync(backupDirPath)) {\n    mkdirSync(backupDirPath, { recursive: true });\n  }\n  \n  copyFileSync(filePath, backupPath);\n  return backupPath;\n}\n\nfunction obfuscateSourceFile(filePath, projectRoot) {\n  try {\n    const relativePath = relative(projectRoot, filePath);\n    console.log(`üîí Mengobfuscate: ${relativePath}`);\n    \n    let code = readFileSync(filePath, 'utf8');\n    \n    // Jika file TypeScript, kita obfuscate sebagai JavaScript\n    // (dalam production, TypeScript sudah di-compile ke JS)\n    const ext = extname(filePath);\n    \n    // Untuk file .ts, kita tambahkan comment bahwa ini obfuscated TypeScript\n    if (ext === '.ts') {\n      code = `/* Obfuscated TypeScript - Compile to JavaScript before running */\\n${code}`;\n    }\n    \n    const obfuscationResult = JavaScriptObfuscator.obfuscate(code, maxObfuscationConfig);\n    \n    writeFileSync(filePath, obfuscationResult.getObfuscatedCode());\n    console.log(`‚úÖ Berhasil: ${relativePath}`);\n  } catch (error) {\n    console.error(`‚ùå Error mengobfuscate ${filePath}:`, error.message);\n  }\n}\n\nasync function main() {\n  const projectRoot = join(__dirname, '..');\n  const backupDir = join(projectRoot, 'backup');\n  const timestamp = new Date().toISOString().replace(/[:.]/g, '-').split('T')[0];\n  const timestampedBackupDir = join(backupDir, `backup-${timestamp}-${Date.now()}`);\n  \n  console.log('üöÄ Memulai proses backup dan obfuscation SOURCE CODE...\\n');\n  console.log('‚ö†Ô∏è  PERHATIAN: File original akan diganti dengan versi obfuscated!');\n  console.log('üì¶ Backup akan disimpan di:', relative(projectRoot, timestampedBackupDir));\n  console.log('');\n  \n  // Buat folder backup\n  if (!existsSync(timestampedBackupDir)) {\n    mkdirSync(timestampedBackupDir, { recursive: true });\n  }\n  \n  // Dapatkan semua file source\n  const allFiles = getAllSourceFiles(projectRoot);\n  \n  console.log(`üìÅ Ditemukan ${allFiles.length} file TypeScript/JavaScript\\n`);\n  \n  // Backup semua file terlebih dahulu\n  console.log('üìã Step 1/2: Backup semua file...\\n');\n  let backedUpCount = 0;\n  \n  allFiles.forEach(file => {\n    const relativePath = relative(projectRoot, file);\n    console.log(`üíæ Backup: ${relativePath}`);\n    backupFile(file, timestampedBackupDir, projectRoot);\n    backedUpCount++;\n  });\n  \n  console.log(`\\n‚úÖ ${backedUpCount} file telah di-backup!\\n`);\n  \n  // Obfuscate semua file\n  console.log('üìã Step 2/2: Obfuscate semua file...\\n');\n  \n  allFiles.forEach(file => {\n    obfuscateSourceFile(file, projectRoot);\n  });\n  \n  console.log('\\n‚ú® Proses selesai!');\n  console.log(`üì¶ Backup original ada di: ${relative(projectRoot, timestampedBackupDir)}`);\n  console.log('üîí Semua source code telah di-obfuscate!');\n  console.log('');\n  console.log('‚ö†Ô∏è  PENTING:');\n  console.log('   - File original telah diganti dengan versi obfuscated');\n  console.log('   - Backup original tersimpan di folder backup/');\n  console.log('   - Untuk restore, copy kembali dari folder backup/');\n  console.log('   - Jangan commit ke Git jika tidak perlu!');\n}\n\nmain().catch(error => {\n  console.error('‚ùå Error:', error);\n  process.exit(1);\n});\n","size_bytes":5986},"scripts/obfuscate.js":{"content":"#!/usr/bin/env node\n\nimport JavaScriptObfuscator from 'javascript-obfuscator';\nimport { readFileSync, writeFileSync, readdirSync, statSync, mkdirSync, existsSync } from 'fs';\nimport { join, dirname, relative } from 'path';\nimport { fileURLToPath } from 'url';\n\nconst __filename = fileURLToPath(import.meta.url);\nconst __dirname = dirname(__filename);\n\n// Konfigurasi obfuscation untuk API/Backend (Perlindungan Maksimal)\nconst serverObfuscationConfig = {\n  compact: true,\n  controlFlowFlattening: true,\n  controlFlowFlatteningThreshold: 1,\n  deadCodeInjection: true,\n  deadCodeInjectionThreshold: 0.5,\n  debugProtection: true,\n  debugProtectionInterval: 4000,\n  disableConsoleOutput: true,\n  identifierNamesGenerator: 'hexadecimal',\n  log: false,\n  numbersToExpressions: true,\n  renameGlobals: false,\n  selfDefending: true,\n  simplify: true,\n  splitStrings: true,\n  splitStringsChunkLength: 5,\n  stringArray: true,\n  stringArrayCallsTransform: true,\n  stringArrayEncoding: ['rc4'],\n  stringArrayIndexShift: true,\n  stringArrayRotate: true,\n  stringArrayShuffle: true,\n  stringArrayWrappersCount: 5,\n  stringArrayWrappersChainedCalls: true,\n  stringArrayWrappersParametersMaxCount: 5,\n  stringArrayWrappersType: 'function',\n  stringArrayThreshold: 1,\n  transformObjectKeys: true,\n  unicodeEscapeSequence: false\n};\n\n// Konfigurasi obfuscation untuk Client/Frontend (Lebih ringan agar performa tetap baik)\nconst clientObfuscationConfig = {\n  compact: true,\n  controlFlowFlattening: true,\n  controlFlowFlatteningThreshold: 0.5,\n  deadCodeInjection: true,\n  deadCodeInjectionThreshold: 0.2,\n  debugProtection: false,\n  disableConsoleOutput: false,\n  identifierNamesGenerator: 'hexadecimal',\n  log: false,\n  numbersToExpressions: true,\n  renameGlobals: false,\n  selfDefending: false,\n  simplify: true,\n  splitStrings: true,\n  splitStringsChunkLength: 10,\n  stringArray: true,\n  stringArrayCallsTransform: true,\n  stringArrayEncoding: ['base64'],\n  stringArrayIndexShift: true,\n  stringArrayRotate: true,\n  stringArrayShuffle: true,\n  stringArrayWrappersCount: 2,\n  stringArrayWrappersChainedCalls: true,\n  stringArrayWrappersParametersMaxCount: 2,\n  stringArrayWrappersType: 'function',\n  stringArrayThreshold: 0.8,\n  transformObjectKeys: true,\n  unicodeEscapeSequence: false\n};\n\nfunction getAllFiles(dirPath, arrayOfFiles = []) {\n  const files = readdirSync(dirPath);\n\n  files.forEach(file => {\n    const filePath = join(dirPath, file);\n    if (statSync(filePath).isDirectory()) {\n      arrayOfFiles = getAllFiles(filePath, arrayOfFiles);\n    } else if (file.endsWith('.js') || file.endsWith('.mjs')) {\n      arrayOfFiles.push(filePath);\n    }\n  });\n\n  return arrayOfFiles;\n}\n\nfunction obfuscateFile(filePath, outputDir) {\n  try {\n    const relativePath = relative(outputDir, filePath);\n    \n    // Deteksi apakah file adalah frontend atau backend\n    const isFrontend = relativePath.includes('public/') || \n                       relativePath.includes('assets/') ||\n                       relativePath.includes('client/');\n    \n    const config = isFrontend ? clientObfuscationConfig : serverObfuscationConfig;\n    const type = isFrontend ? 'üåê Frontend' : 'üîê Backend';\n    \n    console.log(`üîí Mengobfuscate [${type}]: ${relativePath}`);\n    \n    const code = readFileSync(filePath, 'utf8');\n    const obfuscationResult = JavaScriptObfuscator.obfuscate(code, config);\n    \n    const outputPath = join(outputDir, relativePath);\n    const outputDirPath = dirname(outputPath);\n    \n    if (!existsSync(outputDirPath)) {\n      mkdirSync(outputDirPath, { recursive: true });\n    }\n    \n    writeFileSync(outputPath, obfuscationResult.getObfuscatedCode());\n    console.log(`‚úÖ Berhasil: ${relativePath}`);\n  } catch (error) {\n    console.error(`‚ùå Error mengobfuscate ${filePath}:`, error.message);\n  }\n}\n\nasync function main() {\n  const distDir = join(__dirname, '../dist');\n  \n  if (!existsSync(distDir)) {\n    console.error('‚ùå Folder dist tidak ditemukan. Jalankan \"npm run build\" terlebih dahulu.');\n    process.exit(1);\n  }\n\n  console.log('üöÄ Memulai proses obfuscation...\\n');\n  \n  // Obfuscate semua file di dist folder\n  const allFiles = getAllFiles(distDir);\n  \n  console.log(`üì¶ Ditemukan ${allFiles.length} file JavaScript\\n`);\n  \n  allFiles.forEach(file => {\n    // Otomatis deteksi dan gunakan konfigurasi yang sesuai\n    obfuscateFile(file, distDir);\n  });\n  \n  console.log('\\n‚ú® Obfuscation selesai!');\n  console.log('üìÅ File yang sudah diobfuscate ada di folder: dist/');\n  console.log('‚ö†Ô∏è  PERHATIAN: File asli telah ditimpa dengan versi obfuscated.');\n  console.log('üí° TIP: Simpan backup kode sebelum deploy jika diperlukan.');\n}\n\nmain().catch(error => {\n  console.error('‚ùå Error:', error);\n  process.exit(1);\n});\n","size_bytes":4750},"client/src/i18n/config.ts":{"content":"import i18n from 'i18next';\nimport { initReactI18next } from 'react-i18next';\nimport en from './locales/en.json';\nimport id from './locales/id.json';\n\ni18n\n  .use(initReactI18next)\n  .init({\n    resources: {\n      en: { translation: en },\n      id: { translation: id },\n    },\n    lng: localStorage.getItem('language') || 'id',\n    fallbackLng: 'id',\n    interpolation: {\n      escapeValue: false,\n    },\n  });\n\nexport default i18n;\n","size_bytes":433},"client/src/components/LanguageToggle.tsx":{"content":"import { useTranslation } from 'react-i18next';\nimport { Button } from '@/components/ui/button';\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n} from '@/components/ui/dropdown-menu';\nimport { Languages } from 'lucide-react';\n\nexport default function LanguageToggle() {\n  const { i18n } = useTranslation();\n\n  const changeLanguage = (lng: string) => {\n    i18n.changeLanguage(lng);\n    localStorage.setItem('language', lng);\n  };\n\n  const currentLanguage = i18n.language;\n\n  return (\n    <DropdownMenu>\n      <DropdownMenuTrigger asChild>\n        <Button variant=\"ghost\" size=\"icon\" data-testid=\"button-language-toggle\">\n          <Languages className=\"h-4 w-4\" />\n          <span className=\"sr-only\">Toggle language</span>\n        </Button>\n      </DropdownMenuTrigger>\n      <DropdownMenuContent align=\"end\">\n        <DropdownMenuItem\n          onClick={() => changeLanguage('en')}\n          className={currentLanguage === 'en' ? 'bg-accent' : ''}\n          data-testid=\"menu-item-english\"\n        >\n          English\n        </DropdownMenuItem>\n        <DropdownMenuItem\n          onClick={() => changeLanguage('id')}\n          className={currentLanguage === 'id' ? 'bg-accent' : ''}\n          data-testid=\"menu-item-indonesian\"\n        >\n          Indonesia\n        </DropdownMenuItem>\n      </DropdownMenuContent>\n    </DropdownMenu>\n  );\n}\n","size_bytes":1390},"client/src/components/ModernMetricCard.tsx":{"content":"import { motion } from \"framer-motion\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { LucideIcon } from \"lucide-react\";\nimport { useEffect, useState } from \"react\";\n\ninterface ModernMetricCardProps {\n  title: string;\n  value: string | number;\n  description?: string;\n  icon: LucideIcon;\n  trend?: {\n    value: number;\n    label: string;\n  };\n  gradient?: string;\n  index?: number;\n}\n\nfunction AnimatedCounter({ value, duration = 2000 }: { value: number; duration?: number }) {\n  const [count, setCount] = useState(0);\n  const [prefersReducedMotion, setPrefersReducedMotion] = useState(false);\n\n  useEffect(() => {\n    const mediaQuery = window.matchMedia('(prefers-reduced-motion: reduce)');\n    setPrefersReducedMotion(mediaQuery.matches);\n\n    const handleChange = () => setPrefersReducedMotion(mediaQuery.matches);\n    mediaQuery.addEventListener('change', handleChange);\n    return () => mediaQuery.removeEventListener('change', handleChange);\n  }, []);\n\n  useEffect(() => {\n    if (prefersReducedMotion) {\n      setCount(value);\n      return;\n    }\n\n    let startTime: number;\n    let animationFrame: number;\n\n    const animate = (currentTime: number) => {\n      if (!startTime) startTime = currentTime;\n      const progress = Math.min((currentTime - startTime) / duration, 1);\n      \n      setCount(Math.floor(progress * value));\n\n      if (progress < 1) {\n        animationFrame = requestAnimationFrame(animate);\n      }\n    };\n\n    animationFrame = requestAnimationFrame(animate);\n    return () => cancelAnimationFrame(animationFrame);\n  }, [value, duration, prefersReducedMotion]);\n\n  return <>{count.toLocaleString()}</>;\n}\n\nexport default function ModernMetricCard({\n  title,\n  value,\n  description,\n  icon: Icon,\n  trend,\n  gradient = \"from-blue-500/10 to-purple-500/10\",\n  index = 0,\n}: ModernMetricCardProps) {\n  // Only animate pure numbers, not formatted strings with units\n  const isPureNumber = typeof value === 'number';\n  const numericValue = isPureNumber ? value : 0;\n\n  return (\n    <motion.div\n      initial={{ opacity: 0, y: 20, rotateX: -15 }}\n      animate={{ opacity: 1, y: 0, rotateX: 0 }}\n      transition={{\n        duration: 0.5,\n        delay: index * 0.1,\n        ease: [0.22, 1, 0.36, 1],\n      }}\n      whileHover={{\n        y: -8,\n        scale: 1.02,\n        rotateX: 5,\n        transition: { duration: 0.3 },\n      }}\n      style={{\n        transformStyle: \"preserve-3d\",\n        perspective: \"1000px\",\n      }}\n      data-testid={`card-metric-${title.toLowerCase().replace(/\\s+/g, \"-\")}`}\n    >\n      <Card className={`relative overflow-hidden border-0 bg-gradient-to-br ${gradient} backdrop-blur-xl shadow-2xl`}>\n        <div className=\"absolute inset-0 bg-gradient-to-br from-white/5 to-transparent\" />\n        <div className=\"absolute -top-24 -right-24 w-48 h-48 bg-gradient-to-br from-white/10 to-transparent rounded-full blur-3xl\" />\n        \n        <CardContent className=\"p-6 relative\">\n          <div className=\"flex items-start justify-between mb-4\">\n            <motion.div\n              className=\"p-3 rounded-2xl bg-gradient-to-br from-white/10 to-white/5 backdrop-blur-sm\"\n              whileHover={{ scale: 1.1, rotate: 5 }}\n              transition={{ type: \"spring\", stiffness: 400 }}\n            >\n              <Icon className=\"h-6 w-6 text-primary\" data-testid=\"icon-metric\" />\n            </motion.div>\n            \n            {trend && (\n              <motion.div\n                initial={{ opacity: 0, scale: 0.8 }}\n                animate={{ opacity: 1, scale: 1 }}\n                transition={{ delay: 0.3 }}\n                className={`px-3 py-1 rounded-full text-xs font-medium backdrop-blur-sm ${\n                  trend.value >= 0\n                    ? \"bg-green-500/20 text-green-600 dark:text-green-400\"\n                    : \"bg-red-500/20 text-red-600 dark:text-red-400\"\n                }`}\n                data-testid=\"badge-trend\"\n              >\n                {trend.value >= 0 ? \"‚Üó\" : \"‚Üò\"} {Math.abs(trend.value)}%\n              </motion.div>\n            )}\n          </div>\n\n          <h3 className=\"text-sm font-medium text-muted-foreground mb-2\">\n            {title}\n          </h3>\n\n          <motion.div \n            className=\"text-4xl font-bold mb-2 bg-gradient-to-r from-foreground to-foreground/70 bg-clip-text text-transparent\" \n            data-testid=\"text-value\"\n            initial={{ opacity: 0 }}\n            animate={{ opacity: 1 }}\n            transition={{ delay: 0.2 }}\n          >\n            {isPureNumber ? <AnimatedCounter value={numericValue} /> : value}\n          </motion.div>\n\n          {description && (\n            <p className=\"text-xs text-muted-foreground\" data-testid=\"text-description\">\n              {description}\n            </p>\n          )}\n        </CardContent>\n\n        <div className=\"absolute bottom-0 left-0 right-0 h-1 bg-gradient-to-r from-transparent via-primary/50 to-transparent\" />\n      </Card>\n    </motion.div>\n  );\n}\n","size_bytes":4976},"client/src/components/CircularProgress.tsx":{"content":"import { motion } from \"framer-motion\";\n\ninterface CircularProgressProps {\n  value: number;\n  max?: number;\n  size?: number;\n  strokeWidth?: number;\n  label: string;\n  subLabel?: string;\n  color?: string;\n  className?: string;\n}\n\nexport default function CircularProgress({\n  value,\n  max = 100,\n  size = 120,\n  strokeWidth = 8,\n  label,\n  subLabel,\n  color = \"hsl(var(--primary))\",\n  className = \"\",\n}: CircularProgressProps) {\n  const percentage = Math.min((value / max) * 100, 100);\n  const radius = (size - strokeWidth) / 2;\n  const circumference = radius * 2 * Math.PI;\n  const offset = circumference - (percentage / 100) * circumference;\n\n  return (\n    <div className={`flex flex-col items-center gap-3 ${className}`} data-testid=\"circular-progress\">\n      <div className=\"relative\" style={{ width: size, height: size }}>\n        {/* Background Circle */}\n        <svg width={size} height={size} className=\"transform -rotate-90\">\n          <circle\n            cx={size / 2}\n            cy={size / 2}\n            r={radius}\n            fill=\"none\"\n            stroke=\"rgba(100, 100, 100, 0.2)\"\n            strokeWidth={strokeWidth}\n          />\n          <motion.circle\n            cx={size / 2}\n            cy={size / 2}\n            r={radius}\n            fill=\"none\"\n            stroke={color}\n            strokeWidth={strokeWidth}\n            strokeLinecap=\"round\"\n            strokeDasharray={circumference}\n            initial={{ strokeDashoffset: circumference }}\n            animate={{ strokeDashoffset: offset }}\n            transition={{ duration: 1.5, ease: \"easeOut\" }}\n          />\n        </svg>\n        \n        {/* Center Content */}\n        <div className=\"absolute inset-0 flex flex-col items-center justify-center\">\n          <motion.div\n            className=\"text-center\"\n            initial={{ opacity: 0, scale: 0.5 }}\n            animate={{ opacity: 1, scale: 1 }}\n            transition={{ delay: 0.3, duration: 0.5 }}\n          >\n            <div className=\"text-4xl font-bold text-white\" data-testid=\"text-percentage\">\n              {Math.round(percentage)}\n            </div>\n            <div className=\"text-sm text-slate-400\">%</div>\n          </motion.div>\n        </div>\n      </div>\n      \n      {subLabel && (\n        <div className=\"text-center\">\n          <div className=\"text-sm font-medium text-slate-300\" data-testid=\"text-sublabel\">{subLabel}</div>\n        </div>\n      )}\n    </div>\n  );\n}\n","size_bytes":2435},"client/src/components/BarChartCard.tsx":{"content":"import { BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer } from 'recharts';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\n\ninterface BarChartData {\n  label: string;\n  value: number;\n}\n\ninterface BarChartCardProps {\n  data: BarChartData[];\n  title: string;\n  color?: string;\n  height?: number;\n  valueFormatter?: (value: number) => string;\n}\n\nexport default function BarChartCard({\n  data,\n  title,\n  color = \"hsl(var(--primary))\",\n  height = 200,\n  valueFormatter = (value) => value.toString(),\n}: BarChartCardProps) {\n  return (\n    <Card data-testid=\"card-barchart\">\n      <CardHeader className=\"pb-2\">\n        <CardTitle className=\"text-sm font-medium\">{title}</CardTitle>\n      </CardHeader>\n      <CardContent>\n        <ResponsiveContainer width=\"100%\" height={height}>\n          <BarChart data={data} margin={{ top: 5, right: 5, left: 5, bottom: 5 }}>\n            <CartesianGrid strokeDasharray=\"3 3\" stroke=\"hsl(var(--border))\" opacity={0.3} />\n            <XAxis \n              dataKey=\"label\" \n              stroke=\"hsl(var(--muted-foreground))\" \n              fontSize={12}\n              tickLine={false}\n            />\n            <YAxis \n              stroke=\"hsl(var(--muted-foreground))\" \n              fontSize={12}\n              tickLine={false}\n              tickFormatter={valueFormatter}\n            />\n            <Tooltip \n              contentStyle={{\n                backgroundColor: 'hsl(var(--popover))',\n                border: '1px solid hsl(var(--border))',\n                borderRadius: '6px',\n                fontSize: '12px',\n              }}\n              formatter={valueFormatter}\n              cursor={{ fill: 'hsl(var(--accent))' }}\n            />\n            <Bar \n              dataKey=\"value\" \n              fill={color}\n              radius={[4, 4, 0, 0]}\n            />\n          </BarChart>\n        </ResponsiveContainer>\n      </CardContent>\n    </Card>\n  );\n}\n","size_bytes":1964},"client/src/components/TimeSeriesChart.tsx":{"content":"import { AreaChart, Area, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer } from 'recharts';\n\ninterface TimeSeriesData {\n  time: string;\n  value: number;\n}\n\ninterface TimeSeriesChartProps {\n  data: TimeSeriesData[];\n  title: string;\n  color?: string;\n  height?: number;\n  valueFormatter?: (value: number) => string;\n}\n\nexport default function TimeSeriesChart({\n  data,\n  title,\n  color = \"rgb(168, 85, 247)\",\n  height = 200,\n  valueFormatter = (value) => value.toString(),\n}: TimeSeriesChartProps) {\n  return (\n    <ResponsiveContainer width=\"100%\" height={height}>\n      <AreaChart data={data} margin={{ top: 10, right: 10, left: -20, bottom: 0 }}>\n        <defs>\n          <linearGradient id=\"colorGradient\" x1=\"0\" y1=\"0\" x2=\"0\" y2=\"1\">\n            <stop offset=\"5%\" stopColor={color} stopOpacity={0.4} />\n            <stop offset=\"95%\" stopColor={color} stopOpacity={0} />\n          </linearGradient>\n        </defs>\n        <CartesianGrid strokeDasharray=\"3 3\" stroke=\"rgba(100, 100, 100, 0.2)\" vertical={false} />\n        <XAxis \n          dataKey=\"time\" \n          stroke=\"rgba(148, 163, 184, 0.5)\"\n          fontSize={11}\n          tickLine={false}\n          axisLine={false}\n        />\n        <YAxis \n          stroke=\"rgba(148, 163, 184, 0.5)\"\n          fontSize={11}\n          tickLine={false}\n          axisLine={false}\n          tickFormatter={valueFormatter}\n        />\n        <Tooltip \n          contentStyle={{\n            backgroundColor: 'rgba(15, 23, 42, 0.95)',\n            border: '1px solid rgba(100, 100, 100, 0.3)',\n            borderRadius: '8px',\n            fontSize: '12px',\n            color: '#fff',\n            backdropFilter: 'blur(10px)',\n          }}\n          formatter={(value: any) => [valueFormatter(value), 'Verifications']}\n          labelStyle={{ color: 'rgba(148, 163, 184, 0.8)' }}\n        />\n        <Area \n          type=\"monotone\" \n          dataKey=\"value\" \n          stroke={color} \n          strokeWidth={3}\n          fillOpacity={1} \n          fill=\"url(#colorGradient)\"\n          animationDuration={1500}\n        />\n      </AreaChart>\n    </ResponsiveContainer>\n  );\n}\n","size_bytes":2131},"server/geolocation.ts":{"content":"import geoip from 'geoip-lite';\n\nexport interface GeolocationData {\n  country: string | null;\n  countryName: string | null;\n  region: string | null;\n  city: string | null;\n  latitude: string | null;\n  longitude: string | null;\n  timezone: string | null;\n}\n\ninterface IPAPIResponse {\n  status: string;\n  country: string;\n  countryCode: string;\n  region: string;\n  regionName: string;\n  city: string;\n  zip: string;\n  lat: number;\n  lon: number;\n  timezone: string;\n  isp: string;\n  org: string;\n  as: string;\n  query: string;\n}\n\nconst countryNames: { [key: string]: string } = {\n  'US': 'United States',\n  'ID': 'Indonesia',\n  'GB': 'United Kingdom',\n  'IN': 'India',\n  'CN': 'China',\n  'JP': 'Japan',\n  'DE': 'Germany',\n  'FR': 'France',\n  'BR': 'Brazil',\n  'CA': 'Canada',\n  'AU': 'Australia',\n  'KR': 'South Korea',\n  'RU': 'Russia',\n  'MX': 'Mexico',\n  'IT': 'Italy',\n  'ES': 'Spain',\n  'NL': 'Netherlands',\n  'SG': 'Singapore',\n  'MY': 'Malaysia',\n  'TH': 'Thailand',\n  'PH': 'Philippines',\n  'VN': 'Vietnam',\n  'TR': 'Turkey',\n  'SA': 'Saudi Arabia',\n  'AE': 'United Arab Emirates',\n  'PL': 'Poland',\n  'SE': 'Sweden',\n  'NO': 'Norway',\n  'DK': 'Denmark',\n  'FI': 'Finland',\n  'BE': 'Belgium',\n  'CH': 'Switzerland',\n  'AT': 'Austria',\n  'IE': 'Ireland',\n  'NZ': 'New Zealand',\n  'ZA': 'South Africa',\n  'EG': 'Egypt',\n  'AR': 'Argentina',\n  'CL': 'Chile',\n  'CO': 'Colombia',\n  'PE': 'Peru',\n  'PK': 'Pakistan',\n  'BD': 'Bangladesh',\n  'NG': 'Nigeria',\n  'KE': 'Kenya',\n  'MA': 'Morocco',\n  'DZ': 'Algeria',\n  'TN': 'Tunisia',\n  'GH': 'Ghana',\n  'UG': 'Uganda',\n  'TZ': 'Tanzania',\n  'ET': 'Ethiopia',\n  'IL': 'Israel',\n  'IQ': 'Iraq',\n  'IR': 'Iran',\n  'JO': 'Jordan',\n  'LB': 'Lebanon',\n  'KW': 'Kuwait',\n  'QA': 'Qatar',\n  'OM': 'Oman',\n  'BH': 'Bahrain',\n  'YE': 'Yemen',\n  'SY': 'Syria',\n  'CZ': 'Czech Republic',\n  'HU': 'Hungary',\n  'RO': 'Romania',\n  'GR': 'Greece',\n  'PT': 'Portugal',\n  'UA': 'Ukraine',\n  'BG': 'Bulgaria',\n  'RS': 'Serbia',\n  'HR': 'Croatia',\n  'SK': 'Slovakia',\n  'SI': 'Slovenia',\n  'LT': 'Lithuania',\n  'LV': 'Latvia',\n  'EE': 'Estonia',\n  'IS': 'Iceland',\n  'LU': 'Luxembourg',\n  'MT': 'Malta',\n  'CY': 'Cyprus',\n  'HK': 'Hong Kong',\n  'TW': 'Taiwan',\n  'MM': 'Myanmar',\n  'KH': 'Cambodia',\n  'LA': 'Laos',\n  'NP': 'Nepal',\n  'LK': 'Sri Lanka',\n  'MV': 'Maldives',\n  'BT': 'Bhutan',\n  'AF': 'Afghanistan',\n  'MN': 'Mongolia',\n  'KZ': 'Kazakhstan',\n  'UZ': 'Uzbekistan',\n  'TM': 'Turkmenistan',\n  'TJ': 'Tajikistan',\n  'KG': 'Kyrgyzstan',\n  'GE': 'Georgia',\n  'AM': 'Armenia',\n  'AZ': 'Azerbaijan',\n  'BY': 'Belarus',\n  'MD': 'Moldova',\n  'AL': 'Albania',\n  'MK': 'North Macedonia',\n  'BA': 'Bosnia and Herzegovina',\n  'ME': 'Montenegro',\n  'XK': 'Kosovo',\n};\n\nfunction getCountryName(countryCode: string): string | null {\n  if (!countryCode) return null;\n  \n  if (countryNames[countryCode]) {\n    return countryNames[countryCode];\n  }\n  \n  return countryCode;\n}\n\nfunction isPrivateIP(ip: string): boolean {\n  const parts = ip.split('.');\n  if (parts.length !== 4) return false;\n  \n  const first = parseInt(parts[0]);\n  const second = parseInt(parts[1]);\n  \n  // 10.0.0.0 - 10.255.255.255\n  if (first === 10) return true;\n  \n  // 172.16.0.0 - 172.31.255.255\n  if (first === 172 && second >= 16 && second <= 31) return true;\n  \n  // 192.168.0.0 - 192.168.255.255\n  if (first === 192 && second === 168) return true;\n  \n  // 127.0.0.0 - 127.255.255.255 (localhost)\n  if (first === 127) return true;\n  \n  return false;\n}\n\nasync function fetchGeolocationFromAPI(ipAddress: string): Promise<GeolocationData | null> {\n  try {\n    // Use IP-API.com - free, no signup required, 45 req/minute\n    const response = await fetch(`http://ip-api.com/json/${ipAddress}?fields=status,country,countryCode,region,regionName,city,lat,lon,timezone`);\n    \n    if (!response.ok) {\n      console.warn(`[GEOLOCATION-API] HTTP error! status: ${response.status}`);\n      return null;\n    }\n    \n    const data: IPAPIResponse = await response.json();\n    \n    if (data.status !== 'success') {\n      console.warn(`[GEOLOCATION-API] ‚úó API returned failure status for IP: ${ipAddress}`);\n      return null;\n    }\n    \n    console.log(`[GEOLOCATION-API] ‚úì IP ${ipAddress} -> ${data.country} (${data.city || 'Unknown City'})`);\n    \n    return {\n      country: data.countryCode,\n      countryName: data.country,\n      region: data.regionName || data.region || null,\n      city: data.city || null,\n      latitude: data.lat ? data.lat.toString() : null,\n      longitude: data.lon ? data.lon.toString() : null,\n      timezone: data.timezone || null,\n    };\n  } catch (error) {\n    console.error('[GEOLOCATION-API] Error fetching geolocation from external API:', error);\n    return null;\n  }\n}\n\nexport async function getGeolocationFromIP(ipAddress: string | undefined | null): Promise<GeolocationData> {\n  const defaultData: GeolocationData = {\n    country: null,\n    countryName: null,\n    region: null,\n    city: null,\n    latitude: null,\n    longitude: null,\n    timezone: null,\n  };\n\n  // FIXED BUG: Better handling for missing/invalid IP addresses\n  if (!ipAddress || ipAddress === 'unknown' || ipAddress === '') {\n    console.warn('[GEOLOCATION] No valid IP address provided, returning default data. Received:', ipAddress);\n    return defaultData;\n  }\n\n  let cleanIP = ipAddress.trim();\n  \n  // Remove IPv6 prefix\n  if (cleanIP.startsWith('::ffff:')) {\n    cleanIP = cleanIP.replace('::ffff:', '');\n  }\n  \n  // Handle localhost\n  if (cleanIP === '127.0.0.1' || cleanIP === 'localhost' || cleanIP === '::1') {\n    console.log('[GEOLOCATION] Localhost IP detected:', cleanIP);\n    return {\n      country: 'XX',\n      countryName: 'Localhost',\n      region: 'Local',\n      city: 'Local',\n      latitude: '0',\n      longitude: '0',\n      timezone: 'UTC',\n    };\n  }\n\n  // Validate IP format (basic validation)\n  const ipv4Regex = /^(\\d{1,3}\\.){3}\\d{1,3}$/;\n  const ipv6Regex = /^([0-9a-fA-F]{0,4}:){2,7}[0-9a-fA-F]{0,4}$/;\n  \n  if (!ipv4Regex.test(cleanIP) && !ipv6Regex.test(cleanIP)) {\n    console.warn('[GEOLOCATION] Invalid IP format:', cleanIP);\n    return defaultData;\n  }\n\n  // Check if IP is private/internal\n  // Private IPs cannot be geolocated - they should have been filtered out by getClientIP()\n  // If we still receive one, it means no public IP was found in proxy chain\n  if (isPrivateIP(cleanIP)) {\n    console.warn(`[GEOLOCATION] Private IP detected (${cleanIP}) - cannot geolocate. This means getClientIP() could not find a public IP in proxy headers.`);\n    return {\n      country: null,\n      countryName: null,\n      region: null,\n      city: null,\n      latitude: null,\n      longitude: null,\n      timezone: null,\n    };\n  }\n\n  // Try local geoip-lite database first (faster)\n  try {\n    const geo = geoip.lookup(cleanIP);\n    \n    if (geo) {\n      const countryCode = geo.country;\n      const countryName = getCountryName(countryCode);\n      \n      console.log(`[GEOLOCATION] ‚úì Local DB: IP ${cleanIP} -> ${countryName || countryCode} (${geo.city || 'Unknown City'})`);\n      \n      return {\n        country: countryCode,\n        countryName: countryName,\n        region: geo.region || null,\n        city: geo.city || null,\n        latitude: geo.ll && geo.ll[0] ? geo.ll[0].toString() : null,\n        longitude: geo.ll && geo.ll[1] ? geo.ll[1].toString() : null,\n        timezone: geo.timezone || null,\n      };\n    } else {\n      console.warn(`[GEOLOCATION] ‚úó No data in local database for IP: ${cleanIP}, trying external API...`);\n    }\n  } catch (error) {\n    console.error('[GEOLOCATION] Error looking up in local database for IP', cleanIP, ':', error);\n  }\n\n  // Fallback to external API if local database fails\n  console.log(`[GEOLOCATION] Falling back to external API for IP: ${cleanIP}`);\n  const apiData = await fetchGeolocationFromAPI(cleanIP);\n  if (apiData) {\n    return apiData;\n  }\n\n  console.warn('[GEOLOCATION] All geolocation methods failed, returning default data');\n  return defaultData;\n}\n\nexport function formatGeolocationString(geo: GeolocationData): string {\n  const parts: string[] = [];\n  \n  if (geo.city) parts.push(geo.city);\n  if (geo.region) parts.push(geo.region);\n  if (geo.countryName) parts.push(geo.countryName);\n  \n  return parts.join(', ') || 'Unknown';\n}\n","size_bytes":8228},"client/src/components/CountryAnalyticsCard.tsx":{"content":"import { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Globe, TrendingUp, Users, Clock, MapPin } from \"lucide-react\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\n\ninterface CountryAnalytics {\n  country: string;\n  countryName: string;\n  totalVerifications: number;\n  successfulVerifications: number;\n  failedVerifications: number;\n  successRate: string;\n  uniqueIps: number;\n  averageTimeToSolve: number | null;\n}\n\ninterface CountryAnalyticsCardProps {\n  data: CountryAnalytics[];\n  isLoading?: boolean;\n}\n\nconst getCountryFlag = (countryCode: string): string => {\n  if (!countryCode || countryCode === 'Unknown' || countryCode === 'XX') return 'üåê';\n  \n  const codePoints = countryCode\n    .toUpperCase()\n    .split('')\n    .map(char => 127397 + char.charCodeAt(0));\n  return String.fromCodePoint(...codePoints);\n};\n\nexport default function CountryAnalyticsCard({ data, isLoading }: CountryAnalyticsCardProps) {\n  if (isLoading) {\n    return (\n      <Card>\n        <CardHeader className=\"gap-2\">\n          <div className=\"flex items-center justify-between gap-2\">\n            <CardTitle className=\"text-lg text-foreground flex items-center gap-2\">\n              <Globe className=\"h-5 w-5 text-blue-600 dark:text-blue-400\" />\n              Country Analytics\n            </CardTitle>\n          </div>\n        </CardHeader>\n        <CardContent>\n          <div className=\"flex items-center justify-center h-64\">\n            <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500\" />\n          </div>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  if (!data || data.length === 0) {\n    return (\n      <Card>\n        <CardHeader className=\"gap-2\">\n          <div className=\"flex items-center justify-between gap-2\">\n            <CardTitle className=\"text-lg text-foreground flex items-center gap-2\">\n              <Globe className=\"h-5 w-5 text-blue-600 dark:text-blue-400\" />\n              Country Analytics\n            </CardTitle>\n          </div>\n        </CardHeader>\n        <CardContent>\n          <div className=\"flex flex-col items-center justify-center h-64 text-muted-foreground\">\n            <MapPin className=\"h-12 w-12 mb-2 opacity-50\" />\n            <p>No country data available yet</p>\n          </div>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  return (\n    <Card data-testid=\"card-country-analytics\">\n      <CardHeader className=\"gap-2\">\n        <div className=\"flex items-center justify-between gap-2\">\n          <CardTitle className=\"text-lg text-foreground flex items-center gap-2\">\n            <Globe className=\"h-5 w-5 text-blue-600 dark:text-blue-400\" />\n            Verifications by Country\n          </CardTitle>\n          <Badge variant=\"secondary\" className=\"text-xs\">\n            Top {data.length}\n          </Badge>\n        </div>\n      </CardHeader>\n      <CardContent>\n        <ScrollArea className=\"h-[400px] pr-4\">\n          <div className=\"space-y-2\">\n            {data.map((country, index) => (\n              <div\n                key={country.country}\n                className=\"flex items-center gap-3 p-3 rounded-lg bg-muted/50 dark:bg-muted border border-border hover-elevate\"\n                data-testid={`country-item-${country.country}`}\n              >\n                <div className=\"text-3xl flex-shrink-0\">\n                  {getCountryFlag(country.country)}\n                </div>\n                \n                <div className=\"flex-1 min-w-0\">\n                  <div className=\"flex items-center gap-2 mb-1 flex-wrap\">\n                    <span className=\"font-medium text-foreground truncate\">\n                      {country.countryName}\n                    </span>\n                    <Badge variant=\"outline\" className=\"text-xs\">\n                      {country.country}\n                    </Badge>\n                    {index < 3 && (\n                      <Badge className=\"text-xs bg-gradient-to-r from-yellow-500 to-orange-500 text-white\">\n                        #{index + 1}\n                      </Badge>\n                    )}\n                  </div>\n                  \n                  <div className=\"grid grid-cols-2 sm:grid-cols-4 gap-2 text-xs\">\n                    <div className=\"flex items-center gap-1 text-muted-foreground\">\n                      <TrendingUp className=\"h-3 w-3 text-green-600 dark:text-green-400\" />\n                      <span className=\"truncate\">{country.totalVerifications} total</span>\n                    </div>\n                    \n                    <div className=\"flex items-center gap-1 text-muted-foreground\">\n                      <Users className=\"h-3 w-3 text-blue-600 dark:text-blue-400\" />\n                      <span className=\"truncate\">{country.uniqueIps} IPs</span>\n                    </div>\n                    \n                    <div className=\"flex items-center gap-1\">\n                      <span className={`font-medium ${\n                        parseFloat(country.successRate) >= 80 \n                          ? 'text-green-600 dark:text-green-400' \n                          : parseFloat(country.successRate) >= 50 \n                          ? 'text-yellow-600 dark:text-yellow-400' \n                          : 'text-red-600 dark:text-red-400'\n                      }`}>\n                        {country.successRate}\n                      </span>\n                      <span className=\"text-muted-foreground text-xs\">success</span>\n                    </div>\n                    \n                    {country.averageTimeToSolve && (\n                      <div className=\"flex items-center gap-1 text-muted-foreground\">\n                        <Clock className=\"h-3 w-3 text-purple-600 dark:text-purple-400\" />\n                        <span className=\"truncate\">{(country.averageTimeToSolve / 1000).toFixed(1)}s</span>\n                      </div>\n                    )}\n                  </div>\n                </div>\n              </div>\n            ))}\n          </div>\n        </ScrollArea>\n      </CardContent>\n    </Card>\n  );\n}\n","size_bytes":6084},"client/src/components/ApiKeySettingsDialog.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useTranslation } from \"react-i18next\";\nimport { Settings, AlertTriangle, Shield, Zap, Lock, Brain, Activity, Clock, X, ChevronsUpDown, Check } from \"lucide-react\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n} from \"@/components/ui/dialog\";\nimport {\n  Alert,\n  AlertDescription,\n  AlertTitle,\n} from \"@/components/ui/alert\";\nimport { Button } from \"@/components/ui/button\";\nimport { Label } from \"@/components/ui/label\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Input } from \"@/components/ui/input\";\nimport { Slider } from \"@/components/ui/slider\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { Badge } from \"@/components/ui/badge\";\nimport {\n  Command,\n  CommandEmpty,\n  CommandGroup,\n  CommandInput,\n  CommandItem,\n  CommandList,\n} from \"@/components/ui/command\";\nimport {\n  Popover,\n  PopoverContent,\n  PopoverTrigger,\n} from \"@/components/ui/popover\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport type { SecuritySettings } from \"@shared/schema\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { COUNTRIES } from \"@/lib/countries\";\nimport { cn } from \"@/lib/utils\";\n\ninterface ApiKeySettingsDialogProps {\n  apiKeyId: string;\n  apiKeyName: string;\n}\n\nexport default function ApiKeySettingsDialog({ apiKeyId, apiKeyName }: ApiKeySettingsDialogProps) {\n  const { t } = useTranslation();\n  const [isOpen, setIsOpen] = useState(false);\n  const [settings, setSettings] = useState<SecuritySettings | null>(null);\n  const [showWarning, setShowWarning] = useState<{ feature: string; show: boolean } | null>(null);\n  const [countryPopoverOpen, setCountryPopoverOpen] = useState(false);\n  const { toast } = useToast();\n\n  // Load settings from API\n  const { data: loadedSettings, isLoading } = useQuery<SecuritySettings>({\n    queryKey: [\"/api/keys\", apiKeyId, \"settings\"],\n    enabled: isOpen,\n  });\n\n  // Initialize local state when data loads\n  useEffect(() => {\n    if (loadedSettings) {\n      setSettings(loadedSettings);\n    }\n  }, [loadedSettings]);\n\n  const saveMutation = useMutation({\n    mutationFn: async (data: SecuritySettings) => {\n      const res = await apiRequest(\"PUT\", `/api/keys/${apiKeyId}/settings`, data);\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/keys\", apiKeyId, \"settings\"] });\n      setIsOpen(false);\n      toast({\n        title: t(\"apiKeys.settings.toast.saved.title\"),\n        description: t(\"apiKeys.settings.toast.saved.description\"),\n      });\n    },\n    onError: () => {\n      toast({\n        title: t(\"apiKeys.settings.toast.error.title\"),\n        description: t(\"apiKeys.settings.toast.error.description\"),\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleToggleFeature = (feature: string, currentValue: boolean) => {\n    if (!settings) return;\n\n    // If trying to disable a security feature, show warning first\n    if (currentValue === true) {\n      setShowWarning({ feature, show: true });\n    } else {\n      // Enabling feature - no warning needed\n      setSettings({ ...settings, [feature]: true });\n    }\n  };\n\n  const confirmDisable = () => {\n    if (!settings || !showWarning) return;\n    setSettings({ ...settings, [showWarning.feature]: false });\n    setShowWarning(null);\n  };\n\n  const handleSave = () => {\n    if (!settings) return;\n    saveMutation.mutate(settings);\n  };\n\n  if (!settings) {\n    return (\n      <Dialog open={isOpen} onOpenChange={setIsOpen}>\n        <DialogTrigger asChild>\n          <Button variant=\"outline\" size=\"sm\" data-testid={`button-settings-${apiKeyId}`}>\n            <Settings className=\"h-4 w-4 mr-2\" />\n            {t(\"apiKeys.settings.button\")}\n          </Button>\n        </DialogTrigger>\n        <DialogContent className=\"max-w-3xl max-h-[90vh] overflow-y-auto\">\n          <DialogHeader>\n            <DialogTitle>{t(\"apiKeys.settings.title\")}</DialogTitle>\n            <DialogDescription>\n              {t(\"apiKeys.settings.loading\", { name: apiKeyName })}\n            </DialogDescription>\n          </DialogHeader>\n          {isLoading && <p>{t(\"common.loading\")}</p>}\n        </DialogContent>\n      </Dialog>\n    );\n  }\n\n  return (\n    <>\n      <Dialog open={isOpen} onOpenChange={setIsOpen}>\n        <DialogTrigger asChild>\n          <Button variant=\"outline\" size=\"sm\" data-testid={`button-settings-${apiKeyId}`}>\n            <Settings className=\"h-4 w-4 mr-2\" />\n            {t(\"apiKeys.settings.button\")}\n          </Button>\n        </DialogTrigger>\n        <DialogContent className=\"max-w-4xl max-h-[90vh] overflow-y-auto\">\n          <DialogHeader>\n            <DialogTitle>{t(\"apiKeys.settings.titleFull\")}</DialogTitle>\n            <DialogDescription>\n              {t(\"apiKeys.settings.description\", { name: apiKeyName })}\n            </DialogDescription>\n          </DialogHeader>\n          \n          <Alert>\n            <Shield className=\"h-4 w-4\" />\n            <AlertTitle>{t(\"apiKeys.settings.coreSecurityTitle\")}</AlertTitle>\n            <AlertDescription>\n              {t(\"apiKeys.settings.coreSecurityDescription\")}\n            </AlertDescription>\n          </Alert>\n\n          <Tabs defaultValue=\"security\" className=\"w-full\">\n            <TabsList className=\"grid w-full grid-cols-3\">\n              <TabsTrigger value=\"security\">{t(\"apiKeys.settings.tabs.security\")}</TabsTrigger>\n              <TabsTrigger value=\"performance\">{t(\"apiKeys.settings.tabs.performance\")}</TabsTrigger>\n              <TabsTrigger value=\"design\">{t(\"apiKeys.settings.tabs.design\")}</TabsTrigger>\n            </TabsList>\n\n            <TabsContent value=\"security\" className=\"space-y-4 mt-4\">\n              <Card>\n                <CardHeader>\n                  <div className=\"flex items-center gap-2\">\n                    <Shield className=\"h-5 w-5 text-blue-500\" />\n                    <CardTitle>{t(\"apiKeys.settings.protectionFeatures.title\")}</CardTitle>\n                  </div>\n                  <CardDescription>\n                    {t(\"apiKeys.settings.protectionFeatures.description\")}\n                  </CardDescription>\n                </CardHeader>\n                <CardContent className=\"space-y-4\">\n                  {/* Anti-Debugger */}\n                  <div className=\"flex items-center justify-between\">\n                    <div className=\"space-y-0.5\">\n                      <Label htmlFor=\"antiDebugger\">{t(\"apiKeys.settings.protectionFeatures.antiDebugger.label\")}</Label>\n                      <p className=\"text-xs text-muted-foreground\">\n                        {t(\"apiKeys.settings.protectionFeatures.antiDebugger.description\")}\n                      </p>\n                    </div>\n                    <Switch\n                      id=\"antiDebugger\"\n                      checked={settings.antiDebugger}\n                      onCheckedChange={() => handleToggleFeature(\"antiDebugger\", settings.antiDebugger)}\n                      data-testid=\"switch-anti-debugger\"\n                    />\n                  </div>\n\n                  {/* Advanced Fingerprinting */}\n                  <div className=\"flex items-center justify-between\">\n                    <div className=\"space-y-0.5\">\n                      <Label htmlFor=\"advancedFingerprinting\">{t(\"apiKeys.settings.protectionFeatures.advancedFingerprinting.label\")}</Label>\n                      <p className=\"text-xs text-muted-foreground\">\n                        {t(\"apiKeys.settings.protectionFeatures.advancedFingerprinting.description\")}\n                      </p>\n                    </div>\n                    <Switch\n                      id=\"advancedFingerprinting\"\n                      checked={settings.advancedFingerprinting}\n                      onCheckedChange={() => handleToggleFeature(\"advancedFingerprinting\", settings.advancedFingerprinting)}\n                      data-testid=\"switch-fingerprinting\"\n                    />\n                  </div>\n\n                  {/* Session Binding */}\n                  <div className=\"flex items-center justify-between\">\n                    <div className=\"space-y-0.5\">\n                      <Label htmlFor=\"sessionBinding\">{t(\"apiKeys.settings.protectionFeatures.sessionBinding.label\")}</Label>\n                      <p className=\"text-xs text-muted-foreground\">\n                        {t(\"apiKeys.settings.protectionFeatures.sessionBinding.description\")}\n                      </p>\n                    </div>\n                    <Switch\n                      id=\"sessionBinding\"\n                      checked={settings.sessionBinding}\n                      onCheckedChange={() => handleToggleFeature(\"sessionBinding\", settings.sessionBinding)}\n                      data-testid=\"switch-session-binding\"\n                    />\n                  </div>\n\n                  {/* CSRF Protection */}\n                  <div className=\"flex items-center justify-between\">\n                    <div className=\"space-y-0.5\">\n                      <Label htmlFor=\"csrfProtection\">{t(\"apiKeys.settings.protectionFeatures.csrfProtection.label\")}</Label>\n                      <p className=\"text-xs text-muted-foreground\">\n                        {t(\"apiKeys.settings.protectionFeatures.csrfProtection.description\")}\n                      </p>\n                    </div>\n                    <Switch\n                      id=\"csrfProtection\"\n                      checked={settings.csrfProtection}\n                      onCheckedChange={() => handleToggleFeature(\"csrfProtection\", settings.csrfProtection)}\n                      data-testid=\"switch-csrf\"\n                    />\n                  </div>\n\n                  {/* IP Rate Limiting */}\n                  <div className=\"flex items-center justify-between\">\n                    <div className=\"space-y-0.5\">\n                      <Label htmlFor=\"ipRateLimiting\">{t(\"apiKeys.settings.protectionFeatures.ipRateLimiting.label\")}</Label>\n                      <p className=\"text-xs text-muted-foreground\">\n                        {t(\"apiKeys.settings.protectionFeatures.ipRateLimiting.description\")}\n                      </p>\n                    </div>\n                    <Switch\n                      id=\"ipRateLimiting\"\n                      checked={settings.ipRateLimiting}\n                      onCheckedChange={() => handleToggleFeature(\"ipRateLimiting\", settings.ipRateLimiting)}\n                      data-testid=\"switch-rate-limit\"\n                    />\n                  </div>\n\n                  {/* Automation Detection */}\n                  <div className=\"flex items-center justify-between\">\n                    <div className=\"space-y-0.5\">\n                      <Label htmlFor=\"automationDetection\">{t(\"apiKeys.settings.protectionFeatures.automationDetection.label\")}</Label>\n                      <p className=\"text-xs text-muted-foreground\">\n                        {t(\"apiKeys.settings.protectionFeatures.automationDetection.description\")}\n                      </p>\n                    </div>\n                    <Switch\n                      id=\"automationDetection\"\n                      checked={settings.automationDetection}\n                      onCheckedChange={() => handleToggleFeature(\"automationDetection\", settings.automationDetection)}\n                      data-testid=\"switch-automation\"\n                    />\n                  </div>\n\n                  {/* Behavioral Analysis */}\n                  <div className=\"flex items-center justify-between\">\n                    <div className=\"space-y-0.5\">\n                      <Label htmlFor=\"behavioralAnalysis\">{t(\"apiKeys.settings.protectionFeatures.behavioralAnalysis.label\")}</Label>\n                      <p className=\"text-xs text-muted-foreground\">\n                        {t(\"apiKeys.settings.protectionFeatures.behavioralAnalysis.description\")}\n                      </p>\n                    </div>\n                    <Switch\n                      id=\"behavioralAnalysis\"\n                      checked={settings.behavioralAnalysis}\n                      onCheckedChange={() => handleToggleFeature(\"behavioralAnalysis\", settings.behavioralAnalysis)}\n                      data-testid=\"switch-behavioral\"\n                    />\n                  </div>\n\n                  {/* Risk Adaptive Difficulty */}\n                  <div className=\"flex items-center justify-between\">\n                    <div className=\"space-y-0.5\">\n                      <Label htmlFor=\"riskAdaptiveDifficulty\">{t(\"apiKeys.settings.protectionFeatures.riskAdaptiveDifficulty.label\")}</Label>\n                      <p className=\"text-xs text-muted-foreground\">\n                        {t(\"apiKeys.settings.protectionFeatures.riskAdaptiveDifficulty.description\")}\n                      </p>\n                    </div>\n                    <Switch\n                      id=\"riskAdaptiveDifficulty\"\n                      checked={settings.riskAdaptiveDifficulty}\n                      onCheckedChange={() => handleToggleFeature(\"riskAdaptiveDifficulty\", settings.riskAdaptiveDifficulty)}\n                      data-testid=\"switch-adaptive\"\n                    />\n                  </div>\n                </CardContent>\n              </Card>\n\n              {/* IP and Country Blocking */}\n              <Card>\n                <CardHeader>\n                  <div className=\"flex items-center gap-2\">\n                    <Lock className=\"h-5 w-5 text-red-500\" />\n                    <CardTitle>{t(\"apiKeys.settings.accessControl.title\")}</CardTitle>\n                  </div>\n                  <CardDescription>\n                    {t(\"apiKeys.settings.accessControl.description\")}\n                  </CardDescription>\n                </CardHeader>\n                <CardContent className=\"space-y-4\">\n                  {/* Blocked IPs */}\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"blockedIps\">{t(\"apiKeys.settings.accessControl.blockedIps.label\")}</Label>\n                    <Input\n                      id=\"blockedIps\"\n                      placeholder={t(\"apiKeys.settings.accessControl.blockedIps.placeholder\")}\n                      value={(settings.blockedIps || []).join(', ')}\n                      onChange={(e) => {\n                        const ips = e.target.value.split(',').map(ip => ip.trim()).filter(ip => ip.length > 0);\n                        setSettings({ ...settings, blockedIps: ips });\n                      }}\n                      data-testid=\"input-blocked-ips\"\n                    />\n                    <p className=\"text-xs text-muted-foreground\">\n                      {t(\"apiKeys.settings.accessControl.blockedIps.helpText\")}\n                    </p>\n                  </div>\n\n                  {/* Blocked Countries */}\n                  <div className=\"space-y-2\">\n                    <Label>{t(\"apiKeys.settings.accessControl.blockedCountries.label\")}</Label>\n                    \n                    {/* Selected Countries as Badges */}\n                    {settings.blockedCountries && settings.blockedCountries.length > 0 && (\n                      <div className=\"flex flex-wrap gap-2 p-2 border rounded-md\">\n                        {settings.blockedCountries.map((code) => {\n                          const country = COUNTRIES.find(c => c.code === code);\n                          return (\n                            <Badge key={code} variant=\"secondary\" className=\"gap-1\">\n                              {country?.name || code}\n                              <button\n                                type=\"button\"\n                                onClick={() => {\n                                  setSettings({\n                                    ...settings,\n                                    blockedCountries: settings.blockedCountries?.filter(c => c !== code) || []\n                                  });\n                                }}\n                                className=\"ml-1 hover:bg-muted rounded-full\"\n                              >\n                                <X className=\"h-3 w-3\" />\n                              </button>\n                            </Badge>\n                          );\n                        })}\n                      </div>\n                    )}\n\n                    {/* Country Selector */}\n                    <Popover open={countryPopoverOpen} onOpenChange={setCountryPopoverOpen}>\n                      <PopoverTrigger asChild>\n                        <Button\n                          variant=\"outline\"\n                          role=\"combobox\"\n                          aria-expanded={countryPopoverOpen}\n                          className=\"w-full justify-between\"\n                          data-testid=\"button-select-countries\"\n                        >\n                          {t(\"apiKeys.settings.accessControl.blockedCountries.placeholder\")}\n                          <ChevronsUpDown className=\"ml-2 h-4 w-4 shrink-0 opacity-50\" />\n                        </Button>\n                      </PopoverTrigger>\n                      <PopoverContent className=\"w-full p-0\" align=\"start\">\n                        <Command>\n                          <CommandInput placeholder={t(\"apiKeys.settings.accessControl.blockedCountries.search\")} />\n                          <CommandList>\n                            <CommandEmpty>{t(\"apiKeys.settings.accessControl.blockedCountries.noResults\")}</CommandEmpty>\n                            <CommandGroup>\n                              {COUNTRIES.map((country) => {\n                                const isSelected = settings.blockedCountries?.includes(country.code);\n                                return (\n                                  <CommandItem\n                                    key={country.code}\n                                    value={`${country.name} ${country.code}`}\n                                    onSelect={() => {\n                                      const currentCountries = settings.blockedCountries || [];\n                                      if (isSelected) {\n                                        setSettings({\n                                          ...settings,\n                                          blockedCountries: currentCountries.filter(c => c !== country.code)\n                                        });\n                                      } else {\n                                        setSettings({\n                                          ...settings,\n                                          blockedCountries: [...currentCountries, country.code]\n                                        });\n                                      }\n                                    }}\n                                  >\n                                    <Check\n                                      className={cn(\n                                        \"mr-2 h-4 w-4\",\n                                        isSelected ? \"opacity-100\" : \"opacity-0\"\n                                      )}\n                                    />\n                                    {country.name}\n                                  </CommandItem>\n                                );\n                              })}\n                            </CommandGroup>\n                          </CommandList>\n                        </Command>\n                      </PopoverContent>\n                    </Popover>\n                    \n                    <p className=\"text-xs text-muted-foreground\">\n                      {t(\"apiKeys.settings.accessControl.blockedCountries.helpText\")}\n                    </p>\n                  </div>\n\n                  {(settings.blockedIps && settings.blockedIps.length > 0) || (settings.blockedCountries && settings.blockedCountries.length > 0) ? (\n                    <Alert>\n                      <AlertTriangle className=\"h-4 w-4\" />\n                      <AlertTitle>{t(\"apiKeys.settings.accessControl.restrictionsActive.title\")}</AlertTitle>\n                      <AlertDescription>\n                        {settings.blockedIps && settings.blockedIps.length > 0 && (\n                          <div>{t(\"apiKeys.settings.accessControl.restrictionsActive.blockingIps\", { count: settings.blockedIps.length })}</div>\n                        )}\n                        {settings.blockedCountries && settings.blockedCountries.length > 0 && (\n                          <div>{t(\"apiKeys.settings.accessControl.restrictionsActive.blockingCountries\", { count: settings.blockedCountries.length })}</div>\n                        )}\n                      </AlertDescription>\n                    </Alert>\n                  ) : null}\n                </CardContent>\n              </Card>\n            </TabsContent>\n\n            <TabsContent value=\"performance\" className=\"space-y-4 mt-4\">\n              <Card>\n                <CardHeader>\n                  <div className=\"flex items-center gap-2\">\n                    <Zap className=\"h-5 w-5 text-yellow-500\" />\n                    <CardTitle>{t(\"apiKeys.settings.performanceSettings.title\")}</CardTitle>\n                  </div>\n                  <CardDescription>\n                    {t(\"apiKeys.settings.performanceSettings.description\")}\n                  </CardDescription>\n                </CardHeader>\n                <CardContent className=\"space-y-6\">\n                  {/* Proof of Work Difficulty */}\n                  <div className=\"space-y-2\">\n                    <div className=\"flex items-center justify-between\">\n                      <Label htmlFor=\"powDifficulty\">{t(\"apiKeys.settings.performanceSettings.powDifficulty.label\")}</Label>\n                      <span className=\"text-sm font-medium\">{settings.proofOfWorkDifficulty}/10</span>\n                    </div>\n                    <Slider\n                      id=\"powDifficulty\"\n                      min={1}\n                      max={10}\n                      step={1}\n                      value={[settings.proofOfWorkDifficulty]}\n                      onValueChange={(value) => setSettings({ ...settings, proofOfWorkDifficulty: value[0] })}\n                      data-testid=\"slider-difficulty\"\n                    />\n                    <p className=\"text-xs text-muted-foreground\">\n                      {t(\"apiKeys.settings.performanceSettings.powDifficulty.helpText\")}\n                    </p>\n                  </div>\n\n                  {/* Rate Limit Settings */}\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"rateLimit\">{t(\"apiKeys.settings.performanceSettings.rateLimit.label\")}</Label>\n                    <Input\n                      id=\"rateLimit\"\n                      type=\"number\"\n                      min={1}\n                      max={1000}\n                      value={settings.rateLimitMaxRequests}\n                      onChange={(e) => setSettings({ ...settings, rateLimitMaxRequests: parseInt(e.target.value) || 30 })}\n                      data-testid=\"input-rate-limit\"\n                    />\n                    <p className=\"text-xs text-muted-foreground\">\n                      {t(\"apiKeys.settings.performanceSettings.rateLimit.helpText\")}\n                    </p>\n                  </div>\n                </CardContent>\n              </Card>\n            </TabsContent>\n\n            <TabsContent value=\"design\" className=\"space-y-4 mt-4\">\n              <Card>\n                <CardHeader>\n                  <div className=\"flex items-center gap-2\">\n                    <Activity className=\"h-5 w-5 text-purple-500\" />\n                    <CardTitle>{t(\"apiKeys.settings.challengeDesign.title\")}</CardTitle>\n                  </div>\n                  <CardDescription>\n                    {t(\"apiKeys.settings.challengeDesign.description\")}\n                  </CardDescription>\n                </CardHeader>\n                <CardContent className=\"space-y-6\">\n                  {/* Challenge Timeout */}\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"challengeTimeout\">{t(\"apiKeys.settings.challengeDesign.challengeTimeout.label\")}</Label>\n                    <Input\n                      id=\"challengeTimeout\"\n                      type=\"number\"\n                      min={10}\n                      max={300}\n                      value={settings.challengeTimeoutMs / 1000}\n                      onChange={(e) => setSettings({ ...settings, challengeTimeoutMs: (parseInt(e.target.value) || 60) * 1000 })}\n                      data-testid=\"input-challenge-timeout\"\n                    />\n                    <p className=\"text-xs text-muted-foreground\">\n                      {t(\"apiKeys.settings.challengeDesign.challengeTimeout.helpText\")}\n                    </p>\n                  </div>\n\n                  {/* Token Expiry */}\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"tokenExpiry\">{t(\"apiKeys.settings.challengeDesign.tokenExpiry.label\")}</Label>\n                    <Input\n                      id=\"tokenExpiry\"\n                      type=\"number\"\n                      min={30}\n                      max={600}\n                      value={settings.tokenExpiryMs / 1000}\n                      onChange={(e) => setSettings({ ...settings, tokenExpiryMs: (parseInt(e.target.value) || 60) * 1000 })}\n                      data-testid=\"input-token-expiry\"\n                    />\n                    <p className=\"text-xs text-muted-foreground\">\n                      {t(\"apiKeys.settings.challengeDesign.tokenExpiry.helpText\")}\n                    </p>\n                  </div>\n\n                  {/* Challenge Types */}\n                  <div className=\"space-y-2\">\n                    <Label>{t(\"apiKeys.settings.challengeDesign.enabledTypes.label\")}</Label>\n                    <div className=\"space-y-2\">\n                      {[\n                        { value: 'grid', label: t(\"apiKeys.settings.challengeDesign.enabledTypes.grid\") },\n                        { value: 'jigsaw', label: t(\"apiKeys.settings.challengeDesign.enabledTypes.jigsaw\") },\n                        { value: 'gesture', label: t(\"apiKeys.settings.challengeDesign.enabledTypes.gesture\") },\n                        { value: 'upside_down', label: t(\"apiKeys.settings.challengeDesign.enabledTypes.upsideDown\") },\n                      ].map((type) => (\n                        <div key={type.value} className=\"flex items-center space-x-2\">\n                          <Checkbox\n                            id={`type-${type.value}`}\n                            checked={settings.enabledChallengeTypes.includes(type.value as any)}\n                            onCheckedChange={(checked) => {\n                              if (checked) {\n                                setSettings({\n                                  ...settings,\n                                  enabledChallengeTypes: [...settings.enabledChallengeTypes, type.value as any]\n                                });\n                              } else {\n                                setSettings({\n                                  ...settings,\n                                  enabledChallengeTypes: settings.enabledChallengeTypes.filter(t => t !== type.value)\n                                });\n                              }\n                            }}\n                            data-testid={`checkbox-${type.value}`}\n                          />\n                          <Label htmlFor={`type-${type.value}`} className=\"font-normal cursor-pointer\">\n                            {type.label}\n                          </Label>\n                        </div>\n                      ))}\n                    </div>\n                    {settings.enabledChallengeTypes.length === 0 && (\n                      <p className=\"text-xs text-destructive\">\n                        {t(\"apiKeys.settings.challengeDesign.enabledTypes.atLeastOne\")}\n                      </p>\n                    )}\n                  </div>\n                </CardContent>\n              </Card>\n            </TabsContent>\n          </Tabs>\n\n          <DialogFooter>\n            <Button variant=\"outline\" onClick={() => setIsOpen(false)}>\n              {t(\"apiKeys.settings.buttons.cancel\")}\n            </Button>\n            <Button onClick={handleSave} disabled={saveMutation.isPending} data-testid=\"button-save-settings\">\n              {saveMutation.isPending ? t(\"apiKeys.settings.buttons.saving\") : t(\"apiKeys.settings.buttons.save\")}\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      {/* Warning Dialog */}\n      <Dialog open={showWarning?.show || false} onOpenChange={(open) => !open && setShowWarning(null)}>\n        <DialogContent>\n          <DialogHeader>\n            <div className=\"flex items-center gap-2\">\n              <AlertTriangle className=\"h-5 w-5 text-amber-500\" />\n              <DialogTitle>{t(\"apiKeys.settings.warnings.title\")}</DialogTitle>\n            </div>\n            <DialogDescription>\n              {t(\"apiKeys.settings.warnings.description\")}\n            </DialogDescription>\n          </DialogHeader>\n          \n          {showWarning && (\n            <Alert variant=\"destructive\">\n              <AlertTriangle className=\"h-4 w-4\" />\n              <AlertTitle>{t(`apiKeys.settings.warnings.${showWarning.feature}.title`)}</AlertTitle>\n              <AlertDescription>\n                {t(`apiKeys.settings.warnings.${showWarning.feature}.description`)}\n              </AlertDescription>\n            </Alert>\n          )}\n\n          <DialogFooter>\n            <Button variant=\"outline\" onClick={() => setShowWarning(null)}>\n              {t(\"apiKeys.settings.buttons.cancel\")}\n            </Button>\n            <Button variant=\"destructive\" onClick={confirmDisable} data-testid=\"button-confirm-disable\">\n              {t(\"apiKeys.settings.buttons.disableAnyway\")}\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n    </>\n  );\n}\n","size_bytes":30195},".local/state/replit/agent/progress_tracker.md":{"content":"[x] 1. Install the required packages\n[x] 2. Restart the workflow to see if the project is working\n[x] 3. Verify the project is working - Application is running successfully on port 5000\n[x] 4. Verify api.js security integrations - All security systems integrated\n[x] 5. Inform user the import is completed and they can start building, mark the import as completed using the complete_project_import tool\n[x] 6. Upgrade fingerprinting system with Canvas, WebGL, Audio, Fonts, Screen, and more\n[x] 7. Integrate advanced fingerprinting into all challenge and verify requests\n[x] 8. Create obfuscation system for production code protection with RC4 encryption and anti-debugging\n[x] 9. Create source code obfuscation system with automatic backup and restore capabilities\n[x] 10. Configure workflow with proper webview output type and port 5000\n[x] 11. Verify application starts successfully with database migrations\n[x] 12. Confirm all systems operational - Ready for user\n[x] 13. Implement immediate captcha refresh on refresh button click and incorrect answers - Reduced delay from 5s to 0.8s\n[x] 14. Add smooth slide animations for captcha transitions - Captcha slides out left, new captcha slides in from right on refresh/timeout/incorrect\n[x] 15. Fix double slide animation bug - Added isReloading flag to prevent duplicate renderChallenge calls\n[x] 16. Final npm install completed - All dependencies installed successfully\n[x] 17. Application verified running on port 5000 - Migration complete\n[x] 18. Fixed bug #1 (REVERTED - wrong fix): Removed duplicate event listener - caused checkbox to stop working\n[x] 19. Fixed bug #2: Improved IP address extraction for Replit environment to enable proper country detection in analytics  \n[x] 20. Fixed bug #1 (ATTEMPT 1): Added verificationToken reset in reset() function to prevent old success tokens from being reused\n[x] 21. Fixed bug #1 (FINAL FIX): Removed duplicate event listener in render() to prevent callback from being triggered multiple times when re-clicking widget after success\n[x] 22. Added advanced security settings feature - Developers can configure security features per API key\n[x] 23. Created database schema for settings storage with comprehensive SecuritySettings type\n[x] 24. Built settings management UI with warnings for security feature toggles\n[x] 25. Implemented backend API endpoints for loading and saving per-API-key settings\n[x] 26. Migration to Replit environment completed - November 14, 2025\n[x] 27. Dependencies reinstalled and workflow restarted successfully\n[x] 28. Application verified running on port 5000 with all features operational\n[x] 29. Project import marked as complete and ready for development\n[x] 30. November 15, 2025 - Re-verified migration: Dependencies installed, workflow configured with webview on port 5000\n[x] 31. All systems operational - Database migrations completed, demo API key created, application serving on port 5000\n[x] 32. November 15, 2025 - Fixed custom settings by API key integration - Settings now properly control api.js behavior\n[x] 33. api.js updated: challengeTimeoutMs now read from securityConfig (removed hardcoded 60000ms)\n[x] 34. api.js updated: tokenExpiryMs now read from securityConfig with fallback to challengeTimeoutMs\n[x] 35. Implemented conditional advanced fingerprinting - collectFingerprint() method respects advancedFingerprinting setting\n[x] 36. Backend routes.ts updated to send complete securityConfig: antiDebugger, challengeTimeoutMs, tokenExpiryMs, advancedFingerprinting\n[x] 37. Custom settings flow verified working end-to-end: Dashboard -> Database -> Backend -> api.js -> User Experience\n[x] 38. November 16, 2025 - Re-migration to Replit environment: npm install completed successfully\n[x] 39. Workflow configured with webview output type on port 5000 and restarted\n[x] 40. Database migrations executed successfully - Demo API key created\n[x] 41. Application verified running and serving on port 5000 - ProofCaptcha homepage loading correctly\n[x] 42. All systems operational - Project fully migrated and ready for development\n[x] 43. November 16, 2025 14:21 - Workflow restarted successfully after migration verification\n[x] 44. All systems operational - Ready for new feature development (email integration pending user request)\n[x] 45. November 16, 2025 14:21 - Migration verification: Workflow reconfigured with webview output type on port 5000\n[x] 46. Application confirmed running: Database migrations completed, demo API key created (pk_ab6c4ac2...)\n[x] 47. Express server serving on port 5000, cleanup tasks configured, all systems operational\n[x] 48. Migration to Replit environment complete - Ready for development\n[x] 49. November 16, 2025 19:38 - Final migration verification: npm install completed successfully\n[x] 50. Workflow reconfigured with webview output type and restarted on port 5000\n[x] 51. Database migrations executed successfully, demo API key verified (pk_ab6c4ac2...)\n[x] 52. Application verified running: ProofCaptcha homepage loading correctly with all features\n[x] 53. All systems operational: Email service initialized, database connected, cleanup tasks running\n[x] 54. Project import completed successfully - Ready for active development\n[x] 55. November 16, 2025 19:40 - Bug Fix: Email verification redirect issue resolved\n[x] 56. Added 2-second delay before dashboard redirect after successful email verification\n[x] 57. Updated toast message to inform users about automatic redirect\n[x] 58. Workflow restarted successfully - Bug fix applied and tested\n[x] 59. November 16, 2025 19:45 - Bug Fix: CSRF token missing in forgot-password page\n[x] 60. Added CSRF token fetch before POST request to /api/auth/forgot-password\n[x] 61. Security enhancement: All auth pages now properly protected with CSRF tokens\n[x] 62. Workflow restarted successfully - CSRF protection implemented\n[x] 63. November 16, 2025 19:53 - Bug Fix: Stuck on verify-email page after successful verification\n[x] 64. Fixed race condition: Added await for invalidateQueries and refetchQueries to ensure state updates\n[x] 65. Reduced redirect delay to 500ms after query refetch completes\n[x] 66. Ensured developer.isEmailVerified state is updated before redirect to dashboard\n[x] 67. Workflow restarted successfully - Email verification redirect working properly\n[x] 68. November 16, 2025 20:00 - Bug Fix: Stuck on verify-email page when already verified\n[x] 69. Added useEffect auto-redirect: Checks developer.isEmailVerified on page load and redirects if true\n[x] 70. Handle \"Already verified\" error: If backend returns \"Already verified\", show success toast and redirect\n[x] 71. Added error handler for \"already verified\" message in catch block\n[x] 72. Triple protection: useEffect check, success response handling, error response handling\n[x] 73. Workflow restarted successfully - Already verified users will auto-redirect to dashboard\n[x] 74. November 16, 2025 20:09 - CRITICAL BUG FIX: Backend not sending isEmailVerified field\n[x] 75. Root cause identified: /api/auth/user endpoint only returned id, email, name - missing isEmailVerified\n[x] 76. Fixed server/routes.ts line 779: Added isEmailVerified to user response\n[x] 77. Frontend now receives complete user data with verification status\n[x] 78. All redirect logic (ProtectedRoute + useEffect) will now work correctly\n[x] 79. Workflow restarted successfully - VERIFY EMAIL BUG COMPLETELY FIXED\n[x] 80. November 17, 2025 - Migration to Replit environment: npm install completed successfully\n[x] 81. Workflow configured with webview output type on port 5000 and restarted\n[x] 82. Database migrations executed successfully - Demo API key verified (pk_ab6c4ac2...)\n[x] 83. Application verified running: Express server serving on port 5000, cleanup tasks running\n[x] 84. All systems operational - Project fully migrated and ready for development\n[x] 85. November 17, 2025 - CRITICAL BUG FIX: Captcha widget tidak bisa diklik di halaman /api-docs\n[x] 86. Root cause identified: .card-3d::before pseudo-element memiliki position:absolute dengan inset:0 yang memblokir pointer events\n[x] 87. Fixed client/src/index.css: Added pointer-events:none to .card-3d::before pseudo-element\n[x] 88. Solution applied: Invisible overlay sekarang tidak lagi memblokir klik pada widget captcha\n[x] 89. Workflow restarted successfully - Captcha widget dan challenge selector sekarang bisa diklik dengan normal\n[x] 90. November 17, 2025 - IMPROVEMENT: Memperbaiki tampilan overlay captcha agar seperti api.js\n[x] 91. Added fadeIn and slideUp animations to client/src/index.css matching api.js styling\n[x] 92. Updated CaptchaWidget.tsx overlay dengan animasi fadeIn 0.2s ease-in-out untuk smooth appearance\n[x] 93. Updated modal dengan animasi slideUp 0.2s ease-in-out untuk smooth slide-up effect\n[x] 94. Enhanced overlay dengan proper z-index (9999), backdrop-filter blur(8px), dan shadow yang lebih dramatis\n[x] 95. Workflow restarted successfully - Overlay sekarang terlihat profesional seperti di api.js dengan animasi smooth\n[x] 96. November 17, 2025 - RESPONSIVE DESIGN: Semua tantangan sekarang mendukung mode mobile dan desktop\n[x] 97. Grid Challenge: Responsive padding (p-3 sm:p-6), text (text-xs sm:text-sm), emoji size (text-lg sm:text-2xl), grid items (h-20 sm:h-28), dan maxWidth yang disesuaikan\n[x] 98. Jigsaw Challenge: Responsive layout dengan gap-2 sm:gap-4, piece height (h-20 sm:h-28), emoji size (text-2xl sm:text-4xl), ring size (ring-2 sm:ring-4)\n[x] 99. Gesture/Puzzle Challenge: Responsive header, description, button text, dan loader size untuk mobile dan desktop\n[x] 100. Upside Down Challenge: Updated UpsideDownCaptcha.tsx dengan responsive padding, text, spinner, dan buttons - Reset button shows icon (‚Üª) on mobile\n[x] 101. All challenges: Consistent responsive patterns - smaller spacing/text on mobile (text-xs, p-3, gap-2), larger on desktop (text-base, p-6, gap-3)\n[x] 102. Workflow restarted successfully - Semua tantangan captcha sekarang tampil rapi di mobile dan desktop\n[x] 103. November 17, 2025 - LANGUAGE FIX: Adding all missing translations to en.json and id.json for hardcoded Indonesian text\n[x] 104. Added comprehensive translations for Register page, VerifyEmail, ResetPassword, and VerifyResetCode pages\n[x] 105. Updating Register.tsx to use i18n translation system - COMPLETED\n[x] 106. Updating VerifyEmailPage.tsx to use i18n translation system - COMPLETED\n[x] 107. Updating ResetPasswordPage.tsx to use i18n translation system - COMPLETED\n[x] 108. Updating VerifyResetCodePage.tsx to use i18n translation system - COMPLETED\n[x] 109. Call architect to review i18n implementation - Found 3 issues to fix\n[x] 110. Fixed Architect feedback: \n  - Made Zod schemas dynamic using factory functions with t() for validation messages\n  - Replaced literal \"Error\" titles with t('auth.error')\n  - Updated copy-to-clipboard toast to use translated sitekey/secretkey labels\n[x] 111. Added missing translation keys to en.json and id.json (error, resetCodeMustBe6, passwordMinLength, etc.)\n[x] 112. Final architect review - Found issue with form resolver not updating on language change\n[x] 113. Fixed form resolver issue:\n  - Added useMemo for schemas keyed on i18n.language\n  - Added useEffect to clear form errors on language change\n  - Imported i18n from useTranslation hook\n  - Applied to VerifyEmailPage, ResetPasswordPage, and VerifyResetCodePage\n[x] 114. User reported Home page still has hardcoded text\n[x] 115. Fixed Home.tsx hardcoded text:\n  - Added translation keys for trust indicators (freeToStart, noCreditCard, quickSetup)\n  - Added missing home.stats and home.features.title/subtitle keys to en.json\n  - Updated id.json with Indonesian translations for all new keys\n  - Updated Home.tsx trust indicators section to use t() function\n[x] 116. Architect found hardcoded English fallback in Register.tsx error handling\n[x] 117. Fixed Register.tsx hardcoded fallback:\n  - Changed \"Registration failed\" to t('register.registrationError')\n  - Now all error messages properly localize based on selected language\n[x] 118. Final architect verification - PASSED ‚úÖ\n  - All hardcoded strings eliminated across all authentication pages\n  - Dynamic Zod schemas work correctly with language switching\n  - All toast notifications and error messages properly localized\n  - No remaining issues detected\n\n## ‚úÖ COMPLETE - Full i18n Migration Successful\n\n**Final Implementation Summary:**\n\n**Pages with Full i18n Support:**\n1. ‚úÖ Home.tsx - Hero section, stats, features, trust indicators, CTA\n2. ‚úÖ Register.tsx - All UI text, validation, toasts, error messages (including fallbacks)\n3. ‚úÖ VerifyEmailPage.tsx - Complete email verification flow with dynamic validation\n4. ‚úÖ ResetPasswordPage.tsx - Complete password reset flow with dynamic validation\n5. ‚úÖ VerifyResetCodePage.tsx - Complete reset code verification with dynamic validation\n\n**Technical Achievements:**\n- ‚úÖ Dynamic Zod schema factories using t() parameter for validation messages\n- ‚úÖ Form resolvers update on language change using useMemo keyed on i18n.language\n- ‚úÖ useEffect clears form errors when language switches for clean UX\n- ‚úÖ All toast notifications use translation keys (no hardcoded text)\n- ‚úÖ All error paths including network failures use localized messages\n- ‚úÖ Translation keys well-organized and semantically meaningful\n- ‚úÖ Implementation follows React i18next best practices\n\n**Translation Coverage:**\n- ‚úÖ 100% coverage in en.json and id.json for all targeted pages\n- ‚úÖ All UI text, labels, buttons, placeholders, validation messages\n- ‚úÖ All toast notifications (success, error, info)\n- ‚úÖ All error fallbacks and network error messages\n\n**Architect Review:** PASSED with no remaining issues\n**Application Status:** Running successfully, hot reload working\n**Ready for:** User testing in both English and Indonesian languages\n\n---\n\n## üìö November 17, 2025 - Documentation Overhaul Complete\n\n[x] 118. README.md completely refactored and updated with actual project state:\n  - ‚úÖ Comprehensive Quick Start guide with environment setup, database migrations, demo data\n  - ‚úÖ Detailed development setup instructions (npm install, .env configuration, npm run dev)\n  - ‚úÖ Full documentation of all 6 challenge types (Grid, Jigsaw, Gesture, Upside-Down, Slider, Checkbox)\n  - ‚úÖ Integration guides for Node.js, PHP, Python with complete code examples\n  - ‚úÖ Backend verification examples showing proper security practices\n  - ‚úÖ Complete API Reference (client-side and server-side)\n  - ‚úÖ Security Features section documenting E2EE, bot detection, anti-debugger, obfuscation\n  - ‚úÖ Advanced Configuration section with per-API-key security settings\n  - ‚úÖ Obfuscation & Anti-Debugger section with npm scripts and usage\n  - ‚úÖ Analytics Dashboard documentation\n  - ‚úÖ Internationalization (i18n) section with language support details\n  - ‚úÖ Development section with project structure and available scripts\n  - ‚úÖ Troubleshooting section with common issues and solutions\n  - ‚úÖ Contributing guidelines\n\n[x] 119. SECURITY.md created with comprehensive security documentation:\n  - ‚úÖ Security Policy with vulnerability disclosure process\n  - ‚úÖ Supported Versions table with update policy\n  - ‚úÖ Detailed vulnerability report template\n  - ‚úÖ Response timeline and bounty program information\n  - ‚úÖ Complete Security Architecture documentation:\n    * End-to-End Encryption (ECDH + HKDF + AES-GCM)\n    * Multi-Layer Bot Detection (5 layers)\n    * Anti-Debugger Protection\n    * Code Obfuscation (RC4 backend, Base64 frontend)\n    * Domain Validation\n    * Session Management with fingerprint binding\n  - ‚úÖ Security Features breakdown (core vs configurable)\n  - ‚úÖ Security Best Practices for developers (10+ guidelines)\n  - ‚úÖ Known Security Considerations with mitigation strategies (10 issues)\n  - ‚úÖ Security Audit Log with CVE tracking\n  - ‚úÖ Security Testing recommendations\n  - ‚úÖ Security Contact information\n\n[x] 120. Documentation matches actual implementation:\n  - ‚úÖ All npm scripts documented correctly (dev, build, obfuscate, db:push, setup-db, etc.)\n  - ‚úÖ Database schema documentation matches shared/schema.ts\n  - ‚úÖ API endpoints documented with actual request/response formats\n  - ‚úÖ Security features documentation matches server implementation\n  - ‚úÖ Challenge types documentation matches client/src/components/challenges/\n  - ‚úÖ i18n documentation matches actual i18next setup (en.json, id.json)\n  - ‚úÖ Environment variables match .env.example\n  - ‚úÖ Project structure matches actual directory layout\n\n[x] 121. Documentation quality improvements:\n  - ‚úÖ Professional formatting with emojis and clear sections\n  - ‚úÖ Table of contents for easy navigation\n  - ‚úÖ Code examples in multiple languages (JavaScript, PHP, Python)\n  - ‚úÖ Security diagrams (ASCII art) showing encryption flow\n  - ‚úÖ Clear distinction between mandatory and optional features\n  - ‚úÖ Warning boxes for critical security information\n  - ‚úÖ Troubleshooting section with solutions\n  - ‚úÖ Best practices with do's and don'ts\n  - ‚úÖ Complete cross-referencing between README.md and SECURITY.md\n\n**Documentation Status:** ‚úÖ COMPLETE\n**README.md:** 800+ lines of comprehensive documentation\n**SECURITY.md:** 1000+ lines of detailed security documentation\n**Coverage:** 100% of project features and capabilities documented","size_bytes":17376},"client/src/pages/VerifyEmailPage.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useLocation } from \"wouter\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { queryClient } from \"@/lib/queryClient\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { Shield, Mail, ArrowRight, RefreshCw } from \"lucide-react\";\nimport { useAuth } from \"@/hooks/use-auth\";\nimport { useTranslation } from \"react-i18next\";\nimport { useMemo } from \"react\";\n\nconst createVerificationSchema = (t: (key: string) => string) => z.object({\n  code: z.string().length(6, t('auth.verificationCodeMustBe6')),\n});\n\nexport default function VerifyEmailPage() {\n  const { t, i18n } = useTranslation();\n  const verificationSchema = useMemo(() => createVerificationSchema(t), [t, i18n.language]);\n  type VerificationData = z.infer<typeof verificationSchema>;\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  const { developer } = useAuth();\n  const [isResending, setIsResending] = useState(false);\n\n  const form = useForm<VerificationData>({\n    resolver: zodResolver(verificationSchema),\n    defaultValues: {\n      code: \"\",\n    },\n  });\n\n  // Update form resolver when language changes\n  useEffect(() => {\n    form.clearErrors();\n  }, [i18n.language, form]);\n\n  // Auto-redirect if already verified\n  useEffect(() => {\n    if (developer?.isEmailVerified) {\n      toast({\n        title: t('auth.emailAlreadyVerified'),\n        description: t('auth.alreadyVerifiedRedirect'),\n      });\n      setTimeout(() => {\n        setLocation(\"/dashboard\");\n      }, 1000);\n    }\n  }, [developer, setLocation, toast, t]);\n\n  const onSubmit = async (data: VerificationData) => {\n    try {\n      // Get CSRF token\n      const csrfResponse = await fetch(\"/api/security/csrf\", {\n        credentials: \"include\",\n      });\n      const { csrfToken } = await csrfResponse.json();\n\n      const response = await fetch(\"/api/auth/verify-email\", {\n        method: \"POST\",\n        headers: { \n          \"Content-Type\": \"application/json\",\n          \"X-CSRF-Token\": csrfToken,\n        },\n        body: JSON.stringify(data),\n        credentials: \"include\",\n      });\n\n      const result = await response.json();\n\n      if (result.success) {\n        toast({\n          title: t('auth.emailVerified'),\n          description: t('auth.emailVerifiedDesc'),\n        });\n        \n        // Invalidate and refetch user query to get updated verification status\n        await queryClient.invalidateQueries({ queryKey: [\"/api/auth/user\"] });\n        await queryClient.refetchQueries({ queryKey: [\"/api/auth/user\"] });\n        \n        // Redirect to dashboard after query refetch completes\n        setTimeout(() => {\n          setLocation(\"/dashboard\");\n        }, 500);\n      } else if (result.error === \"Already verified\" || result.message?.includes(\"already verified\")) {\n        // Handle already verified case - redirect to dashboard\n        toast({\n          title: t('auth.emailAlreadyVerified'),\n          description: t('auth.alreadyVerifiedRedirect'),\n        });\n        \n        // Refetch user data and redirect\n        await queryClient.invalidateQueries({ queryKey: [\"/api/auth/user\"] });\n        await queryClient.refetchQueries({ queryKey: [\"/api/auth/user\"] });\n        \n        setTimeout(() => {\n          setLocation(\"/dashboard\");\n        }, 1000);\n      } else {\n        throw new Error(result.message || t('auth.verificationError'));\n      }\n    } catch (error: any) {\n      // Check if error is about already verified\n      if (error.message?.includes(\"already verified\") || error.message?.includes(\"Already verified\")) {\n        toast({\n          title: t('auth.emailAlreadyVerified'),\n          description: t('auth.alreadyVerifiedRedirect'),\n        });\n        \n        setTimeout(() => {\n          setLocation(\"/dashboard\");\n        }, 1000);\n      } else {\n        toast({\n          variant: \"destructive\",\n          title: t('auth.verificationFailed'),\n          description: error.message || t('auth.invalidVerificationCode'),\n        });\n      }\n    }\n  };\n\n  const handleResendCode = async () => {\n    setIsResending(true);\n    try {\n      // Get CSRF token\n      const csrfResponse = await fetch(\"/api/security/csrf\", {\n        credentials: \"include\",\n      });\n      const { csrfToken } = await csrfResponse.json();\n\n      const response = await fetch(\"/api/auth/resend-verification\", {\n        method: \"POST\",\n        headers: {\n          \"X-CSRF-Token\": csrfToken,\n        },\n        credentials: \"include\",\n      });\n\n      const result = await response.json();\n\n      if (result.success) {\n        toast({\n          title: t('auth.codeSentAgain'),\n          description: t('auth.newCodeSent'),\n        });\n      } else {\n        throw new Error(result.message || t('auth.failedToResend'));\n      }\n    } catch (error: any) {\n      toast({\n        variant: \"destructive\",\n        title: t('auth.failedToResend'),\n        description: error.message || t('auth.resendError'),\n      });\n    } finally {\n      setIsResending(false);\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen flex items-center justify-center p-4 relative overflow-hidden\">\n      {/* Animated gradient background blobs */}\n      <div className=\"absolute inset-0 -z-10\">\n        <div className=\"absolute top-0 -left-4 w-72 h-72 sm:w-96 sm:h-96 bg-primary/30 rounded-full mix-blend-multiply filter blur-3xl opacity-70 animate-blob dark:opacity-50\" />\n        <div className=\"absolute top-0 -right-4 w-72 h-72 sm:w-96 sm:h-96 bg-purple-300/30 rounded-full mix-blend-multiply filter blur-3xl opacity-70 animate-blob animation-delay-2000 dark:opacity-50 dark:bg-purple-500/20\" />\n        <div className=\"absolute -bottom-8 left-20 w-72 h-72 sm:w-96 sm:h-96 bg-blue-300/30 rounded-full mix-blend-multiply filter blur-3xl opacity-70 animate-blob animation-delay-4000 dark:opacity-50 dark:bg-blue-500/20\" />\n      </div>\n\n      <Card className=\"w-full max-w-md relative overflow-hidden border-2 shadow-2xl backdrop-blur-sm bg-card/95\">\n        {/* Card gradient overlay */}\n        <div className=\"absolute inset-0 bg-gradient-to-br from-primary/5 to-purple-500/5 opacity-50 pointer-events-none\" />\n        \n        <CardHeader className=\"text-center space-y-2 sm:space-y-3 relative px-4 sm:px-6 pt-6\">\n          {/* Floating 3D icon */}\n          <div className=\"flex justify-center mb-3 sm:mb-4 perspective-1000\">\n            <div className=\"relative transform-gpu hover:scale-110 transition-all duration-500 floating\">\n              <div className=\"absolute inset-0 bg-gradient-to-br from-primary/50 to-purple-500/50 rounded-2xl sm:rounded-3xl blur-xl sm:blur-2xl opacity-60 animate-pulse-slow\" />\n              <div className=\"relative bg-gradient-to-br from-primary to-purple-600 p-4 sm:p-6 rounded-2xl sm:rounded-3xl shadow-2xl transform rotate-3 hover:rotate-0 transition-all duration-500\">\n                <Mail className=\"w-10 h-10 sm:w-12 sm:h-12 text-white drop-shadow-lg\" />\n              </div>\n            </div>\n          </div>\n          \n          <CardTitle className=\"text-xl sm:text-2xl font-bold bg-gradient-to-r from-foreground to-muted-foreground bg-clip-text text-transparent\">\n            {t('auth.emailVerificationTitle')}\n          </CardTitle>\n          <CardDescription className=\"text-sm sm:text-base px-2\">\n            {t('auth.emailVerificationSubtitle')}{\" \"}\n            <span className=\"font-semibold text-foreground\">{developer?.email}</span>\n          </CardDescription>\n        </CardHeader>\n        <CardContent className=\"space-y-4 sm:space-y-6 relative px-4 sm:px-6 pb-6\">\n          <Form {...form}>\n            <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-3 sm:space-y-4\">\n              <FormField\n                control={form.control}\n                name=\"code\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>{t('auth.verificationCodeLabel')}</FormLabel>\n                    <FormControl>\n                      <Input\n                        {...field}\n                        placeholder={t('auth.enterCodePlaceholder')}\n                        maxLength={6}\n                        className=\"text-center text-2xl tracking-widest font-mono\"\n                        autoComplete=\"off\"\n                        data-testid=\"input-verification-code\"\n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <Button\n                type=\"submit\"\n                className=\"w-full shadow-lg hover:shadow-xl transition-all duration-300\"\n                disabled={form.formState.isSubmitting}\n                data-testid=\"button-verify\"\n              >\n                {form.formState.isSubmitting ? (\n                  <>\n                    <Shield className=\"mr-2 h-4 w-4 animate-spin\" />\n                    {t('auth.verifying')}\n                  </>\n                ) : (\n                  <>\n                    {t('auth.emailVerificationTitle')}\n                    <ArrowRight className=\"ml-2 h-4 w-4\" />\n                  </>\n                )}\n              </Button>\n            </form>\n          </Form>\n\n          <div className=\"space-y-4\">\n            <div className=\"relative\">\n              <div className=\"absolute inset-0 flex items-center\">\n                <div className=\"w-full border-t\" />\n              </div>\n              <div className=\"relative flex justify-center text-sm\">\n                <span className=\"bg-card px-2 text-muted-foreground\">\n                  {t('auth.or')}\n                </span>\n              </div>\n            </div>\n\n            <Button\n              variant=\"outline\"\n              className=\"w-full backdrop-blur-sm\"\n              onClick={handleResendCode}\n              disabled={isResending}\n              data-testid=\"button-resend-code\"\n            >\n              {isResending ? (\n                <>\n                  <RefreshCw className=\"mr-2 h-4 w-4 animate-spin\" />\n                  {t('auth.sending')}\n                </>\n              ) : (\n                <>\n                  <RefreshCw className=\"mr-2 h-4 w-4\" />\n                  {t('auth.resendCode')}\n                </>\n              )}\n            </Button>\n          </div>\n\n          <div className=\"text-center text-sm text-muted-foreground\">\n            <p>{t('auth.codeExpiresIn')}</p>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":10837},"server/email-service.ts":{"content":"import dotenv from 'dotenv';\ndotenv.config({ override: true });\n\nimport nodemailer from 'nodemailer';\n\ninterface EmailConfig {\n  host: string;\n  port: number;\n  secure: boolean;\n  auth: {\n    user: string;\n    pass: string;\n  };\n  from: string;\n}\n\nclass EmailService {\n  private transporter: nodemailer.Transporter | null = null;\n  private config: EmailConfig | null = null;\n\n  constructor() {\n    this.initialize();\n  }\n\n  private initialize() {\n    const host = process.env.SMTP_HOST;\n    const port = parseInt(process.env.SMTP_PORT || '587');\n    const user = process.env.SMTP_USER;\n    const pass = process.env.SMTP_PASSWORD;\n    const from = process.env.SMTP_FROM_EMAIL;\n\n    if (!host || !user || !pass || !from) {\n      console.warn('[EMAIL] SMTP configuration incomplete, email service disabled');\n      return;\n    }\n\n    this.config = {\n      host,\n      port,\n      secure: port === 465,\n      auth: { user, pass },\n      from,\n    };\n\n    this.transporter = nodemailer.createTransport({\n      host: this.config.host,\n      port: this.config.port,\n      secure: this.config.secure,\n      auth: this.config.auth,\n      tls: {\n        rejectUnauthorized: process.env.SMTP_TLS_REJECT_UNAUTHORIZED !== 'false',\n        servername: process.env.SMTP_TLS_SERVERNAME || undefined,\n      },\n    });\n\n    console.log('[EMAIL] Email service initialized successfully');\n  }\n\n  async sendVerificationEmail(to: string, code: string, name: string): Promise<boolean> {\n    if (!this.transporter || !this.config) {\n      console.error('[EMAIL] Email service not configured');\n      return false;\n    }\n\n    try {\n      const mailOptions = {\n        from: `ProofCaptcha <${this.config.from}>`,\n        to,\n        subject: 'üîê Verifikasi Email Anda - ProofCaptcha',\n        html: `\n          <!DOCTYPE html>\n          <html lang=\"id\">\n          <head>\n            <meta charset=\"utf-8\">\n            <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n            <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\n            <title>Verifikasi Email</title>\n            <!--[if mso]>\n            <style type=\"text/css\">\n              body, table, td {font-family: Arial, Helvetica, sans-serif !important;}\n            </style>\n            <![endif]-->\n          </head>\n          <body style=\"margin: 0; padding: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh;\">\n            <!-- Outer wrapper -->\n            <table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" role=\"presentation\" style=\"background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 60px 20px;\">\n              <tr>\n                <td align=\"center\">\n                  <!-- Main container -->\n                  <table width=\"600\" cellpadding=\"0\" cellspacing=\"0\" role=\"presentation\" style=\"max-width: 600px; background-color: #ffffff; border-radius: 16px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); overflow: hidden;\">\n                    \n                    <!-- Header with logo and icon -->\n                    <tr>\n                      <td style=\"padding: 48px 40px; text-align: center; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); position: relative;\">\n                        <!-- Decorative circles -->\n                        <div style=\"position: absolute; top: -50px; right: -50px; width: 150px; height: 150px; background: rgba(255,255,255,0.1); border-radius: 50%;\"></div>\n                        <div style=\"position: absolute; bottom: -30px; left: -30px; width: 100px; height: 100px; background: rgba(255,255,255,0.1); border-radius: 50%;\"></div>\n                        \n                        <!-- Logo/Brand -->\n                        <div style=\"position: relative; z-index: 1;\">\n                          <!-- ProofCaptcha Logo -->\n                          <svg width=\"280\" height=\"80\" viewBox=\"0 0 280 80\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\" style=\"margin-bottom: 8px;\">\n                            <!-- Shield Icon -->\n                            <g transform=\"translate(0, 10)\">\n                              <path d=\"M30 5L15 10V22C15 30.5 19.8 38.5 30 41C40.2 38.5 45 30.5 45 22V10L30 5Z\" fill=\"white\" fill-opacity=\"0.95\"/>\n                              <path d=\"M27 32L21 26L22.4 24.6L27 29.2L37.6 18.6L39 20L27 32Z\" fill=\"#667eea\"/>\n                              <!-- Decorative glow -->\n                              <circle cx=\"30\" cy=\"23\" r=\"18\" fill=\"white\" fill-opacity=\"0.2\" filter=\"url(#glow)\"/>\n                            </g>\n                            \n                            <!-- ProofCaptcha Text -->\n                            <text x=\"65\" y=\"38\" font-family=\"-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif\" font-size=\"28\" font-weight=\"700\" fill=\"white\" letter-spacing=\"-0.5\">\n                              Proof<tspan fill=\"rgba(255,255,255,0.9)\">Captcha</tspan>\n                            </text>\n                            \n                            <!-- Tagline -->\n                            <text x=\"65\" y=\"54\" font-family=\"-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif\" font-size=\"11\" font-weight=\"500\" fill=\"rgba(255,255,255,0.85)\" letter-spacing=\"0.5\">\n                              ADVANCED BOT PROTECTION\n                            </text>\n                            \n                            <!-- Glow filter -->\n                            <defs>\n                              <filter id=\"glow\">\n                                <feGaussianBlur stdDeviation=\"3\" result=\"coloredBlur\"/>\n                                <feMerge>\n                                  <feMergeNode in=\"coloredBlur\"/>\n                                  <feMergeNode in=\"SourceGraphic\"/>\n                                </feMerge>\n                              </filter>\n                            </defs>\n                          </svg>\n                        </div>\n                      </td>\n                    </tr>\n                    \n                    <!-- Main content -->\n                    <tr>\n                      <td style=\"padding: 48px 40px;\">\n                        <!-- Greeting -->\n                        <h2 style=\"margin: 0 0 16px 0; color: #1a1a1a; font-size: 28px; font-weight: 700; line-height: 1.3;\">\n                          Halo, ${name}! üëã\n                        </h2>\n                        <p style=\"margin: 0 0 32px 0; color: #4b5563; font-size: 16px; line-height: 1.6;\">\n                          Terima kasih telah bergabung dengan ProofCaptcha! Kami senang Anda di sini. Untuk mengamankan akun Anda, silakan verifikasi email dengan kode di bawah ini.\n                        </p>\n                        \n                        <!-- Verification code card -->\n                        <div style=\"background: linear-gradient(135deg, #f8f9ff 0%, #f0f4ff 100%); border: 2px solid #e0e7ff; border-radius: 16px; padding: 32px; text-align: center; margin: 32px 0; position: relative; overflow: hidden;\">\n                          <!-- Decorative gradient overlay -->\n                          <div style=\"position: absolute; top: 0; left: 0; right: 0; height: 4px; background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);\"></div>\n                          \n                          <div style=\"display: inline-block; background: rgba(102, 126, 234, 0.1); padding: 8px 16px; border-radius: 20px; margin-bottom: 16px;\">\n                            <p style=\"margin: 0; color: #667eea; font-size: 12px; font-weight: 700; text-transform: uppercase; letter-spacing: 1.5px;\">Kode Verifikasi Anda</p>\n                          </div>\n                          \n                          <div style=\"background: #ffffff; border-radius: 12px; padding: 24px; margin: 16px 0; box-shadow: 0 4px 12px rgba(102, 126, 234, 0.1);\">\n                            <p style=\"margin: 0; color: #667eea; font-size: 48px; font-weight: 800; letter-spacing: 12px; font-family: 'Courier New', Consolas, monospace; text-shadow: 0 2px 4px rgba(102, 126, 234, 0.2);\">\n                              ${code}\n                            </p>\n                          </div>\n                          \n                          <p style=\"margin: 16px 0 0 0; color: #6b7280; font-size: 13px; line-height: 1.5;\">\n                            <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" style=\"vertical-align: middle; margin-right: 4px;\">\n                              <path d=\"M12 22C6.477 22 2 17.523 2 12S6.477 2 12 2s10 4.477 10 10-4.477 10-10 10zm0-2a8 8 0 1 0 0-16 8 8 0 0 0 0 16zM11 7h2v2h-2V7zm0 4h2v6h-2v-6z\" fill=\"#f59e0b\"/>\n                            </svg>\n                            Kode ini akan <strong style=\"color: #f59e0b;\">kadaluarsa dalam 15 menit</strong>\n                          </p>\n                        </div>\n                        \n                        <!-- Security notice -->\n                        <div style=\"background: #fef3c7; border-left: 4px solid #f59e0b; border-radius: 8px; padding: 16px 20px; margin: 24px 0;\">\n                          <p style=\"margin: 0; color: #92400e; font-size: 14px; line-height: 1.6;\">\n                            <strong style=\"color: #78350f;\">üîí Tips Keamanan:</strong><br>\n                            Jangan bagikan kode ini kepada siapa pun. Tim ProofCaptcha tidak akan pernah meminta kode verifikasi Anda melalui email, telepon, atau pesan.\n                          </p>\n                        </div>\n                        \n                        <!-- Didn't request notice -->\n                        <div style=\"background: #f9fafb; border-radius: 8px; padding: 20px; margin: 24px 0;\">\n                          <p style=\"margin: 0; color: #6b7280; font-size: 14px; line-height: 1.6; text-align: center;\">\n                            Tidak melakukan pendaftaran ini?<br>\n                            <span style=\"color: #9ca3af;\">Abaikan email ini dengan aman. Akun Anda tetap terlindungi.</span>\n                          </p>\n                        </div>\n                      </td>\n                    </tr>\n                    \n                    <!-- Footer -->\n                    <tr>\n                      <td style=\"padding: 32px 40px; background: linear-gradient(to bottom, #f9fafb 0%, #f3f4f6 100%); border-top: 1px solid #e5e7eb;\">\n                        <table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\">\n                          <tr>\n                            <td style=\"text-align: center; padding-bottom: 16px;\">\n                              <p style=\"margin: 0 0 12px 0; color: #6b7280; font-size: 13px; font-weight: 600;\">Butuh Bantuan?</p>\n                              <a href=\"mailto:support@proofcaptcha.com\" style=\"color: #667eea; text-decoration: none; font-size: 14px; font-weight: 500;\">support@proofcaptcha.com</a>\n                            </td>\n                          </tr>\n                          <tr>\n                            <td style=\"text-align: center; padding: 16px 0; border-top: 1px solid #e5e7eb;\">\n                              <p style=\"margin: 0 0 8px 0; color: #9ca3af; font-size: 12px; line-height: 1.5;\">\n                                ¬© ${new Date().getFullYear()} ProofCaptcha. All rights reserved.<br>\n                                Email otomatis, mohon tidak membalas.\n                              </p>\n                            </td>\n                          </tr>\n                        </table>\n                      </td>\n                    </tr>\n                  </table>\n                  \n                  <!-- Bottom spacing -->\n                  <table width=\"600\" cellpadding=\"0\" cellspacing=\"0\" style=\"max-width: 600px;\">\n                    <tr>\n                      <td style=\"padding: 24px 0; text-align: center;\">\n                        <p style=\"margin: 0; color: rgba(255,255,255,0.8); font-size: 12px;\">\n                          Powered by ProofCaptcha Security\n                        </p>\n                      </td>\n                    </tr>\n                  </table>\n                </td>\n              </tr>\n            </table>\n          </body>\n          </html>\n        `,\n        text: `\nHalo ${name}!\n\nTerima kasih telah mendaftar di ProofCaptcha. Untuk menyelesaikan pendaftaran Anda, silakan masukkan kode verifikasi berikut:\n\nKODE VERIFIKASI: ${code}\n\nKode ini akan kadaluarsa dalam 15 menit. Jika Anda tidak melakukan pendaftaran ini, abaikan email ini.\n\n¬© ${new Date().getFullYear()} ProofCaptcha. All rights reserved.\n        `.trim(),\n      };\n\n      await this.transporter.sendMail(mailOptions);\n      console.log(`[EMAIL] Verification email sent successfully to ${to}`);\n      return true;\n    } catch (error) {\n      console.error('[EMAIL] Failed to send verification email:', error);\n      return false;\n    }\n  }\n\n  async sendPasswordResetEmail(to: string, code: string, name: string): Promise<boolean> {\n    if (!this.transporter || !this.config) {\n      console.error('[EMAIL] Email service not configured');\n      return false;\n    }\n\n    try {\n      const mailOptions = {\n        from: `ProofCaptcha <${this.config.from}>`,\n        to,\n        subject: 'üîë Reset Password - ProofCaptcha',\n        html: `\n          <!DOCTYPE html>\n          <html lang=\"id\">\n          <head>\n            <meta charset=\"utf-8\">\n            <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n            <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\n            <title>Reset Password</title>\n            <!--[if mso]>\n            <style type=\"text/css\">\n              body, table, td {font-family: Arial, Helvetica, sans-serif !important;}\n            </style>\n            <![endif]-->\n          </head>\n          <body style=\"margin: 0; padding: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh;\">\n            <!-- Outer wrapper -->\n            <table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" role=\"presentation\" style=\"background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 60px 20px;\">\n              <tr>\n                <td align=\"center\">\n                  <!-- Main container -->\n                  <table width=\"600\" cellpadding=\"0\" cellspacing=\"0\" role=\"presentation\" style=\"max-width: 600px; background-color: #ffffff; border-radius: 16px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); overflow: hidden;\">\n                    \n                    <!-- Header with logo and icon -->\n                    <tr>\n                      <td style=\"padding: 48px 40px; text-align: center; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); position: relative;\">\n                        <!-- Decorative circles -->\n                        <div style=\"position: absolute; top: -50px; right: -50px; width: 150px; height: 150px; background: rgba(255,255,255,0.1); border-radius: 50%;\"></div>\n                        <div style=\"position: absolute; bottom: -30px; left: -30px; width: 100px; height: 100px; background: rgba(255,255,255,0.1); border-radius: 50%;\"></div>\n                        \n                        <!-- Logo/Brand -->\n                        <div style=\"position: relative; z-index: 1;\">\n                          <!-- ProofCaptcha Logo -->\n                          <svg width=\"280\" height=\"80\" viewBox=\"0 0 280 80\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\" style=\"margin-bottom: 8px;\">\n                            <!-- Shield Icon -->\n                            <g transform=\"translate(0, 10)\">\n                              <path d=\"M30 5L15 10V22C15 30.5 19.8 38.5 30 41C40.2 38.5 45 30.5 45 22V10L30 5Z\" fill=\"white\" fill-opacity=\"0.95\"/>\n                              <path d=\"M27 32L21 26L22.4 24.6L27 29.2L37.6 18.6L39 20L27 32Z\" fill=\"#667eea\"/>\n                              <!-- Decorative glow -->\n                              <circle cx=\"30\" cy=\"23\" r=\"18\" fill=\"white\" fill-opacity=\"0.2\" filter=\"url(#glow2)\"/>\n                            </g>\n                            \n                            <!-- ProofCaptcha Text -->\n                            <text x=\"65\" y=\"38\" font-family=\"-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif\" font-size=\"28\" font-weight=\"700\" fill=\"white\" letter-spacing=\"-0.5\">\n                              Proof<tspan fill=\"rgba(255,255,255,0.9)\">Captcha</tspan>\n                            </text>\n                            \n                            <!-- Tagline -->\n                            <text x=\"65\" y=\"54\" font-family=\"-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif\" font-size=\"11\" font-weight=\"500\" fill=\"rgba(255,255,255,0.85)\" letter-spacing=\"0.5\">\n                              ADVANCED BOT PROTECTION\n                            </text>\n                            \n                            <!-- Glow filter -->\n                            <defs>\n                              <filter id=\"glow2\">\n                                <feGaussianBlur stdDeviation=\"3\" result=\"coloredBlur\"/>\n                                <feMerge>\n                                  <feMergeNode in=\"coloredBlur\"/>\n                                  <feMergeNode in=\"SourceGraphic\"/>\n                                </feMerge>\n                              </filter>\n                            </defs>\n                          </svg>\n                        </div>\n                      </td>\n                    </tr>\n                    \n                    <!-- Main content -->\n                    <tr>\n                      <td style=\"padding: 48px 40px;\">\n                        <!-- Greeting -->\n                        <h2 style=\"margin: 0 0 16px 0; color: #1a1a1a; font-size: 28px; font-weight: 700; line-height: 1.3;\">\n                          Reset Password üîê\n                        </h2>\n                        <p style=\"margin: 0 0 24px 0; color: #4b5563; font-size: 16px; line-height: 1.6;\">\n                          Halo, <strong>${name}</strong>!\n                        </p>\n                        <p style=\"margin: 0 0 32px 0; color: #4b5563; font-size: 16px; line-height: 1.6;\">\n                          Kami menerima permintaan untuk mereset password akun Anda. Gunakan kode verifikasi di bawah ini untuk melanjutkan proses reset password.\n                        </p>\n                        \n                        <!-- Reset code card -->\n                        <div style=\"background: linear-gradient(135deg, #fff4ed 0%, #ffe8d9 100%); border: 2px solid #fed7aa; border-radius: 16px; padding: 32px; text-align: center; margin: 32px 0; position: relative; overflow: hidden;\">\n                          <!-- Decorative gradient overlay -->\n                          <div style=\"position: absolute; top: 0; left: 0; right: 0; height: 4px; background: linear-gradient(90deg, #f97316 0%, #ea580c 100%);\"></div>\n                          \n                          <div style=\"display: inline-block; background: rgba(249, 115, 22, 0.1); padding: 8px 16px; border-radius: 20px; margin-bottom: 16px;\">\n                            <p style=\"margin: 0; color: #ea580c; font-size: 12px; font-weight: 700; text-transform: uppercase; letter-spacing: 1.5px;\">Kode Reset Password</p>\n                          </div>\n                          \n                          <div style=\"background: #ffffff; border-radius: 12px; padding: 24px; margin: 16px 0; box-shadow: 0 4px 12px rgba(249, 115, 22, 0.15);\">\n                            <p style=\"margin: 0; color: #ea580c; font-size: 48px; font-weight: 800; letter-spacing: 12px; font-family: 'Courier New', Consolas, monospace; text-shadow: 0 2px 4px rgba(249, 115, 22, 0.2);\">\n                              ${code}\n                            </p>\n                          </div>\n                          \n                          <p style=\"margin: 16px 0 0 0; color: #6b7280; font-size: 13px; line-height: 1.5;\">\n                            <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" style=\"vertical-align: middle; margin-right: 4px;\">\n                              <path d=\"M12 22C6.477 22 2 17.523 2 12S6.477 2 12 2s10 4.477 10 10-4.477 10-10 10zm0-2a8 8 0 1 0 0-16 8 8 0 0 0 0 16zM11 7h2v2h-2V7zm0 4h2v6h-2v-6z\" fill=\"#f59e0b\"/>\n                            </svg>\n                            Kode ini akan <strong style=\"color: #f59e0b;\">kadaluarsa dalam 15 menit</strong>\n                          </p>\n                        </div>\n                        \n                        <!-- Action steps -->\n                        <div style=\"background: #f0f9ff; border-left: 4px solid #0ea5e9; border-radius: 8px; padding: 20px 24px; margin: 24px 0;\">\n                          <p style=\"margin: 0 0 12px 0; color: #0c4a6e; font-size: 15px; font-weight: 700;\">\n                            üìã Langkah Selanjutnya:\n                          </p>\n                          <ol style=\"margin: 0; padding-left: 20px; color: #075985; font-size: 14px; line-height: 1.8;\">\n                            <li>Masukkan kode 6 digit di atas pada halaman verifikasi</li>\n                            <li>Buat password baru yang kuat dan unik</li>\n                            <li>Simpan password Anda dengan aman</li>\n                          </ol>\n                        </div>\n                        \n                        <!-- Security notice -->\n                        <div style=\"background: #fef2f2; border-left: 4px solid #ef4444; border-radius: 8px; padding: 16px 20px; margin: 24px 0;\">\n                          <p style=\"margin: 0; color: #991b1b; font-size: 14px; line-height: 1.6;\">\n                            <strong style=\"color: #7f1d1d;\">‚ö†Ô∏è Peringatan Keamanan:</strong><br>\n                            Jangan bagikan kode ini kepada siapa pun, termasuk staf ProofCaptcha. Kami tidak akan pernah meminta kode reset password Anda.\n                          </p>\n                        </div>\n                        \n                        <!-- Didn't request notice -->\n                        <div style=\"background: #f9fafb; border-radius: 8px; padding: 20px; margin: 24px 0;\">\n                          <p style=\"margin: 0; color: #6b7280; font-size: 14px; line-height: 1.6; text-align: center;\">\n                            <strong>Tidak melakukan permintaan reset password?</strong><br>\n                            <span style=\"color: #9ca3af;\">Segera amankan akun Anda dengan mengganti password. Abaikan email ini jika Anda sudah mengamankan akun.</span>\n                          </p>\n                        </div>\n                      </td>\n                    </tr>\n                    \n                    <!-- Footer -->\n                    <tr>\n                      <td style=\"padding: 32px 40px; background: linear-gradient(to bottom, #f9fafb 0%, #f3f4f6 100%); border-top: 1px solid #e5e7eb;\">\n                        <table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\">\n                          <tr>\n                            <td style=\"text-align: center; padding-bottom: 16px;\">\n                              <p style=\"margin: 0 0 12px 0; color: #6b7280; font-size: 13px; font-weight: 600;\">Butuh Bantuan?</p>\n                              <a href=\"mailto:support@proofcaptcha.com\" style=\"color: #667eea; text-decoration: none; font-size: 14px; font-weight: 500;\">support@proofcaptcha.com</a>\n                            </td>\n                          </tr>\n                          <tr>\n                            <td style=\"text-align: center; padding: 16px 0; border-top: 1px solid #e5e7eb;\">\n                              <p style=\"margin: 0 0 8px 0; color: #9ca3af; font-size: 12px; line-height: 1.5;\">\n                                ¬© ${new Date().getFullYear()} ProofCaptcha. All rights reserved.<br>\n                                Email otomatis, mohon tidak membalas.\n                              </p>\n                            </td>\n                          </tr>\n                        </table>\n                      </td>\n                    </tr>\n                  </table>\n                  \n                  <!-- Bottom spacing -->\n                  <table width=\"600\" cellpadding=\"0\" cellspacing=\"0\" style=\"max-width: 600px;\">\n                    <tr>\n                      <td style=\"padding: 24px 0; text-align: center;\">\n                        <p style=\"margin: 0; color: rgba(255,255,255,0.8); font-size: 12px;\">\n                          Powered by ProofCaptcha Security\n                        </p>\n                      </td>\n                    </tr>\n                  </table>\n                </td>\n              </tr>\n            </table>\n          </body>\n          </html>\n        `,\n        text: `\nHalo ${name},\n\nKami menerima permintaan untuk reset password akun Anda. Gunakan kode berikut untuk melanjutkan:\n\nKODE RESET: ${code}\n\nKode ini akan kadaluarsa dalam 15 menit. Jika Anda tidak melakukan permintaan ini, abaikan email ini.\n\n¬© ${new Date().getFullYear()} ProofCaptcha. All rights reserved.\n        `.trim(),\n      };\n\n      await this.transporter.sendMail(mailOptions);\n      console.log(`[EMAIL] Password reset email sent successfully to ${to}`);\n      return true;\n    } catch (error) {\n      console.error('[EMAIL] Failed to send password reset email:', error);\n      return false;\n    }\n  }\n}\n\nexport const emailService = new EmailService();\n","size_bytes":25516},"client/src/pages/ForgotPasswordPage.tsx":{"content":"import { useState, useEffect, useRef } from \"react\";\nimport { useLocation } from \"wouter\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { KeyRound, Mail, ArrowLeft } from \"lucide-react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { useTranslation } from \"react-i18next\";\n\ndeclare global {\n  interface Window {\n    onCaptchaSuccess?: (token: string) => void;\n    onCaptchaError?: (error: string) => void;\n  }\n}\n\n// Schema definition needs to use dynamic translation in component\nconst getForgotPasswordSchema = (t: (key: string) => string) => z.object({\n  email: z.string().email(t('auth.invalidEmail')),\n});\n\nexport default function ForgotPasswordPage() {\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  const { t } = useTranslation();\n  const [captchaToken, setCaptchaToken] = useState<string>(\"\");\n  const [widgetId, setWidgetId] = useState<number | null>(null);\n  const captchaContainerRef = useRef<HTMLDivElement>(null);\n\n  const { data: demoKey } = useQuery<{ sitekey: string; publicKey: string; name: string }>({\n    queryKey: [\"/api/demo/key\"],\n  });\n\n  const forgotPasswordSchema = getForgotPasswordSchema(t);\n  type ForgotPasswordData = z.infer<typeof forgotPasswordSchema>;\n\n  const form = useForm<ForgotPasswordData>({\n    resolver: zodResolver(forgotPasswordSchema),\n    defaultValues: {\n      email: \"\",\n    },\n  });\n\n  useEffect(() => {\n    const script = document.createElement('script');\n    script.src = '/proofCaptcha/api.js';\n    script.async = true;\n    script.onload = () => {\n      window.onCaptchaSuccess = (token: string) => {\n        setCaptchaToken(token);\n      };\n\n      window.onCaptchaError = (error: string) => {\n        setCaptchaToken(\"\");\n        toast({\n          variant: \"destructive\",\n          title: t('auth.captchaError'),\n          description: error,\n        });\n      };\n\n      if (window.ProofCaptcha && captchaContainerRef.current && demoKey?.sitekey) {\n        const id = window.ProofCaptcha.render(captchaContainerRef.current, {\n          sitekey: demoKey.sitekey,\n          type: 'random',\n          callback: 'onCaptchaSuccess',\n          'error-callback': 'onCaptchaError',\n        });\n        setWidgetId(id);\n      }\n    };\n\n    document.body.appendChild(script);\n\n    return () => {\n      delete window.onCaptchaSuccess;\n      delete window.onCaptchaError;\n    };\n  }, [demoKey, toast]);\n\n  const onSubmit = async (data: ForgotPasswordData) => {\n    if (!captchaToken) {\n      toast({\n        variant: \"destructive\",\n        title: t('auth.captchaRequired'),\n        description: t('auth.completeCaptcha'),\n      });\n      return;\n    }\n\n    try {\n      // Get CSRF token\n      const csrfResponse = await fetch(\"/api/security/csrf\", {\n        credentials: \"include\",\n      });\n      \n      if (!csrfResponse.ok) {\n        throw new Error(\"Failed to get CSRF token\");\n      }\n      \n      const { csrfToken } = await csrfResponse.json();\n\n      const response = await fetch(\"/api/auth/forgot-password\", {\n        method: \"POST\",\n        headers: { \n          \"Content-Type\": \"application/json\",\n          \"X-CSRF-Token\": csrfToken,\n        },\n        body: JSON.stringify({\n          email: data.email,\n          captchaToken: captchaToken,\n        }),\n        credentials: \"include\",\n      });\n\n      const result = await response.json();\n\n      if (response.ok && result.success) {\n        toast({\n          title: t('auth.codeSent'),\n          description: t('auth.codeSentDescription'),\n        });\n        \n        // Navigate to verify reset code page\n        setLocation(`/verify-reset-code?email=${encodeURIComponent(data.email)}`);\n      } else {\n        throw new Error(result.message || t('auth.failedToSendCode'));\n      }\n    } catch (error: any) {\n      console.error(\"Forgot password error:\", error);\n      toast({\n        variant: \"destructive\",\n        title: t('auth.sendCodeError'),\n        description: error.message || t('auth.sendCodeErrorDescription'),\n      });\n      \n      // Reset captcha on error\n      setCaptchaToken(\"\");\n      if (window.ProofCaptcha && widgetId !== null) {\n        window.ProofCaptcha.reset(widgetId);\n      }\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen flex items-center justify-center p-4 relative overflow-hidden\">\n      {/* Animated gradient background blobs */}\n      <div className=\"absolute inset-0 -z-10\">\n        <div className=\"absolute top-0 -left-4 w-72 h-72 sm:w-96 sm:h-96 bg-primary/30 rounded-full mix-blend-multiply filter blur-3xl opacity-70 animate-blob dark:opacity-50\" />\n        <div className=\"absolute top-0 -right-4 w-72 h-72 sm:w-96 sm:h-96 bg-purple-300/30 rounded-full mix-blend-multiply filter blur-3xl opacity-70 animate-blob animation-delay-2000 dark:opacity-50 dark:bg-purple-500/20\" />\n        <div className=\"absolute -bottom-8 left-20 w-72 h-72 sm:w-96 sm:h-96 bg-blue-300/30 rounded-full mix-blend-multiply filter blur-3xl opacity-70 animate-blob animation-delay-4000 dark:opacity-50 dark:bg-blue-500/20\" />\n      </div>\n\n      <Card className=\"w-full max-w-md relative overflow-hidden border-2 shadow-2xl backdrop-blur-sm bg-card/95\">\n        {/* Card gradient overlay */}\n        <div className=\"absolute inset-0 bg-gradient-to-br from-primary/5 to-purple-500/5 opacity-50 pointer-events-none\" />\n        \n        <CardHeader className=\"text-center space-y-2 sm:space-y-3 relative px-4 sm:px-6 pt-6\">\n          {/* Floating 3D icon */}\n          <div className=\"flex justify-center mb-3 sm:mb-4 perspective-1000\">\n            <div className=\"relative transform-gpu hover:scale-110 transition-all duration-500 floating\">\n              <div className=\"absolute inset-0 bg-gradient-to-br from-primary/50 to-purple-500/50 rounded-2xl sm:rounded-3xl blur-xl sm:blur-2xl opacity-60 animate-pulse-slow\" />\n              <div className=\"relative bg-gradient-to-br from-primary to-purple-600 p-4 sm:p-6 rounded-2xl sm:rounded-3xl shadow-2xl transform rotate-3 hover:rotate-0 transition-all duration-500\">\n                <KeyRound className=\"w-10 h-10 sm:w-12 sm:h-12 text-white drop-shadow-lg\" />\n              </div>\n            </div>\n          </div>\n          \n          <CardTitle className=\"text-xl sm:text-2xl font-bold bg-gradient-to-r from-foreground to-muted-foreground bg-clip-text text-transparent\">\n            {t('auth.forgotPasswordTitle')}\n          </CardTitle>\n          <CardDescription className=\"text-sm sm:text-base px-2\">\n            {t('auth.forgotPasswordSubtitle')}\n          </CardDescription>\n        </CardHeader>\n        <CardContent className=\"space-y-4 sm:space-y-6 relative px-4 sm:px-6 pb-6\">\n          <Form {...form}>\n            <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-3 sm:space-y-4\">\n              <FormField\n                control={form.control}\n                name=\"email\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>{t('auth.emailLabel')}</FormLabel>\n                    <FormControl>\n                      <Input\n                        {...field}\n                        type=\"email\"\n                        placeholder={t('auth.emailPlaceholderForgot')}\n                        data-testid=\"input-email\"\n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <div ref={captchaContainerRef} data-testid=\"captcha-container\"></div>\n\n              <Button\n                type=\"submit\"\n                className=\"w-full shadow-lg hover:shadow-xl transition-all duration-300\"\n                disabled={form.formState.isSubmitting}\n                data-testid=\"button-send-reset-code\"\n              >\n                {form.formState.isSubmitting ? (\n                  <>\n                    <Mail className=\"mr-2 h-4 w-4 animate-pulse\" />\n                    {t('auth.sending')}\n                  </>\n                ) : (\n                  <>\n                    <Mail className=\"mr-2 h-4 w-4\" />\n                    {t('auth.sendResetCode')}\n                  </>\n                )}\n              </Button>\n            </form>\n          </Form>\n\n          <div className=\"space-y-4\">\n            <div className=\"relative\">\n              <div className=\"absolute inset-0 flex items-center\">\n                <div className=\"w-full border-t\" />\n              </div>\n              <div className=\"relative flex justify-center text-sm\">\n                <span className=\"bg-card px-2 text-muted-foreground\">\n                  {t('auth.or')}\n                </span>\n              </div>\n            </div>\n\n            <Button\n              variant=\"outline\"\n              className=\"w-full backdrop-blur-sm\"\n              onClick={() => setLocation(\"/login\")}\n              data-testid=\"button-back-to-login\"\n            >\n              <ArrowLeft className=\"mr-2 h-4 w-4\" />\n              {t('auth.backToLogin')}\n            </Button>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":9461},"client/src/pages/ResetPasswordPage.tsx":{"content":"import { useEffect, useState } from \"react\";\nimport { useLocation } from \"wouter\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { Lock, ArrowRight, Eye, EyeOff } from \"lucide-react\";\nimport { useTranslation } from \"react-i18next\";\nimport { useMemo } from \"react\";\n\nconst createResetPasswordSchema = (t: (key: string) => string) => z.object({\n  newPassword: z.string().min(8, t('auth.passwordMinLength')),\n  confirmPassword: z.string().min(8, t('auth.passwordMinLength')),\n}).refine((data) => data.newPassword === data.confirmPassword, {\n  message: t('auth.passwordsDoNotMatch'),\n  path: [\"confirmPassword\"],\n});\n\nexport default function ResetPasswordPage() {\n  const [location, setLocation] = useLocation();\n  const { toast } = useToast();\n  const { t, i18n } = useTranslation();\n  const resetPasswordSchema = useMemo(() => createResetPasswordSchema(t), [t, i18n.language]);\n  type ResetPasswordData = z.infer<typeof resetPasswordSchema>;\n  const [showPassword, setShowPassword] = useState(false);\n  const [showConfirmPassword, setShowConfirmPassword] = useState(false);\n\n  const form = useForm<ResetPasswordData>({\n    resolver: zodResolver(resetPasswordSchema),\n    defaultValues: {\n      newPassword: \"\",\n      confirmPassword: \"\",\n    },\n  });\n\n  // Update form resolver when language changes\n  useEffect(() => {\n    form.clearErrors();\n  }, [i18n.language, form]);\n\n  const resetToken = new URLSearchParams(window.location.search).get('token');\n\n  useEffect(() => {\n    if (!resetToken) {\n      toast({\n        variant: \"destructive\",\n        title: t('auth.error'),\n        description: t('auth.invalidToken'),\n      });\n      setLocation(\"/forgot-password\");\n    }\n  }, [resetToken, setLocation, toast]);\n\n  const onSubmit = async (data: ResetPasswordData) => {\n    if (!resetToken) return;\n\n    try {\n      const csrfResponse = await fetch(\"/api/security/csrf\", {\n        credentials: \"include\",\n      });\n      const { csrfToken } = await csrfResponse.json();\n\n      const response = await fetch(\"/api/auth/reset-password\", {\n        method: \"POST\",\n        headers: { \n          \"Content-Type\": \"application/json\",\n          \"X-CSRF-Token\": csrfToken,\n        },\n        body: JSON.stringify({\n          resetToken: resetToken,\n          newPassword: data.newPassword,\n        }),\n        credentials: \"include\",\n      });\n\n      const result = await response.json();\n\n      if (result.success) {\n        toast({\n          title: t('auth.passwordResetSuccess'),\n          description: t('auth.passwordResetSuccessDesc'),\n        });\n        \n        setLocation(\"/login\");\n      } else {\n        throw new Error(result.message || t('auth.resetPasswordFailed'));\n      }\n    } catch (error: any) {\n      toast({\n        variant: \"destructive\",\n        title: t('auth.resetPasswordFailed'),\n        description: error.message || t('auth.invalidOrExpiredToken'),\n      });\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen flex items-center justify-center p-4 relative overflow-hidden\">\n      {/* Animated gradient background blobs */}\n      <div className=\"absolute inset-0 -z-10\">\n        <div className=\"absolute top-0 -left-4 w-72 h-72 sm:w-96 sm:h-96 bg-primary/30 rounded-full mix-blend-multiply filter blur-3xl opacity-70 animate-blob dark:opacity-50\" />\n        <div className=\"absolute top-0 -right-4 w-72 h-72 sm:w-96 sm:h-96 bg-purple-300/30 rounded-full mix-blend-multiply filter blur-3xl opacity-70 animate-blob animation-delay-2000 dark:opacity-50 dark:bg-purple-500/20\" />\n        <div className=\"absolute -bottom-8 left-20 w-72 h-72 sm:w-96 sm:h-96 bg-blue-300/30 rounded-full mix-blend-multiply filter blur-3xl opacity-70 animate-blob animation-delay-4000 dark:opacity-50 dark:bg-blue-500/20\" />\n      </div>\n\n      <Card className=\"w-full max-w-md relative overflow-hidden border-2 shadow-2xl backdrop-blur-sm bg-card/95\">\n        {/* Card gradient overlay */}\n        <div className=\"absolute inset-0 bg-gradient-to-br from-primary/5 to-purple-500/5 opacity-50 pointer-events-none\" />\n        \n        <CardHeader className=\"text-center space-y-2 sm:space-y-3 relative px-4 sm:px-6 pt-6\">\n          {/* Floating 3D icon */}\n          <div className=\"flex justify-center mb-3 sm:mb-4 perspective-1000\">\n            <div className=\"relative transform-gpu hover:scale-110 transition-all duration-500 floating\">\n              <div className=\"absolute inset-0 bg-gradient-to-br from-primary/50 to-purple-500/50 rounded-2xl sm:rounded-3xl blur-xl sm:blur-2xl opacity-60 animate-pulse-slow\" />\n              <div className=\"relative bg-gradient-to-br from-primary to-purple-600 p-4 sm:p-6 rounded-2xl sm:rounded-3xl shadow-2xl transform rotate-3 hover:rotate-0 transition-all duration-500\">\n                <Lock className=\"w-10 h-10 sm:w-12 sm:h-12 text-white drop-shadow-lg\" />\n              </div>\n            </div>\n          </div>\n          \n          <CardTitle className=\"text-xl sm:text-2xl font-bold bg-gradient-to-r from-foreground to-muted-foreground bg-clip-text text-transparent\">\n            {t('auth.resetPasswordTitle')}\n          </CardTitle>\n          <CardDescription className=\"text-sm sm:text-base px-2\">\n            {t('auth.resetPasswordSubtitle')}\n          </CardDescription>\n        </CardHeader>\n        <CardContent className=\"space-y-4 sm:space-y-6 relative px-4 sm:px-6 pb-6\">\n          <Form {...form}>\n            <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-3 sm:space-y-4\">\n              <FormField\n                control={form.control}\n                name=\"newPassword\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>{t('auth.newPasswordLabel')}</FormLabel>\n                    <FormControl>\n                      <div className=\"relative\">\n                        <Input\n                          {...field}\n                          type={showPassword ? \"text\" : \"password\"}\n                          placeholder={t('auth.newPasswordPlaceholder')}\n                          data-testid=\"input-new-password\"\n                        />\n                        <Button\n                          type=\"button\"\n                          variant=\"ghost\"\n                          size=\"icon\"\n                          className=\"absolute right-0 top-0 h-full\"\n                          onClick={() => setShowPassword(!showPassword)}\n                          data-testid=\"button-toggle-password\"\n                        >\n                          {showPassword ? (\n                            <EyeOff className=\"h-4 w-4\" />\n                          ) : (\n                            <Eye className=\"h-4 w-4\" />\n                          )}\n                        </Button>\n                      </div>\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={form.control}\n                name=\"confirmPassword\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>{t('auth.confirmPasswordLabel')}</FormLabel>\n                    <FormControl>\n                      <div className=\"relative\">\n                        <Input\n                          {...field}\n                          type={showConfirmPassword ? \"text\" : \"password\"}\n                          placeholder={t('auth.confirmPasswordRepeat')}\n                          data-testid=\"input-confirm-password\"\n                        />\n                        <Button\n                          type=\"button\"\n                          variant=\"ghost\"\n                          size=\"icon\"\n                          className=\"absolute right-0 top-0 h-full\"\n                          onClick={() => setShowConfirmPassword(!showConfirmPassword)}\n                          data-testid=\"button-toggle-confirm-password\"\n                        >\n                          {showConfirmPassword ? (\n                            <EyeOff className=\"h-4 w-4\" />\n                          ) : (\n                            <Eye className=\"h-4 w-4\" />\n                          )}\n                        </Button>\n                      </div>\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <Button\n                type=\"submit\"\n                className=\"w-full shadow-lg hover:shadow-xl transition-all duration-300\"\n                disabled={form.formState.isSubmitting}\n                data-testid=\"button-reset-password\"\n              >\n                {form.formState.isSubmitting ? (\n                  <>\n                    <Lock className=\"mr-2 h-4 w-4 animate-spin\" />\n                    {t('auth.resetting')}\n                  </>\n                ) : (\n                  <>\n                    {t('auth.resetPassword')}\n                    <ArrowRight className=\"ml-2 h-4 w-4\" />\n                  </>\n                )}\n              </Button>\n            </form>\n          </Form>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":9544},"scripts/setup-env.js":{"content":"#!/usr/bin/env node\n\nimport fs from 'fs';\nimport path from 'path';\nimport { fileURLToPath } from 'url';\nimport crypto from 'crypto';\n\nconst __dirname = path.dirname(fileURLToPath(import.meta.url));\nconst rootDir = path.join(__dirname, '..');\nconst envPath = path.join(rootDir, '.env');\nconst envExamplePath = path.join(rootDir, '.env.example');\n\nconsole.log('üîß ProofCaptcha Environment Setup\\n');\n\n// Check if .env already exists\nif (fs.existsSync(envPath)) {\n  console.log('‚ö†Ô∏è  File .env already exists!');\n  console.log('   If you want to recreate it, please delete the existing file first.');\n  console.log('   Or edit it manually based on .env.example\\n');\n  process.exit(0);\n}\n\n// Check if .env.example exists\nif (!fs.existsSync(envExamplePath)) {\n  console.error('‚ùå Error: .env.example not found!');\n  console.error('   Please make sure you have the .env.example file in the root directory.\\n');\n  process.exit(1);\n}\n\n// Generate secure SESSION_SECRET\nconst sessionSecret = crypto.randomBytes(32).toString('base64');\n\n// Read .env.example\nlet envContent = fs.readFileSync(envExamplePath, 'utf8');\n\n// Replace placeholder values\nenvContent = envContent.replace(\n  'SESSION_SECRET=your-secret-key-change-in-production',\n  `SESSION_SECRET=${sessionSecret}`\n);\n\n// Write to .env\nfs.writeFileSync(envPath, envContent, 'utf8');\n\nconsole.log('‚úÖ Created .env file successfully!\\n');\nconsole.log('üìù Next steps:\\n');\nconsole.log('   1. Edit .env file and fill in your SMTP credentials:');\nconsole.log('      - SMTP_PASSWORD (required for email functionality)');\nconsole.log('      - Other SMTP_* variables if needed\\n');\nconsole.log('   2. Optional: Set DATABASE_URL for PostgreSQL');\nconsole.log('      (Leave empty to use in-memory storage)\\n');\nconsole.log('   3. Start the application:');\nconsole.log('      npm run dev\\n');\nconsole.log('üîê Note: A secure SESSION_SECRET has been generated for you.\\n');\n","size_bytes":1920},"replit.md":{"content":"# ProofCaptcha\n\n## Overview\n\nProofCaptcha is an advanced proof-of-work based CAPTCHA system designed to protect websites from automated bots using cryptographic challenges. Unlike traditional image-based CAPTCHAs, ProofCaptcha employs end-to-end encryption, multiple challenge types, and sophisticated bot detection mechanisms to provide modern, privacy-focused bot protection.\n\nThe system consists of a React-based frontend dashboard for developers to manage API keys and view analytics, an Express backend API for challenge generation and verification, and embeddable JavaScript widgets for integration into third-party websites.\n\n## Recent Changes\n\n**2024-11-17:** Fixed syntax highlighting error in Integration Helper page\n- Fixed `getLanguage()` function to use correct language codes for react-syntax-highlighter\n- Changed React/Next.js frontend from 'tsx' to 'typescript' (tsx not supported)\n- Changed Vue frontend from 'vue' to 'javascript' (vue not supported)\n- This prevents syntax highlighting errors in backend/frontend code display\n\n**2024-11-17:** Added branded ProofCaptcha logo to email templates\n- Replaced simple icon with full branded SVG logo\n- Logo includes:\n  - Shield icon with checkmark\n  - \"ProofCaptcha\" text with premium typography\n  - \"ADVANCED BOT PROTECTION\" tagline\n  - Glow effect for premium feel\n  - Consistent branding across all emails\n- Logo is inline SVG (always visible, not blocked by email clients)\n- Applied to both verification and password reset emails\n\n**2024-11-17:** Redesigned email templates with modern, professional design\n- Updated verification email template with:\n  - Modern gradient background and card-based layout\n  - Premium visual design with SVG icons and decorative elements\n  - Enhanced security notices and user guidance\n  - Better mobile responsiveness\n  - Professional color scheme with purple gradients\n- Updated password reset email template with:\n  - Consistent design language with verification email\n  - Orange/amber accent colors for reset context\n  - Step-by-step action guide\n  - Enhanced security warnings\n  - Clear call-to-action elements\n- Both templates now include:\n  - Better typography hierarchy\n  - Improved spacing and readability\n  - Support email contact information\n  - Professional footer with branding\n  - Accessibility improvements for various email clients\n\n**2024-11-17:** Fixed bug in forgot password flow where URL query parameters were not being extracted correctly\n- Fixed `VerifyResetCodePage.tsx` - Changed from `location.split('?')[1]` to `window.location.search` for email parameter\n- Fixed `ResetPasswordPage.tsx` - Changed from `location.split('?')[1]` to `window.location.search` for token parameter\n- Issue: wouter's `useLocation()` hook only returns the path, not the query string, causing \"Email tidak ditemukan\" error even when backend successfully sent verification code\n\n## User Preferences\n\nPreferred communication style: Simple, everyday language.\n\n## System Architecture\n\n### Frontend Architecture\n\n**Technology Stack:**\n- React with TypeScript\n- Vite as build tool and dev server\n- Wouter for client-side routing\n- TanStack Query for server state management\n- shadcn/ui components (Radix UI primitives)\n- Tailwind CSS for styling\n- i18next for internationalization (English/Indonesian)\n\n**Key Design Decisions:**\n- **Component Library:** Uses shadcn/ui (Radix UI) for accessible, customizable UI components following the \"New York\" style preset\n- **State Management:** React Query handles all server state, eliminating the need for Redux/Zustand\n- **Routing:** Wouter provides lightweight client-side routing without React Router overhead\n- **Theming:** Custom theme system with light/dark modes using CSS variables and Tailwind\n- **Build Output:** Compiled to `dist/public` for static file serving by Express\n\n**Authentication Flow:**\n- Session-based authentication using Express session middleware\n- Email verification system with verification codes\n- Password reset functionality with time-limited codes\n- Protected routes checked via `requireAuth` middleware\n\n### Backend Architecture\n\n**Technology Stack:**\n- Node.js with Express\n- TypeScript with ES modules\n- Drizzle ORM for database access\n- Neon serverless PostgreSQL\n- bcrypt for password hashing\n- jsonwebtoken for token generation\n- nanoid for unique ID generation\n\n**Core Components:**\n\n1. **Challenge Generation System:**\n   - Multiple challenge types: checkbox, slider, grid, jigsaw, gesture, upside-down\n   - Proof-of-work challenges with adjustable difficulty\n   - Adaptive difficulty based on risk assessment\n   - Challenge data stored with expiration timestamps\n\n2. **End-to-End Encryption:**\n   - ECDH (Elliptic Curve Diffie-Hellman) key exchange using P-256 curve\n   - HKDF (HMAC-based Key Derivation Function) for deriving session keys\n   - AES-256-GCM for encrypting challenge/solution payloads\n   - Server controls encryption mode to prevent downgrade attacks\n   - Session-based key caching with automatic rotation\n\n3. **Security Layers:**\n   - **Automation Detection:** Detects headless browsers, Selenium, Puppeteer, and other automation frameworks\n   - **Device Fingerprinting:** Generates fingerprints from browser characteristics (User-Agent, Accept headers, screen resolution, canvas rendering)\n   - **Advanced Fingerprinting:** Canvas, WebGL, and audio context fingerprinting for enhanced bot detection\n   - **Behavioral Analysis:** Tracks request patterns, timing, and frequency to identify bot behavior\n   - **Risk Scoring:** Calculates risk scores from multiple signals and adjusts challenge difficulty dynamically\n   - **IP Blocking:** Automatic blocking after failed attempts with configurable thresholds and durations\n   - **Session Binding:** Binds challenge tokens to session fingerprints to prevent token theft\n   - **CSRF Protection:** Token-based CSRF protection for state-changing operations\n   - **Honeypot Detection:** Invisible form fields to catch automated submissions\n   - **Replay Attack Prevention:** Tracks used challenge tokens in memory to prevent reuse\n\n4. **API Key Management:**\n   - Public sitekey for client-side widget initialization\n   - Secret key for server-side verification\n   - Per-key security settings (encryption mode, difficulty, fingerprinting)\n   - Domain validation and CORS configuration\n   - API key status toggling (active/inactive)\n\n5. **Analytics System:**\n   - Daily aggregated analytics per API key\n   - Country-level analytics with geolocation\n   - Metrics: total challenges, successful/failed verifications, average solve time\n   - Time-series data for visualization in dashboard\n\n### Data Storage Solutions\n\n**Primary Database:**\n- PostgreSQL (via Neon serverless)\n- Drizzle ORM provides type-safe database access\n- Schema defined in `shared/schema.ts` with Zod validation\n\n**Database Tables:**\n- `developers` - Developer accounts with email verification\n- `api_keys` - API credentials and security settings\n- `challenges` - Generated challenges with expiration\n- `verifications` - Verification attempt logs\n- `analytics` - Daily aggregated statistics\n- `country_analytics` - Geographic analytics\n\n**In-Memory Caching:**\n- Session keys cache (`SessionCache` class) for ephemeral ECDH keys\n- Used challenges tracker (Map-based) for replay prevention\n- IP blocker state (Map-based) for rate limiting\n- Device fingerprint tracking (Map-based)\n- Automatic cleanup tasks run periodically to prevent memory leaks\n\n**Storage Abstraction:**\n- `IStorage` interface allows swapping between in-memory and database storage\n- `DatabaseStorage` implements persistent PostgreSQL storage\n- Fallback mechanisms when database is unavailable\n\n### Authentication and Authorization\n\n**Developer Authentication:**\n- Email/password registration with bcrypt hashing\n- Email verification via verification codes (6 digits)\n- Password reset flow with time-limited codes\n- Express session-based authentication\n- Session secret from environment variable\n\n**API Key Authentication:**\n- Public sitekey used in client-side widget\n- Secret key used for server-side verification\n- HMAC signatures bind challenges to validated domains\n- Domain validation prevents unauthorized usage\n- CORS configured to allow cross-origin captcha embedding\n\n**Security Mechanisms:**\n- Timing-safe comparison for signature verification\n- Domain normalization to prevent bypass via case manipulation\n- Challenge expiration (default 5 minutes)\n- Grace period for network latency (30 seconds)\n- Token binding to session fingerprints\n\n### External Dependencies\n\n**Database:**\n- Neon Serverless PostgreSQL\n- Connection via `DATABASE_URL` environment variable\n- WebSocket support for serverless connections\n\n**Email Service:**\n- Nodemailer for email delivery\n- SMTP configuration via environment variables:\n  - `SMTP_HOST`, `SMTP_PORT`, `SMTP_USER`, `SMTP_PASSWORD`\n  - `SMTP_FROM_EMAIL`, `SMTP_FROM_NAME`\n- Used for verification emails and password reset\n\n**Geolocation:**\n- geoip-lite for IP-based country detection\n- Fallback to external IP-API service when needed\n- Supports mapping IP addresses to country codes\n\n**Frontend Build Tools:**\n- Vite for development server and production builds\n- Replit-specific plugins for development environment\n- PostCSS with Tailwind for CSS processing\n\n**Security Libraries:**\n- crypto (Node.js built-in) for cryptographic operations\n- bcryptjs for password hashing\n- jsonwebtoken for JWT token generation\n- express-rate-limit for rate limiting\n- express-session for session management\n- cookie-parser for cookie handling\n\n**Obfuscation (Optional):**\n- javascript-obfuscator for code protection\n- Configurable obfuscation for server/client bundles\n- Backup/restore scripts for source code\n\n**Migration System:**\n- Drizzle Kit for database migrations\n- Migrations stored in `migrations/` directory\n- Automatic migration execution on startup (production)","size_bytes":9879},"client/src/lib/countries.ts":{"content":"export const COUNTRIES = [\n  { code: 'AF', name: 'Afghanistan' },\n  { code: 'AL', name: 'Albania' },\n  { code: 'DZ', name: 'Algeria' },\n  { code: 'AD', name: 'Andorra' },\n  { code: 'AO', name: 'Angola' },\n  { code: 'AG', name: 'Antigua and Barbuda' },\n  { code: 'AR', name: 'Argentina' },\n  { code: 'AM', name: 'Armenia' },\n  { code: 'AU', name: 'Australia' },\n  { code: 'AT', name: 'Austria' },\n  { code: 'AZ', name: 'Azerbaijan' },\n  { code: 'BS', name: 'Bahamas' },\n  { code: 'BH', name: 'Bahrain' },\n  { code: 'BD', name: 'Bangladesh' },\n  { code: 'BB', name: 'Barbados' },\n  { code: 'BY', name: 'Belarus' },\n  { code: 'BE', name: 'Belgium' },\n  { code: 'BZ', name: 'Belize' },\n  { code: 'BJ', name: 'Benin' },\n  { code: 'BT', name: 'Bhutan' },\n  { code: 'BO', name: 'Bolivia' },\n  { code: 'BA', name: 'Bosnia and Herzegovina' },\n  { code: 'BW', name: 'Botswana' },\n  { code: 'BR', name: 'Brazil' },\n  { code: 'BN', name: 'Brunei' },\n  { code: 'BG', name: 'Bulgaria' },\n  { code: 'BF', name: 'Burkina Faso' },\n  { code: 'BI', name: 'Burundi' },\n  { code: 'KH', name: 'Cambodia' },\n  { code: 'CM', name: 'Cameroon' },\n  { code: 'CA', name: 'Canada' },\n  { code: 'CV', name: 'Cape Verde' },\n  { code: 'CF', name: 'Central African Republic' },\n  { code: 'TD', name: 'Chad' },\n  { code: 'CL', name: 'Chile' },\n  { code: 'CN', name: 'China' },\n  { code: 'CO', name: 'Colombia' },\n  { code: 'KM', name: 'Comoros' },\n  { code: 'CG', name: 'Congo' },\n  { code: 'CR', name: 'Costa Rica' },\n  { code: 'HR', name: 'Croatia' },\n  { code: 'CU', name: 'Cuba' },\n  { code: 'CY', name: 'Cyprus' },\n  { code: 'CZ', name: 'Czech Republic' },\n  { code: 'DK', name: 'Denmark' },\n  { code: 'DJ', name: 'Djibouti' },\n  { code: 'DM', name: 'Dominica' },\n  { code: 'DO', name: 'Dominican Republic' },\n  { code: 'EC', name: 'Ecuador' },\n  { code: 'EG', name: 'Egypt' },\n  { code: 'SV', name: 'El Salvador' },\n  { code: 'GQ', name: 'Equatorial Guinea' },\n  { code: 'ER', name: 'Eritrea' },\n  { code: 'EE', name: 'Estonia' },\n  { code: 'ET', name: 'Ethiopia' },\n  { code: 'FJ', name: 'Fiji' },\n  { code: 'FI', name: 'Finland' },\n  { code: 'FR', name: 'France' },\n  { code: 'GA', name: 'Gabon' },\n  { code: 'GM', name: 'Gambia' },\n  { code: 'GE', name: 'Georgia' },\n  { code: 'DE', name: 'Germany' },\n  { code: 'GH', name: 'Ghana' },\n  { code: 'GR', name: 'Greece' },\n  { code: 'GD', name: 'Grenada' },\n  { code: 'GT', name: 'Guatemala' },\n  { code: 'GN', name: 'Guinea' },\n  { code: 'GW', name: 'Guinea-Bissau' },\n  { code: 'GY', name: 'Guyana' },\n  { code: 'HT', name: 'Haiti' },\n  { code: 'HN', name: 'Honduras' },\n  { code: 'HU', name: 'Hungary' },\n  { code: 'IS', name: 'Iceland' },\n  { code: 'IN', name: 'India' },\n  { code: 'ID', name: 'Indonesia' },\n  { code: 'IR', name: 'Iran' },\n  { code: 'IQ', name: 'Iraq' },\n  { code: 'IE', name: 'Ireland' },\n  { code: 'IL', name: 'Israel' },\n  { code: 'IT', name: 'Italy' },\n  { code: 'JM', name: 'Jamaica' },\n  { code: 'JP', name: 'Japan' },\n  { code: 'JO', name: 'Jordan' },\n  { code: 'KZ', name: 'Kazakhstan' },\n  { code: 'KE', name: 'Kenya' },\n  { code: 'KI', name: 'Kiribati' },\n  { code: 'KP', name: 'North Korea' },\n  { code: 'KR', name: 'South Korea' },\n  { code: 'KW', name: 'Kuwait' },\n  { code: 'KG', name: 'Kyrgyzstan' },\n  { code: 'LA', name: 'Laos' },\n  { code: 'LV', name: 'Latvia' },\n  { code: 'LB', name: 'Lebanon' },\n  { code: 'LS', name: 'Lesotho' },\n  { code: 'LR', name: 'Liberia' },\n  { code: 'LY', name: 'Libya' },\n  { code: 'LI', name: 'Liechtenstein' },\n  { code: 'LT', name: 'Lithuania' },\n  { code: 'LU', name: 'Luxembourg' },\n  { code: 'MK', name: 'North Macedonia' },\n  { code: 'MG', name: 'Madagascar' },\n  { code: 'MW', name: 'Malawi' },\n  { code: 'MY', name: 'Malaysia' },\n  { code: 'MV', name: 'Maldives' },\n  { code: 'ML', name: 'Mali' },\n  { code: 'MT', name: 'Malta' },\n  { code: 'MH', name: 'Marshall Islands' },\n  { code: 'MR', name: 'Mauritania' },\n  { code: 'MU', name: 'Mauritius' },\n  { code: 'MX', name: 'Mexico' },\n  { code: 'FM', name: 'Micronesia' },\n  { code: 'MD', name: 'Moldova' },\n  { code: 'MC', name: 'Monaco' },\n  { code: 'MN', name: 'Mongolia' },\n  { code: 'ME', name: 'Montenegro' },\n  { code: 'MA', name: 'Morocco' },\n  { code: 'MZ', name: 'Mozambique' },\n  { code: 'MM', name: 'Myanmar' },\n  { code: 'NA', name: 'Namibia' },\n  { code: 'NR', name: 'Nauru' },\n  { code: 'NP', name: 'Nepal' },\n  { code: 'NL', name: 'Netherlands' },\n  { code: 'NZ', name: 'New Zealand' },\n  { code: 'NI', name: 'Nicaragua' },\n  { code: 'NE', name: 'Niger' },\n  { code: 'NG', name: 'Nigeria' },\n  { code: 'NO', name: 'Norway' },\n  { code: 'OM', name: 'Oman' },\n  { code: 'PK', name: 'Pakistan' },\n  { code: 'PW', name: 'Palau' },\n  { code: 'PA', name: 'Panama' },\n  { code: 'PG', name: 'Papua New Guinea' },\n  { code: 'PY', name: 'Paraguay' },\n  { code: 'PE', name: 'Peru' },\n  { code: 'PH', name: 'Philippines' },\n  { code: 'PL', name: 'Poland' },\n  { code: 'PT', name: 'Portugal' },\n  { code: 'QA', name: 'Qatar' },\n  { code: 'RO', name: 'Romania' },\n  { code: 'RU', name: 'Russia' },\n  { code: 'RW', name: 'Rwanda' },\n  { code: 'KN', name: 'Saint Kitts and Nevis' },\n  { code: 'LC', name: 'Saint Lucia' },\n  { code: 'VC', name: 'Saint Vincent and the Grenadines' },\n  { code: 'WS', name: 'Samoa' },\n  { code: 'SM', name: 'San Marino' },\n  { code: 'ST', name: 'Sao Tome and Principe' },\n  { code: 'SA', name: 'Saudi Arabia' },\n  { code: 'SN', name: 'Senegal' },\n  { code: 'RS', name: 'Serbia' },\n  { code: 'SC', name: 'Seychelles' },\n  { code: 'SL', name: 'Sierra Leone' },\n  { code: 'SG', name: 'Singapore' },\n  { code: 'SK', name: 'Slovakia' },\n  { code: 'SI', name: 'Slovenia' },\n  { code: 'SB', name: 'Solomon Islands' },\n  { code: 'SO', name: 'Somalia' },\n  { code: 'ZA', name: 'South Africa' },\n  { code: 'SS', name: 'South Sudan' },\n  { code: 'ES', name: 'Spain' },\n  { code: 'LK', name: 'Sri Lanka' },\n  { code: 'SD', name: 'Sudan' },\n  { code: 'SR', name: 'Suriname' },\n  { code: 'SZ', name: 'Eswatini' },\n  { code: 'SE', name: 'Sweden' },\n  { code: 'CH', name: 'Switzerland' },\n  { code: 'SY', name: 'Syria' },\n  { code: 'TW', name: 'Taiwan' },\n  { code: 'TJ', name: 'Tajikistan' },\n  { code: 'TZ', name: 'Tanzania' },\n  { code: 'TH', name: 'Thailand' },\n  { code: 'TL', name: 'Timor-Leste' },\n  { code: 'TG', name: 'Togo' },\n  { code: 'TO', name: 'Tonga' },\n  { code: 'TT', name: 'Trinidad and Tobago' },\n  { code: 'TN', name: 'Tunisia' },\n  { code: 'TR', name: 'Turkey' },\n  { code: 'TM', name: 'Turkmenistan' },\n  { code: 'TV', name: 'Tuvalu' },\n  { code: 'UG', name: 'Uganda' },\n  { code: 'UA', name: 'Ukraine' },\n  { code: 'AE', name: 'United Arab Emirates' },\n  { code: 'GB', name: 'United Kingdom' },\n  { code: 'US', name: 'United States' },\n  { code: 'UY', name: 'Uruguay' },\n  { code: 'UZ', name: 'Uzbekistan' },\n  { code: 'VU', name: 'Vanuatu' },\n  { code: 'VA', name: 'Vatican City' },\n  { code: 'VE', name: 'Venezuela' },\n  { code: 'VN', name: 'Vietnam' },\n  { code: 'YE', name: 'Yemen' },\n  { code: 'ZM', name: 'Zambia' },\n  { code: 'ZW', name: 'Zimbabwe' },\n];\n","size_bytes":7049},"client/src/pages/VerifyResetCodePage.tsx":{"content":"import { useEffect } from \"react\";\nimport { useLocation } from \"wouter\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { Shield, ArrowRight, ArrowLeft } from \"lucide-react\";\nimport { useTranslation } from \"react-i18next\";\nimport { useMemo } from \"react\";\n\nconst createVerifyCodeSchema = (t: (key: string) => string) => z.object({\n  code: z.string().length(6, t('auth.resetCodeMustBe6')),\n});\n\nexport default function VerifyResetCodePage() {\n  const [location, setLocation] = useLocation();\n  const { toast } = useToast();\n  const { t, i18n } = useTranslation();\n  const verifyCodeSchema = useMemo(() => createVerifyCodeSchema(t), [t, i18n.language]);\n  type VerifyCodeData = z.infer<typeof verifyCodeSchema>;\n\n  const form = useForm<VerifyCodeData>({\n    resolver: zodResolver(verifyCodeSchema),\n    defaultValues: {\n      code: \"\",\n    },\n  });\n\n  // Update form resolver when language changes\n  useEffect(() => {\n    form.clearErrors();\n  }, [i18n.language, form]);\n\n  const email = new URLSearchParams(window.location.search).get('email');\n\n  useEffect(() => {\n    if (!email) {\n      toast({\n        variant: \"destructive\",\n        title: t('auth.error'),\n        description: t('auth.emailNotFound'),\n      });\n      setLocation(\"/forgot-password\");\n    }\n  }, [email, setLocation, toast]);\n\n  const onSubmit = async (data: VerifyCodeData) => {\n    if (!email) return;\n\n    try {\n      const csrfResponse = await fetch(\"/api/security/csrf\", {\n        credentials: \"include\",\n      });\n      const { csrfToken } = await csrfResponse.json();\n\n      const response = await fetch(\"/api/auth/verify-reset-code\", {\n        method: \"POST\",\n        headers: { \n          \"Content-Type\": \"application/json\",\n          \"X-CSRF-Token\": csrfToken,\n        },\n        body: JSON.stringify({\n          email: email,\n          code: data.code,\n        }),\n        credentials: \"include\",\n      });\n\n      const result = await response.json();\n\n      if (result.success) {\n        toast({\n          title: t('auth.codeVerified'),\n          description: t('auth.codeVerifiedDesc'),\n        });\n        \n        // Redirect ke halaman reset password dengan token\n        setLocation(`/reset-password?token=${result.resetToken}`);\n      } else {\n        throw new Error(result.message || t('auth.verificationFailed'));\n      }\n    } catch (error: any) {\n      toast({\n        variant: \"destructive\",\n        title: t('auth.verificationFailed'),\n        description: error.message || t('auth.invalidResetCode'),\n      });\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen flex items-center justify-center p-4 relative overflow-hidden\">\n      {/* Animated gradient background blobs */}\n      <div className=\"absolute inset-0 -z-10\">\n        <div className=\"absolute top-0 -left-4 w-72 h-72 sm:w-96 sm:h-96 bg-primary/30 rounded-full mix-blend-multiply filter blur-3xl opacity-70 animate-blob dark:opacity-50\" />\n        <div className=\"absolute top-0 -right-4 w-72 h-72 sm:w-96 sm:h-96 bg-purple-300/30 rounded-full mix-blend-multiply filter blur-3xl opacity-70 animate-blob animation-delay-2000 dark:opacity-50 dark:bg-purple-500/20\" />\n        <div className=\"absolute -bottom-8 left-20 w-72 h-72 sm:w-96 sm:h-96 bg-blue-300/30 rounded-full mix-blend-multiply filter blur-3xl opacity-70 animate-blob animation-delay-4000 dark:opacity-50 dark:bg-blue-500/20\" />\n      </div>\n\n      <Card className=\"w-full max-w-md relative overflow-hidden border-2 shadow-2xl backdrop-blur-sm bg-card/95\">\n        {/* Card gradient overlay */}\n        <div className=\"absolute inset-0 bg-gradient-to-br from-primary/5 to-purple-500/5 opacity-50 pointer-events-none\" />\n        \n        <CardHeader className=\"text-center space-y-2 sm:space-y-3 relative px-4 sm:px-6 pt-6\">\n          {/* Floating 3D icon */}\n          <div className=\"flex justify-center mb-3 sm:mb-4 perspective-1000\">\n            <div className=\"relative transform-gpu hover:scale-110 transition-all duration-500 floating\">\n              <div className=\"absolute inset-0 bg-gradient-to-br from-primary/50 to-purple-500/50 rounded-2xl sm:rounded-3xl blur-xl sm:blur-2xl opacity-60 animate-pulse-slow\" />\n              <div className=\"relative bg-gradient-to-br from-primary to-purple-600 p-4 sm:p-6 rounded-2xl sm:rounded-3xl shadow-2xl transform rotate-3 hover:rotate-0 transition-all duration-500\">\n                <Shield className=\"w-10 h-10 sm:w-12 sm:h-12 text-white drop-shadow-lg\" />\n              </div>\n            </div>\n          </div>\n          \n          <CardTitle className=\"text-xl sm:text-2xl font-bold bg-gradient-to-r from-foreground to-muted-foreground bg-clip-text text-transparent\">\n            {t('auth.verifyCodeTitle')}\n          </CardTitle>\n          <CardDescription className=\"text-sm sm:text-base px-2\">\n            {t('auth.verifyCodeSubtitle')} <span className=\"font-semibold text-foreground\">{email}</span>\n          </CardDescription>\n        </CardHeader>\n        <CardContent className=\"space-y-4 sm:space-y-6 relative px-4 sm:px-6 pb-6\">\n          <Form {...form}>\n            <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-3 sm:space-y-4\">\n              <FormField\n                control={form.control}\n                name=\"code\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>{t('auth.verificationCodeLabel')}</FormLabel>\n                    <FormControl>\n                      <Input\n                        {...field}\n                        placeholder={t('auth.enterCodePlaceholder')}\n                        maxLength={6}\n                        className=\"text-center text-2xl sm:text-3xl tracking-widest font-mono\"\n                        autoComplete=\"off\"\n                        data-testid=\"input-verification-code\"\n                        autoFocus\n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <div className=\"text-center text-sm text-muted-foreground\">\n                <p>{t('auth.codeExpiresIn')}</p>\n              </div>\n\n              <Button\n                type=\"submit\"\n                className=\"w-full shadow-lg hover:shadow-xl transition-all duration-300\"\n                disabled={form.formState.isSubmitting}\n                data-testid=\"button-verify-code\"\n              >\n                {form.formState.isSubmitting ? (\n                  <>\n                    <Shield className=\"mr-2 h-4 w-4 animate-pulse\" />\n                    {t('auth.verifying')}\n                  </>\n                ) : (\n                  <>\n                    {t('auth.verifyCodeTitle')}\n                    <ArrowRight className=\"ml-2 h-4 w-4\" />\n                  </>\n                )}\n              </Button>\n            </form>\n          </Form>\n\n          <div className=\"space-y-4\">\n            <div className=\"relative\">\n              <div className=\"absolute inset-0 flex items-center\">\n                <div className=\"w-full border-t\" />\n              </div>\n              <div className=\"relative flex justify-center text-sm\">\n                <span className=\"bg-card px-2 text-muted-foreground\">\n                  {t('auth.or')}\n                </span>\n              </div>\n            </div>\n\n            <Button\n              variant=\"outline\"\n              className=\"w-full backdrop-blur-sm\"\n              onClick={() => setLocation(\"/forgot-password\")}\n              data-testid=\"button-back-to-forgot\"\n            >\n              <ArrowLeft className=\"mr-2 h-4 w-4\" />\n              {t('auth.backToForgotPassword')}\n            </Button>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":8148}},"version":2}